<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting</title>
<link href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting" property="og:title"/>
<meta content="It can be difficult when starting out on a new predictive modeling project with neural networks. There is so much to configure, and no clear idea where to start. It is important to be systematic. You can break bad assumptions and quickly hone in on configurations that work and areas for further investigation likely to …" property="og:description"/>
<meta content="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Time Series" property="article:section"/>
<meta content="2017-04-25T19:00:24+00:00" property="article:published_time"/>
<meta content="2018-08-30T00:26:47+00:00" property="article:modified_time"/>
<meta content="2018-08-30T00:26:47+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Exploratory-Configuration-of-a-Multilayer-Perceptron-Network-for-Time-Series-Forecasting.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Exploratory-Configuration-of-a-Multilayer-Perceptron-Network-for-Time-Series-Forecasting.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="427" property="og:image:height"/>
<meta content="Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/feed/" rel="alternate" title="Machine Learning Mastery » Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=3943" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fexploratory-configuration-multilayer-perceptron-network-time-series-forecasting%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fexploratory-configuration-multilayer-perceptron-network-time-series-forecasting%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-3943 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-53"> <div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-3943 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
<header>
<h1 class="title entry-title">Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-04-26T05:00:24+1100">April 26, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-3943 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=Exploratory+Configuration+of+a+Multilayer+Perceptron+Network+for+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>It can be difficult when starting out on a new predictive modeling project with neural networks.</p>
<p>There is so much to configure, and no clear idea where to start.</p>
<p>It is important to be systematic. You can break bad assumptions and quickly hone in on configurations that work and areas for further investigation likely to payoff.</p>
<p>In this tutorial, you will discover how to use exploratory configuration of multilayer perceptron (MLP) neural networks to find good first-cut models for time series forecasting.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to design a robust experimental test harness to evaluate MLP models for time series forecasting.</li>
<li>Systematic experimental designs for varying epochs, neurons, and lag configurations.</li>
<li>How to interpret results and use diagnostics to learn more about well-performing models.</li>
</ul>
<p>Let’s get started.</p>
<ul>
<li><strong>Update July/2017</strong>: Changed function for creating models to be more descriptive.</li>
</ul>
<p> </p>
<div class="wp-caption aligncenter" id="attachment_3951" style="width: 650px"><img alt="Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting" class="size-full wp-image-3951" height="427" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Exploratory-Configuration-of-a-Multilayer-Perceptron-Network-for-Time-Series-Forecasting.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Exploratory-Configuration-of-a-Multilayer-Perceptron-Network-for-Time-Series-Forecasting.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Exploratory-Configuration-of-a-Multilayer-Perceptron-Network-for-Time-Series-Forecasting-300x200.jpg 300w" width="640"/><p class="wp-caption-text">Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting<br/>Photo by <a href="https://www.flickr.com/photos/lox/33885582/">Lachlan Donald</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is broken down into 6 parts. They are:</p>
<ol>
<li>Shampoo Sales Dataset</li>
<li>Experimental Test Harness</li>
<li>Vary Training Epochs</li>
<li>Vary Hidden Layer Neurons</li>
<li>Vary Hidden Layer Neurons with Lag</li>
<li>Review of Results</li>
</ol>
<h3>Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this example.</p>
<p>This tutorial assumes you have Keras v2.0 or higher installed with either the TensorFlow or Theano backend.</p>
<p>This tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>Next, let’s take a look at a standard time series forecasting problem that we can use as context for this experiment.</p>
<p>If you need help setting up your Python environment, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<h2>Shampoo Sales Dataset</h2>
<p>This dataset describes the monthly number of sales of shampoo over a 3-year period.</p>
<p>The units are a sales count and there are 36 observations. The original dataset is credited to Makridakis, Wheelwright, and Hyndman (1998).</p>
<p><a href="https://datamarket.com/data/set/22r0/sales-of-shampoo-over-a-three-year-period">You can download and learn more about the dataset here</a>.</p>
<p>The example below loads and creates a plot of the loaded dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2d1781943328" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load and plot dataset
from pandas import read_csv
from pandas import datetime
from matplotlib import pyplot
# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# summarize first few rows
print(series.head())
# line plot
series.plot()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d1781943328-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d1781943328-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d1781943328-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d1781943328-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d1781943328-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d1781943328-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d1781943328-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d1781943328-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d1781943328-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d1781943328-10">10</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d1781943328-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d1781943328-12">12</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d1781943328-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2d1781943328-1"><span class="crayon-p"># load and plot dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d1781943328-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2d1781943328-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d1781943328-4"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2d1781943328-5"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d1781943328-6"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2d1781943328-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d1781943328-8"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2d1781943328-9"><span class="crayon-p"># summarize first few rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d1781943328-10"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2d1781943328-11"><span class="crayon-p"># line plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d1781943328-12"><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2d1781943328-13"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Running the example loads the dataset as a Pandas Series and prints the first 5 rows.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2d9250768202" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month
1901-01-01 266.0
1901-02-01 145.9
1901-03-01 183.1
1901-04-01 119.3
1901-05-01 180.3
Name: Sales, dtype: float64</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d9250768202-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d9250768202-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d9250768202-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d9250768202-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d9250768202-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2d9250768202-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2d9250768202-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2d9250768202-1">Month</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d9250768202-2">1901-01-01 266.0</div><div class="crayon-line" id="crayon-5c0c9c2c9d2d9250768202-3">1901-02-01 145.9</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d9250768202-4">1901-03-01 183.1</div><div class="crayon-line" id="crayon-5c0c9c2c9d2d9250768202-5">1901-04-01 119.3</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2d9250768202-6">1901-05-01 180.3</div><div class="crayon-line" id="crayon-5c0c9c2c9d2d9250768202-7">Name: Sales, dtype: float64</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A line plot of the series is then created showing a clear increasing trend.</p>
<div class="wp-caption aligncenter" id="attachment_3901" style="width: 650px"><img alt="Line Plot of Shampoo Sales Dataset" class="size-full wp-image-3901" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of Shampoo Sales Dataset</p></div>
<p>Next, we will take a look at the model configuration and test harness used in the experiment.</p>
<h2>Experimental Test Harness</h2>
<p>This section describes the test harness used in this tutorial.</p>
<h3>Data Split</h3>
<p>We will split the Shampoo Sales dataset into two parts: a training and a test set.</p>
<p>The first two years of data will be taken for the training dataset and the remaining one year of data will be used for the test set.</p>
<p>Models will be developed using the training dataset and will make predictions on the test dataset.</p>
<p>The persistence forecast (naive forecast) on the test dataset achieves an error of 136.761 monthly shampoo sales. This provides a lower acceptable bound of performance on the test set.</p>
<h3>Model Evaluation</h3>
<p>A rolling-forecast scenario will be used, also called walk-forward model validation.</p>
<p>Each time step of the test dataset will be walked one at a time. A model will be used to make a forecast for the time step, then the actual expected value from the test set will be taken and made available to the model for the forecast on the next time step.</p>
<p>This mimics a real-world scenario where new Shampoo Sales observations would be available each month and used in the forecasting of the following month.</p>
<p>This will be simulated by the structure of the train and test datasets.</p>
<p>All forecasts on the test dataset will be collected and an error score calculated to summarize the skill of the model. The root mean squared error (RMSE) will be used as it punishes large errors and results in a score that is in the same units as the forecast data, namely monthly shampoo sales.</p>
<h3>Data Preparation</h3>
<p>Before we can fit an MLP model to the dataset, we must transform the data.</p>
<p>The following three data transforms are performed on the dataset prior to fitting a model and making a forecast.</p>
<ol>
<li><strong>Transform the time series data so that it is stationary</strong>. Specifically, a lag=1 differencing to remove the increasing trend in the data.</li>
<li><strong>Transform the time series into a supervised learning problem</strong>. Specifically, the organization of data into input and output patterns where the observation at the previous time step is used as an input to forecast the observation at the current timestep</li>
<li><strong>Transform the observations to have a specific scale</strong>. Specifically, to rescale the data to values between -1 and 1.</li>
</ol>
<p>These transforms are inverted on forecasts to return them into their original scale before calculating and error score.</p>
<h3>MLP Model</h3>
<p>We will use a base MLP model with 1 neuron hidden layer, a rectified linear activation function on hidden neurons, and linear activation function on output neurons.</p>
<p>A batch size of 4 is used where possible, with the training data truncated to ensure the number of patterns is divisible by 4. In some cases a batch size of 2 is used.</p>
<p>Normally, the training dataset is shuffled after each batch or each epoch, which can aid in fitting the training dataset on classification and regression problems. Shuffling was turned off for all experiments as it seemed to result in better performance. More studies are needed to confirm this result for time series forecasting.</p>
<p>The model will be fit using the efficient ADAM optimization algorithm and the mean squared error loss function.</p>
<h3>Experimental Runs</h3>
<p>Each experimental scenario will be run 30 times and the RMSE score on the test set will be recorded from the end each run.</p>
<p>Let’s dive into the experiments.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Download Your FREE Mini-Course</a><script data-config="%7B%7D" data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Vary Training Epochs</h2>
<p>In this first experiment, we will investigate varying the number of training epochs for a simple MLP with one hidden layer and one neuron in the hidden layer.</p>
<p>We will use a batch size of 4 and evaluate training epochs 50, 100, 500, 1000, and 2000.</p>
<p>The complete code listing is provided below.</p>
<p>This code listing will be used as the basis for all following experiments, with only the changes to this code provided in subsequent sections.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2dc290099956" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import Series
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import MinMaxScaler
from keras.models import Sequential
from keras.layers import Dense
from math import sqrt
import matplotlib
# be able to save images on server
matplotlib.use('Agg')
from matplotlib import pyplot
import numpy

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	return df

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# invert differenced value
def inverse_difference(history, yhat, interval=1):
	return yhat + history[-interval]

# scale train and test data to [-1, 1]
def scale(train, test):
	# fit scaler
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaler = scaler.fit(train)
	# transform train
	train = train.reshape(train.shape[0], train.shape[1])
	train_scaled = scaler.transform(train)
	# transform test
	test = test.reshape(test.shape[0], test.shape[1])
	test_scaled = scaler.transform(test)
	return scaler, train_scaled, test_scaled

# inverse scaling for a forecasted value
def invert_scale(scaler, X, yhat):
	new_row = [x for x in X] + [yhat]
	array = numpy.array(new_row)
	array = array.reshape(1, len(array))
	inverted = scaler.inverse_transform(array)
	return inverted[0, -1]

# fit an MLP network to training data
def fit_model(train, batch_size, nb_epoch, neurons):
	X, y = train[:, 0:-1], train[:, -1]
	model = Sequential()
	model.add(Dense(neurons, activation='relu', input_dim=X.shape[1]))
	model.add(Dense(1))
	model.compile(loss='mean_squared_error', optimizer='adam')
	model.fit(X, y, epochs=nb_epoch, batch_size=batch_size, verbose=0, shuffle=False)
	return model

# run a repeated experiment
def experiment(repeats, series, epochs, lag, neurons):
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, lag)
	supervised_values = supervised.values[lag:,:]
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# run experiment
	error_scores = list()
	for r in range(repeats):
		# fit the model
		batch_size = 4
		train_trimmed = train_scaled[2:, :]
		model = fit_model(train_trimmed, batch_size, epochs, neurons)
		# forecast test dataset
		test_reshaped = test_scaled[:,0:-1]
		output = model.predict(test_reshaped, batch_size=batch_size)
		predictions = list()
		for i in range(len(output)):
			yhat = output[i,0]
			X = test_scaled[i, 0:-1]
			# invert scaling
			yhat = invert_scale(scaler, X, yhat)
			# invert differencing
			yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
			# store forecast
			predictions.append(yhat)
		# report performance
		rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
		print('%d) Test RMSE: %.3f' % (r+1, rmse))
		error_scores.append(rmse)
	return error_scores

# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# experiment
repeats = 30
results = DataFrame()
lag = 1
neurons = 1
# vary training epochs
epochs = [50, 100, 500, 1000, 2000]
for e in epochs:
	results[str(e)] = experiment(repeats, series, e, lag, neurons)
# summarize results
print(results.describe())
# save boxplot
results.boxplot()
pyplot.savefig('boxplot_epochs.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-10">10</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-12">12</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-14">14</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-16">16</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-18">18</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-20">20</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-22">22</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-24">24</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-26">26</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-28">28</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-30">30</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-32">32</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-34">34</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-36">36</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-38">38</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-40">40</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-42">42</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-44">44</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-46">46</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-48">48</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-50">50</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-52">52</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-54">54</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-56">56</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-58">58</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-60">60</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-62">62</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-64">64</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-66">66</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-68">68</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-70">70</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-72">72</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-74">74</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-76">76</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-78">78</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-80">80</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-82">82</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-84">84</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-86">86</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-88">88</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-90">90</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-92">92</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-94">94</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-96">96</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-98">98</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-100">100</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-102">102</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-104">104</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-106">106</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-108">108</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-110">110</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-112">112</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-114">114</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-116">116</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-118">118</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-120">120</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-122">122</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2dc290099956-124">124</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2dc290099956-125">125</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-10"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-11"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-12"><span class="crayon-p"># be able to save images on server</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-13"><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-s">'Agg'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-14"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-15"><span class="crayon-e">import </span><span class="crayon-v">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-16"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-17"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-18"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-20"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-21"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-22"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-23"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-24"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-25"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-26"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-28"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-29"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-30"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-31"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-32"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-33"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-34"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-36"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-37"><span class="crayon-p"># invert differenced value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-38"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-39"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-40"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-41"><span class="crayon-p"># scale train and test data to [-1, 1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-42"><span class="crayon-e">def </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-43"><span class="crayon-h"> </span><span class="crayon-p"># fit scaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-44"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-45"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-46"><span class="crayon-h"> </span><span class="crayon-p"># transform train</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-47"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-48"><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-49"><span class="crayon-h"> </span><span class="crayon-p"># transform test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-50"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-51"><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-52"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-53"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-54"><span class="crayon-p"># inverse scaling for a forecasted value</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-55"><span class="crayon-e">def </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-56"><span class="crayon-h"> </span><span class="crayon-v">new_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">yhat</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-57"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">new_row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-58"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-59"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-60"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-61"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-62"><span class="crayon-p"># fit an MLP network to training data</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-63"><span class="crayon-e">def </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-64"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-65"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-66"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-67"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-68"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-69"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-70"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-71"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-72"><span class="crayon-p"># run a repeated experiment</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-73"><span class="crayon-e">def </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-74"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-75"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-76"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-77"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-78"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-79"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">lag</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-80"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-81"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-82"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-83"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-84"><span class="crayon-h"> </span><span class="crayon-p"># run experiment</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-85"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-86"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-87"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-88"><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-89"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-90"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-91"><span class="crayon-h"> </span><span class="crayon-p"># forecast test dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-92"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-93"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-94"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-95"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-96"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-97"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-98"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-99"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-100"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-101"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-102"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-103"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-104"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-105"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-106"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-107"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-108"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error_scores</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-109"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-110"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-111"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-112"><span class="crayon-p"># experiment</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-113"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-114"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-115"><span class="crayon-v">lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-116"><span class="crayon-v">neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-117"><span class="crayon-p"># vary training epochs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-118"><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2000</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-119"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-120"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-121"><span class="crayon-p"># summarize results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-122"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">describe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-123"><span class="crayon-p"># save boxplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2dc290099956-124"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2dc290099956-125"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'boxplot_epochs.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0067 seconds] -->
<p>Running the experiment prints the test set RMSE at the end of each experimental run.</p>
<p>At the end of all runs, a table of summary statistics is provided, one row for each statistic and one configuration for each column.</p>
<p>The summary statistics suggest that on average 1000 training epochs resulted in the better performance with a general decreasing trend in error with the increase of training epochs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2e1266472581" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
               50         100         500        1000        2000
count   30.000000   30.000000   30.000000   30.000000   30.000000
mean   129.660167  129.388944  111.444027  103.821703  107.500301
std     30.926344   28.499592   23.181317   22.138705   24.780781
min     94.598957   94.184903   89.506815   86.511801   86.452041
25%    105.198414  105.722736   90.679930   90.058655   86.457260
50%    129.705407  127.449491   93.508245   90.118331   90.074494
75%    141.420145  149.625816  136.157299  135.510850  135.741340
max    198.716220  198.704352  141.226816  139.994388  142.097747</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e1266472581-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e1266472581-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e1266472581-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e1266472581-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e1266472581-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e1266472581-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e1266472581-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e1266472581-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e1266472581-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2e1266472581-1">               50         100         500        1000        2000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e1266472581-2">count   30.000000   30.000000   30.000000   30.000000   30.000000</div><div class="crayon-line" id="crayon-5c0c9c2c9d2e1266472581-3">mean   129.660167  129.388944  111.444027  103.821703  107.500301</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e1266472581-4">std     30.926344   28.499592   23.181317   22.138705   24.780781</div><div class="crayon-line" id="crayon-5c0c9c2c9d2e1266472581-5">min     94.598957   94.184903   89.506815   86.511801   86.452041</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e1266472581-6">25%    105.198414  105.722736   90.679930   90.058655   86.457260</div><div class="crayon-line" id="crayon-5c0c9c2c9d2e1266472581-7">50%    129.705407  127.449491   93.508245   90.118331   90.074494</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e1266472581-8">75%    141.420145  149.625816  136.157299  135.510850  135.741340</div><div class="crayon-line" id="crayon-5c0c9c2c9d2e1266472581-9">max    198.716220  198.704352  141.226816  139.994388  142.097747</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A box and whisker plot of the distribution of test RMSE scores for each configuration was also created and saved to file.</p>
<p>The plot highlights that each configuration shows the same general spread in test RMSE scores (box), with the median (green line) trending downward with the increase of training epochs.</p>
<p>The results confirm that the configured MLP trained for 1000 is a good starting point on this problem.</p>
<div class="wp-caption aligncenter" id="attachment_3944" style="width: 650px"><img alt="Box and Whisker Plot of Vary Training Epochs for Time Series Forecasting on the Shampoo Sales Dataset" class="size-full wp-image-3944" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Vary-Training-Epochs-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Vary-Training-Epochs-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Vary-Training-Epochs-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Box and Whisker Plot of Varying Training Epochs for Time Series Forecasting on the Shampoo Sales Dataset</p></div>
<p>Another angle to consider with a network configuration is how it behaves over time as the model is being fit.</p>
<p>We can evaluate the model on the training and test datasets after each training epoch to get an idea as to if the configuration is overfitting or underfitting the problem.</p>
<p>We will use this diagnostic approach on the top result from each set of experiments. A total of 10 repeats of the configuration will be run and the train and test RMSE scores after each training epoch plotted on a line plot.</p>
<p>In this case, we will use this diagnostic on the MLP fit for 1000 epochs.</p>
<p>The complete diagnostic code listing is provided below.</p>
<p>As with the previous code listing, the code listing below will be used as the basis for all diagnostics in this tutorial and only the changes to this listing will be provided in subsequent sections.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2e5501783967" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import Series
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import MinMaxScaler
from keras.models import Sequential
from keras.layers import Dense
from math import sqrt
import matplotlib
# be able to save images on server
matplotlib.use('Agg')
from matplotlib import pyplot
import numpy

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	df = df.drop(0)
	return df

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# scale train and test data to [-1, 1]
def scale(train, test):
	# fit scaler
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaler = scaler.fit(train)
	# transform train
	train = train.reshape(train.shape[0], train.shape[1])
	train_scaled = scaler.transform(train)
	# transform test
	test = test.reshape(test.shape[0], test.shape[1])
	test_scaled = scaler.transform(test)
	return scaler, train_scaled, test_scaled

# inverse scaling for a forecasted value
def invert_scale(scaler, X, yhat):
	new_row = [x for x in X] + [yhat]
	array = numpy.array(new_row)
	array = array.reshape(1, len(array))
	inverted = scaler.inverse_transform(array)
	return inverted[0, -1]

# evaluate the model on a dataset, returns RMSE in transformed units
def evaluate(model, raw_data, scaled_dataset, scaler, offset, batch_size):
	# separate
	X, y = scaled_dataset[:,0:-1], scaled_dataset[:,-1]
	# forecast dataset
	output = model.predict(X, batch_size=batch_size)
	# invert data transforms on forecast
	predictions = list()
	for i in range(len(output)):
		yhat = output[i,0]
		# invert scaling
		yhat = invert_scale(scaler, X[i], yhat)
		# invert differencing
		yhat = yhat + raw_data[i]
		# store forecast
		predictions.append(yhat)
	# report performance
	rmse = sqrt(mean_squared_error(raw_data[1:], predictions))
	return rmse

# fit an MLP network to training data
def fit(train, test, raw, scaler, batch_size, nb_epoch, neurons):
	X, y = train[:, 0:-1], train[:, -1]
	# prepare model
	model = Sequential()
	model.add(Dense(neurons, activation='relu', input_dim=X.shape[1]))
	model.add(Dense(1))
	model.compile(loss='mean_squared_error', optimizer='adam')
	# fit model
	train_rmse, test_rmse = list(), list()
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)
		# evaluate model on train data
		raw_train = raw[-(len(train)+len(test)+1):-len(test)]
		train_rmse.append(evaluate(model, raw_train, train, scaler, 0, batch_size))
		# evaluate model on test data
		raw_test = raw[-(len(test)+1):]
		test_rmse.append(evaluate(model, raw_test, test, scaler, 0, batch_size))
	history = DataFrame()
	history['train'], history['test'] = train_rmse, test_rmse
	return history

# run diagnostic experiments
def run():
	# config
	repeats = 10
	n_batch = 4
	n_epochs = 1000
	n_neurons = 1
	n_lag = 1
	# load dataset
	series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, n_lag)
	supervised_values = supervised.values[n_lag:,:]
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# fit and evaluate model
	train_trimmed = train_scaled[2:, :]
	# run diagnostic tests
	for i in range(repeats):
		history = fit(train_trimmed, test_scaled, raw_values, scaler, n_batch, n_epochs, n_neurons)
		pyplot.plot(history['train'], color='blue')
		pyplot.plot(history['test'], color='orange')
		print('%d) TrainRMSE=%f, TestRMSE=%f' % (i, history['train'].iloc[-1], history['test'].iloc[-1]))
	pyplot.savefig('diagnostic_epochs.png')

# entry point
run()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-10">10</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-12">12</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-14">14</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-16">16</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-18">18</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-20">20</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-22">22</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-24">24</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-26">26</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-28">28</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-30">30</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-32">32</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-34">34</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-36">36</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-38">38</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-40">40</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-42">42</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-44">44</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-46">46</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-48">48</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-50">50</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-52">52</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-54">54</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-56">56</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-58">58</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-60">60</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-62">62</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-64">64</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-66">66</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-68">68</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-70">70</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-72">72</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-74">74</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-76">76</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-78">78</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-80">80</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-82">82</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-84">84</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-86">86</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-88">88</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-90">90</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-92">92</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-94">94</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-96">96</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-98">98</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-100">100</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-102">102</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-104">104</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-106">106</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-108">108</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-110">110</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-112">112</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-114">114</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-116">116</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-118">118</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-120">120</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-122">122</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-124">124</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-126">126</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-128">128</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-130">130</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e5501783967-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e5501783967-132">132</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-10"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-11"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-12"><span class="crayon-p"># be able to save images on server</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-13"><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-s">'Agg'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-14"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-15"><span class="crayon-e">import </span><span class="crayon-v">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-16"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-17"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-18"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-20"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-21"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-22"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-23"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-24"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-25"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-26"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-27"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">drop</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-30"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-31"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-32"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-33"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-34"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-35"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-38"><span class="crayon-p"># scale train and test data to [-1, 1]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-39"><span class="crayon-e">def </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-40"><span class="crayon-h"> </span><span class="crayon-p"># fit scaler</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-41"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-42"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-43"><span class="crayon-h"> </span><span class="crayon-p"># transform train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-44"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-45"><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-46"><span class="crayon-h"> </span><span class="crayon-p"># transform test</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-47"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-48"><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-49"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-50"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-51"><span class="crayon-p"># inverse scaling for a forecasted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-52"><span class="crayon-e">def </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-53"><span class="crayon-h"> </span><span class="crayon-v">new_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">yhat</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-54"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">new_row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-55"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-56"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-57"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-58"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-59"><span class="crayon-p"># evaluate the model on a dataset, returns RMSE in transformed units</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-60"><span class="crayon-e">def </span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaled_dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-61"><span class="crayon-h"> </span><span class="crayon-p"># separate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-62"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaled_dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaled_dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-63"><span class="crayon-h"> </span><span class="crayon-p"># forecast dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-64"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-65"><span class="crayon-h"> </span><span class="crayon-p"># invert data transforms on forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-66"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-67"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-68"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-69"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-70"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-71"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-72"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">raw_data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-73"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-74"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-75"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-76"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-77"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-78"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-79"><span class="crayon-p"># fit an MLP network to training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-80"><span class="crayon-e">def </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-81"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-82"><span class="crayon-h"> </span><span class="crayon-p"># prepare model</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-83"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-84"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-85"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-86"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-87"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-88"><span class="crayon-h"> </span><span class="crayon-v">train_rmse</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-89"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-90"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-91"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model on train data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-92"><span class="crayon-h"> </span><span class="crayon-v">raw_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-93"><span class="crayon-h"> </span><span class="crayon-v">train_rmse</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-94"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model on test data</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-95"><span class="crayon-h"> </span><span class="crayon-v">raw_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-96"><span class="crayon-h"> </span><span class="crayon-v">test_rmse</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-97"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-98"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_rmse</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">test_rmse</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-99"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-100"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-101"><span class="crayon-p"># run diagnostic experiments</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-102"><span class="crayon-e">def </span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-103"><span class="crayon-h"> </span><span class="crayon-p"># config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-104"><span class="crayon-h"> </span><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-105"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-106"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-107"><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-108"><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-109"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-110"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-111"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-112"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-113"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-114"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-115"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-116"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-117"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-118"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-119"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-120"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-121"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-122"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-123"><span class="crayon-h"> </span><span class="crayon-p"># run diagnostic tests</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-124"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-125"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-126"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'blue'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-127"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'orange'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-128"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) TrainRMSE=%f, TestRMSE=%f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-129"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'diagnostic_epochs.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-130"> </div><div class="crayon-line" id="crayon-5c0c9c2c9d2e5501783967-131"><span class="crayon-p"># entry point</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e5501783967-132"><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0076 seconds] -->
<p>Running the diagnostic prints the final train and test RMSE for each run. More interesting is the final line plot created.</p>
<p>The line plot shows the train RMSE (blue) and test RMSE (orange) after each training epoch.</p>
<p>In this case, the diagnostic plot shows little difference in train and test RMSE after about 400 training epochs. Both train and test performance level out on a near flat line.</p>
<p>This rapid leveling out suggests the model is reaching capacity and may benefit from more information in terms of lag observations or additional neurons.</p>
<div class="wp-caption aligncenter" id="attachment_3945" style="width: 650px"><img alt="Diagnostic Line Plot of Train and Test Performance of 400 Epochs on the Shampoo Sales Dataset" class="size-full wp-image-3945" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-400-Epochs-on-the-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-400-Epochs-on-the-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-400-Epochs-on-the-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Line Plot of Train and Test Performance of 1000 Epochs on the Shampoo Sales Dataset</p></div>
<h2>Vary Hidden Layer Neurons</h2>
<p>In this section, we will look at varying the number of neurons in the single hidden layer.</p>
<p>Increasing the number of neurons can increase the learning capacity of the network at the risk of overfitting the training data.</p>
<p>We will explore increasing the number of neurons from 1 to 5 and fit the network for 1000 epochs.</p>
<p>The differences in the experiment script are listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2e8442430586" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# experiment
repeats = 30
results = DataFrame()
lag = 1
epochs = 1000
# vary neurons
neurons = [1, 2, 3, 4, 5]
for n in neurons:
	results[str(n)] = experiment(repeats, series, epochs, lag, n)
# summarize results
print(results.describe())
# save boxplot
results.boxplot()
pyplot.savefig('boxplot_neurons.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-10">10</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-12">12</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-14">14</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2e8442430586-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2e8442430586-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-1"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-2"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-3"><span class="crayon-p"># experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-4"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-5"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-6"><span class="crayon-v">lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-7"><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-8"><span class="crayon-p"># vary neurons</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-9"><span class="crayon-v">neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-10"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-11"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-12"><span class="crayon-p"># summarize results</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-13"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">describe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-14"><span class="crayon-p"># save boxplot</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2e8442430586-15"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2e8442430586-16"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'boxplot_neurons.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Running the experiment prints summary statistics for each configuration.</p>
<p>Looking at the average performance, it suggests a decrease of test RMSE with an increase in the number of neurons in the single hidden layer.</p>
<p>The best results appear to be with 3 neurons.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2ec082795095" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
                1           2           3           4           5
count   30.000000   30.000000   30.000000   30.000000   30.000000
mean   105.107026  102.836520   92.675912   94.889952   96.577617
std     23.130824   20.102353   10.266732    9.751318    6.421356
min     86.565630   84.199871   83.388967   84.385293   87.208454
25%     88.035396   89.386670   87.643954   89.154866   89.961809
50%     90.084895   91.488484   90.670565   91.204303   96.717739
75%    136.145248  104.416518   93.117926  100.228730  101.969331
max    143.428154  140.923087  136.883946  135.891663  106.797563</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ec082795095-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ec082795095-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ec082795095-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ec082795095-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ec082795095-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ec082795095-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ec082795095-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ec082795095-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ec082795095-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2ec082795095-1">                1           2           3           4           5</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ec082795095-2">count   30.000000   30.000000   30.000000   30.000000   30.000000</div><div class="crayon-line" id="crayon-5c0c9c2c9d2ec082795095-3">mean   105.107026  102.836520   92.675912   94.889952   96.577617</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ec082795095-4">std     23.130824   20.102353   10.266732    9.751318    6.421356</div><div class="crayon-line" id="crayon-5c0c9c2c9d2ec082795095-5">min     86.565630   84.199871   83.388967   84.385293   87.208454</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ec082795095-6">25%     88.035396   89.386670   87.643954   89.154866   89.961809</div><div class="crayon-line" id="crayon-5c0c9c2c9d2ec082795095-7">50%     90.084895   91.488484   90.670565   91.204303   96.717739</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ec082795095-8">75%    136.145248  104.416518   93.117926  100.228730  101.969331</div><div class="crayon-line" id="crayon-5c0c9c2c9d2ec082795095-9">max    143.428154  140.923087  136.883946  135.891663  106.797563</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A box and whisker plot is also created to summarize and compare the distributions of results.</p>
<p>The plot confirms the suggestion of 3 neurons performing well compared to the other configurations and suggests in addition that the spread of results is also smaller. This may indicate a more stable configuration.</p>
<div class="wp-caption aligncenter" id="attachment_3946" style="width: 650px"><img alt="Box and Whisker Plot of Varying Hidden Neurons for Time Series Forecasting on the Shampoo Sales Dataset" class="size-full wp-image-3946" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Varying-Hidden-Neurons-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Varying-Hidden-Neurons-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Varying-Hidden-Neurons-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Box and Whisker Plot of Varying Hidden Neurons for Time Series Forecasting on the Shampoo Sales Dataset</p></div>
<p>Again, we can dive a little deeper by reviewing diagnostics of the chosen configuration of 3 neurons fit for 1000 epochs.</p>
<p>The changes to the diagnostic script are limited to the <em>run()</em> function and listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2ee807716129" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# run diagnostic experiments
def run():
	# config
	repeats = 10
	n_batch = 4
	n_epochs = 1000
	n_neurons = 3
	n_lag = 1
	# load dataset
	series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, n_lag)
	supervised_values = supervised.values[n_lag:,:]
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# fit and evaluate model
	train_trimmed = train_scaled[2:, :]
	# run diagnostic tests
	for i in range(repeats):
		history = fit(train_trimmed, test_scaled, raw_values, scaler, n_batch, n_epochs, n_neurons)
		pyplot.plot(history['train'], color='blue')
		pyplot.plot(history['test'], color='orange')
		print('%d) TrainRMSE=%f, TestRMSE=%f' % (i, history['train'].iloc[-1], history['test'].iloc[-1]))
	pyplot.savefig('diagnostic_neurons.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-10">10</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-12">12</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-14">14</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-16">16</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-18">18</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-20">20</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-22">22</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-24">24</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-26">26</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2ee807716129-28">28</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2ee807716129-29">29</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-1"><span class="crayon-p"># run diagnostic experiments</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-2"><span class="crayon-e">def </span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-3"><span class="crayon-h"> </span><span class="crayon-p"># config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-4"><span class="crayon-h"> </span><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-5"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-6"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-7"><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-8"><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-9"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-10"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-11"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-12"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-13"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-14"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-15"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-16"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-17"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-18"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-19"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-20"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-21"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-22"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-23"><span class="crayon-h"> </span><span class="crayon-p"># run diagnostic tests</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-25"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-26"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'blue'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-27"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'orange'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2ee807716129-28"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) TrainRMSE=%f, TestRMSE=%f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2ee807716129-29"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'diagnostic_neurons.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0019 seconds] -->
<p>Running the diagnostic script provides a line plot of train and test RMSE for each training epoch.</p>
<p>The diagnostics suggest a flattening out of model skill, perhaps around 400 epochs. The plot also suggests a possible situation of overfitting where there is a slight increase in test RMSE over the last 500 training epochs, but not a strong increase in training RMSE.</p>
<div class="wp-caption aligncenter" id="attachment_3947" style="width: 650px"><img alt="Diagnostic Line Plot of Train and Test Performance of 3 Hidden Neurons on the Shampoo Sales Dataset" class="size-full wp-image-3947" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-3-Hidden-Neurons-on-the-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-3-Hidden-Neurons-on-the-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-3-Hidden-Neurons-on-the-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Line Plot of Train and Test Performance of 3 Hidden Neurons on the Shampoo Sales Dataset</p></div>
<h2>Vary Hidden Layer Neurons with Lag</h2>
<p>In this section, we will look at increasing the lag observations as input, whilst at the same time increasing the capacity of the network.</p>
<p>Increased lag observations will automatically scale the number of input neurons. For example, 3 lag observations as input will result in 3 input neurons.</p>
<p>The added input will require additional capacity in the network. As such, we will also scale the number of neurons in the one hidden layer with the number of lag observations used as input.</p>
<p>We will use odd numbers of lag observations as input from 1, 3, 5, and 7 and use the same number of neurons respectively.</p>
<p>The change to the number of inputs affects the total number of training patterns during the conversion of the time series data to a supervised learning problem. As such, the batch size was reduced from 4 to 2 for all experiments in this section.</p>
<p>A total of 1000 training epochs are used in each experimental run.</p>
<p>The changes from the base experiment script are limited to the <em>experiment()</em> function and the running of the experiment, listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2f0806467156" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# run a repeated experiment
def experiment(repeats, series, epochs, lag, neurons):
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, lag)
	supervised_values = supervised.values[lag:,:]
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# run experiment
	error_scores = list()
	for r in range(repeats):
		# fit the model
		batch_size = 2
		model = fit_model(train_scaled, batch_size, epochs, neurons)
		# forecast test dataset
		test_reshaped = test_scaled[:,0:-1]
		output = model.predict(test_reshaped, batch_size=batch_size)
		predictions = list()
		for i in range(len(output)):
			yhat = output[i,0]
			X = test_scaled[i, 0:-1]
			# invert scaling
			yhat = invert_scale(scaler, X, yhat)
			# invert differencing
			yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
			# store forecast
			predictions.append(yhat)
		# report performance
		rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
		print('%d) Test RMSE: %.3f' % (r+1, rmse))
		error_scores.append(rmse)
	return error_scores

# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# experiment
repeats = 30
results = DataFrame()
epochs = 1000
# vary neurons
neurons = [1, 3, 5, 7]
for n in neurons:
	results[str(n)] = experiment(repeats, series, epochs, n, n)
# summarize results
print(results.describe())
# save boxplot
results.boxplot()
pyplot.savefig('boxplot_neurons_lag.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-10">10</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-12">12</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-14">14</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-16">16</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-18">18</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-20">20</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-22">22</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-24">24</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-26">26</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-28">28</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-30">30</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-32">32</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-34">34</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-36">36</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-38">38</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-40">40</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-42">42</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-44">44</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-46">46</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-48">48</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-50">50</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f0806467156-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f0806467156-52">52</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-1"><span class="crayon-p"># run a repeated experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-2"><span class="crayon-e">def </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-3"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-4"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-5"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-6"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-7"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-8"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">lag</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-9"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-10"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-11"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-12"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-13"><span class="crayon-h"> </span><span class="crayon-p"># run experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-14"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-16"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-17"><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-19"><span class="crayon-h"> </span><span class="crayon-p"># forecast test dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-20"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-21"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-22"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-23"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-24"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-25"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-26"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-27"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-28"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-29"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-30"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-31"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-32"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-33"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-34"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-35"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error_scores</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-38"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-39"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-40"><span class="crayon-p"># experiment</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-41"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-42"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-43"><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-44"><span class="crayon-p"># vary neurons</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-45"><span class="crayon-v">neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-46"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-47"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-48"><span class="crayon-p"># summarize results</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-49"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">describe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-50"><span class="crayon-p"># save boxplot</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f0806467156-51"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f0806467156-52"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'boxplot_neurons_lag.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0029 seconds] -->
<p>Running the experiment summarizes the results using descriptive statistics for each configuration.</p>
<p>The results suggest that all increases in lag input variables with increases with hidden neurons decrease performance.</p>
<p>Of note is the 1 neuron and 1 input configuration, which compared to the results from the previous section resulted in a similar mean and standard deviation.</p>
<p>It is possible that the decrease in performance is related to the smaller batch size and that the results from the 1-neuron/1-lag case are insufficient to tease this out.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2f3966885224" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
                1           3           5           7
count   30.000000   30.000000   30.000000   30.000000
mean   105.465038  109.447044  158.894730  147.024776
std     20.827644   15.312300   43.177520   22.717514
min     89.909627   77.426294   88.515319   95.801699
25%     92.187690  102.233491  125.008917  132.335683
50%     92.587411  109.506480  166.438582  145.078842
75%    135.386125  118.635143  189.457325  166.329000
max    139.941789  144.700754  232.962778  186.185471</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f3966885224-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f3966885224-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f3966885224-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f3966885224-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f3966885224-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f3966885224-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f3966885224-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f3966885224-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f3966885224-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2f3966885224-1">                1           3           5           7</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f3966885224-2">count   30.000000   30.000000   30.000000   30.000000</div><div class="crayon-line" id="crayon-5c0c9c2c9d2f3966885224-3">mean   105.465038  109.447044  158.894730  147.024776</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f3966885224-4">std     20.827644   15.312300   43.177520   22.717514</div><div class="crayon-line" id="crayon-5c0c9c2c9d2f3966885224-5">min     89.909627   77.426294   88.515319   95.801699</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f3966885224-6">25%     92.187690  102.233491  125.008917  132.335683</div><div class="crayon-line" id="crayon-5c0c9c2c9d2f3966885224-7">50%     92.587411  109.506480  166.438582  145.078842</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f3966885224-8">75%    135.386125  118.635143  189.457325  166.329000</div><div class="crayon-line" id="crayon-5c0c9c2c9d2f3966885224-9">max    139.941789  144.700754  232.962778  186.185471</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A box and whisker plot of the distribution of results was also created allowing configurations to be compared.</p>
<p>Interestingly, the use of 3 neurons and 3 input variables shows a tighter spread compared to the other configurations. This is similar to the observation from 3 neurons and 1 input variable seen in the previous section.</p>
<div class="wp-caption aligncenter" id="attachment_3948" style="width: 650px"><img alt="Box and Whisker Plot of Varying Lag Features and Hidden Neurons for Time Series Forecasting on the Shampoo Sales Dataset" class="size-full wp-image-3948" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Varying-Lag-Features-and-Hidden-Neurons-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Varying-Lag-Features-and-Hidden-Neurons-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-of-Varying-Lag-Features-and-Hidden-Neurons-for-Time-Series-Forecasting-on-the-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Box and Whisker Plot of Varying Lag Features and Hidden Neurons for Time Series Forecasting on the Shampoo Sales Dataset</p></div>
<p>We can also use diagnostics to tease out how the dynamics of the model might have changed while fitting the model.</p>
<p>The results for 3-lags/3-neurons are interesting and we will investigate them further.</p>
<p>The changes to the diagnostic script are confined to the <em>run()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9c2c9d2f5146377716" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# run diagnostic experiments
def run():
	# config
	repeats = 10
	n_batch = 2
	n_epochs = 1000
	n_neurons = 3
	n_lag = 3
	# load dataset
	series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, n_lag)
	supervised_values = supervised.values[n_lag:,:]
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# fit and evaluate model
	train_trimmed = train_scaled[2:, :]
	# run diagnostic tests
	for i in range(repeats):
		history = fit(train_trimmed, test_scaled, raw_values, scaler, n_batch, n_epochs, n_neurons)
		pyplot.plot(history['train'], color='blue')
		pyplot.plot(history['test'], color='orange')
		print('%d) TrainRMSE=%f, TestRMSE=%f' % (i, history['train'].iloc[-1], history['test'].iloc[-1]))
	pyplot.savefig('diagnostic_neurons_lag.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-2">2</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-4">4</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-6">6</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-8">8</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-10">10</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-12">12</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-14">14</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-16">16</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-18">18</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-20">20</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-22">22</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-24">24</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-26">26</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9c2c9d2f5146377716-28">28</div><div class="crayon-num" data-line="crayon-5c0c9c2c9d2f5146377716-29">29</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-1"><span class="crayon-p"># run diagnostic experiments</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-2"><span class="crayon-e">def </span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-3"><span class="crayon-h"> </span><span class="crayon-p"># config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-4"><span class="crayon-h"> </span><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-5"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-6"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-7"><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-8"><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-9"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-10"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-11"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-12"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-13"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-14"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-15"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-16"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-17"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-18"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-19"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-20"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-21"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-22"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-23"><span class="crayon-h"> </span><span class="crayon-p"># run diagnostic tests</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-25"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-26"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'blue'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-27"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'orange'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9c2c9d2f5146377716-28"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) TrainRMSE=%f, TestRMSE=%f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9c2c9d2f5146377716-29"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'diagnostic_neurons_lag.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0019 seconds] -->
<p>Running the diagnostics script creates a line plot showing the train and test RMSE after each training epoch for 10 experimental runs.</p>
<p>The results suggest good learning during the first 500 epochs and perhaps overfitting in the remaining epochs with the test RMSE showing an increasing trend and the train RMSE showing a decreasing trend.</p>
<div class="wp-caption aligncenter" id="attachment_3949" style="width: 650px"><img alt="Diagnostic Line Plot of Train and Test Performance of 3 Hidden Neurons and Lag Features on the Shampoo Sales Dataset" class="size-full wp-image-3949" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-3-Hidden-Neurons-and-Lag-Features-on-the-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-3-Hidden-Neurons-and-Lag-Features-on-the-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Line-Plot-of-Train-and-Test-Performance-of-3-Hidden-Neurons-and-Lag-Features-on-the-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Line Plot of Train and Test Performance of 3 Hidden Neurons and Lag Features on the Shampoo Sales Dataset</p></div>
<h2>Review of Results</h2>
<p>We have covered a lot of ground in this tutorial. Let’s review.</p>
<ul>
<li><strong>Epochs</strong>. We looked at how model skill varied with the number of training epochs and found that 1000 might be a good starting point.</li>
<li><strong>Neurons</strong>. We looked at varying the number of neurons in the hidden layer and found that 3 neurons might be a good configuration.</li>
<li><strong>Lag Inputs</strong>. We looked at varying the number of lag observations as inputs whilst at the same time increasing the number of neurons in the hidden layer and found that results generally got worse, but again, 3 neurons in the hidden layer shows interest. Poor results may have been related to the change of batch size from 4 to 2 compared to other experiments.</li>
</ul>
<p>The results suggest using a 1 lag input, 3 neurons in the hidden layer, and fit for 1000 epochs as a first-cut model configuration.</p>
<p>This can be improved upon in many ways; the next section lists some ideas.</p>
<h3>Extensions</h3>
<p>This section lists extensions and follow-up experiments you might like to explore.</p>
<ul>
<li><strong>Shuffle vs No Shuffle</strong>. No shuffling was used, which is abnormal. Develop an experiment to compare shuffling to no shuffling of the training set when fitting the model for time series forecasting.</li>
<li><strong>Normalization Method</strong>. Data was rescaled to -1 to 1, typical for a tanh activation function, not used in the model configurations. Explore other rescaling, such as 0-1 normalization and standardization and the impact on model performance.</li>
<li><strong>Multiple Layers</strong>. Explore the use of multiple hidden layers to add network capacity to learn more complex multi-step patterns.</li>
<li><strong>Feature Engineering</strong>. Explore the use of additional features, such as an error time series and even elements of the date-time of each observation.</li>
</ul>
<p>Also, check out the post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/improve-deep-learning-performance/">How To Improve Deep Learning Performance</a></li>
</ul>
<p>Did you try any of these extensions?<br/>
Post your results in the comments below.</p>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to use systematic experiments to explore the configuration of a multilayer perceptron for time series forecasting and develop a first-cut model.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a robust test harness for evaluating MLP models for time series forecasting.</li>
<li>How to systematically evaluate training epochs, hidden layer neurons, and lag inputs.</li>
<li>How to use diagnostics to help interpret results and suggest follow-up experiments.</li>
</ul>
<p>Do you have any questions about this tutorial?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img align="left" alt="Deep Learning for Time Series Forecasting" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br/>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-3943 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=Exploratory+Configuration+of+a+Multilayer+Perceptron+Network+for+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/instability-online-learning-stateful-lstm-time-series-forecasting/" rel="prev"><i class="fa fa-angle-left"></i> Instability of Online Learning for Stateful LSTM for Time Series Forecasting</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/" rel="next">How to Use Dropout with LSTM Networks for Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">32 Responses to <em>Exploratory Configuration of a Multilayer Perceptron Network for Time Series Forecasting</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-397694">
<div class="comment-container" id="li-comment-397694">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/929e95264ee011391b25a4cc3477826c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/929e95264ee011391b25a4cc3477826c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">elina</span>
<span class="date">April 26, 2017 at 11:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-397694" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>what is mean by transforming observations to have specific scale? can u more elaborate it with simple example?</p>
<div class="reply">
<a aria-label="Reply to elina" class="comment-reply-link" href="#comment-397694" onclick='return addComment.moveForm( "comment-397694", "397694", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397738">
<div class="comment-container" id="li-comment-397738">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 27, 2017 at 8:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-397738" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, normalize each column to the range 0-1.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-397738" onclick='return addComment.moveForm( "comment-397738", "397738", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-397817">
<div class="comment-container" id="li-comment-397817">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">April 28, 2017 at 3:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-397817" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I have a question regarding the prediction result evaluation.<br/>
In my code, I get MSE MAE MAPE calculated by keras as follows:<br/>
model.compile(loss=’mse’, optimizer=optimizer, metrics=[‘mae’, ‘mape’])<br/>
…<br/>
Epoch 150/150<br/>
0s – loss: 0.0038 – mean_absolute_error: 0.0455 – mean_absolute_percentage_error: 164095.5176<br/>
mse=0.003538, mae=0.043654, mape=58238.251235<br/>
————————————————————————-<br/>
But when I compute these values by the code:<br/>
mse = mean_squared_error(test_Y, predicted_output)<br/>
rmse = math.sqrt(mse)<br/>
mae = mean_absolute_error(test_Y, predicted_output)<br/>
mape = np.mean(np.abs(np.divide(np.subtract(test_Y, predicted_output), test_Y))) * 100<br/>
RMSE: 14.992<br/>
MAE: 10.462<br/>
MAPE: 2.208</p>
<p>The two results are very different from each other. What happened?</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="#comment-397817" onclick='return addComment.moveForm( "comment-397817", "397817", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397858">
<div class="comment-container" id="li-comment-397858">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 28, 2017 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-397858" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That is interesting. I’m not sure what is going on here.</p>
<p>I would trust the manual results. I have not had any issues like this myself, my epoch scores always seem to match my post-training evaluation.</p>
<p>Consider preparing a small self-contained example and posting it as a bug to the Keras project:<br/>
<a href="https://github.com/fchollet/keras" rel="nofollow">https://github.com/fchollet/keras</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-397858" onclick='return addComment.moveForm( "comment-397858", "397858", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-398011">
<div class="comment-container" id="li-comment-398011">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">April 29, 2017 at 11:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398011" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I give it a try on your example.<br/>
<a href="http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/</a></p>
<p>Change<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)<br/>
to<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’, metrics=[‘mae’, ‘mape’])<br/>
Got the same result.<br/>
0s – loss: 0.0019 – mean_absolute_error: 0.0343 – mean_absolute_percentage_error: 620693.8651<br/>
Epoch 96/100<br/>
0s – loss: 0.0020 – mean_absolute_error: 0.0351 – mean_absolute_percentage_error: 326543.9207<br/>
Epoch 97/100<br/>
0s – loss: 0.0019 – mean_absolute_error: 0.0345 – mean_absolute_percentage_error: 488762.9108<br/>
Epoch 98/100<br/>
0s – loss: 0.0019 – mean_absolute_error: 0.0345 – mean_absolute_percentage_error: 514091.1566<br/>
Epoch 99/100<br/>
0s – loss: 0.0019 – mean_absolute_error: 0.0345 – mean_absolute_percentage_error: 531419.0410<br/>
Epoch 100/100<br/>
0s – loss: 0.0019 – mean_absolute_error: 0.0341 – mean_absolute_percentage_error: 454424.3737<br/>
Train Score: 22.34 RMSE<br/>
Test Score: 45.66 RMSE</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="#comment-398011" onclick='return addComment.moveForm( "comment-398011", "398011", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-397900">
<div class="comment-container" id="li-comment-397900">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 28, 2017 at 6:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-397900" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the most robust sign for overfitting?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="#comment-397900" onclick='return addComment.moveForm( "comment-397900", "397900", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397962">
<div class="comment-container" id="li-comment-397962">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 29, 2017 at 7:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-397962" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Skill on the test set is worse than the training set.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-397962" onclick='return addComment.moveForm( "comment-397962", "397962", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-398073">
<div class="comment-container" id="li-comment-398073">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 30, 2017 at 3:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398073" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is there a list of overfitting signs available?</p>
<p>Alternative:</p>
<p>If I want to prepare such a list, how should it look like?</p>
<p>1. Skill on the test set is worse than the training set.<br/>
2. ?<br/>
3. ?<br/>
4. ?<br/>
5. ?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="#comment-398073" onclick='return addComment.moveForm( "comment-398073", "398073", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-398074">
<div class="comment-container" id="li-comment-398074">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 30, 2017 at 3:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398074" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is there a function available for our code, which ‘alerts’ overfitting?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="#comment-398074" onclick='return addComment.moveForm( "comment-398074", "398074", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-398075">
<div class="comment-container" id="li-comment-398075">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 30, 2017 at 4:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398075" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I monitor every result and multiple parameters of your examples in a Sqlite database.</p>
<p>Therefore I could easelly tagging overfitting. </p>
<p>For example if a test result is worse then the training set. </p>
<p>Could there be more relations of parameters and results to monitor for overfitting in general?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-398132">
<div class="comment-container" id="li-comment-398132">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 1, 2017 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398132" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is a trend you are seeking for overfitting, not necessarily one result being worse.<br/>
<a href="https://en.wikipedia.org/wiki/Overfitting" rel="nofollow">https://en.wikipedia.org/wiki/Overfitting</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-398131">
<div class="comment-container" id="li-comment-398131">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 1, 2017 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398131" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-398130">
<div class="comment-container" id="li-comment-398130">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 1, 2017 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398130" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nope. The first is all you need.</p>
<p>Instead, you develop a list of 100s of ways to address overfitting/early convergence.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-398130" onclick='return addComment.moveForm( "comment-398130", "398130", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-398154">
<div class="comment-container" id="li-comment-398154">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">May 1, 2017 at 9:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398154" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>A)<br/>
Does “Skill on the test set is worse than the training set”<br/>
mean trainRmse is less then testRmse?</p>
<p>In my baseline-test my trainRmse is always zero and the testRmse is always higher? Is this normal?</p>
<p>B)<br/>
Could we say that a higher variance of test values is an indicator for overfitting?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-398226">
<div class="comment-container" id="li-comment-398226">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 2, 2017 at 5:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398226" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post might make things clearer for you Hans:<br/>
<a href="http://machinelearningmastery.com/overfitting-and-underfitting-with-machine-learning-algorithms/" rel="nofollow">http://machinelearningmastery.com/overfitting-and-underfitting-with-machine-learning-algorithms/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-398080">
<div class="comment-container" id="li-comment-398080">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 30, 2017 at 4:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398080" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could we assume that the best performing epoches, neurons and lag inputs found with this MLP setup are also the best performing ones in a LSTM model or any other model?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="#comment-398080" onclick='return addComment.moveForm( "comment-398080", "398080", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-398135">
<div class="comment-container" id="li-comment-398135">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 1, 2017 at 5:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398135" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, generally findings are not transferable to other problems or other algorithms.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-398135" onclick='return addComment.moveForm( "comment-398135", "398135", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-398189">
<div class="comment-container" id="li-comment-398189">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">May 1, 2017 at 8:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-398189" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is it possible to save a trained model on HD, to predict unseen data later, in a shorter time?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="#comment-398189" onclick='return addComment.moveForm( "comment-398189", "398189", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-399500">
<div class="comment-container" id="li-comment-399500">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d2d0dadc3e4cd520f14f70264094f8f1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d2d0dadc3e4cd520f14f70264094f8f1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Magnus</span>
<span class="date">May 12, 2017 at 11:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-399500" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Would it be possible to achieve the same study using GridSearchCV, like you did in another post? Or is it not possible for time series?</p>
<div class="reply">
<a aria-label="Reply to Magnus" class="comment-reply-link" href="#comment-399500" onclick='return addComment.moveForm( "comment-399500", "399500", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-399534">
<div class="comment-container" id="li-comment-399534">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 13, 2017 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-399534" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, we must use walk-forward validation to evaluate time series models correctly:<br/>
<a href="http://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-399534" onclick='return addComment.moveForm( "comment-399534", "399534", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-422088">
<div class="comment-container" id="li-comment-422088">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/659d852ded99e60dca2f34c0ae8e3a33?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/659d852ded99e60dca2f34c0ae8e3a33?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jussi</span>
<span class="date">December 4, 2017 at 6:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-422088" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for a great tutorial. </p>
<p>Could you give me an advice how to model, a multivariate timeseries with MLP. For example, if we model a timeseries such an energy consumption with window approach like in the example above. How do we add/model additional features such as dates, temperature, etc, which can be also timeseries?</p>
<p>Is the only option to create a single array with all the different timeseries one after another and hope that the network can learn their relations? If yes, it seems strange that there are no way to indicate which inputs relate to each other timewise… But I guess the LSTM and other RNN are just for this purpose…</p>
<div class="reply">
<a aria-label="Reply to Jussi" class="comment-reply-link" href="#comment-422088" onclick='return addComment.moveForm( "comment-422088", "422088", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422105">
<div class="comment-container" id="li-comment-422105">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 4, 2017 at 8:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-422105" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could try modeling each series with separate networks and ensemble the models, you could try one large model for all series, I’d encourage you to experiment and see what works best for your data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-422105" onclick='return addComment.moveForm( "comment-422105", "422105", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-445076">
<div class="comment-container" id="li-comment-445076">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6e414586915a976767216a6f578e4615?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6e414586915a976767216a6f578e4615?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kingsley udeh</span>
<span class="date">August 2, 2018 at 9:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-445076" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Please do you have any example of this:</p>
<p>“You could try modeling each series with separate networks and ensemble the models…”</p>
<p>Could you please give more explanation of how we could combine the models to form an ensample?</p>
<p>In this case, any need for a final model? That is, fitting the ensembled model(s) with all available data?</p>
<div class="reply">
<a aria-label="Reply to kingsley udeh" class="comment-reply-link" href="#comment-445076" onclick='return addComment.moveForm( "comment-445076", "445076", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-445110">
<div class="comment-container" id="li-comment-445110">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2018 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-445110" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445110" onclick='return addComment.moveForm( "comment-445110", "445110", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-429982">
<div class="comment-container" id="li-comment-429982">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fce041d659785cad2e79cda4324b050b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fce041d659785cad2e79cda4324b050b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Steven</span>
<span class="date">February 20, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-429982" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the great tutorials you offer. I have both tried the LSTM examples and this MLP example. All these examples gave me good insights and helped me to configure models and do optimizations for my own data. </p>
<p>A characteristic of time series is that the predictions (forecasts) are based on history data. But in this MLP example I observed the testing data is used to make the predictions:<br/>
output = model.predict(test_reshaped, batch_size=batch_size)<br/>
I think this essentially is a matter of regression and not time series. The model can only predict values based on input values and the model is not able to predict solely based on history data. Can you please comment on this?</p>
<div class="reply">
<a aria-label="Reply to Steven" class="comment-reply-link" href="#comment-429982" onclick='return addComment.moveForm( "comment-429982", "429982", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430092">
<div class="comment-container" id="li-comment-430092">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 21, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-430092" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It really comes down to how you frame your forecasting problem Steven.</p>
<p>Often a good way to test a forecast model is to use walk-forward validation which does make test data available to the model for training/re-training between test time steps. Learn more here:<br/>
<a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430092" onclick='return addComment.moveForm( "comment-430092", "430092", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-456229">
<div class="comment-container" id="li-comment-456229">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/47c597869959fd6bc5c7c5968d28349d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/47c597869959fd6bc5c7c5968d28349d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://amelie.bm90@gmail.com" rel="external nofollow">Amelie</a></span>
<span class="date">November 26, 2018 at 11:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-456229" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your demo,</p>
<p>I want to know please, the difference between a NAR and a MLP?<br/>
and how a MLP can take into consideration the time aspect of the series..</p>
<p>Can you lead me to an example of application of a BPTT (Backpropagation through time)</p>
<div class="reply">
<a aria-label="Reply to Amelie" class="comment-reply-link" href="#comment-456229" onclick='return addComment.moveForm( "comment-456229", "456229", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-456276">
<div class="comment-container" id="li-comment-456276">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-456276" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is NAR?</p>
<p>Learn more about BPTT here:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456276" onclick='return addComment.moveForm( "comment-456276", "456276", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-456343">
<div class="comment-container" id="li-comment-456343">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/47c597869959fd6bc5c7c5968d28349d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/47c597869959fd6bc5c7c5968d28349d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://amelie.bm90@gmail.com" rel="external nofollow">Amelie</a></span>
<span class="date">November 27, 2018 at 7:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-456343" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The difference between NAR (Nonlinear AutoRegressive neural network) and MLP (MultiLayer Perceptron)</p>
<div class="reply">
<a aria-label="Reply to Amelie" class="comment-reply-link" href="#comment-456343" onclick='return addComment.moveForm( "comment-456343", "456343", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-456411">
<div class="comment-container" id="li-comment-456411">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2018 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-456411" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If NAR is a specific method, I am not familiar with it sorry. </p>
<p>From the name, an MLP applied to time series would be nonlinear (i.e. the activation function) and autoregressive (lag obs as input).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456411" onclick='return addComment.moveForm( "comment-456411", "456411", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-457863">
<div class="comment-container" id="li-comment-457863">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0ff1a8a6f413fc63f2286d67b3125e30?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0ff1a8a6f413fc63f2286d67b3125e30?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ehsan</span>
<span class="date">December 8, 2018 at 7:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-457863" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason. I run your code and got the info that you said it is important.(n neurons, epochs and etc)so now how can I use these parameters to run the model and plot the future  price predictions? in auto arima I got the plot that shows future vs original  values but here I don’t know how to do it. thanks</p>
<div class="reply">
<a aria-label="Reply to Ehsan" class="comment-reply-link" href="#comment-457863" onclick='return addComment.moveForm( "comment-457863", "457863", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457876">
<div class="comment-container" id="li-comment-457876">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 8, 2018 at 7:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#comment-457876" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this will help:<br/>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" rel="nofollow">https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457876" onclick='return addComment.moveForm( "comment-457876", "457876", "respond", "3943" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/exploratory-configuration-multilayer-perceptron-network-time-series-forecasting/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="3943"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="d9c3cb6f23"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="58"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-51"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for Time Series</strong><br/>
Forecast the future with MLPs, CNNs, and LSTMs.
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>