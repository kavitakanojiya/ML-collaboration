<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python</title>
<link href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python" property="og:title"/>
<meta content="Long Short-Term Networks or LSTMs are a popular and powerful type of Recurrent Neural Network, or RNN. They can be quite difficult to configure and apply to arbitrary sequence prediction problems, even with well defined and “easy to use” interfaces like those provided in the Keras deep learning library in Python. One reason for this …" property="og:description"/>
<meta content="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-05-16T19:00:45+00:00" property="article:published_time"/>
<meta content="2017-12-14T18:35:11+00:00" property="article:modified_time"/>
<meta content="2017-12-14T18:35:11+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Use-the-TimeDistributed-Layer-for-Long-Short-Term-Memory-Networks-in-Python.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Use-the-TimeDistributed-Layer-for-Long-Short-Term-Memory-Networks-in-Python.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="477" property="og:image:height"/>
<meta content="How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/feed/" rel="alternate" title="Machine Learning Mastery » How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=3998" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftimedistributed-layer-for-long-short-term-memory-networks-in-python%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftimedistributed-layer-for-long-short-term-memory-networks-in-python%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-3998 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Want help with LSTMs? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-3998 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-05-17T05:00:45+1100">May 17, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-3998 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Use+the+TimeDistributed+Layer+for+Long+Short-Term+Memory+Networks+in+Python&amp;url=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Long Short-Term Networks or LSTMs are a popular and powerful type of Recurrent Neural Network, or RNN.</p>
<p>They can be quite difficult to configure and apply to arbitrary sequence prediction problems, even with well defined and “easy to use” interfaces like those provided in the Keras deep learning library in Python.</p>
<p>One reason for this difficulty in Keras is the use of the TimeDistributed wrapper layer and the need for some LSTM layers to return sequences rather than single values.</p>
<p>In this tutorial, you will discover different ways to configure LSTM networks for sequence prediction, the role that the TimeDistributed layer plays, and exactly how to use it.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to design a one-to-one LSTM for sequence prediction.</li>
<li>How to design a many-to-one LSTM for sequence prediction without the TimeDistributed Layer.</li>
<li>How to design a many-to-many LSTM for sequence prediction with the TimeDistributed Layer.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_3999" style="width: 650px"><img alt="How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python" class="size-full wp-image-3999" height="477" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Use-the-TimeDistributed-Layer-for-Long-Short-Term-Memory-Networks-in-Python.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Use-the-TimeDistributed-Layer-for-Long-Short-Term-Memory-Networks-in-Python.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Use-the-TimeDistributed-Layer-for-Long-Short-Term-Memory-Networks-in-Python-300x224.jpg 300w" width="640"/><p class="wp-caption-text">How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python<br/>Photo by <a href="https://www.flickr.com/photos/43158397@N02/5774000092/">jans canon</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 5 parts; they are:</p>
<ol>
<li>TimeDistributed Layer</li>
<li>Sequence Learning Problem</li>
<li>One-to-One LSTM for Sequence Prediction</li>
<li>Many-to-One LSTM for Sequence Prediction (without TimeDistributed)</li>
<li>Many-to-Many LSTM for Sequence Prediction (with TimeDistributed)</li>
</ol>
<h3>Environment</h3>
<p>This tutorial assumes a Python 2 or Python 3 development environment with SciPy, NumPy, and Pandas installed.</p>
<p>The tutorial also assumes scikit-learn and Keras v2.0+ are installed with either the Theano or TensorFlow backend.</p>
<p>For help setting up your Python environment, see the post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div>
<h2>TimeDistributed Layer</h2>
<p>LSTMs are powerful, but hard to use and hard to configure, especially for beginners.</p>
<p>An added complication is the <a href="https://keras.io/layers/wrappers/#timedistributed">TimeDistributed</a> Layer (and the former <em>TimeDistributedDense</em> layer) that is cryptically described as a layer wrapper:</p>
<blockquote><p>This wrapper allows us to apply a layer to every temporal slice of an input.</p></blockquote>
<p>How and when are you supposed to use this wrapper with LSTMs?</p>
<p>The confusion is compounded when you search through discussions about the wrapper layer on the Keras GitHub issues and StackOverflow.</p>
<p>For example, in the issue “<a href="https://github.com/fchollet/keras/issues/1029">When and How to use TimeDistributedDense</a>,” fchollet (Keras’ author) explains:</p>
<blockquote><p>TimeDistributedDense applies a same Dense (fully-connected) operation to every timestep of a 3D tensor.</p></blockquote>
<p>This makes perfect sense if you already understand what the TimeDistributed layer is for and when to use it, but is no help at all to a beginner.</p>
<p>This tutorial aims to clear up confusion around using the TimeDistributed wrapper with LSTMs with worked examples that you can inspect, run, and play with to help your concrete understanding.</p>
<h2>Sequence Learning Problem</h2>
<p>We will use a simple sequence learning problem to demonstrate the TimeDistributed layer.</p>
<p>In this problem, the sequence [0.0, 0.2, 0.4, 0.6, 0.8] will be given as input one item at a time and must be in turn returned as output, one item at a time.</p>
<p>Think of it as learning a simple echo program. We give 0.0 as input, we expect to see 0.0 as output, repeated for each item in the sequence.</p>
<p>We can generate this sequence directly as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca77781814173" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from numpy import array
length = 5
seq = array([i/float(length) for i in range(length)])
print(seq)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca77781814173-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca77781814173-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca77781814173-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca77781814173-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca77781814173-1"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca77781814173-2"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca77781814173-3"><span class="crayon-v">seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca77781814173-4"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Running this example prints the generated sequence:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca80283593724" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[ 0.   0.2  0.4  0.6  0.8]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca80283593724-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca80283593724-1">[ 0.   0.2  0.4  0.6  0.8]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The example is configurable and you can play with longer/shorter sequences yourself later if you like. Let me know about your results in the comments.</p>
<h2>One-to-One LSTM for Sequence Prediction</h2>
<p>Before we dive in, it is important to show that this sequence learning problem can be learned piecewise.</p>
<p>That is, we can reframe the problem into a dataset of input-output pairs for each item in the sequence. Given 0, the network should output 0, given 0.2, the network must output 0.2, and so on.</p>
<p>This is the simplest formulation of the problem and requires the sequence to be split into input-output pairs and for the sequence to be predicted one step at a time and gathered outside of the network.</p>
<p>The input-output pairs are as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca83252201028" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X, 	y
0.0,	0.0
0.2,	0.2
0.4,	0.4
0.6,	0.6
0.8,	0.8</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca83252201028-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca83252201028-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca83252201028-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca83252201028-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca83252201028-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca83252201028-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca83252201028-1">X, 	y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca83252201028-2">0.0,	0.0</div><div class="crayon-line" id="crayon-5c0ca63f5ca83252201028-3">0.2,	0.2</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca83252201028-4">0.4,	0.4</div><div class="crayon-line" id="crayon-5c0ca63f5ca83252201028-5">0.6,	0.6</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca83252201028-6">0.8,	0.8</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The input for LSTMs must be three dimensional. We can reshape the 2D sequence into a 3D sequence with 5 samples, 1 time step, and 1 feature. We will define the output as 5 samples with 1 feature.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca84020078984" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X = seq.reshape(5, 1, 1)
y = seq.reshape(5, 1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca84020078984-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca84020078984-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca84020078984-1"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca84020078984-2"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We will define the network model as having 1 input with 1 time step. The first hidden layer will be an LSTM with 5 units. The output layer with be a fully-connected layer with 1 output.</p>
<p>The model will be fit with efficient ADAM optimization algorithm and the mean squared error loss function.</p>
<p>The batch size was set to the number of samples in the epoch to avoid having to make the LSTM stateful and manage state resets manually, although this could just as easily be done in order to update weights after each sample is shown to the network.</p>
<p>The complete code listing is provided below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca86138371514" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from numpy import array
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
# prepare sequence
length = 5
seq = array([i/float(length) for i in range(length)])
X = seq.reshape(len(seq), 1, 1)
y = seq.reshape(len(seq), 1)
# define LSTM configuration
n_neurons = length
n_batch = length
n_epoch = 1000
# create LSTM
model = Sequential()
model.add(LSTM(n_neurons, input_shape=(1, 1)))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
print(model.summary())
# train LSTM
model.fit(X, y, epochs=n_epoch, batch_size=n_batch, verbose=2)
# evaluate
result = model.predict(X, batch_size=n_batch, verbose=0)
for value in result:
	print('%.1f' % value)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-6">6</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-8">8</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-10">10</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-12">12</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-14">14</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-16">16</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-18">18</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-20">20</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-22">22</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca86138371514-24">24</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca86138371514-25">25</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-1"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">LSTM</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-5"><span class="crayon-p"># prepare sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-6"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-7"><span class="crayon-v">seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-8"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">seq</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-9"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">seq</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-10"><span class="crayon-p"># define LSTM configuration</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-11"><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-12"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">length</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-13"><span class="crayon-v">n_epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-14"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-15"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-16"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-17"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-18"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-19"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-20"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-21"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-22"><span class="crayon-p"># evaluate</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-23"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca86138371514-24"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca86138371514-25"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Running the example first prints the structure of the configured network.</p>
<p>We can see that the LSTM layer has 140 parameters. This is calculated based on the number of inputs (1) and the number of outputs (5 for the 5 units in the hidden layer), as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca88259565151" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n = 4 * ((inputs + 1) * outputs + outputs^2)
n = 4 * ((1 + 1) * 5 + 5^2)
n = 4 * 35
n = 140</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca88259565151-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca88259565151-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca88259565151-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca88259565151-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca88259565151-1">n = 4 * ((inputs + 1) * outputs + outputs^2)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca88259565151-2">n = 4 * ((1 + 1) * 5 + 5^2)</div><div class="crayon-line" id="crayon-5c0ca63f5ca88259565151-3">n = 4 * 35</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca88259565151-4">n = 140</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can also see that the fully connected layer only has 6 parameters for the number of inputs (5 for the 5 inputs from the previous layer), number of outputs (1 for the 1 neuron in the layer), and the bias.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca89384663999" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n = inputs * outputs + outputs
n = 5 * 1 + 1
n = 6</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca89384663999-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca89384663999-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca89384663999-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca89384663999-1">n = inputs * outputs + outputs</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca89384663999-2">n = 5 * 1 + 1</div><div class="crayon-line" id="crayon-5c0ca63f5ca89384663999-3">n = 6</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca8b384039821" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
lstm_1 (LSTM)                (None, 1, 5)              140
_________________________________________________________________
dense_1 (Dense)              (None, 1, 1)              6
=================================================================
Total params: 146.0
Trainable params: 146
Non-trainable params: 0.0
_________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca8b384039821-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca8b384039821-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca8b384039821-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca8b384039821-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca8b384039821-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca8b384039821-6">6</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca8b384039821-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca8b384039821-8">8</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca8b384039821-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca8b384039821-10">10</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca8b384039821-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca8b384039821-1">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca8b384039821-2">Layer (type)                 Output Shape              Param #</div><div class="crayon-line" id="crayon-5c0ca63f5ca8b384039821-3">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca8b384039821-4">lstm_1 (LSTM)                (None, 1, 5)              140</div><div class="crayon-line" id="crayon-5c0ca63f5ca8b384039821-5">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca8b384039821-6">dense_1 (Dense)              (None, 1, 1)              6</div><div class="crayon-line" id="crayon-5c0ca63f5ca8b384039821-7">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca8b384039821-8">Total params: 146.0</div><div class="crayon-line" id="crayon-5c0ca63f5ca8b384039821-9">Trainable params: 146</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca8b384039821-10">Non-trainable params: 0.0</div><div class="crayon-line" id="crayon-5c0ca63f5ca8b384039821-11">_________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The network correctly learns the prediction problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca8d263175810" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0.0
0.2
0.4
0.6
0.8</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca8d263175810-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca8d263175810-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca8d263175810-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca8d263175810-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca8d263175810-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca8d263175810-1">0.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca8d263175810-2">0.2</div><div class="crayon-line" id="crayon-5c0ca63f5ca8d263175810-3">0.4</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca8d263175810-4">0.6</div><div class="crayon-line" id="crayon-5c0ca63f5ca8d263175810-5">0.8</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Many-to-One LSTM for Sequence Prediction (without  TimeDistributed)</h2>
<p>In this section, we develop an LSTM to output the sequence all at once, although without the TimeDistributed wrapper layer.</p>
<p>The input for LSTMs must be three dimensional. We can reshape the 2D sequence into a 3D sequence with 1 sample, 5 time steps, and 1 feature. We will define the output as 1 sample with 5 features.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca92927988094" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X = seq.reshape(1, 5, 1)
y = seq.reshape(1, 5)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca92927988094-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca92927988094-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca92927988094-1"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca92927988094-2"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Immediately, you can see that the problem definition must be slightly adjusted to support a network for sequence prediction without a TimeDistributed wrapper. Specifically, output one vector rather build out an output sequence one step at a time. The difference may sound subtle, but it is important to understanding the role of the TimeDistributed wrapper.</p>
<p>We will define the model as having one input with 5 time steps. The first hidden layer will be an LSTM with 5 units. The output layer is a fully-connected layer with 5 neurons.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca93309269633" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create LSTM
model = Sequential()
model.add(LSTM(5, input_shape=(5, 1)))
model.add(Dense(length))
model.compile(loss='mean_squared_error', optimizer='adam')
print(model.summary())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca93309269633-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca93309269633-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca93309269633-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca93309269633-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca93309269633-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca93309269633-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca93309269633-1"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca93309269633-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca93309269633-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca93309269633-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca93309269633-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca93309269633-6"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we fit the model for only 500 epochs and a batch size of 1 for the single sample in the training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca95083144976" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train LSTM
model.fit(X, y, epochs=500, batch_size=1, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca95083144976-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca95083144976-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca95083144976-1"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca95083144976-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Putting this all together, the complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca97510721058" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from numpy import array
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
# prepare sequence
length = 5
seq = array([i/float(length) for i in range(length)])
X = seq.reshape(1, length, 1)
y = seq.reshape(1, length)
# define LSTM configuration
n_neurons = length
n_batch = 1
n_epoch = 500
# create LSTM
model = Sequential()
model.add(LSTM(n_neurons, input_shape=(length, 1)))
model.add(Dense(length))
model.compile(loss='mean_squared_error', optimizer='adam')
print(model.summary())
# train LSTM
model.fit(X, y, epochs=n_epoch, batch_size=n_batch, verbose=2)
# evaluate
result = model.predict(X, batch_size=n_batch, verbose=0)
for value in result[0,:]:
	print('%.1f' % value)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-6">6</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-8">8</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-10">10</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-12">12</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-14">14</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-16">16</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-18">18</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-20">20</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-22">22</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca97510721058-24">24</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca97510721058-25">25</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-1"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">LSTM</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-5"><span class="crayon-p"># prepare sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-6"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-7"><span class="crayon-v">seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-8"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-9"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-10"><span class="crayon-p"># define LSTM configuration</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-11"><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-12"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-13"><span class="crayon-v">n_epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">500</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-14"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-15"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-16"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-17"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-18"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-19"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-20"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-21"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-22"><span class="crayon-p"># evaluate</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-23"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca97510721058-24"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca63f5ca97510721058-25"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>Running the example first prints a summary of the configured network.</p>
<p>We can see that the LSTM layer has 140 parameters as in the previous section.</p>
<p>The LSTM units have been crippled and will each output a single value, providing a vector of 5 values as inputs to the fully connected layer. The time dimension or sequence information has been thrown away and collapsed into a vector of 5 values.</p>
<p>We can see that the fully connected output layer has 5 inputs and is expected to output 5 values. We can account for the 30 weights to be learned as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca98038776563" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n = inputs * outputs + outputs
n = 5 * 5 + 5
n = 30</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca98038776563-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca98038776563-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca98038776563-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca98038776563-1">n = inputs * outputs + outputs</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca98038776563-2">n = 5 * 5 + 5</div><div class="crayon-line" id="crayon-5c0ca63f5ca98038776563-3">n = 30</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The summary of the network is reported as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca9a863199561" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
lstm_1 (LSTM)                (None, 5)                 140
_________________________________________________________________
dense_1 (Dense)              (None, 5)                 30
=================================================================
Total params: 170.0
Trainable params: 170
Non-trainable params: 0.0
_________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca9a863199561-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca9a863199561-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca9a863199561-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca9a863199561-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca9a863199561-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca9a863199561-6">6</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca9a863199561-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca9a863199561-8">8</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca9a863199561-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca9a863199561-10">10</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca9a863199561-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca9a863199561-1">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca9a863199561-2">Layer (type)                 Output Shape              Param #</div><div class="crayon-line" id="crayon-5c0ca63f5ca9a863199561-3">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca9a863199561-4">lstm_1 (LSTM)                (None, 5)                 140</div><div class="crayon-line" id="crayon-5c0ca63f5ca9a863199561-5">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca9a863199561-6">dense_1 (Dense)              (None, 5)                 30</div><div class="crayon-line" id="crayon-5c0ca63f5ca9a863199561-7">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca9a863199561-8">Total params: 170.0</div><div class="crayon-line" id="crayon-5c0ca63f5ca9a863199561-9">Trainable params: 170</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca9a863199561-10">Non-trainable params: 0.0</div><div class="crayon-line" id="crayon-5c0ca63f5ca9a863199561-11">_________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The model is fit, printing loss information before finalizing and printing the predicted sequence.</p>
<p>The sequence is reproduced correctly, but as a single piece rather than stepwise through the input data. We may have used a Dense layer as the first hidden layer instead of LSTMs as this usage of LSTMs does not take much advantage of their full capability for sequence learning and processing.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca9c991518353" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0.0
0.2
0.4
0.6
0.8</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca9c991518353-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca9c991518353-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca9c991518353-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5ca9c991518353-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5ca9c991518353-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca9c991518353-1">0.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca9c991518353-2">0.2</div><div class="crayon-line" id="crayon-5c0ca63f5ca9c991518353-3">0.4</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5ca9c991518353-4">0.6</div><div class="crayon-line" id="crayon-5c0ca63f5ca9c991518353-5">0.8</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Many-to-Many LSTM for Sequence Prediction (with TimeDistributed)</h2>
<p>In this section, we will use the TimeDistributed layer to process the output from the LSTM hidden layer.</p>
<p>There are two key points to remember when using the TimeDistributed wrapper layer:</p>
<ul>
<li><strong>The input must be (at least) 3D</strong>. This often means that you will need to configure your last LSTM layer prior to your TimeDistributed wrapped Dense layer to return sequences (e.g. set the “return_sequences” argument to “True”).</li>
<li><strong>The output will be 3D</strong>. This means that if your TimeDistributed wrapped Dense layer is your output layer and you are predicting a sequence, you will need to resize your y array into a 3D vector.</li>
</ul>
<p>We can define the shape of the output as having 1 sample, 5 time steps, and 1 feature, just like the input sequence, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5ca9e014099626" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
y = seq.reshape(1, length, 1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5ca9e014099626-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5ca9e014099626-1"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can define the LSTM hidden layer to return sequences rather than single values by setting the “<em>return_sequences</em>” argument to true.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5caa0272723214" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(LSTM(n_neurons, input_shape=(length, 1), return_sequences=True))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5caa0272723214-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5caa0272723214-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>This has the effect of each LSTM unit returning a sequence of 5 outputs, one for each time step in the input data, instead of single output value as in the previous example.</p>
<p>We also can use the TimeDistributed on the output layer to wrap a fully connected Dense layer with a single output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5caa1833520030" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(TimeDistributed(Dense(1)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5caa1833520030-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5caa1833520030-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The single output value in the output layer is key. It highlights that we intend to output one time step from the sequence for each time step in the input. It just so happens that we will process 5 time steps of the input sequence at a time.</p>
<p>The TimeDistributed achieves this trick by applying the same Dense layer (same weights) to the LSTMs outputs for one time step at a time. In this way, the output layer only needs one connection to each LSTM unit (plus one bias).</p>
<p>For this reason, the number of training epochs needs to be increased to account for the smaller network capacity. I doubled it from 500 to 1000 to match the first one-to-one example.</p>
<p>Putting this together, the full code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5caa3017985015" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from numpy import array
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import TimeDistributed
from keras.layers import LSTM
# prepare sequence
length = 5
seq = array([i/float(length) for i in range(length)])
X = seq.reshape(1, length, 1)
y = seq.reshape(1, length, 1)
# define LSTM configuration
n_neurons = length
n_batch = 1
n_epoch = 1000
# create LSTM
model = Sequential()
model.add(LSTM(n_neurons, input_shape=(length, 1), return_sequences=True))
model.add(TimeDistributed(Dense(1)))
model.compile(loss='mean_squared_error', optimizer='adam')
print(model.summary())
# train LSTM
model.fit(X, y, epochs=n_epoch, batch_size=n_batch, verbose=2)
# evaluate
result = model.predict(X, batch_size=n_batch, verbose=0)
for value in result[0,:,0]:
	print('%.1f' % value)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-6">6</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-8">8</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-10">10</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-12">12</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-14">14</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-16">16</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-18">18</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-20">20</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-22">22</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-24">24</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa3017985015-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa3017985015-26">26</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-1"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-6"><span class="crayon-p"># prepare sequence</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-7"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-8"><span class="crayon-v">seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-9"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-10"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-11"><span class="crayon-p"># define LSTM configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-12"><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">length</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-13"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-14"><span class="crayon-v">n_epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-15"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-16"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-17"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-18"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-19"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-20"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-21"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-22"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-23"><span class="crayon-p"># evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-24"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca63f5caa3017985015-25"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa3017985015-26"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0026 seconds] -->
<p>Running the example, we can see the structure of the configured network.</p>
<p>We can see that as in the previous example, we have 140 parameters in the LSTM hidden layer.</p>
<p>The fully connected output layer is a very different story. In fact, it matches the one-to-one example exactly. One neuron that has one weight for each LSTM unit in the previous layer, plus one for the bias input.</p>
<p>This does two important things:</p>
<ul>
<li>Allows the problem to be framed and learned as it was defined, that is one input to one output, keeping the internal process for each time step separate.</li>
<li>Simplifies the network by requiring far fewer weights such that only one time step is processed at a time.</li>
</ul>
<p>The one simpler fully connected layer is applied to each time step in the sequence provided from the previous layer to build up the output sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5caa5583043288" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
lstm_1 (LSTM)                (None, 5, 5)              140
_________________________________________________________________
time_distributed_1 (TimeDist (None, 5, 1)              6
=================================================================
Total params: 146.0
Trainable params: 146
Non-trainable params: 0.0
_________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5caa5583043288-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa5583043288-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa5583043288-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa5583043288-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa5583043288-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa5583043288-6">6</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa5583043288-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa5583043288-8">8</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa5583043288-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa5583043288-10">10</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa5583043288-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5caa5583043288-1">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa5583043288-2">Layer (type)                 Output Shape              Param #</div><div class="crayon-line" id="crayon-5c0ca63f5caa5583043288-3">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa5583043288-4">lstm_1 (LSTM)                (None, 5, 5)              140</div><div class="crayon-line" id="crayon-5c0ca63f5caa5583043288-5">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa5583043288-6">time_distributed_1 (TimeDist (None, 5, 1)              6</div><div class="crayon-line" id="crayon-5c0ca63f5caa5583043288-7">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa5583043288-8">Total params: 146.0</div><div class="crayon-line" id="crayon-5c0ca63f5caa5583043288-9">Trainable params: 146</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa5583043288-10">Non-trainable params: 0.0</div><div class="crayon-line" id="crayon-5c0ca63f5caa5583043288-11">_________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Again, the network learns the sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63f5caa7855490461" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0.0
0.2
0.4
0.6
0.8</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63f5caa7855490461-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa7855490461-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa7855490461-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63f5caa7855490461-4">4</div><div class="crayon-num" data-line="crayon-5c0ca63f5caa7855490461-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63f5caa7855490461-1">0.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa7855490461-2">0.2</div><div class="crayon-line" id="crayon-5c0ca63f5caa7855490461-3">0.4</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63f5caa7855490461-4">0.6</div><div class="crayon-line" id="crayon-5c0ca63f5caa7855490461-5">0.8</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can think of the framing of the problem with time steps and a TimeDistributed layer as a more compact way of implementing the one-to-one network in the first example. It may even be more efficient (space or time wise) at a larger scale.</p>
<h2>Further Reading</h2>
<p>Below are some resources and discussions on the TimeDistributed layer you may like to dive in into.</p>
<ul>
<li><a href="https://keras.io/layers/wrappers/#timedistributed">TimeDistributed Layer</a> in the Keras API</li>
<li><a href="https://github.com/fchollet/keras/blob/master/keras/layers/wrappers.py#L56">TimeDistributed</a> code on GitHub</li>
<li><a href="http://datascience.stackexchange.com/questions/10836/the-difference-between-dense-and-timedistributeddense-of-keras">The difference between ‘Dense’ and ‘TimeDistributedDense’ of ‘Keras’</a> on StackExchange</li>
<li><a href="https://github.com/fchollet/keras/issues/1029">When and How to use TimeDistributedDense</a> on GitHub</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop LSTM networks for sequence prediction and the role of the TimeDistributed layer.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to design a one-to-one LSTM for sequence prediction.</li>
<li>How to design a many-to-one LSTM for sequence prediction without the TimeDistributed Layer.</li>
<li>How to design a many-to-many LSTM for sequence prediction with the TimeDistributed Layer.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer them.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-3998 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Use+the+TimeDistributed+Layer+for+Long+Short-Term+Memory+Networks+in+Python&amp;url=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/use-different-batch-sizes-training-predicting-python-keras/" rel="prev"><i class="fa fa-angle-left"></i> How to use Different Batch Sizes when Training and Predicting with LSTMs</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" rel="next">Learn to Add Numbers with an Encoder-Decoder LSTM Recurrent Neural Network <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">148 Responses to <em>How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-399890">
<div class="comment-container" id="li-comment-399890">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfccb37eb2036bb031f66fc21c544815?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfccb37eb2036bb031f66fc21c544815?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Birkey</span>
<span class="date">May 17, 2017 at 7:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-399890" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason, nice article on TimeDistributed layer!</p>
<p>Basically, there’re three configurations for X (and thus y):<br/>
1. (5,1,1) – 5 batchs, 1 time step, 1 feature/step – result shape (5,1)<br/>
2. (1,5,1) – 1 batch, 5 time steps, 1 feature/step – result shape (1,5)<br/>
3. (1,1,5) – 1 batch, 1 time step, 5 features/step</p>
<p>in article, you discussed previous 2 configures.<br/>
I did experiment of config 3, result same shape (1, 5) as 2 does, ’cause X input only 1 batch (which contains 1 sample, which has 5 features.) this config surely lost time information.</p>
<p>3 differ from 2 in two ways:<br/>
1) how we/model frame the problem: sequence should be framed as multi time steps as 2<br/>
2) different number of LSTM params: config 2 has 140, while config 3 has 220! (big input vector)</p>
<p>Q:<br/>
in section ‘many to one without TimeDistributed’, with config 2, you said “The time dimension or sequence information has been thrown away and collapsed into a vector of 5 values.” — that surprise me a little bit.<br/>
– does that mean, for seq-to-seq problem, we should always use TimeDistributed?<br/>
– what situation suites config 2 (samples, multi-time-steps, features)?</p>
<div class="reply">
<a aria-label="Reply to Birkey" class="comment-reply-link" href="#comment-399890" onclick='return addComment.moveForm( "comment-399890", "399890", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-399892">
<div class="comment-container" id="li-comment-399892">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfccb37eb2036bb031f66fc21c544815?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfccb37eb2036bb031f66fc21c544815?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Birkey</span>
<span class="date">May 17, 2017 at 7:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-399892" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I guess for sequence-to-vector problem (predict one target one time step), config 2 is fine. But for sequence-to-sequence problem discussed here, config 2 is not the right choice, go TimeDistributed.</p>
<div class="reply">
<a aria-label="Reply to Birkey" class="comment-reply-link" href="#comment-399892" onclick='return addComment.moveForm( "comment-399892", "399892", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399931">
<div class="comment-container" id="li-comment-399931">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 18, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-399931" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very nice, yes I agree.</p>
<p>Generally, we must model sequences as time steps. BPTT will use the sequence data to estimate the gradient. LSTMs have memory, but we cannot rely on them to remember everything (e.g. sequence length of 1).</p>
<p>We can configure an MLP or LSTM to output a vector. For an LSTM, if we output a vector of n values for one time step, each output is considered by the LSTM as a feature, not a time step. Thus it is a many-to-one architecture. The vector may contain timesteps, but the LSTM is not outputting time steps, it is outputting features.</p>
<p>This is no more or less valid, it may require more weights and may give better or worse performance.</p>
<p>Does that make sense?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-399931" onclick='return addComment.moveForm( "comment-399931", "399931", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-399939">
<div class="comment-container" id="li-comment-399939">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ce481eb218a5d07e5e88a2ebd269c15c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ce481eb218a5d07e5e88a2ebd269c15c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Victor Garcia Cazorla</span>
<span class="date">May 18, 2017 at 9:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-399939" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Any recommendations when facing a one-to-many problem?</p>
<div class="reply">
<a aria-label="Reply to Victor Garcia Cazorla" class="comment-reply-link" href="#comment-399939" onclick='return addComment.moveForm( "comment-399939", "399939", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400001">
<div class="comment-container" id="li-comment-400001">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2017 at 8:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-400001" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>They often need more training than you think and consider using bidirectional inputs and regularization on input connections.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-400001" onclick='return addComment.moveForm( "comment-400001", "400001", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-404943">
<div class="comment-container" id="li-comment-404943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://babble-rnn.consected.com" rel="external nofollow">Phil Ayres</a></span>
<span class="date">July 6, 2017 at 8:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-404943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post is great! Thanks for being about the only person to actually explain simply what the TimeDistributed wrapper is doing. </p>
<p>I tried it out with audio vocal data to attempt generation of new speech. I’d previously got basic results with a plain Dense layer on the output. </p>
<p>With the TimeDistributed the network of lstms learned fast. But the result was just to return a rough version of the seed data inputted during generation. This appears to be modelling the equality function, when what I expected was something resembling the sequence following the seed. </p>
<p>My X input is an array of batches, timesteps, and vocal properties. Just a longer version of your example. My y output for measuring error is effectively the same data, just one timestamp later for each batch (time sequence). </p>
<p>Since your examples are for equality modelling, it’s hard to tell if I’ve missed a concept. Any thoughts on why this seems to generate equality rather than next timesteps, from my basic description?</p>
<p>By the way, my original project without TimeDistributed is found at <a href="http://babble-rnn.consected.com" rel="nofollow">http://babble-rnn.consected.com</a> in case you’re interested in extra context.</p>
<div class="reply">
<a aria-label="Reply to Phil Ayres" class="comment-reply-link" href="#comment-404943" onclick='return addComment.moveForm( "comment-404943", "404943", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-405227">
<div class="comment-container" id="li-comment-405227">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 9, 2017 at 10:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405227" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you need to fit for longer or require more training data?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-405227" onclick='return addComment.moveForm( "comment-405227", "405227", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-405411">
<div class="comment-container" id="li-comment-405411">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Phil Ayres</span>
<span class="date">July 10, 2017 at 9:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405411" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I wondered about that. I think my mistake may be simple…</p>
<p>Imagine the sequence I was trying to learn was 1,2,3,4,5,6,7,8 (which I’d normalise in the range 0:1). In the standard Keras LSTM example without TimeDistributed I’d have:</p>
<p>input X[0] = [0,1,2]<br/>
output y[0] = [3]<br/>
X[1] = [1,2,3]<br/>
y[1] = [4]<br/>
…</p>
<p>So in the TimeDistributed setup I reported above, I tried:</p>
<p>X[0] = [0,1,2]<br/>
y[0] = [1,2,3]<br/>
X[1] = [1,2,3]<br/>
y[1] = [2,3,4]<br/>
…<br/>
In other words, I was offsetting the intended output by just a single timestep for each batch to be learned.</p>
<p>But I’m guessing that I should really offset the output to be learned by the full number of timesteps in each batch:</p>
<p>X[0] = [0,1,2]<br/>
y[0] = [3,4,5]<br/>
X[1] = [1,2,3]<br/>
y[1] = [4,5,6]</p>
<p>Is the latter example what I should be doing? Intuitively, this would explain why I was learning something close to equality in my first run. But from multiple readings of your code in the post it is not clear to me that this is the case.</p>
<div class="reply">
<a aria-label="Reply to Phil Ayres" class="comment-reply-link" href="#comment-405411" onclick='return addComment.moveForm( "comment-405411", "405411", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-405482">
<div class="comment-container" id="li-comment-405482">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 11, 2017 at 10:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405482" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure I follow. There are indeed many ways to frame a sequence prediction problem.</p>
<p>The simplest framing is sequence in =&gt; sequence out where either in or out could be one or more time steps.</p>
<p>Keep one sequence as one sample if possible.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-405482" onclick='return addComment.moveForm( "comment-405482", "405482", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-405551">
<div class="comment-container" id="li-comment-405551">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Phil Ayres</span>
<span class="date">July 12, 2017 at 12:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405551" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hmm, I think I have missed something big here. Please humour and let me try once more. </p>
<p>In the standard LSTM examples on Keras, if I was to learn a long time sequence (for example integers incrementing in the range 1..100000), I would pick a shorter segment of the total sequence to pass to the LSTM (I split my corpus into sub-batches that represent the number of LSTM timesteps), then the output to learn would be just the next item in the sequence. There is no TimeDistributed output, so I get one result to calculate error against.</p>
<p>input set: 1,2,3<br/>
desired output: 4</p>
<p>then repeat with other sub-batches in the same way (and Keras scrambles the order), so the next one may be…</p>
<p>input set: 473, 474, 475<br/>
desired output: 476</p>
<p>If that makes sense, then allow me to ask simply what the input and output should be for the TimeDistributed setup. Would it be</p>
<p>(option A)<br/>
input set: 1, 2, 3<br/>
desired output: 2, 3, 4</p>
<p>(option B)<br/>
input set: 1, 2, 3<br/>
desired output: 4, 5, 6</p>
<p>(option C)<br/>
something else entirely.</p>
<p>Am I making more sense now?</p>
<p>Your example shows input set and desired output being the same, which says to me that the net will just learn the equality function. Again, am I missing something?</p>
<p>Thanks again for your help.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-405602">
<div class="comment-container" id="li-comment-405602">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2017 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405602" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, good question.</p>
<p>Option B.</p>
<p>In your first example you have a many-to-one time step predictive model. In option B you have a many-to-many time step predictive model. The TimeDistributed wrapper would allow you to use the same Dense layer to output each time step in the output sequence, in this case one output time step per input time step.</p>
<p>I hope that helps.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-419952">
<div class="comment-container" id="li-comment-419952">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.etherpros.com" rel="external nofollow">John Strong</a></span>
<span class="date">November 14, 2017 at 10:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-419952" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Agreed. Jason’s practically the only person to explain all kinds of things, especially with regard to the tricky subject of data dimensions in the various permutations of different types of NN layers. It has gotten to point where I approach any new Keras subject by including his name in the Google search.</p>
<div class="reply">
<a aria-label="Reply to John Strong" class="comment-reply-link" href="#comment-419952" onclick='return addComment.moveForm( "comment-419952", "419952", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-419956">
<div class="comment-container" id="li-comment-419956">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 14, 2017 at 10:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-419956" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Haha, thanks John! </p>
<p>If you ever need help on these types of topics, post or email a question to me. I’ll whip up a post. Sounds like I’ve found a valuable niche 🙂</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-419956" onclick='return addComment.moveForm( "comment-419956", "419956", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-405042">
<div class="comment-container" id="li-comment-405042">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1b5b73184d41bb86c47d8eb576fb851c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1b5b73184d41bb86c47d8eb576fb851c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">zceewhc</span>
<span class="date">July 7, 2017 at 10:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405042" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the great article!</p>
<p>Having looked through this article and forums online, is it correct to say that if we were to do many-to-one prediction (an input vector with an output value), it will be straightforward and faster to just use the Dense layer? </p>
<p>In the case where we want to do many-to-many predictions (multiple input vectors/matrices with an output vector/matrix), TimeDistributed layer should be used instead?</p>
<div class="reply">
<a aria-label="Reply to zceewhc" class="comment-reply-link" href="#comment-405042" onclick='return addComment.moveForm( "comment-405042", "405042", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-405252">
<div class="comment-container" id="li-comment-405252">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 9, 2017 at 10:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405252" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but in the latter case the dense is wrapped in the timedistributed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-405252" onclick='return addComment.moveForm( "comment-405252", "405252", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-455870">
<div class="comment-container" id="li-comment-455870">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4da9475fe9401558a2a3d7421edc281e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4da9475fe9401558a2a3d7421edc281e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jairo</span>
<span class="date">November 23, 2018 at 1:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-455870" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you. I thought the TimeDistributed layer was going to be used to “pass sequentially” the inputs fot the LSTM layer.</p>
<p>Now I understood that the TimeDistributed layer simply “freezes” the Dense output layer weights in order for them to seem like the Dense part is just another “recurrent” tip of the LSTM layer.</p>
<p>One question:<br/>
Why do we always have a Dense layer after the last LSTM? Is that a requirement? If yes, why?</p>
<p>Thank you Dr. Jason!</p>
<div class="reply">
<a aria-label="Reply to Jairo" class="comment-reply-link" href="#comment-455870" onclick='return addComment.moveForm( "comment-455870", "455870", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-455895">
<div class="comment-container" id="li-comment-455895">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-455895" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There’s no requirement to wrap a Dense layer, wrap anything you wish.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455895" onclick='return addComment.moveForm( "comment-455895", "455895", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-405650">
<div class="comment-container" id="li-comment-405650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/59bd5a9012c5648af2965f00c459c4ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Phil Ayres</span>
<span class="date">July 12, 2017 at 5:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That does, thank you! For some reason I couldn’t get that from your post, so thanks for taking the time to explain in more detail.</p>
<div class="reply">
<a aria-label="Reply to Phil Ayres" class="comment-reply-link" href="#comment-405650" onclick='return addComment.moveForm( "comment-405650", "405650", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-405614">
<div class="comment-container" id="li-comment-405614">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d7169af3ae10b1f6de0580f882e786c9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d7169af3ae10b1f6de0580f882e786c9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexandr Pavel</span>
<span class="date">July 12, 2017 at 10:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405614" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, that cleared up return_sequences for me, but I still don’t fully understand what TimeDistributed does.</p>
<p>In the last example (Many-to-Many): If I change TimeDistributed(Dense(1)) to just Dense(1), neither the output shape nor the number of parameters changes and it works just as well. What is the difference between these two options in this case?</p>
<div class="reply">
<a aria-label="Reply to Alexandr Pavel" class="comment-reply-link" href="#comment-405614" onclick='return addComment.moveForm( "comment-405614", "405614", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-405711">
<div class="comment-container" id="li-comment-405711">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 13, 2017 at 9:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-405711" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Note the number of weights in the network.</p>
<p>Without the TimeDistributed wrapper, the Dense is connected to the output from each time step. With the wrapper, the same Dense is applied to each time step. </p>
<p>It’s a question of how you want to model the problem. Let the Dense combine the time steps and output a vector or process each time step one at a time.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-405711" onclick='return addComment.moveForm( "comment-405711", "405711", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-411818">
<div class="comment-container" id="li-comment-411818">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/326f64ef151a4e4aaf17af5479b7aa34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/326f64ef151a4e4aaf17af5479b7aa34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Varuna Bamunusinghe</span>
<span class="date">August 31, 2017 at 2:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-411818" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the article. I have the same question though… number of weights are same regardless of Dense is wrapped by TimeDistributed or not. So, what is the difference, and where can I see that?</p>
<div class="reply">
<a aria-label="Reply to Varuna Bamunusinghe" class="comment-reply-link" href="#comment-411818" onclick='return addComment.moveForm( "comment-411818", "411818", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-411851">
<div class="comment-container" id="li-comment-411851">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-411851" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>But we have the same number of weights in a many-to-many model as we did no the one-to-one model.</p>
<p>A better model design for increased model complexity/capability with the same resources.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-411851" onclick='return addComment.moveForm( "comment-411851", "411851", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-406793">
<div class="comment-container" id="li-comment-406793">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/548d49f09bfa14c3dc6fc01bd3309046?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/548d49f09bfa14c3dc6fc01bd3309046?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">chintan zaveri</span>
<span class="date">July 22, 2017 at 4:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-406793" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey,<br/>
Thanks for amazing tutorial.<br/>
This shows simple echo program implementation right ?</p>
<p>I want something like –<br/>
Input(For time period 2012-2013) – 1,2,5,3,6,4,7,8,9,5<br/>
output(For Time Period 2014) – 1,3,4</p>
<p>The output sequence should be generated based on the input sequence, kindly guide me on that.</p>
<div class="reply">
<a aria-label="Reply to chintan zaveri" class="comment-reply-link" href="#comment-406793" onclick='return addComment.moveForm( "comment-406793", "406793", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-406836">
<div class="comment-container" id="li-comment-406836">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 22, 2017 at 8:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-406836" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds great.</p>
<p>What is the issue exactly? You can use code from the blog directly and adapt it for your problem. Where are you having trouble?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-406836" onclick='return addComment.moveForm( "comment-406836", "406836", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-406798">
<div class="comment-container" id="li-comment-406798">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fc06b93e29f78e7e0ae9e0db48b5865f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fc06b93e29f78e7e0ae9e0db48b5865f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ISR</span>
<span class="date">July 22, 2017 at 4:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-406798" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How to create a pyramid of LSTMs. i.e. the input to the first node of 2nd layer LSTM will be output at t1 and t2 of first layer LSTM, similrly 2nd node of the 2nd layer will use t3 and t4 from first layer, and so on..</p>
<div class="reply">
<a aria-label="Reply to ISR" class="comment-reply-link" href="#comment-406798" onclick='return addComment.moveForm( "comment-406798", "406798", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-406837">
<div class="comment-container" id="li-comment-406837">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 22, 2017 at 8:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-406837" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You mean a stacked LSTM?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-406837" onclick='return addComment.moveForm( "comment-406837", "406837", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-410730">
<div class="comment-container" id="li-comment-410730">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cdc8815b0e20a3ffe34bf9bae93cc85?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cdc8815b0e20a3ffe34bf9bae93cc85?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://exceptioncoder.com" rel="external nofollow">Sri Harsha Gangisetty</a></span>
<span class="date">August 23, 2017 at 6:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-410730" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hmm, that’s an interesting layer configuration, I would go with Tensorflow module directly instead of Keras to create such a model, Keras doesn’t have that functionality I guess.</p>
<div class="reply">
<a aria-label="Reply to Sri Harsha Gangisetty" class="comment-reply-link" href="#comment-410730" onclick='return addComment.moveForm( "comment-410730", "410730", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-408925">
<div class="comment-container" id="li-comment-408925">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1bb0f856ca16ee025470fd8aba5d6203?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1bb0f856ca16ee025470fd8aba5d6203?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ilja</span>
<span class="date">August 8, 2017 at 10:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-408925" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello! Is the a way to have DIFFERENT length of input and output-timesteps?<br/>
Like, I have series with 100 timesteps in the past and will learn next 10 in the feature?<br/>
TimeDistributed requires equal length.<br/>
If I output return_sequence=false in the last LSTM and Dense with 10 neurones, would it be the same?<br/>
Thanks You!</p>
<div class="reply">
<a aria-label="Reply to Ilja" class="comment-reply-link" href="#comment-408925" onclick='return addComment.moveForm( "comment-408925", "408925", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408955">
<div class="comment-container" id="li-comment-408955">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 8, 2017 at 5:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-408955" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow, can you restate your question?</p>
<p>Generally, different numbers of times steps on the input and output are referred to as seq2seq problems and are perhaps best addressed with an encoder-decoder network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-408955" onclick='return addComment.moveForm( "comment-408955", "408955", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-411721">
<div class="comment-container" id="li-comment-411721">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69cfca0d66219b4c859047ec1ef89bd2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69cfca0d66219b4c859047ec1ef89bd2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">james</span>
<span class="date">August 30, 2017 at 9:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-411721" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is the procedure similar when using SimpleRNN?</p>
<div class="reply">
<a aria-label="Reply to james" class="comment-reply-link" href="#comment-411721" onclick='return addComment.moveForm( "comment-411721", "411721", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411760">
<div class="comment-container" id="li-comment-411760">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2017 at 4:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-411760" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you mean James?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-411760" onclick='return addComment.moveForm( "comment-411760", "411760", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413834">
<div class="comment-container" id="li-comment-413834">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/892f7184439305a8d8e8073aabe717ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/892f7184439305a8d8e8073aabe717ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Darshan Bagul</span>
<span class="date">September 15, 2017 at 4:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-413834" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Nice article. I was wondering if TimeDistributed layer in Keras is analogous to sequence-to-sequence learning module in Tensorflow. If not, could you point out the distinction between the two?<br/>
Thanks.</p>
<div class="reply">
<a aria-label="Reply to Darshan Bagul" class="comment-reply-link" href="#comment-413834" onclick='return addComment.moveForm( "comment-413834", "413834", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413904">
<div class="comment-container" id="li-comment-413904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2017 at 12:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-413904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot draw this comparison for you as I am not deeply familiar with the TF code.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-413904" onclick='return addComment.moveForm( "comment-413904", "413904", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-414085">
<div class="comment-container" id="li-comment-414085">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bc889007e6e9189126206d30e2955460?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bc889007e6e9189126206d30e2955460?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eldar M.</span>
<span class="date">September 17, 2017 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414085" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason. I hope I’m understanding this correctly.</p>
<p>I was trying to model a certain number of days ahead, and found myself frustrated with the fact that I couldn’t just predict one day ahead, then right away use that as part of the sliding input window prior to weights being adjusted – basically I wanted the sliding window to move n days forward using predicted values and only then have gradient descent update weights.</p>
<p>I think this might be the way to do so, but am unsure if I need to wrap every layer in timedistributed or what exactly to do with that.</p>
<div class="reply">
<a aria-label="Reply to Eldar M." class="comment-reply-link" href="#comment-414085" onclick='return addComment.moveForm( "comment-414085", "414085", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414148">
<div class="comment-container" id="li-comment-414148">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 18, 2017 at 5:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414148" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can do this, but you will need to create the sliding window yourself and call your model recursively. </p>
<p>Keras will not do this for you with the TimeDistributed layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-414148" onclick='return addComment.moveForm( "comment-414148", "414148", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-414217">
<div class="comment-container" id="li-comment-414217">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e4a447a6bf160fb318070b87a5014525?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e4a447a6bf160fb318070b87a5014525?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abuzar</span>
<span class="date">September 19, 2017 at 2:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414217" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this post,</p>
<p>I have an Input sequence and output sequence shape as follows:<br/>
X_shape: (1, 82600, 1)<br/>
Y_shape: (1, 82600, 1)</p>
<p>When I try to use your code for this input and output I get following error:<br/>
—————————————————————————<br/>
MemoryError                               Traceback (most recent call last)<br/>
 in ()<br/>
     60 # create LSTM<br/>
     61 model = Sequential()<br/>
—&gt; 62 model.add(LSTM(n_neurons, input_shape=(length, 1), return_sequences=True))<br/>
     63 model.add(TimeDistributed(Dense(1)))</p>
<p>How can I go around this?</p>
<div class="reply">
<a aria-label="Reply to Abuzar" class="comment-reply-link" href="#comment-414217" onclick='return addComment.moveForm( "comment-414217", "414217", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-414219">
<div class="comment-container" id="li-comment-414219">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e4a447a6bf160fb318070b87a5014525?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e4a447a6bf160fb318070b87a5014525?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abuzar</span>
<span class="date">September 19, 2017 at 2:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414219" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Since my length was 82600, according to the code, nb_neurons = 82600</p>
<p>I just reduced the number of neurons to 8260 and the compilation was successful</p>
<p>Since, by default this model is stateless (stateful = True) is not specifically specified, do you think reducing the number of neurons was a right choice or could you suggest some other method.</p>
<p>Note: In my sequence of length 82600, every 10 numbers are dependent on previous 10 numbers.</p>
<div class="reply">
<a aria-label="Reply to Abuzar" class="comment-reply-link" href="#comment-414219" onclick='return addComment.moveForm( "comment-414219", "414219", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-414251">
<div class="comment-container" id="li-comment-414251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 19, 2017 at 7:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, that was far too many neurons for the first hidden layer. Nice work.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-414251" onclick='return addComment.moveForm( "comment-414251", "414251", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414250">
<div class="comment-container" id="li-comment-414250">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 19, 2017 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414250" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you have too much data to fit into memory.</p>
<p>Perhaps work with a smaller sample?<br/>
Perhaps try running on a larger computer like AWS?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-414250" onclick='return addComment.moveForm( "comment-414250", "414250", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-414390">
<div class="comment-container" id="li-comment-414390">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e4a447a6bf160fb318070b87a5014525?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e4a447a6bf160fb318070b87a5014525?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abuzar</span>
<span class="date">September 21, 2017 at 1:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414390" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Thanks for responses,</p>
<p>In extension to the question that Phil Ayres asked:</p>
<p>My training data shape is (4096,8) that is 4096 rows and each row has 8 features (8 numeric values).</p>
<p>and the target shape is the same.</p>
<p>Requirement is one entire row is responsible to predict the next row.<br/>
example:<br/>
input<br/>
[1,2,3,4,5,6,7,8]</p>
<p>expected<br/>
[100,200,300,400,500,600,700,800]</p>
<p>How can I use time distributed for this kind of data.<br/>
Can you please provide an example?<br/>
Do I have to call model iteratively, if yes how?</p>
<div class="reply">
<a aria-label="Reply to Abuzar" class="comment-reply-link" href="#comment-414390" onclick='return addComment.moveForm( "comment-414390", "414390", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-414415">
<div class="comment-container" id="li-comment-414415">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 21, 2017 at 5:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-414415" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your problem is seq2seq:<br/>
<a href="https://machinelearningmastery.com/models-sequence-prediction-recurrent-neural-networks/" rel="nofollow">https://machinelearningmastery.com/models-sequence-prediction-recurrent-neural-networks/</a></p>
<p>You have options:</p>
<p>1. The model can output one output time step for each input time step (e.g. via timedistributed).<br/>
2. The model can read the entire input sequence, encode it, then output the entire output sequence (e.g. no timedistributed).</p>
<p>I would recommend trying both approaches and see what works best for your data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-414415" onclick='return addComment.moveForm( "comment-414415", "414415", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-416870">
<div class="comment-container" id="li-comment-416870">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/740cace112999287d056d47e5ec406e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/740cace112999287d056d47e5ec406e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">gana</span>
<span class="date">October 16, 2017 at 2:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-416870" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you sir</p>
<p>For the clarification i have a question that i have a bit of confusion on parameters you have explained above. </p>
<p>For example:<br/>
3D sequence with 5 samples, 1 time step, and 1 feature. We will define the output as 5 samples with 1 feature.</p>
<p>X = seq.reshape(5, 1, 1)<br/>
y = seq.reshape(5, 1)</p>
<p>What are feature and samples in this example? </p>
<p>Let me have one example assuming we are working on images.<br/>
Then i have 2 classes: class-1 is running man (a sequence with 100 images) and class-2 is walking man (a sequence with 100 images).</p>
<p>Then:<br/>
– sample = 2 means 1 image from class-1 and 1 image from class-2?<br/>
  or just 2 images from class-1 or class-2?<br/>
  If batch is set of samples then why we define sample = 5 and again batch =<br/>
  5 in this example?<br/>
  If sample = 1 then we can define batch = 1. What are difference?    </p>
<p>– time step = 10 means we are taking images (t1-t10) from 100 images of a<br/>
 class for prediction? and next time step we are talking images (t2-t11) and<br/>
 (t3-t12) etc?</p>
<p>– is ‘feature’ image dimension or feature map as an output of Conv layer?<br/>
  it sounds like a dimension in this example, however cnn says it is output of<br/>
  conv layer while we are defining ‘feature’ for input image.<br/>
  if my input image has width = 100 and height = 50 then feature = 5000?</p>
<div class="reply">
<a aria-label="Reply to gana" class="comment-reply-link" href="#comment-416870" onclick='return addComment.moveForm( "comment-416870", "416870", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416885">
<div class="comment-container" id="li-comment-416885">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2017 at 3:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-416885" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I explain the LSTM input format in more detail here:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-416885" onclick='return addComment.moveForm( "comment-416885", "416885", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-417894">
<div class="comment-container" id="li-comment-417894">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1ee5b8a43df47601b42585e95272ea7f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1ee5b8a43df47601b42585e95272ea7f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Garry</span>
<span class="date">October 25, 2017 at 6:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-417894" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, first of all thanks for your wonderful tutorial. However, I found myself a bizarre issue when testing out on your third example, which is Many-to-Many LSTM for Sequence Prediction (with TimeDistributed). When I remove the TimeDistributed wrapping for the dense layer while keeping the return sequence statement true for the LSTM layer, the model’s summary doesn’t seem to change (same param #). I suppose removing the TimeDistributed wrapping for the dense layer implies a huge fully connected layer connecting to all the outputs of all time stamps, whereas wrapping by the TimeDistributed implies a relatively small fully connected layer connecting to the outputs of one time stamp at a time. Any explanations to this problem? Thanks in advance 🙂</p>
<div class="reply">
<a aria-label="Reply to Garry" class="comment-reply-link" href="#comment-417894" onclick='return addComment.moveForm( "comment-417894", "417894", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417958">
<div class="comment-container" id="li-comment-417958">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2017 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-417958" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes – I have noticed in some of my own experiments that it seems that Dense can now support 3D input without the wrapper.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417958" onclick='return addComment.moveForm( "comment-417958", "417958", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-434522">
<div class="comment-container" id="li-comment-434522">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/487645f035e9b2f095acf7510b32ce89?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/487645f035e9b2f095acf7510b32ce89?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Willie Maddox</span>
<span class="date">April 9, 2018 at 12:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-434522" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Support is one thing, behavior is another.  Are you saying that a “TimeDistributed(Dense(n)) “layer is no different than a plain “Dense(n)” layer?</p>
<div class="reply">
<a aria-label="Reply to Willie Maddox" class="comment-reply-link" href="#comment-434522" onclick='return addComment.moveForm( "comment-434522", "434522", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-434589">
<div class="comment-container" id="li-comment-434589">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 10, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-434589" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is the same layer, but the wrapper allows the weights required for one time step output from the LSTM to be reused for each time step.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434589" onclick='return addComment.moveForm( "comment-434589", "434589", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420610">
<div class="comment-container" id="li-comment-420610">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harry Garrison</span>
<span class="date">November 20, 2017 at 3:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420610" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this amazing explanation, Jason! I have already put it to the test by creating a “denoiser”, where an image with noise is given as input and a clean version of that image is returned. This is a problem typically solved with the use of autoencoders, which are a complex matter if you ask me. However, I was able to pull this through using this tutorial and that got me thinking: would it be possible to train many-to-many architectures without autoencoders, just by padding input and output sequences to a fixed length? And if yes, would this model work with one-hot encoded vectors? I am not sure how mean squared error calculates results, but would it work with padded, one-hot encoded timestep sequences?</p>
<div class="reply">
<a aria-label="Reply to Harry Garrison" class="comment-reply-link" href="#comment-420610" onclick='return addComment.moveForm( "comment-420610", "420610", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420644">
<div class="comment-container" id="li-comment-420644">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 20, 2017 at 10:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420644" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I don’t see why not.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420644" onclick='return addComment.moveForm( "comment-420644", "420644", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420775">
<div class="comment-container" id="li-comment-420775">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9cd7850606fe952ba9401cd5be3f591e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9cd7850606fe952ba9401cd5be3f591e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">daniel</span>
<span class="date">November 22, 2017 at 3:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420775" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thank you for this great post.<br/>
I’ve read this post three times and the forum discussions, but I still can’t understand how to apply the techniques to the topic I have been working on recently. </p>
<p>Here is the scenario</p>
<p>Input:<br/>
[a1,a2,a3,a4,a5,…,aN]<br/>
[b1,b2,b3,b4,b5,…,bN]<br/>
[c1,c2,c3,c4,c5,….,cN]</p>
<p>Output:<br/>
[yN+1,yN+2,yN+3,yN+4,yN+5,….,yM]        </p>
<p>(  Imagine we have history stock related data (a ,b,c, 3 features of the input). They are all time-series.<br/>
And the task is to make predictions ,say, 10 steps ahead ( y of the output )    )</p>
<p>Is this a many to many sequence prediction ?<br/>
If it is, then based on the discussions above, I think I would have to use TimeDistributedDense.</p>
<p>However, according to the heavy discussion in the github link below,<br/>
<a href="https://github.com/fchollet/keras/issues/1029" rel="nofollow">https://github.com/fchollet/keras/issues/1029</a><br/>
“For each sample, the input is a sequence (a1,a2,a3,a4…aN) and the output is a sequence (b1,b2,b3,b4…bN) with the same length. bi could be viewed as the label of ai.<br/>
Push a1 into a recurrent nn to get output b1. Than push a2 and the hidden output of a1 to get b2…”</p>
<p>It seems that TimeDistributedDense is for sequence labeling, so it is not suitable for my case. Am I right ?</p>
<div class="reply">
<a aria-label="Reply to daniel" class="comment-reply-link" href="#comment-420775" onclick='return addComment.moveForm( "comment-420775", "420775", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420821">
<div class="comment-container" id="li-comment-420821">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2017 at 11:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420821" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will help:<br/>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420821" onclick='return addComment.moveForm( "comment-420821", "420821", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420901">
<div class="comment-container" id="li-comment-420901">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/02b96efb73ee673ad268766964c5bc6f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/02b96efb73ee673ad268766964c5bc6f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arnold Christian Loaiza Fabian</span>
<span class="date">November 23, 2017 at 3:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420901" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
I have my information in the following way:</p>
<p>  X                 						Y<br/>
 ==========                                  =============<br/>
 t1,t2, t3,  t4,t5, t6, t7, t8, t9,t10       t11,t12,t13,t14,t15</p>
<p>10,20,20,30,30,40,50,50,50,60       60, 60,70 ,70 ,70</p>
<p> I have 10 most recent time steps to predict the next 5 steps.  </p>
<p>In this case from many to many, I could use that method without TimeDistributed for the dense layer ?. Because I understood that in that case the number of dense layer neurons would give me the value for each time step, in this case if I put 5 neurons would have 5 values representing my 5 time steps.<br/>
Or maybe I should use the TimeDistributed (DenseLayer) to produce the prediction of the next 5 steps? I’m confused.</p>
<div class="reply">
<a aria-label="Reply to Arnold Christian Loaiza Fabian" class="comment-reply-link" href="#comment-420901" onclick='return addComment.moveForm( "comment-420901", "420901", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-420905">
<div class="comment-container" id="li-comment-420905">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/02b96efb73ee673ad268766964c5bc6f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/02b96efb73ee673ad268766964c5bc6f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arnold Christian Loaiza Fabian</span>
<span class="date">November 23, 2017 at 4:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420905" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I read your post about encoder-decoder. I do not want to use that configuration, I could convert my problem to many to one, and use the only predicted value t11 to predict the next t12 and so on. Does that idea seem right to you?</p>
<p>PS: I also saw an example using repeatvector to be able to do my problem, but I do not know if it is correct.</p>
<div class="reply">
<a aria-label="Reply to Arnold Christian Loaiza Fabian" class="comment-reply-link" href="#comment-420905" onclick='return addComment.moveForm( "comment-420905", "420905", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-420952">
<div class="comment-container" id="li-comment-420952">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420952" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will help:<br/>
<a href="https://machinelearningmastery.com/models-sequence-prediction-recurrent-neural-networks/" rel="nofollow">https://machinelearningmastery.com/models-sequence-prediction-recurrent-neural-networks/</a></p>
<p>Yes, there are multiple ways to formulate the encoder-decoder model, one way with the repeat vector is easy to code and results in good performance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420952" onclick='return addComment.moveForm( "comment-420952", "420952", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420950">
<div class="comment-container" id="li-comment-420950">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-420950" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow your data.</p>
<p>If you have 5 outputs, you can have a model that outputs a vector of all 5 values or output one at a time using a distributed dense. Why not try both and see which framing of the problem is easier to learn or results in better skill?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420950" onclick='return addComment.moveForm( "comment-420950", "420950", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421765">
<div class="comment-container" id="li-comment-421765">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1e8ced31df9006f997fd7004189bb1af?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1e8ced31df9006f997fd7004189bb1af?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">n1k31t4</span>
<span class="date">December 1, 2017 at 2:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-421765" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Running examples 1 and 2 (just copying your code) returned loss values during training of <code>nan</code> and then correspondingly I got <code>nan</code> values for the predictions. After some playing around, I found that simply changing the optimizer to <code>sgd</code> fixed the issue. I had first tried different learning rates within an <code>Adam</code> class for optimisation, but it always returned <code>nan</code>s. I can’t from the Keras implementation why this might be the case.</p>
<div class="reply">
<a aria-label="Reply to n1k31t4" class="comment-reply-link" href="#comment-421765" onclick='return addComment.moveForm( "comment-421765", "421765", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421814">
<div class="comment-container" id="li-comment-421814">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 1, 2017 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-421814" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421814" onclick='return addComment.moveForm( "comment-421814", "421814", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421872">
<div class="comment-container" id="li-comment-421872">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2f1b9c87315fd529e7fd1f8ecc60fdeb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2f1b9c87315fd529e7fd1f8ecc60fdeb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vishal</span>
<span class="date">December 1, 2017 at 9:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-421872" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Nice post! Have a question regarding your statement: “The LSTM units have been crippled and will each output a single value, providing a vector of 5 values as inputs to the fully connected layer. The time dimension or sequence information has been thrown away and collapsed into a vector of 5 values.”</p>
<p>What I am understanding from your statement above is that configuration 2 does not give any opportunity for the unrolling. It is almost like an MLP network. Please correct me if I am wrong. Thank you.</p>
<div class="reply">
<a aria-label="Reply to Vishal" class="comment-reply-link" href="#comment-421872" onclick='return addComment.moveForm( "comment-421872", "421872", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421914">
<div class="comment-container" id="li-comment-421914">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2017 at 9:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-421914" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Indeed, there is no unrolling when time steps are set to 1.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421914" onclick='return addComment.moveForm( "comment-421914", "421914", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421873">
<div class="comment-container" id="li-comment-421873">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2f1b9c87315fd529e7fd1f8ecc60fdeb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2f1b9c87315fd529e7fd1f8ecc60fdeb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vishal</span>
<span class="date">December 1, 2017 at 9:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-421873" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If my understanding is correct, can you please explain why you have used “LSTM units” and not “LSTM unit”. If all I am doing is taking a 5 length sequence as an input and outputting a 5 length sequence, then why do I need multiple LSTM units? Please explain.</p>
<div class="reply">
<a aria-label="Reply to Vishal" class="comment-reply-link" href="#comment-421873" onclick='return addComment.moveForm( "comment-421873", "421873", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421915">
<div class="comment-container" id="li-comment-421915">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2017 at 9:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-421915" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The length of input sequences is unrelated to the number of units in the LSTM layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421915" onclick='return addComment.moveForm( "comment-421915", "421915", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422935">
<div class="comment-container" id="li-comment-422935">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fbaf6aec7152c7d2fb5ce3581500a341?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fbaf6aec7152c7d2fb5ce3581500a341?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">beginer</span>
<span class="date">December 13, 2017 at 5:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-422935" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hloo,<br/>
I have  a silly doubt that how one-to -one model be a sequence prediction problem because there is no any sequence in input neither any timesteps.</p>
<div class="reply">
<a aria-label="Reply to beginer" class="comment-reply-link" href="#comment-422935" onclick='return addComment.moveForm( "comment-422935", "422935", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422960">
<div class="comment-container" id="li-comment-422960">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-422960" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question.</p>
<p>If we don’t reset state, there can still be memory from prior I/O, just no BPTT going on.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-422960" onclick='return addComment.moveForm( "comment-422960", "422960", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423133">
<div class="comment-container" id="li-comment-423133">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e3f2ce8688757df67390f03cb7b5bf2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e3f2ce8688757df67390f03cb7b5bf2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nadav B</span>
<span class="date">December 15, 2017 at 1:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-423133" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Small typo “afully-connectedd”</p>
<div class="reply">
<a aria-label="Reply to Nadav B" class="comment-reply-link" href="#comment-423133" onclick='return addComment.moveForm( "comment-423133", "423133", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423157">
<div class="comment-container" id="li-comment-423157">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 15, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-423157" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, fixed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-423157" onclick='return addComment.moveForm( "comment-423157", "423157", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425779">
<div class="comment-container" id="li-comment-425779">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eafdfd56ba4249c22afd26754524b148?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eafdfd56ba4249c22afd26754524b148?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Steve Nguyen</span>
<span class="date">January 6, 2018 at 3:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-425779" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>I purchased entire bundle, great stuffs ! I have question regarding LSTM though. I have a times-series multi-label problem that need to be classified. The problem somewhat the same as the paper “LEARNING TO DIAGNOSE WITH LSTM RECURRENT<br/>
NEURAL NETWORKS” at <a href="https://arxiv.org/pdf/1511.03677.pdf" rel="nofollow">https://arxiv.org/pdf/1511.03677.pdf</a>.</p>
<p>At each end of each sequence (says 3 diagnostic events / sequence ) they they calculate losses differently: calculate log-loss at each time-steps vs multi-label target, and then combing with final output vs multi-label target and then mean them out for entire sequence.</p>
<p>How do I implement this in Keras ?</p>
<p>Thanks you in advanced.<br/>
Steve</p>
<div class="reply">
<a aria-label="Reply to Steve Nguyen" class="comment-reply-link" href="#comment-425779" onclick='return addComment.moveForm( "comment-425779", "425779", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425803">
<div class="comment-container" id="li-comment-425803">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 7, 2018 at 5:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-425803" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I am not familiar with that paper, perhaps contact the authors and ask what type of sequence prediction problem it is.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425803" onclick='return addComment.moveForm( "comment-425803", "425803", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426016">
<div class="comment-container" id="li-comment-426016">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/35a3998398c6e59866578d003783fb33?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/35a3998398c6e59866578d003783fb33?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Linh</span>
<span class="date">January 10, 2018 at 12:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426016" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>When I tried<br/>
# train LSTM<br/>
model.fit(X, y, epochs=n_epoch, batch_size=n_batch, verbose=2)</p>
<p>The system create the error:<br/>
“TypeError                                 Traceback (most recent call last)<br/>
C:\Users\Nguyen Viet Linh\Anaconda3\lib\site-packages\theano\gof\cc.py in compile_args(self)<br/>
    965                 try:<br/>
–&gt; 966                     ret += x.c_compile_args(c_compiler)<br/>
    967                 except TypeError:</p>
<p>TypeError: c_compile_args() takes 1 positional argument but 2 were given”</p>
<div class="reply">
<a aria-label="Reply to Linh" class="comment-reply-link" href="#comment-426016" onclick='return addComment.moveForm( "comment-426016", "426016", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426068">
<div class="comment-container" id="li-comment-426068">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426068" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Looks like your backend might not be installed correctly.</p>
<p>This tutorial may help:<br/>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" rel="nofollow">https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426068" onclick='return addComment.moveForm( "comment-426068", "426068", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-426312">
<div class="comment-container" id="li-comment-426312">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e3ea40d49d01369b42ccaf616200ec04?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e3ea40d49d01369b42ccaf616200ec04?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">shuchen</span>
<span class="date">January 12, 2018 at 5:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426312" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Thanks for your tutorial. That’s amazing!</p>
<p>I have got 2 questions to ask:</p>
<p>* In the last model that uses TimeDistributed layer, the same weights of the dense layer are applied to all the 5 outputs from the LSTM hidden layer. So during training, for the 5 outputs of the dense layer, is the backprop done 5 times from the last output to the first one?</p>
<p>* You said that the number of training epochs needs to be increased to account for the smaller network capacity. Should it be decreased? Because smaller capacity networks need smaller times of training, while bigger capacity networks need bigger times of training?</p>
<p>Thanks a lot!</p>
<div class="reply">
<a aria-label="Reply to shuchen" class="comment-reply-link" href="#comment-426312" onclick='return addComment.moveForm( "comment-426312", "426312", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426359">
<div class="comment-container" id="li-comment-426359">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426359" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the Dense is trained on each output.</p>
<p>Yes. Small is less training, larger is more training.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426359" onclick='return addComment.moveForm( "comment-426359", "426359", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426623">
<div class="comment-container" id="li-comment-426623">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fe63a53837a95d0241547befc1556873?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fe63a53837a95d0241547befc1556873?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">HanSeYeong</span>
<span class="date">January 15, 2018 at 10:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426623" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a question for my text generation project!</p>
<p>Can I adopt</p>
<p>y = np_utils.to_categorical(dataY)<br/>
to<br/>
TimeDistributed model?</p>
<p>TImeDistributed error say that It needs 3-dimensional input and also output.<br/>
But np_utils.to_categorial return 2D output (total_words, n_vocabulary) so I can’t use TimeDistributed model.</p>
<p>Your all posts are really helpful for my LSTM projects! I really appreciate with your sharing</p>
<div class="reply">
<a aria-label="Reply to HanSeYeong" class="comment-reply-link" href="#comment-426623" onclick='return addComment.moveForm( "comment-426623", "426623", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426653">
<div class="comment-container" id="li-comment-426653">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426653" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, TimeDistributed is used for sequence output.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426653" onclick='return addComment.moveForm( "comment-426653", "426653", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-426672">
<div class="comment-container" id="li-comment-426672">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e3ea40d49d01369b42ccaf616200ec04?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e3ea40d49d01369b42ccaf616200ec04?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">shuchen</span>
<span class="date">January 16, 2018 at 7:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426672" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>So what if we don’t use TimeDistributed wrapper when a sequence is returned?</p>
<p>model.add(LSTM(n_neurons, input_shape=(length, 1), return_sequences=True))<br/>
model.add((Dense(1)))</p>
<p>I just want to know what the connections would be between the two layers.<br/>
Thanks!</p>
<div class="reply">
<a aria-label="Reply to shuchen" class="comment-reply-link" href="#comment-426672" onclick='return addComment.moveForm( "comment-426672", "426672", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426716">
<div class="comment-container" id="li-comment-426716">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 17, 2018 at 9:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426716" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe the Dense will now handle 3D input.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426716" onclick='return addComment.moveForm( "comment-426716", "426716", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426944">
<div class="comment-container" id="li-comment-426944">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cc63d6185199d1aaab7e8ca973f0a59f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cc63d6185199d1aaab7e8ca973f0a59f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nathan D.</span>
<span class="date">January 20, 2018 at 2:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426944" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thank you for your great post. I have 2 questions and hope you may address:</p>
<p>1. Are there any specific reasons behind constraining values in an input sequence to be between 0 and 1? I simply replaced the code to generate seq by: </p>
<p>       seq = array([float(i) for i in range(length)]) </p>
<p>and all models perform poorly, cannot predict the output y correctly for the same setting of n_epochs, or even 2*n_epochs.</p>
<p>2. Why do we need the Dense layer for the Many-to-One model? </p>
<p>I personally thought that, as return_sequences=True is not set, the output of LSTM layer is already in a 5D vector. Thus, it is unclear to me the specific role of the added Dense layer which receives an input in 5D and also outputs a 5D vector? Removing it can save us 30 parameters to be trained. (Please correct me if I miss something important here) </p>
<p>Thank you very much.</p>
<div class="reply">
<a aria-label="Reply to Nathan D." class="comment-reply-link" href="#comment-426944" onclick='return addComment.moveForm( "comment-426944", "426944", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426990">
<div class="comment-container" id="li-comment-426990">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 20, 2018 at 8:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-426990" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Normalizing inputs is a standard practice that improves modeling.</p>
<p>The LSTM returns the final output from the end of the sequence by default. We can return the sequence of outputs and have a dense layer interpret them before outputting a final prediction.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426990" onclick='return addComment.moveForm( "comment-426990", "426990", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-427739">
<div class="comment-container" id="li-comment-427739">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9c93bb2b8f62d7d99d875599fb3516b8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9c93bb2b8f62d7d99d875599fb3516b8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">iman</span>
<span class="date">January 27, 2018 at 11:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-427739" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi jason<br/>
i have for example 10 seq of data with the length of 10 char on each one.<br/>
like a matric of 10×10</p>
<p>so at first i want o read row by row and in the next layer iwant to read column by column.<br/>
is it true if i use time distributed(lstm) at the first layer and simple lstm in the second?</p>
<div class="reply">
<a aria-label="Reply to iman" class="comment-reply-link" href="#comment-427739" onclick='return addComment.moveForm( "comment-427739", "427739", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-427774">
<div class="comment-container" id="li-comment-427774">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 28, 2018 at 8:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-427774" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>TimeDistributed is really for seq2seq type problems.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427774" onclick='return addComment.moveForm( "comment-427774", "427774", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-427741">
<div class="comment-container" id="li-comment-427741">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9c93bb2b8f62d7d99d875599fb3516b8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9c93bb2b8f62d7d99d875599fb3516b8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">iman</span>
<span class="date">January 27, 2018 at 11:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-427741" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>in fact i want to know how network deal with data? and how we can determine the way of feeding data to the lstm network.</p>
<div class="reply">
<a aria-label="Reply to iman" class="comment-reply-link" href="#comment-427741" onclick='return addComment.moveForm( "comment-427741", "427741", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-427776">
<div class="comment-container" id="li-comment-427776">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 28, 2018 at 8:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-427776" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ultimately, data is provided one row at a time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427776" onclick='return addComment.moveForm( "comment-427776", "427776", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-429992">
<div class="comment-container" id="li-comment-429992">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b562f3fb8b778fa23c2f25f83229c2f0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b562f3fb8b778fa23c2f25f83229c2f0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">leon kwang</span>
<span class="date">February 20, 2018 at 9:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-429992" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>n = 4 * ((inputs + 1) * outputs + outputs^2), where does the 4 come from?</p>
<div class="reply">
<a aria-label="Reply to leon kwang" class="comment-reply-link" href="#comment-429992" onclick='return addComment.moveForm( "comment-429992", "429992", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-430093">
<div class="comment-container" id="li-comment-430093">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 21, 2018 at 6:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-430093" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The number of weights in an LSTM unit (I guess, from memory).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430093" onclick='return addComment.moveForm( "comment-430093", "430093", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-450671">
<div class="comment-container" id="li-comment-450671">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8adaadfdc7ee0faa5d2c46427fda6ac4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8adaadfdc7ee0faa5d2c46427fda6ac4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kumar</span>
<span class="date">October 4, 2018 at 5:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-450671" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How do we know that it should be 4?</p>
<div class="reply">
<a aria-label="Reply to kumar" class="comment-reply-link" href="#comment-450671" onclick='return addComment.moveForm( "comment-450671", "450671", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-430556">
<div class="comment-container" id="li-comment-430556">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harry Garrison</span>
<span class="date">February 26, 2018 at 10:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-430556" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can the Timedistributed layer be applied to predict individual class values (like vocabulary items)? This seems to work well with regression problems, where the mean_squared_error is used, but what if we wanted to output a sequence of vectorized words for example. I’ve tried training a translation model using a padded 3d sequence as X and a padded 3d sequence as y using the sparse_categorical_crossentropy loss function, I had the last Dense layer output as many outputs as the maximum vocabulary. It seemed to output rubbish with less than 20 examples and when I went to 250 examples, the model would only output zeros. What am I doing wrong? Also, is it possible to output variable length vectors? Let’s say I have a sequence X of shape(1, 300, 1). Can I train it to a y vector of shape (1, 50, 1)?</p>
<div class="reply">
<a aria-label="Reply to Harry Garrison" class="comment-reply-link" href="#comment-430556" onclick='return addComment.moveForm( "comment-430556", "430556", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430593">
<div class="comment-container" id="li-comment-430593">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 27, 2018 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-430593" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes. I have a few examples on the blog for NLP with encoder-decoder LSTMs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430593" onclick='return addComment.moveForm( "comment-430593", "430593", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-431439">
<div class="comment-container" id="li-comment-431439">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9b027718f8d49d81f6ef27ed824cfcd9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9b027718f8d49d81f6ef27ed824cfcd9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Aaron</span>
<span class="date">March 7, 2018 at 12:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-431439" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for your post!</p>
<p>I have three questions:<br/>
1. Regarding to Many-to-One, the output dimension from the last layer is (1, 5), while the input shape to LSTM is (5, 1). To me, it feels like, the input is a one feature with 5 timesteps data while the prediction output has 5 features with 1 time step… I am confused.</p>
<p>2. What is the difference in the performance of forecasting between Many-to-One and Many-to-Many? According to my understanding, Many-to-Many uses all 5 hidden states of the 5 LSTM cells to make prediction, while Many-to-One only uses the final state.</p>
<div class="reply">
<a aria-label="Reply to Aaron" class="comment-reply-link" href="#comment-431439" onclick='return addComment.moveForm( "comment-431439", "431439", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-431454">
<div class="comment-container" id="li-comment-431454">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 7, 2018 at 3:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-431454" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will help you better understand the input shape for LSTMs:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<p>It is the difference between the models is that of outputting a scalar vs a vector.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431454" onclick='return addComment.moveForm( "comment-431454", "431454", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-434049">
<div class="comment-container" id="li-comment-434049">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joey</span>
<span class="date">April 4, 2018 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-434049" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Your tutorials are game-changing.</p>
<p>To use a TimeDistributed output layer for classifying n different classes, would the Y shape be (samples, timesteps, n), with each label as an n-dimensional one-hot array? Or would the binarized label still be considered one feature?</p>
<p>To match that, should the output layer also be of size n?</p>
<p>Thanks for all of your work!</p>
<div class="reply">
<a aria-label="Reply to Joey" class="comment-reply-link" href="#comment-434049" onclick='return addComment.moveForm( "comment-434049", "434049", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434078">
<div class="comment-container" id="li-comment-434078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 4, 2018 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-434078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, for multi-class classification a TimeDistributed layer would not be required.</p>
<p>You would use n neurons in the output layer and a softmax activation function, where n is the number of class values (factors).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434078" onclick='return addComment.moveForm( "comment-434078", "434078", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-434134">
<div class="comment-container" id="li-comment-434134">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joey</span>
<span class="date">April 5, 2018 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-434134" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What I mean is, still using the TimeDistributed wrapper to get one output per time_step, but instead of binary classification, having n categories. My input and output layers are, respectively,</p>
<p>LSTM(32, input_shape=(time_step, num_features), return_sequences=True)</p>
<p>and</p>
<p>TimeDistributed(Dense(num_labels, activation=”softmax”))</p>
<p>And it seems to be working well with Y.shape == (samples, timesteps, num_labels)</p>
<div class="reply">
<a aria-label="Reply to Joey" class="comment-reply-link" href="#comment-434134" onclick='return addComment.moveForm( "comment-434134", "434134", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434177">
<div class="comment-container" id="li-comment-434177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 5, 2018 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-434177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I see, then each time step would be a one hot encoded vector.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434177" onclick='return addComment.moveForm( "comment-434177", "434177", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-435382">
<div class="comment-container" id="li-comment-435382">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joey</span>
<span class="date">April 19, 2018 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-435382" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks again, Jason.</p>
<p>Is it possible to apply sample_weight or class_weight to a model with this input?</p>
<p>Keras requires a 2D sample_weight array:</p>
<p>     “In order to use timestep-wise sample weighting, you should pass a 2D sample_weight array.”</p>
<p>Reshaping it to be 2D obviously does not match Y.shape of (samples,timesteps,num_labels)</p>
<p>I did not forget to set sample_weight_mode=”temporal”.</p>
<p>With the class_weight approach:<br/>
     “ValueError: <code>class_weight</code> not supported for 3+ dimensional targets.”</p>
<p>Is it possible to use either of these functions for the timedistributed layer? Do you have to create a custom loss function?</p>
<div class="reply">
<a aria-label="Reply to Joey" class="comment-reply-link" href="#comment-435382" onclick='return addComment.moveForm( "comment-435382", "435382", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-435403">
<div class="comment-container" id="li-comment-435403">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 19, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-435403" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t know sorry, I have not tried.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435403" onclick='return addComment.moveForm( "comment-435403", "435403", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-435406">
<div class="comment-container" id="li-comment-435406">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joey</span>
<span class="date">April 19, 2018 at 6:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-435406" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason, I’ll share what I find!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-436356">
<div class="comment-container" id="li-comment-436356">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a103f7731d344c805ee175423ce07ade?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joey</span>
<span class="date">May 1, 2018 at 8:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-436356" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It works fine.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-435438">
<div class="comment-container" id="li-comment-435438">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/962ca53391b89d1353c1865709cb72d4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/962ca53391b89d1353c1865709cb72d4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jorn</span>
<span class="date">April 19, 2018 at 4:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-435438" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you very much a great post Jason. I have a problem where the input sequence is longer than the output sequence – input data = (samples, 26 time steps, 20 features) and the target data = (samples, 7 time steps, 1 target). Keras throws and error saying it expects the target data to have a shape of (26, 1) if I feed it the shorter (7, 1) shape in the last TimeDistributed(Dense(1)) layer. </p>
<p>One simple solution would of course be to just grab the first 7 of the 26 steps of the fit. However, I would think that it would be an easier and faster job to fit only 7 steps. </p>
<p>Is it possible to tell Keras that the input sequence is of a different length than the output sequence?</p>
<div class="reply">
<a aria-label="Reply to Jorn" class="comment-reply-link" href="#comment-435438" onclick='return addComment.moveForm( "comment-435438", "435438", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-435475">
<div class="comment-container" id="li-comment-435475">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 20, 2018 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-435475" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When the input and output sequences have a different lengths, you can use an encoder-decoder architecture:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435475" onclick='return addComment.moveForm( "comment-435475", "435475", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-435514">
<div class="comment-container" id="li-comment-435514">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/962ca53391b89d1353c1865709cb72d4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/962ca53391b89d1353c1865709cb72d4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jorn</span>
<span class="date">April 20, 2018 at 4:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-435514" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Many thanks. I will give that a go.</p>
<div class="reply">
<a aria-label="Reply to Jorn" class="comment-reply-link" href="#comment-435514" onclick='return addComment.moveForm( "comment-435514", "435514", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-436832">
<div class="comment-container" id="li-comment-436832">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0b17bfa75ba81d60d99b951f547aec60?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0b17bfa75ba81d60d99b951f547aec60?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam</span>
<span class="date">May 7, 2018 at 9:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-436832" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this article, this is very helpful</p>
<p>I am trying to implement a simple sequence classifier. I create a set containing 10 random integers between 0-100 and if that set consists of a number that is a multiple of 10, then y is 1 and if not, then y is 0. </p>
<p>For ex: If X is  [10,11,34,56,78,99, 21, 24, 25, 77]. Then y is 1<br/>
For ex: if X is [1,11,34,56,78,99, 21, 24, 25, 77], then y is 0</p>
<p>I reused, your code for this purpose, but I am unable to get the correct results. Below is the code, Can you please tell what is wrong with this code? Appreciate your help on this. Thank you!</p>
<p>from random import random<br/>
from numpy import array<br/>
from numpy import cumsum<br/>
from keras.models import Sequential<br/>
from keras.layers import LSTM<br/>
from keras.layers import Dense<br/>
from keras.layers import TimeDistributed<br/>
import numpy as np<br/>
import random as rd</p>
<p># create a sequence classification instance<br/>
def get_sequence(n_timesteps):<br/>
        # create a sequence of 10 random numbers in the range [0-100]<br/>
        X = array([rd.randrange(0, 101, 1) for _ in range(n_timesteps)])</p>
<p>        #If the sequence has a number that is a multiple of 10, then Y is 1<br/>
        #If not, Y is 0 by default<br/>
        y = 0</p>
<p>        for i in range(n_timesteps):<br/>
                if(X[i] % 10 == 0):<br/>
                        y = 1<br/>
                        break;</p>
<p>        #Convert y to a numpy array<br/>
        y = np.asarray(y)</p>
<p>        # reshape input and output data to be suitable for LSTMs<br/>
        X = X.reshape(1, n_timesteps, 1)<br/>
        y = y.reshape(1)</p>
<p>        return X, y</p>
<p># define problem properties<br/>
n_timesteps = 10<br/>
# define LSTM</p>
<p>model = Sequential()<br/>
model.add(LSTM(200, input_shape=(n_timesteps, 1)))<br/>
model.add(Dense(1, activation=’sigmoid’))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’, metrics=[‘acc’])</p>
<p># train LSTM<br/>
for epoch in range(100):<br/>
        # generate new random sequence<br/>
        X,y = get_sequence(n_timesteps)<br/>
        # fit model for one epoch on this sequence<br/>
        model.fit(X, y, epochs=epoch, batch_size=1, verbose=2)</p>
<p># evaluate LSTM<br/>
#Variable to hold correct predictions<br/>
cor_pred = 0</p>
<p>for epoch in range(100):<br/>
        X,y = get_sequence(n_timesteps)<br/>
        yhat = model.predict_classes(X, verbose=0)<br/>
        print(‘Expected:’, y, ‘Predicted’, yhat)</p>
<p>        #Check if the predicted vs actual match, if so increment the count of correct predictions<br/>
        if(y == yhat):<br/>
                cor_pred = cor_pred + 1</p>
<p>print(“Correct Prediction:”, cor_pred)</p>
<div class="reply">
<a aria-label="Reply to Adam" class="comment-reply-link" href="#comment-436832" onclick='return addComment.moveForm( "comment-436832", "436832", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436872">
<div class="comment-container" id="li-comment-436872">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 8, 2018 at 6:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-436872" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you need to tune the model for the problem?</p>
<p>Perhaps explore other framings of the problem?</p>
<p>I offer a suite of more ideas here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436872" onclick='return addComment.moveForm( "comment-436872", "436872", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436898">
<div class="comment-container" id="li-comment-436898">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e383e50f133432cad91f780f024443d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e383e50f133432cad91f780f024443d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mithril</span>
<span class="date">May 8, 2018 at 11:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-436898" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, this article help me a lot.</p>
<p>Now, I only have one question:  how to deal with sequence need padding ?</p>
<p>For example:</p>
<p>I want to train a model to detect wrong word using in an ariticle.<br/>
I generate trainning data as below:</p>
<p><code></code><code><br/>
corrects  = [<br/>
    ['How', 'are', 'you', '!'],             # [1, 1, 1, 1]<br/>
    ['Fine', ',', 'thank', 'you', '.'],      #  [1, 1, 1, 1, 1]<br/>
    ['Do', 'you', 'have', 'meal', '?'],   #  [1, 1, 1, 1, 1]<br/>
    ...<br/>
]</code></p>
<p>wrongs  = [<br/>
    ['How', 'were', 'you', '!'],            # [1, 0, 1, 1]<br/>
    ['Find', ',', 'thank', 'you', '.'],    # [0, 1, 1, 1, 1]<br/>
    ['Did', 'you', 'have', 'meal', '.'],    #  [0, 1, 1, 1, 0]<br/>
    ...<br/>
]<br/>
<code></code></p>
<p>I need handle the wrong word in first,  and also want last word of a sentence can affect by first few words of latter sentence. </p>
<p>Some article told me do not backpropagate for the errors of those padded words,  by masking their loss.<br/>
But I can’t understand what he said,  If I pad X,  I need change y to same size (so the padding label is a new value, may be  <code>-1</code> ? ).  </p>
<p>Could you give me some tip?</p>
<div class="reply">
<a aria-label="Reply to mithril" class="comment-reply-link" href="#comment-436898" onclick='return addComment.moveForm( "comment-436898", "436898", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436920">
<div class="comment-container" id="li-comment-436920">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 8, 2018 at 2:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-436920" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use zero-padding to make sequences the same length and a Masking layer to ignore the zeros.</p>
<p>Here’s examples of padding:<br/>
<a href="https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/" rel="nofollow">https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/</a></p>
<p>Here’s an example of masking:<br/>
<a href="https://machinelearningmastery.com/handle-missing-timesteps-sequence-prediction-problems-python/" rel="nofollow">https://machinelearningmastery.com/handle-missing-timesteps-sequence-prediction-problems-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436920" onclick='return addComment.moveForm( "comment-436920", "436920", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-437014">
<div class="comment-container" id="li-comment-437014">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e383e50f133432cad91f780f024443d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e383e50f133432cad91f780f024443d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mithril</span>
<span class="date">May 9, 2018 at 12:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-437014" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, I get it.</p>
<p>May I ask one more question?</p>
<p>I’d like to use <code>Bidirectional</code>,<br/>
from <a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" rel="nofollow">https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/</a></p>
<p>You use <code>Bidirectional</code> and <code>TimeDistributed</code> together,  is it suit for my wrong word detection task ?</p>
<div class="reply">
<a aria-label="Reply to mithril" class="comment-reply-link" href="#comment-437014" onclick='return addComment.moveForm( "comment-437014", "437014", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-437021">
<div class="comment-container" id="li-comment-437021">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2018 at 2:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-437021" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use them together.</p>
<p>I don’t know about the use on that application, try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437021" onclick='return addComment.moveForm( "comment-437021", "437021", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-436975">
<div class="comment-container" id="li-comment-436975">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4079e1d777f728a38371ab20dcb44d92?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4079e1d777f728a38371ab20dcb44d92?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Divya</span>
<span class="date">May 9, 2018 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-436975" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the great article Jason. I believe i am dealing with a problem of type that can be solved using “Many-to-Many LSTM for Sequence Prediction (with TimeDistributed)” technique explained above.</p>
<p>In my problem i have more samples and more features compared to the example above but i am trying sequence to sequence with output at every timestep.</p>
<p>One sample in my problem, input(1,5,2)–&gt; output(1,5,1) looks as follows.<br/>
[[1,2,3,4,5]<br/>
[10,20,30,40,50]] –&gt; [10,40,90,160,250]</p>
<p>Am i correct in trying out the TimeDistributed technique for this problem?</p>
<p>If so, how are batch-size, epochs, number of neurons going to impact the model intuitively?</p>
<p>Is it correct to say that batch-size and epochs together play role in number of iterations which leads to number of times the weights are updated. And number of neurons help the model to remember the sequence?</p>
<p>Do i have to worry about “stateful” in this kind of problem?</p>
<div class="reply">
<a aria-label="Reply to Divya" class="comment-reply-link" href="#comment-436975" onclick='return addComment.moveForm( "comment-436975", "436975", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-437000">
<div class="comment-container" id="li-comment-437000">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-437000" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could try with and without it and compare the results.</p>
<p>Model weights are updated after each batch. You can make the model stateful and control when weights are updated instead – if you need that control.</p>
<p>More neurons means more capacity to learn, but harder and slower to train.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437000" onclick='return addComment.moveForm( "comment-437000", "437000", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-437002">
<div class="comment-container" id="li-comment-437002">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4079e1d777f728a38371ab20dcb44d92?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4079e1d777f728a38371ab20dcb44d92?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Divya</span>
<span class="date">May 9, 2018 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-437002" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you.</p>
<div class="reply">
<a aria-label="Reply to Divya" class="comment-reply-link" href="#comment-437002" onclick='return addComment.moveForm( "comment-437002", "437002", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-437694">
<div class="comment-container" id="li-comment-437694">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e53bf923a5d34e0f52ed25f2d42505c0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e53bf923a5d34e0f52ed25f2d42505c0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Matmatah</span>
<span class="date">May 16, 2018 at 10:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-437694" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very interesting article!</p>
<p>When you write,<br/>
 “The LSTM units have been crippled and will each output a single value, providing a vector of 5 values as inputs to the fully connected layer.”,</p>
<p>is this vector is the output of the last LSTM unit?</p>
<div class="reply">
<a aria-label="Reply to Matmatah" class="comment-reply-link" href="#comment-437694" onclick='return addComment.moveForm( "comment-437694", "437694", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437730">
<div class="comment-container" id="li-comment-437730">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 17, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-437730" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, of the network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437730" onclick='return addComment.moveForm( "comment-437730", "437730", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-438111">
<div class="comment-container" id="li-comment-438111">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e306680cb9fe51917fc7d6b1323cb4eb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e306680cb9fe51917fc7d6b1323cb4eb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jared</span>
<span class="date">May 21, 2018 at 12:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-438111" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m struggling to figure out what data property determines what the TimeDistributed(Dense(1)) expects. It never seems to line up for me.</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Jared" class="comment-reply-link" href="#comment-438111" onclick='return addComment.moveForm( "comment-438111", "438111", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-438118">
<div class="comment-container" id="li-comment-438118">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 21, 2018 at 2:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-438118" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you mean exactly Jared?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438118" onclick='return addComment.moveForm( "comment-438118", "438118", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-441886">
<div class="comment-container" id="li-comment-441886">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jimmy</span>
<span class="date">June 24, 2018 at 8:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-441886" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, great tutorials, I was wondering , what is the definition of many to many in this example? Is it many features to many features or many time steps to many time steps? Thanks. Jimmy</p>
<div class="reply">
<a aria-label="Reply to Jimmy" class="comment-reply-link" href="#comment-441886" onclick='return addComment.moveForm( "comment-441886", "441886", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441935">
<div class="comment-container" id="li-comment-441935">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 25, 2018 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-441935" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Many input time steps to many output time steps, regardless of the number of features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441935" onclick='return addComment.moveForm( "comment-441935", "441935", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-441956">
<div class="comment-container" id="li-comment-441956">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jimmy</span>
<span class="date">June 25, 2018 at 9:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-441956" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks. So if I want to have 3 outputs at the same time do I change  model.add(TimeDistributed(Dense(1)))  to model.add(TimeDistributed(Dense(3)))  ?   Will this be the same as multi steps forecasting?</p>
<div class="reply">
<a aria-label="Reply to Jimmy" class="comment-reply-link" href="#comment-441956" onclick='return addComment.moveForm( "comment-441956", "441956", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-441974">
<div class="comment-container" id="li-comment-441974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 25, 2018 at 2:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-441974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That would produce 3 features per output time step.</p>
<p>Perhaps try an encoder-decoder network instead:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441974" onclick='return addComment.moveForm( "comment-441974", "441974", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-442162">
<div class="comment-container" id="li-comment-442162">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jimmy</span>
<span class="date">June 27, 2018 at 6:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-442162" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome Thanks. Btw, please see below, both model 1 and 2 compiled and trained but I don’t know what’s their difference?<br/>
x_train.shape  (4767, 10, 4)<br/>
y_train.shape  (4767, 5, 1)</p>
<p>What’s the difference?</p>
<p>#— model 1<br/>
model = Sequential()<br/>
model.add(LSTM(128, input_shape=(data.shape[1],data.shape[2]), return_sequences=True))<br/>
model.add(Dropout(d))<br/>
model.add(LSTM(64, input_shape=(data.shape[1],data.shape[2]), return_sequences=False))<br/>
model.add(Dropout(d))<br/>
model.add(RepeatVector(y_train.shape[1]))<br/>
model.add(LSTM(64, return_sequences=True))<br/>
model.add((Dense(1)))<br/>
model.compile(loss=’mse’,optimizer=’adam’)</p>
<p>#— model 2<br/>
model = Sequential()<br/>
model.add(LSTM(128, input_shape=(data.shape[1],data.shape[2]), return_sequences=True))<br/>
model.add(Dropout(d))<br/>
model.add(LSTM(64, input_shape=(data.shape[1],data.shape[2]), return_sequences=False))<br/>
model.add(Dropout(d))<br/>
model.add(RepeatVector(y_train.shape[1]))<br/>
model.add(LSTM(64, return_sequences=True))<br/>
model.add(TimeDistributed(Dense(1)))<br/>
model.compile(loss=’mse’,optimizer=’adam’)</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-442199">
<div class="comment-container" id="li-comment-442199">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2018 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-442199" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In the first, there will be 1 output, in the second there will be one output per input.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-442320">
<div class="comment-container" id="li-comment-442320">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jimmy</span>
<span class="date">June 29, 2018 at 11:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-442320" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Are they both multi layer seq2seq models ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-442336">
<div class="comment-container" id="li-comment-442336">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 29, 2018 at 3:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-442336" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes and no, it depends on how you define a seq2seq model.</p>
<p>Focus on results rather than model types.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-441966">
<div class="comment-container" id="li-comment-441966">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf68bfe54236d0e71c158b1d7b799cd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jimmy</span>
<span class="date">June 25, 2018 at 1:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-441966" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, by the way, I’m trying to use 10 time steps with 4 features to predict 5 time steps but I got some error. </p>
<p>x_train.shape<br/>
(4768, 10, 4)</p>
<p>y_train.shape<br/>
(4768, 5, 1)</p>
<p>d = 0.2<br/>
model = Sequential()<br/>
model.add(LSTM(128, input_shape = (x_train.shape[1], x_train.shape[2]), return_sequences=True))<br/>
model.add(Dropout(d))<br/>
model.add(LSTM(64,  input_shape = (x_train.shape[1], x_train.shape[2]), return_sequences=True))<br/>
model.add(Dropout(d))<br/>
model.add(TimeDistributed(Dense(5)))<br/>
model.compile(loss=’mse’,optimizer=’adam’,metrics=[‘accuracy’])</p>
<p>model.fit(x_train, y_train, batch_size=512, nb_epoch=3, validation_split=0.05)</p>
<p>#—— got error<br/>
ValueError: Error when checking target: expected time_distributed_14 to have shape (None, 10, 5) but got array with shape (4768, 5, 1)</p>
<div class="reply">
<a aria-label="Reply to Jimmy" class="comment-reply-link" href="#comment-441966" onclick='return addComment.moveForm( "comment-441966", "441966", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441977">
<div class="comment-container" id="li-comment-441977">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 25, 2018 at 2:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-441977" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I recommend using an encoder-decoder model for a seq2seq type problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441977" onclick='return addComment.moveForm( "comment-441977", "441977", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-443017">
<div class="comment-container" id="li-comment-443017">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/93c745693a256b8e48b1936aaa0ce84e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/93c745693a256b8e48b1936aaa0ce84e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rohit</span>
<span class="date">July 9, 2018 at 1:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443017" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I am trying to build a hierarchical model using timedistributed and want to access intermediate layers.</p>
<p>Model:</p>
<p>h_words = Bidirectional(GRU(200, return_sequences=True))(words)<br/>
sentence = Attention()(h_words)<br/>
sent_encoder = Model(sequence_input, sentence)</p>
<p>document_input = Input(shape=(None, MAX_SENT_LENGTH), dtype=’int32′)<br/>
document_enc = TimeDistributed(sent_encoder)(document_input)<br/>
h_sentences = Bidirectional(GRU(100, return_sequences=True))(document_enc)</p>
<p>preds = Dense(7, activation=’softmax’)(h_sentences)</p>
<p>model = Model(document_input, preds)</p>
<p>So, model.layers only gives me the layers from the second part of the model. How can I access model layers used within timedistributed.</p>
<div class="reply">
<a aria-label="Reply to Rohit" class="comment-reply-link" href="#comment-443017" onclick='return addComment.moveForm( "comment-443017", "443017", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-443070">
<div class="comment-container" id="li-comment-443070">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 10, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443070" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>By using the functional API, you can keep reference to any layer you wish directly.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443070" onclick='return addComment.moveForm( "comment-443070", "443070", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-443242">
<div class="comment-container" id="li-comment-443242">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3aee723cf76d17c42ed16607922e12a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3aee723cf76d17c42ed16607922e12a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thuan</span>
<span class="date">July 12, 2018 at 1:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443242" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank for your explanation. </p>
<p>My question: Is it possible to use TimeDistributed in Many-to-One LSTM? Is there any different in terms of accuracy and sensitivity if we use and don’t use TimeDistributed?</p>
<div class="reply">
<a aria-label="Reply to Thuan" class="comment-reply-link" href="#comment-443242" onclick='return addComment.moveForm( "comment-443242", "443242", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-443263">
<div class="comment-container" id="li-comment-443263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<p>It may or may not impact skill directly, it is more a question of how you want the model to interpret your data, e.g. as a vector or as independent time steps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443263" onclick='return addComment.moveForm( "comment-443263", "443263", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-443618">
<div class="comment-container" id="li-comment-443618">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e2de48d0b0008e34ddfdc4ca42ca3010?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e2de48d0b0008e34ddfdc4ca42ca3010?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mikel</span>
<span class="date">July 16, 2018 at 8:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443618" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I want to make a very long sequence classification. I have a dataset with 11000 samples where each sample is composed of 20 sequences of 8000 points. Therefore, the input shape should be (11000, 8000, 20) isn’t it?</p>
<p>However, you recommended several times not to set a time step bigger than 400-600. I have 2 related questions (truncating the sequences is not an option):</p>
<p>1.- I should add an extra dimension to the input shape so as each sample is divided in multiple chunks? Let’s say I want to divide each sequence into 100 sub-sequences of 80 points. The input shape should look like (11000, 100, 80, 20). I do not know if this is the correct way to do this.</p>
<p>2.- In this way, I have to match multiple multiple sub-sequences to a single output. How can I achieve this with TimeDistributed and LSTM?</p>
<p>Any suggestion?<br/>
Thank you in advance</p>
<div class="reply">
<a aria-label="Reply to Mikel" class="comment-reply-link" href="#comment-443618" onclick='return addComment.moveForm( "comment-443618", "443618", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-443661">
<div class="comment-container" id="li-comment-443661">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 17, 2018 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443661" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t understand what you mean by sequences and points.</p>
<p>Perhaps this will help:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/how-do-i-prepare-my-data-for-an-lstm" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-do-i-prepare-my-data-for-an-lstm</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443661" onclick='return addComment.moveForm( "comment-443661", "443661", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-443693">
<div class="comment-container" id="li-comment-443693">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e2de48d0b0008e34ddfdc4ca42ca3010?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e2de48d0b0008e34ddfdc4ca42ca3010?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mikel</span>
<span class="date">July 17, 2018 at 4:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443693" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I did not explain myself correctly. In my case, sequences are time series and the points are the values of the time series.</p>
<p>In this way, I want to make a binary classification of events that are composed of 20 time series of length 8000, that is, for each event, I have multiple large time series and 1 target.</p>
<div class="reply">
<a aria-label="Reply to Mikel" class="comment-reply-link" href="#comment-443693" onclick='return addComment.moveForm( "comment-443693", "443693", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-443739">
<div class="comment-container" id="li-comment-443739">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 18, 2018 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-443739" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>CNNs are excellent a time series classification tasks. I’d recommend starting there.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443739" onclick='return addComment.moveForm( "comment-443739", "443739", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-444993">
<div class="comment-container" id="li-comment-444993">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f4ecd0697f63e75d4b8fbc5e7a4f73b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f4ecd0697f63e75d4b8fbc5e7a4f73b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Justin</span>
<span class="date">August 1, 2018 at 5:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-444993" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
Thanks alot for this blog, learned alot and finally found a possible solution as I am on the verge of giving up. </p>
<p>this is my code, is it possible to have a quick browse through if this makes sense:<br/>
model = Sequential()<br/>
model.add(Bidirectional(LSTM(448, input_shape = (3, 43), activation = ‘relu’, return_sequences=True)))<br/>
model.add(Dropout(0.1))<br/>
model.add(Bidirectional(LSTM(256, activation = ‘relu’, return_sequences = True)))<br/>
model.add(Dropout(0.2))<br/>
model.add(TimeDistributed(Dense(64, kernel_initializer = ‘uniform’, activation = ‘relu’)))<br/>
model.add(TimeDistributed(Dense(1, kernel_initializer = ‘uniform’, activation = ‘linear’,<br/>
                                             kernel_regularizer = regularizers.l2(regu))))<br/>
model.compile(optimizer = ‘adam’, loss = ‘mse’, metrics = [‘accuracy’])</p>
<p>net_history = model.fit(X_train, y_train, batch_size = batch_size, epochs = num_epochs, verbose = 0, validation_split = val_split, shuffle = True, callbacks = [best_model, early_stop])</p>
<p>1. I just to seek your opinion if the above model makes sense. </p>
<p>2. I have having trouble with the shape of test. As you mentioned in the article, it needs to be 3 dimensions.  This is my current shape:<br/>
X_train (3620, 3, 43) y_train (3620, 1)<br/>
  X_test  (905, 3, 43)   y_test  (905, 1)<br/>
I got my X train and test to have a lag of 3 using a moving window method. So when i get an error as follows:<br/>
ValueError: Error when checking target: expected time_distributed_4 to have 3 dimensions, but got array with shape (3620, 1), does it mean I need to apply the moving window to y as well? </p>
<p>Extremely confused and appreciate if you can help me out. </p>
<p>Cheers</p>
<div class="reply">
<a aria-label="Reply to Justin" class="comment-reply-link" href="#comment-444993" onclick='return addComment.moveForm( "comment-444993", "444993", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445025">
<div class="comment-container" id="li-comment-445025">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2018 at 5:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-445025" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have the capacity to review and debug your code example.</p>
<p>Regarding the shape of the data, this might help:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/how-do-i-prepare-my-data-for-an-lstm" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-do-i-prepare-my-data-for-an-lstm</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445025" onclick='return addComment.moveForm( "comment-445025", "445025", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-447134">
<div class="comment-container" id="li-comment-447134">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/032c863219045f4d7f2d12e070fb0a2b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/032c863219045f4d7f2d12e070fb0a2b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tianyi</span>
<span class="date">August 28, 2018 at 7:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-447134" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>in many to many model, full code line 18, </p>
<p>model.add(TimeDistributed(Dense(1)))</p>
<p>Why should we add this TimeDstributed layer here? I changed this line to following: </p>
<p>model.add(Dense(1))</p>
<p>the code still works.</p>
<p>So what is the difference between these two?</p>
<div class="reply">
<a aria-label="Reply to Tianyi" class="comment-reply-link" href="#comment-447134" onclick='return addComment.moveForm( "comment-447134", "447134", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-447179">
<div class="comment-container" id="li-comment-447179">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2018 at 8:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-447179" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The difference is the number of weights.</p>
<p>Perhaps re-read the tutorial?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447179" onclick='return addComment.moveForm( "comment-447179", "447179", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-449442">
<div class="comment-container" id="li-comment-449442">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8496d782866c9ad824004b69d99575cb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8496d782866c9ad824004b69d99575cb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">wrc</span>
<span class="date">September 21, 2018 at 3:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-449442" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Whether I did use TimeDistributed(Dense()) or just Dense(), model description from both cases were exactly the same on Output Shape/Param #.</p>
<p>Is it just a matter of historical design? I had seen through some forum and they said Dense layer won’t compile if an input was not a 2D layer. Now Dense layer supports nD layers. If the parameter numbers and shapes remain the same, and this guy said the Dense connects to all steps when return_sequences=True, does that mean the weights are shared automatically?<br/>
<a href="https://stackoverflow.com/questions/43265084/keras-timedistributed-are-weights-shared" rel="nofollow">https://stackoverflow.com/questions/43265084/keras-timedistributed-are-weights-shared</a></p>
<p>There is a prove that both are the same, but I don’t know if it is valid:<br/>
<a href="https://stackoverflow.com/questions/44611006/timedistributeddense-vs-dense-in-keras-same-number-of-parameters" rel="nofollow">https://stackoverflow.com/questions/44611006/timedistributeddense-vs-dense-in-keras-same-number-of-parameters</a></p>
<div class="reply">
<a aria-label="Reply to wrc" class="comment-reply-link" href="#comment-449442" onclick='return addComment.moveForm( "comment-449442", "449442", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-449456">
<div class="comment-container" id="li-comment-449456">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 21, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-449456" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It comes down to how many weights are in your model and what the output part of the model is actually doing.</p>
<p>Yes, it is a matter of design. Try both, go with what performs better or makes more sense to you.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449456" onclick='return addComment.moveForm( "comment-449456", "449456", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-449876">
<div class="comment-container" id="li-comment-449876">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d2e1d1aafec651ed1cfb0c51c9c9b5b3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d2e1d1aafec651ed1cfb0c51c9c9b5b3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">johannes</span>
<span class="date">September 27, 2018 at 1:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-449876" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you mean by: “The LSTM units have been crippled and will each output a single value, providing a vector of 5 values as inputs to the fully connected layer. The time dimension or sequence information has been thrown away and collapsed into a vector of 5 values.”</p>
<p>Isn’t the (1,5,1) input, the input that is using the sequence information? From the documentation, the dimensions are (batch_size, time_steps, features). Shouldn’t the first version, with dimension (5,1,1) be the case where LSTM is useless, unless you keep the state for the next example?</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to johannes" class="comment-reply-link" href="#comment-449876" onclick='return addComment.moveForm( "comment-449876", "449876", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-449899">
<div class="comment-container" id="li-comment-449899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 27, 2018 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-449899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am suggesting that information over the sequence is lost as we reduce the input sequence down to only the output of the LSTM layer at the end of the sequence, not the output of the layer over the whole sequence.</p>
<p>State is maintained across the batch, the default batch size is 32, no problem with state here.</p>
<p>I don’t see a problem, but perhaps I misunderstand your comment?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449899" onclick='return addComment.moveForm( "comment-449899", "449899", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-449955">
<div class="comment-container" id="li-comment-449955">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d2e1d1aafec651ed1cfb0c51c9c9b5b3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d2e1d1aafec651ed1cfb0c51c9c9b5b3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">johannes</span>
<span class="date">September 27, 2018 at 8:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-449955" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your quick response!</p>
<p>BUT, I am confused about how the batches work in RNNs. The point of the RNN is to use information from previous observations, right? And the equations of an RNN/LSTM are feeding the hidden state Ht-1 from time step t-1 and combining it with the input Xt at timestep t. Where this is done recursively for every t. </p>
<p>Say that we are doing a sentiment classification, which means we are given an input-text, say of length 100, and we are predicting a binary label, 0,1. And we have 1000 of these texts with corresponding label. This will then be a (1000, 100, “embedding_size”) shaped input. The batches are then taken from index, 0, ie dividing up the 1000 examples, correct? Say we have a batch size of 10. This is then 10 sequences, which is not really related. Are the states shared among these 10 sequences for every timestep?</p>
<p>In that case, is the way to “isolate”, ie model one sequence at a time, to use a batch size of size 1? </p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to johannes" class="comment-reply-link" href="#comment-449955" onclick='return addComment.moveForm( "comment-449955", "449955", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-449993">
<div class="comment-container" id="li-comment-449993">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 28, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-449993" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Previous observations are available within each sample as “time steps”. Words would be time steps within a sample.</p>
<p>The model can also maintain state across samples within a batch, or more if you choose stateless and control when the state is reset.</p>
<p>No, it would be [1000, 100, 1] as the embedding takes integer encoded words which it will then map to vectors.</p>
<p>If you have a batch size of 10, then 10 samples of the 1000 will share state before state was reset and weights updated. If each sample is one document, then sharing state across documents may not make sense.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449993" onclick='return addComment.moveForm( "comment-449993", "449993", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-450078">
<div class="comment-container" id="li-comment-450078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d2e1d1aafec651ed1cfb0c51c9c9b5b3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d2e1d1aafec651ed1cfb0c51c9c9b5b3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Johannes</span>
<span class="date">September 28, 2018 at 5:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-450078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks a lot for that comprehensive response. It made things much clearer for me I think.</p>
<p>So if I don’t want states to be shared within a batch, because the sequences are not necessarily related within the batch, is the best solution to use a bath size of 1? Or structure my data in a way that related sequences end up in the same batch?</p>
<div class="reply">
<a aria-label="Reply to Johannes" class="comment-reply-link" href="#comment-450078" onclick='return addComment.moveForm( "comment-450078", "450078", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-450170">
<div class="comment-container" id="li-comment-450170">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 29, 2018 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-450170" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<p>Or first confirm that it even matters for your problem. It often doesn’t.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-450170" onclick='return addComment.moveForm( "comment-450170", "450170", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-450670">
<div class="comment-container" id="li-comment-450670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8adaadfdc7ee0faa5d2c46427fda6ac4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8adaadfdc7ee0faa5d2c46427fda6ac4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kumar</span>
<span class="date">October 4, 2018 at 5:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-450670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the detailed explanation. Might be my question would be simple but I didn’t understand. While doing the parameter calculations I didn’t get why you have multiplied with 4.<br/>
Could you please clarify?</p>
<p>n = 4 * ((inputs + 1) * outputs + outputs^2)<br/>
n = 4 * ((1 + 1) * 5 + 5^2)<br/>
n = 4 * 35<br/>
n = 140</p>
<div class="reply">
<a aria-label="Reply to kumar" class="comment-reply-link" href="#comment-450670" onclick='return addComment.moveForm( "comment-450670", "450670", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-450718">
<div class="comment-container" id="li-comment-450718">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2018 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-450718" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>4 weights per unit.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-450718" onclick='return addComment.moveForm( "comment-450718", "450718", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-450716">
<div class="comment-container" id="li-comment-450716">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fe64befd5a6a9001d74d6ce604e96c4b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fe64befd5a6a9001d74d6ce604e96c4b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">October 5, 2018 at 4:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-450716" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason, this really helps! </p>
<p>For keras model # params calculation , it took me a while to figure out  in your calculation, the multiplier “4”  is from the # of LSTM gates (update, forget, )</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="#comment-450716" onclick='return addComment.moveForm( "comment-450716", "450716", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-450738">
<div class="comment-container" id="li-comment-450738">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2018 at 5:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-450738" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-450738" onclick='return addComment.moveForm( "comment-450738", "450738", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-454096">
<div class="comment-container" id="li-comment-454096">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8d3c906af38c39e9862194930433a11b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8d3c906af38c39e9862194930433a11b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Johny</span>
<span class="date">November 9, 2018 at 2:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-454096" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I use “series_to_supervised” as you teach in my LSTM. Is Timedistributed wrapper is the same or it is a good way to combine both?</p>
<div class="reply">
<a aria-label="Reply to Johny" class="comment-reply-link" href="#comment-454096" onclick='return addComment.moveForm( "comment-454096", "454096", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-454115">
<div class="comment-container" id="li-comment-454115">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 9, 2018 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/#comment-454115" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is very similar. </p>
<p>It may be easier to use for some people.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-454115" onclick='return addComment.moveForm( "comment-454115", "454115", "respond", "3998" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/timedistributed-layer-for-long-short-term-memory-networks-in-python/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="3998"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="70825adb7d"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="146"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center><br/>
<strong>Long Short-Term Memory Networks</strong><br/>
Develop sequence prediction models in Keras.
<p><a href="/lstms-with-python/">Click to Get Started Now!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>