<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting</title>
<link href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting" property="og:title"/>
<meta content="Given the rise of smart electricity meters and the wide adoption of electricity generation technology like solar panels, there is a wealth of electricity usage data available. This data represents a multivariate time series of power-related variables that in turn could be used to model and even forecast future electricity consumption. Unlike other machine learning …" property="og:description"/>
<meta content="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Time Series" property="article:section"/>
<meta content="2018-10-07T18:00:37+00:00" property="article:published_time"/>
<meta content="2018-08-30T00:33:44+00:00" property="article:modified_time"/>
<meta content="2018-08-30T00:33:44+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Convolutional-Neural-Networks-for-Multi-Step-Time-Series-Forecasting.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Convolutional-Neural-Networks-for-Multi-Step-Time-Series-Forecasting.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="428" property="og:image:height"/>
<meta content="How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=6278" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-6278 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-53"> <div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-6278 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
<header>
<h1 class="title entry-title">How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-08T05:00:37+1100">October 8, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6278 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+Convolutional+Neural+Networks+for+Multi-Step+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Given the rise of smart electricity meters and the wide adoption of electricity generation technology like solar panels, there is a wealth of electricity usage data available.</p>
<p>This data represents a multivariate time series of power-related variables that in turn could be used to model and even forecast future electricity consumption.</p>
<p>Unlike other machine learning algorithms, convolutional neural networks are capable of automatically learning features from sequence data, support multiple-variate data, and can directly output a vector for multi-step forecasting. As such, one-dimensional CNNs have been demonstrated to perform well and even achieve state-of-the-art results on challenging sequence prediction problems.</p>
<p>In this tutorial, you will discover how to develop 1D convolutional neural networks for multi-step time series forecasting.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a CNN for multi-step time series forecasting model for univariate data.</li>
<li>How to develop a multichannel multi-step time series forecasting model for multivariate data.</li>
<li>How to develop a multi-headed multi-step time series forecasting model for multivariate data.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_6284" style="width: 650px"><img alt="How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting" class="size-full wp-image-6284" height="428" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Convolutional-Neural-Networks-for-Multi-Step-Time-Series-Forecasting.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Convolutional-Neural-Networks-for-Multi-Step-Time-Series-Forecasting.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Convolutional-Neural-Networks-for-Multi-Step-Time-Series-Forecasting-300x201.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting<br/>Photo by <a href="https://www.flickr.com/photos/richardsummers/4057257184/">Banalities</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into seven parts; they are:</p>
<ol>
<li>Problem Description</li>
<li>Load and Prepare Dataset</li>
<li>Model Evaluation</li>
<li>CNNs for Multi-Step Forecasting</li>
<li>Multi-step Time Series Forecasting With a Univariate CNN</li>
<li>Multi-step Time Series Forecasting With a Multichannel CNN</li>
<li>Multi-step Time Series Forecasting With a Multihead CNN</li>
</ol>
<h2>Problem Description</h2>
<p>The ‘<a href="https://archive.ics.uci.edu/ml/datasets/individual+household+electric+power+consumption">Household Power Consumption</a>‘ dataset is a multivariate time series dataset that describes the electricity consumption for a single household over four years.</p>
<p>The data was collected between December 2006 and November 2010 and observations of power consumption within the household were collected every minute.</p>
<p>It is a multivariate series comprised of seven variables (besides the date and time); they are:</p>
<ul>
<li><strong>global_active_power</strong>: The total active power consumed by the household (kilowatts).</li>
<li><strong>global_reactive_power</strong>: The total reactive power consumed by the household (kilowatts).</li>
<li><strong>voltage</strong>: Average voltage (volts).</li>
<li><strong>global_intensity</strong>: Average current intensity (amps).</li>
<li><strong>sub_metering_1</strong>: Active energy for kitchen (watt-hours of active energy).</li>
<li><strong>sub_metering_2</strong>: Active energy for laundry (watt-hours of active energy).</li>
<li><strong>sub_metering_3</strong>: Active energy for climate control systems (watt-hours of active energy).</li>
</ul>
<p>Active and reactive energy refer to the technical details of <a href="https://en.wikipedia.org/wiki/AC_power">alternative current</a>.</p>
<p>A fourth sub-metering variable can be created by subtracting the sum of three defined sub-metering variables from the total active energy as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad410b069733666" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
sub_metering_remainder = (global_active_power * 1000 / 60) - (sub_metering_1 + sub_metering_2 + sub_metering_3)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad410b069733666-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad410b069733666-1">sub_metering_remainder = (global_active_power * 1000 / 60) - (sub_metering_1 + sub_metering_2 + sub_metering_3)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Load and Prepare Dataset</h2>
<p>The dataset can be downloaded from the UCI Machine Learning repository as a single 20 megabyte .zip file:</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/machine-learning-databases/00235/household_power_consumption.zip">household_power_consumption.zip</a></li>
</ul>
<p>Download the dataset and unzip it into your current working directory. You will now have the file “<em>household_power_consumption.txt</em>” that is about 127 megabytes in size and contains all of the observations.</p>
<p>We can use the <em>read_csv()</em> function to load the data and combine the first two columns into a single date-time column that we can use as an index.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4113784479743" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all data
dataset = read_csv('household_power_consumption.txt', sep=';', header=0, low_memory=False, infer_datetime_format=True, parse_dates={'datetime':[0,1]}, index_col=['datetime'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4113784479743-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4113784479743-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4113784479743-1"><span class="crayon-p"># load all data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4113784479743-2"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sep</span><span class="crayon-o">=</span><span class="crayon-s">';'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">low_memory</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">{</span><span class="crayon-s">'datetime'</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we can mark all <a href="https://machinelearningmastery.com/handle-missing-timesteps-sequence-prediction-problems-python/">missing values</a> indicated with a ‘<em>?</em>‘ character with a <em>NaN</em> value, which is a float.</p>
<p>This will allow us to work with the data as one array of floating point values rather than mixed types (less efficient.)</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4116631699973" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# mark all missing values
dataset.replace('?', nan, inplace=True)
# make dataset numeric
dataset = dataset.astype('float32')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4116631699973-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4116631699973-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4116631699973-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4116631699973-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4116631699973-1"><span class="crayon-p"># mark all missing values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4116631699973-2"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-s">'?'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4116631699973-3"><span class="crayon-p"># make dataset numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4116631699973-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We also need to fill in the missing values now that they have been marked.</p>
<p>A very simple approach would be to copy the observation from the same time the day before. We can implement this in a function named <em>fill_missing()</em> that will take the NumPy array of the data and copy values from exactly 24 hours ago.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4117319771211" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fill missing values with a value at the same time one day ago
def fill_missing(values):
	one_day = 60 * 24
	for row in range(values.shape[0]):
		for col in range(values.shape[1]):
			if isnan(values[row, col]):
				values[row, col] = values[row - one_day, col]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4117319771211-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4117319771211-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4117319771211-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4117319771211-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4117319771211-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4117319771211-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4117319771211-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4117319771211-1"><span class="crayon-p"># fill missing values with a value at the same time one day ago</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4117319771211-2"><span class="crayon-e">def </span><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4117319771211-3"><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4117319771211-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4117319771211-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4117319771211-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4117319771211-7"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can apply this function directly to the data within the DataFrame.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4119654584995" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fill missing
fill_missing(dataset.values)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4119654584995-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4119654584995-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4119654584995-1"><span class="crayon-p"># fill missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4119654584995-2"><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now we can create a new column that contains the remainder of the sub-metering, using the calculation from the previous section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad411b027421583" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# add a column for for the remainder of sub metering
values = dataset.values
dataset['sub_metering_4'] = (values[:,0] * 1000 / 60) - (values[:,4] + values[:,5] + values[:,6])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad411b027421583-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411b027421583-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411b027421583-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad411b027421583-1"><span class="crayon-p"># add a column for for the remainder of sub metering</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411b027421583-2"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411b027421583-3"><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-s">'sub_metering_4'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can now save the cleaned-up version of the dataset to a new file; in this case we will just change the file extension to .csv and save the dataset as ‘<em>household_power_consumption.csv</em>‘.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad411c648165868" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# save updated dataset
dataset.to_csv('household_power_consumption.csv')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad411c648165868-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411c648165868-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad411c648165868-1"><span class="crayon-p"># save updated dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411c648165868-2"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Tying all of this together, the complete example of loading, cleaning-up, and saving the dataset is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad411e280368202" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load and clean-up data
from numpy import nan
from numpy import isnan
from pandas import read_csv
from pandas import to_numeric

# fill missing values with a value at the same time one day ago
def fill_missing(values):
	one_day = 60 * 24
	for row in range(values.shape[0]):
		for col in range(values.shape[1]):
			if isnan(values[row, col]):
				values[row, col] = values[row - one_day, col]

# load all data
dataset = read_csv('household_power_consumption.txt', sep=';', header=0, low_memory=False, infer_datetime_format=True, parse_dates={'datetime':[0,1]}, index_col=['datetime'])
# mark all missing values
dataset.replace('?', nan, inplace=True)
# make dataset numeric
dataset = dataset.astype('float32')
# fill missing
fill_missing(dataset.values)
# add a column for for the remainder of sub metering
values = dataset.values
dataset['sub_metering_4'] = (values[:,0] * 1000 / 60) - (values[:,4] + values[:,5] + values[:,6])
# save updated dataset
dataset.to_csv('household_power_consumption.csv')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-20">20</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-22">22</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-24">24</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad411e280368202-26">26</div><div class="crayon-num" data-line="crayon-5c0c9e4ad411e280368202-27">27</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-1"><span class="crayon-p"># load and clean-up data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">to_numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-6"> </div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-7"><span class="crayon-p"># fill missing values with a value at the same time one day ago</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-8"><span class="crayon-e">def </span><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-9"><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-10"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-12"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-13"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-14"> </div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-15"><span class="crayon-p"># load all data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-16"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sep</span><span class="crayon-o">=</span><span class="crayon-s">';'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">low_memory</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">{</span><span class="crayon-s">'datetime'</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-17"><span class="crayon-p"># mark all missing values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-18"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-s">'?'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-19"><span class="crayon-p"># make dataset numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-20"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-21"><span class="crayon-p"># fill missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-22"><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-23"><span class="crayon-p"># add a column for for the remainder of sub metering</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-24"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-25"><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-s">'sub_metering_4'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad411e280368202-26"><span class="crayon-p"># save updated dataset</span></div><div class="crayon-line" id="crayon-5c0c9e4ad411e280368202-27"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running the example creates the new file ‘<em>household_power_consumption.csv</em>‘ that we can use as the starting point for our modeling project.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Download Your FREE Mini-Course</a><script data-config="%7B%7D" data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Model Evaluation</h2>
<p>In this section, we will consider how we can develop and evaluate predictive models for the household power dataset.</p>
<p>This section is divided into four parts; they are:</p>
<ol>
<li>Problem Framing</li>
<li>Evaluation Metric</li>
<li>Train and Test Sets</li>
<li>Walk-Forward Validation</li>
</ol>
<h3>Problem Framing</h3>
<p>There are many ways to harness and explore the household power consumption dataset.</p>
<p>In this tutorial, we will use the data to explore a very specific question; that is:</p>
<blockquote><p>Given recent power consumption, what is the expected power consumption for the week ahead?</p></blockquote>
<p>This requires that a predictive model forecast the total active power for each day over the next seven days.</p>
<p>Technically, this framing of the problem is referred to as a multi-step time series forecasting problem, given the multiple forecast steps. A model that makes use of multiple input variables may be referred to as a multivariate multi-step time series forecasting model.</p>
<p>A model of this type could be helpful within the household in planning expenditures. It could also be helpful on the supply side for planning electricity demand for a specific household.</p>
<p>This framing of the dataset also suggests that it would be useful to downsample the per-minute observations of power consumption to daily totals. This is not required, but makes sense, given that we are interested in total power per day.</p>
<p>We can achieve this easily using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">resample() function</a> on the pandas DataFrame. Calling this function with the argument ‘<em>D</em>‘ allows the loaded data indexed by date-time to be grouped by day (<a href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">see all offset aliases</a>). We can then calculate the sum of all observations for each day and create a new dataset of daily power consumption data for each of the eight variables.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4120128048235" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# resample minute data to total for each day
from pandas import read_csv
# load the new file
dataset = read_csv('household_power_consumption.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# resample data to daily
daily_groups = dataset.resample('D')
daily_data = daily_groups.sum()
# summarize
print(daily_data.shape)
print(daily_data.head())
# save
daily_data.to_csv('household_power_consumption_days.csv')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4120128048235-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4120128048235-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4120128048235-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4120128048235-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4120128048235-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4120128048235-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4120128048235-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4120128048235-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4120128048235-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4120128048235-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4120128048235-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4120128048235-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4120128048235-1"><span class="crayon-p"># resample minute data to total for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4120128048235-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4120128048235-3"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4120128048235-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4120128048235-5"><span class="crayon-p"># resample data to daily</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4120128048235-6"><span class="crayon-v">daily_groups</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">resample</span><span class="crayon-sy">(</span><span class="crayon-s">'D'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4120128048235-7"><span class="crayon-v">daily_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">daily_groups</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4120128048235-8"><span class="crayon-p"># summarize</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4120128048235-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4120128048235-10"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4120128048235-11"><span class="crayon-p"># save</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4120128048235-12"><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Running the example creates a new daily total power consumption dataset and saves the result into a separate file named ‘<em>household_power_consumption_days.csv</em>‘.</p>
<p>We can use this as the dataset for fitting and evaluating predictive models for the chosen framing of the problem.</p>
<h3>Evaluation Metric</h3>
<p>A forecast will be comprised of seven values, one for each day of the week ahead.</p>
<p>It is common with multi-step forecasting problems to evaluate each forecasted time step separately. This is helpful for a few reasons:</p>
<ul>
<li>To comment on the skill at a specific lead time (e.g. +1 day vs +3 days).</li>
<li>To contrast models based on their skills at different lead times (e.g. models good at +1 day vs models good at days +5).</li>
</ul>
<p>The units of the total power are kilowatts and it would be useful to have an error metric that was also in the same units. Both Root Mean Squared Error (RMSE) and Mean Absolute Error (MAE) fit this bill, although RMSE is more commonly used and will be adopted in this tutorial. Unlike MAE, RMSE is more punishing of forecast errors.</p>
<p>The performance metric for this problem will be the RMSE for each lead time from day 1 to day 7.</p>
<p>As a short-cut, it may be useful to summarize the performance of a model using a single score in order to aide in model selection.</p>
<p>One possible score that could be used would be the RMSE across all forecast days.</p>
<p>The function <em>evaluate_forecasts()</em> below will implement this behavior and return the performance of a model based on multiple seven-day forecasts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4125479262655" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4125479262655-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4125479262655-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-1"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-3"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-4"><span class="crayon-h"> </span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-6"><span class="crayon-h"> </span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-7"><span class="crayon-h"> </span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-8"><span class="crayon-h"> </span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-9"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-10"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-11"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-12"><span class="crayon-h"> </span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-13"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-16"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4125479262655-17"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4125479262655-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Running the function will first return the overall RMSE regardless of day, then an array of RMSE scores for each day.</p>
<h3>Train and Test Sets</h3>
<p>We will use the first three years of data for training predictive models and the final year for evaluating models.</p>
<p>The data in a given dataset will be divided into standard weeks. These are weeks that begin on a Sunday and end on a Saturday.</p>
<p>This is a realistic and useful way for using the chosen framing of the model, where the power consumption for the week ahead can be predicted. It is also helpful with modeling, where models can be used to predict a specific day (e.g. Wednesday) or the entire sequence.</p>
<p>We will split the data into standard weeks, working backwards from the test dataset.</p>
<p>The final year of the data is in 2010 and the first Sunday for 2010 was January 3rd. The data ends in mid November 2010 and the closest final Saturday in the data is November 20th. This gives 46 weeks of test data.</p>
<p>The first and last rows of daily data for the test dataset are provided below for confirmation.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4127817157024" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
2010-01-03,2083.4539999999984,191.61000000000055,350992.12000000034,8703.600000000033,3842.0,4920.0,10074.0,15888.233355799992
...
2010-11-20,2197.006000000004,153.76800000000028,346475.9999999998,9320.20000000002,4367.0,2947.0,11433.0,17869.76663959999</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4127817157024-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4127817157024-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4127817157024-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4127817157024-1">2010-01-03,2083.4539999999984,191.61000000000055,350992.12000000034,8703.600000000033,3842.0,4920.0,10074.0,15888.233355799992</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4127817157024-2">...</div><div class="crayon-line" id="crayon-5c0c9e4ad4127817157024-3">2010-11-20,2197.006000000004,153.76800000000028,346475.9999999998,9320.20000000002,4367.0,2947.0,11433.0,17869.76663959999</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The daily data starts in late 2006.</p>
<p>The first Sunday in the dataset is December 17th, which is the second row of data.</p>
<p>Organizing the data into standard weeks gives 159 full standard weeks for training a predictive model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4129631883836" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
2006-12-17,3390.46,226.0059999999994,345725.32000000024,14398.59999999998,2033.0,4187.0,13341.0,36946.66673200004
...
2010-01-02,1309.2679999999998,199.54600000000016,352332.8399999997,5489.7999999999865,801.0,298.0,6425.0,14297.133406600002</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4129631883836-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4129631883836-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4129631883836-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4129631883836-1">2006-12-17,3390.46,226.0059999999994,345725.32000000024,14398.59999999998,2033.0,4187.0,13341.0,36946.66673200004</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4129631883836-2">...</div><div class="crayon-line" id="crayon-5c0c9e4ad4129631883836-3">2010-01-02,1309.2679999999998,199.54600000000016,352332.8399999997,5489.7999999999865,801.0,298.0,6425.0,14297.133406600002</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The function <em>split_dataset()</em> below splits the daily data into train and test sets and organizes each into standard weeks.</p>
<p>Specific row offsets are used to split the data using knowledge of the dataset. The split datasets are then organized into weekly data using the NumPy <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.split.html">split() function</a>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad412b486723192" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad412b486723192-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412b486723192-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412b486723192-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412b486723192-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412b486723192-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412b486723192-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412b486723192-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412b486723192-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad412b486723192-1"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412b486723192-2"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412b486723192-3"><span class="crayon-h"> </span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412b486723192-4"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412b486723192-5"><span class="crayon-h"> </span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412b486723192-6"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412b486723192-7"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412b486723192-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>We can test this function out by loading the daily dataset and printing the first and last rows of data from both the train and test sets to confirm they match the expectations above.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad412c838030523" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split into standard weeks
from numpy import split
from numpy import array
from pandas import read_csv

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
train, test = split_dataset(dataset.values)
# validate train data
print(train.shape)
print(train[0, 0, 0], train[-1, -1, 0])
# validate test
print(test.shape)
print(test[0, 0, 0], test[-1, -1, 0])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-20">20</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412c838030523-22">22</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412c838030523-23">23</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-1"><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-6"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-7"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-8"><span class="crayon-h"> </span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-9"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-10"><span class="crayon-h"> </span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-11"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-12"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-14"> </div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-15"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-16"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-17"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-18"><span class="crayon-p"># validate train data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-19"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-20"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-21"><span class="crayon-p"># validate test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412c838030523-22"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad412c838030523-23"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Running the example shows that indeed the train dataset has 159 weeks of data, whereas the test dataset has 46 weeks.</p>
<p>We can see that the total active power for the train and test dataset for the first and last rows match the data for the specific dates that we defined as the bounds on the standard weeks for each set.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad412e442041482" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(159, 7, 8)
3390.46 1309.2679999999998
(46, 7, 8)
2083.4539999999984 2197.006000000004</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad412e442041482-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412e442041482-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad412e442041482-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad412e442041482-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad412e442041482-1">(159, 7, 8)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412e442041482-2">3390.46 1309.2679999999998</div><div class="crayon-line" id="crayon-5c0c9e4ad412e442041482-3">(46, 7, 8)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad412e442041482-4">2083.4539999999984 2197.006000000004</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h3>Walk-Forward Validation</h3>
<p>Models will be evaluated using a scheme called <a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/">walk-forward validation</a>.</p>
<p>This is where a model is required to make a one week prediction, then the actual data for that week is made available to the model so that it can be used as the basis for making a prediction on the subsequent week. This is both realistic for how the model may be used in practice and beneficial to the models, allowing them to make use of the best available data.</p>
<p>We can demonstrate this below with separation of input data and output/predicted data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4130321397597" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Input, 						Predict
[Week1]						Week2
[Week1 + Week2]				Week3
[Week1 + Week2 + Week3]		Week4
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4130321397597-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4130321397597-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4130321397597-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4130321397597-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4130321397597-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4130321397597-1">Input, 						Predict</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4130321397597-2">[Week1]						Week2</div><div class="crayon-line" id="crayon-5c0c9e4ad4130321397597-3">[Week1 + Week2]				Week3</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4130321397597-4">[Week1 + Week2 + Week3]		Week4</div><div class="crayon-line" id="crayon-5c0c9e4ad4130321397597-5">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The walk-forward validation approach to evaluating predictive models on this dataset is provided below, named <em>evaluate_model()</em>.</p>
<p>The train and test datasets in standard-week format are provided to the function as arguments. An additional argument, <em>n_input</em>, is provided that is used to define the number of prior observations that the model will use as input in order to make a prediction.</p>
<p>Two new functions are called: one to build a model from the training data called <em>build_model()</em> and another that uses the model to make forecasts for each new standard week, called <em>forecast()</em>. These will be covered in subsequent sections.</p>
<p>We are working with neural networks and as such they are generally slow to train but fast to evaluate. This means that the preferred usage of the models is to build them once on historical data and to use them to forecast each step of the walk-forward validation. The models are static (i.e. not updated) during their evaluation.</p>
<p>This is different to other models that are faster to train, where a model may be re-fit or updated each step of the walk-forward validation as new data is made available. With sufficient resources, it is possible to use neural networks this way, but we will not in this tutorial.</p>
<p>The complete <em>evaluate_model()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4132263747005" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4132263747005-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4132263747005-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-1"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-3"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-5"><span class="crayon-h"> </span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-6"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-7"><span class="crayon-h"> </span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-8"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-10"><span class="crayon-h"> </span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-11"><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-12"><span class="crayon-h"> </span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-13"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-14"><span class="crayon-h"> </span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-15"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-16"><span class="crayon-h"> </span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-17"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4132263747005-18"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4132263747005-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Once we have the evaluation for a model, we can summarize the performance.</p>
<p>The function below, named <em>summarize_scores()</em>, will display the performance of a model as a single line for easy comparison with other models.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4134339828263" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4134339828263-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4134339828263-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4134339828263-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4134339828263-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4134339828263-1"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4134339828263-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4134339828263-3"><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4134339828263-4"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We now have all of the elements to begin evaluating predictive models on the dataset.</p>
<h2>CNNs for Multi-Step Forecasting</h2>
<p>Convolutional Neural Network models, or CNNs for short, are a type of deep neural network that was developed for use with image data, such as handwriting recognition.</p>
<p>They are proven very effective on challenging computer vision problems when trained at scale for tasks such as identifying and localizing objects in images and automatically describing the content of images.</p>
<p>They are a model that are comprised of two main types of elements: convolutional layers and pooling layers.</p>
<p><strong>Convolutional layers</strong> read an input, such as a 2D image or a 1D signal using a kernel that reads in small segments at a time and steps across the entire input field. Each read results in an interpretation of the input that is projected onto a filter map and represents an interpretation of the input.</p>
<p><strong>Pooling layers</strong> take the feature map projections and distill them to the most essential elements, such as using a signal averaging or signal maximizing process.</p>
<p>The convolution and pooling layers can be repeated at depth, providing multiple layers of abstraction of the input signals.</p>
<p>The output of these networks is often one or more fully-connected layers that interpret what has been read and maps this internal representation to a class value.</p>
<p>For more information on convolutional neural networks, you can see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/crash-course-convolutional-neural-networks/">Crash Course in Convolutional Neural Networks for Machine Learning</a></li>
</ul>
<p>Convolutional neural networks can be used for multi-step time series forecasting.</p>
<ul>
<li>The convolutional layers can read sequences of input data and automatically extract features.</li>
<li>The pooling layers can distill the extracted features and focus attention on the most salient elements.</li>
<li>The fully connected layers can interpret the internal representation and output a vector representing multiple time steps.</li>
</ul>
<p>The key benefits of the approach are the automatic feature learning and the ability of the model to output a multi-step vector directly.</p>
<p>CNNs can be used in either a recursive or direct forecast strategy, where the model makes one-step predictions and outputs are fed as inputs for subsequent predictions, and where one model is developed for each time step to be predicted. Alternately, CNNs can be used to predict the entire output sequence as a one-step prediction of the entire vector. This is a general benefit of feed-forward neural networks.</p>
<p>An important secondary benefit of using CNNs is that they can support multiple 1D inputs in order to make a prediction. This is useful if the multi-step output sequence is a function of more than one input sequence. This can be achieved using two different model configurations.</p>
<ul>
<li><strong>Multiple Input Channels</strong>. This is where each input sequence is read as a separate channel, like the different channels of an image (e.g. red, green and blue).</li>
<li><strong>Multiple Input Heads</strong>. This is where each input sequence is read by a different CNN sub-model and the internal representations are combined before being interpreted and used to make a prediction.</li>
</ul>
<p>In this tutorial, we will explore how to develop three different types of CNN models for multi-step time series forecasting; they are:</p>
<ul>
<li>A CNN for multi-step time series forecasting with univariate input data.</li>
<li>A CNN for multi-step time series forecasting with multivariate input data via channels.</li>
<li>A CNN for multi-step time series forecasting with multivariate input data via submodels.</li>
</ul>
<p>The models will be developed and demonstrated on the household power prediction problem. A model is considered skillful if it achieves performance better than a naive model, which is an overall RMSE of about 465 kilowatts across a seven day forecast.</p>
<p>We will not focus on the tuning of these models to achieve optimal performance; instead we will sill stop short at skillful models as compared to a naive forecast. The chosen structures and hyperparameters are chosen with a little trial and error.</p>
<h2>Multi-step Time Series Forecasting With a Univariate CNN</h2>
<p>In this section, we will develop a convolutional neural network for multi-step time series forecasting using only the univariate sequence of daily power consumption.</p>
<p>Specifically, the framing of the problem is:</p>
<blockquote><p>Given some number of prior days of total daily power consumption, predict the next standard week of daily power consumption.</p></blockquote>
<p>The number of prior days used as input defines the one-dimensional (1D) subsequence of data that the CNN will read and learn to extract features. Some ideas on the size and nature of this input include:</p>
<ul>
<li>All prior days, up to years worth of data.</li>
<li>The prior seven days.</li>
<li>The prior two weeks.</li>
<li>The prior one month.</li>
<li>The prior one year.</li>
<li>The prior week and the week to be predicted from one year ago.</li>
</ul>
<p>There is no right answer; instead, each approach and more can be tested and the performance of the model can be used to choose the nature of the input that results in the best model performance.</p>
<p>These choices define a few things about the implementation, such as:</p>
<ul>
<li>How the training data must be prepared in order to fit the model.</li>
<li>How the test data must be prepared in order to evaluate the model.</li>
<li>How to use the model to make predictions with a final model in the future.</li>
</ul>
<p>A good starting point would be to use the prior seven days.</p>
<p>A 1D CNN model expects data to have the shape of:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4136398705246" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[samples, timesteps, features]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4136398705246-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4136398705246-1">[samples, timesteps, features]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>One sample will be comprised of seven time steps with one feature for the seven days of total daily power consumed.</p>
<p>The training dataset has 159 weeks of data, so the shape of the training dataset would be:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4138757695141" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[159, 7, 1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4138757695141-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4138757695141-1">[159, 7, 1]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>This is a good start. The data in this format would use the prior standard week to predict the next standard week. A problem is that 159 instances is not a lot for a neural network.</p>
<p>A way to create a lot more training data is to change the problem during training to predict the next seven days given the prior seven days, regardless of the standard week.</p>
<p>This only impacts the training data, the test problem remains the same: predict the daily power consumption for the next standard week given the prior standard week.</p>
<p>This will require a little preparation of the training data.</p>
<p>The training data is provided in standard weeks with eight variables, specifically in the shape [159, 7, 8]. The first step is to flatten the data so that we have eight time series sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad413a134666173" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# flatten data
data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad413a134666173-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413a134666173-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad413a134666173-1"><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413a134666173-2"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We then need to iterate over the time steps and divide the data into overlapping windows; each iteration moves along one time step and predicts the subsequent seven days.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad413c046965089" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Input, Output
[d01, d02, d03, d04, d05, d06, d07],	[d08, d09, d10, d11, d12, d13, d14]
[d02, d03, d04, d05, d06, d07, d08],	[d09, d10, d11, d12, d13, d14, d15]
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad413c046965089-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413c046965089-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413c046965089-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413c046965089-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad413c046965089-1">Input, Output</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413c046965089-2">[d01, d02, d03, d04, d05, d06, d07],	[d08, d09, d10, d11, d12, d13, d14]</div><div class="crayon-line" id="crayon-5c0c9e4ad413c046965089-3">[d02, d03, d04, d05, d06, d07, d08],	[d09, d10, d11, d12, d13, d14, d15]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413c046965089-4">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can do this by keeping track of start and end indexes for the inputs and outputs as we iterate across the length of the flattened data in terms of time steps.</p>
<p>We can also do this in a way where the number of inputs and outputs are parameterized (e.g. <em>n_input</em>, <em>n_out</em>) so that you can experiment with different values or adapt it for your own problem.</p>
<p>Below is a function named <em>to_supervised()</em> that takes a list of weeks (history) and the number of time steps to use as inputs and outputs and returns the data in the overlapping moving window format.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad413e085658135" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			x_input = data[in_start:in_end, 0]
			x_input = x_input.reshape((len(x_input), 1))
			X.append(x_input)
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad413e085658135-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad413e085658135-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-1"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-2"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-3"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-5"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-6"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-7"><span class="crayon-h"> </span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-9"><span class="crayon-h"> </span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-10"><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-11"><span class="crayon-e"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-12"><span class="crayon-h"> </span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-13"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-14"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-15"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-16"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-17"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-18"><span class="crayon-h"> </span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5c0c9e4ad413e085658135-19"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad413e085658135-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>When we run this function on the entire training dataset, we transform 159 samples into 1,099; specifically, the transformed dataset has the shapes <em>X=[1099, 7, 1]</em> and <em>y=[1099, 7].</em></p>
<p>Next, we can define and fit the CNN model on the training data.</p>
<p>This multi-step time series forecasting problem is an autoregression. That means it is likely best modeled where that the next seven days is some function of observations at prior time steps. This and the relatively small amount of data means that a small model is required.</p>
<p>We will use a model with one convolution layer with 16 filters and a kernel size of 3. This means that the input sequence of seven days will be read with a convolutional operation three time steps at a time and this operation will be performed 16 times. A pooling layer will reduce these feature maps by 1/4 their size before the internal representation is flattened to one long vector. This is then interpreted by a fully connected layer before the output layer predicts the next seven days in the sequence.</p>
<p>We will use the mean squared error loss function as it is a good match for our chosen error metric of RMSE. We will use the efficient <a href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/">Adam</a> implementation of stochastic gradient descent and fit the model for 20 epochs with a batch size of 4.</p>
<p>The small batch size and the stochastic nature of the algorithm means that the same model will learn a slightly different mapping of inputs to outputs each time it is trained. This means <a href="https://machinelearningmastery.com/randomness-in-machine-learning/">results may vary when the model is evaluated</a>. You can try running the model multiple times and calculating an average of model performance.</p>
<p>The <em>build_model()</em> below prepares the training data, defines the model, and fits the model on the training data, returning the fit model ready for making predictions.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4140468942853" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 4
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# define model
	model = Sequential()
	model.add(Conv1D(filters=16, kernel_size=3, activation='relu', input_shape=(n_timesteps,n_features)))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(10, activation='relu'))
	model.add(Dense(n_outputs))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4140468942853-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4140468942853-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-1"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-2"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-3"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-4"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-5"><span class="crayon-h"> </span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-6"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-7"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-8"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-9"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-10"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">16</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-11"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-16"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4140468942853-17"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4140468942853-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>Now that we know how to fit the model, we can look at how the model can be used to make a prediction.</p>
<p>Generally, the model expects data to have the same three dimensional shape when making a prediction.</p>
<p>In this case, the expected shape of an input pattern is one sample, seven days of one feature for the daily power consumed:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4142246518464" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[1, 7, 1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4142246518464-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4142246518464-1">[1, 7, 1]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Data must have this shape when making predictions for the test set and when a final model is being used to make predictions in the future. If you change the number of input days to 14, then the shape of the training data and the shape of new samples when making predictions must be changed accordingly to have 14 time steps. It is a modeling choice that you must carry forward when using the model.</p>
<p>We are using walk-forward validation to evaluate the model as described in the previous section.</p>
<p>This means that we have the observations available for the prior week in order to predict the coming week. These are collected into an array of standard weeks, called history.</p>
<p>In order to predict the next standard week, we need to retrieve the last days of observations. As with the training data, we must first flatten the history data to remove the weekly structure so that we end up with eight parallel time series.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4144389805327" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# flatten data
data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4144389805327-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4144389805327-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4144389805327-1"><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4144389805327-2"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we need to retrieve the last seven days of daily total power consumed (feature number 0). We will parameterize as we did for the training data so that the number of prior days used as input by the model can be modified in the future.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4146488687318" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# retrieve last observations for input data
input_x = data[-n_input:, 0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4146488687318-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4146488687318-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4146488687318-1"><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4146488687318-2"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Next, we reshape the input into the expected three-dimensional structure.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4147481743227" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape into [1, n_input, 1]
input_x = input_x.reshape((1, len(input_x), 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4147481743227-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4147481743227-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4147481743227-1"><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4147481743227-2"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We then make a prediction using the fit model and the input data and retrieve the vector of seven days of output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4149363887413" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast the next week
yhat = model.predict(input_x, verbose=0)
# we only want the vector forecast
yhat = yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4149363887413-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4149363887413-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4149363887413-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4149363887413-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4149363887413-1"><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4149363887413-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4149363887413-3"><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4149363887413-4"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The <em>forecast()</em> function below implements this and takes as arguments the model fit on the training dataset, the history of data observed so far, and the number of inputs time steps expected by the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad414a232439780" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [1, n_input, 1]
	input_x = input_x.reshape((1, len(input_x), 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad414a232439780-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414a232439780-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414a232439780-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414a232439780-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414a232439780-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414a232439780-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414a232439780-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414a232439780-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414a232439780-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414a232439780-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414a232439780-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414a232439780-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414a232439780-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414a232439780-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad414a232439780-1"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414a232439780-2"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414a232439780-3"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414a232439780-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414a232439780-5"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414a232439780-6"><span class="crayon-h"> </span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414a232439780-7"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414a232439780-8"><span class="crayon-h"> </span><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414a232439780-9"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414a232439780-10"><span class="crayon-h"> </span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414a232439780-11"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414a232439780-12"><span class="crayon-h"> </span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414a232439780-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414a232439780-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>That’s it; we now have everything we need to make multi-step time series forecasts with a CNN model on the daily total power consumed univariate dataset.</p>
<p>We can tie all of this together. The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad414c334562307" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# univariate multi-step cnn
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			x_input = data[in_start:in_end, 0]
			x_input = x_input.reshape((len(x_input), 1))
			X.append(x_input)
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 4
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# define model
	model = Sequential()
	model.add(Conv1D(filters=16, kernel_size=3, activation='relu', input_shape=(n_timesteps,n_features)))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(10, activation='relu'))
	model.add(Dense(n_outputs))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [1, n_input, 1]
	input_x = input_x.reshape((1, len(input_x), 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# evaluate model and get scores
n_input = 7
score, scores = evaluate_model(train, test, n_input)
# summarize scores
summarize_scores('cnn', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='cnn')
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-20">20</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-22">22</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-24">24</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-26">26</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-28">28</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-30">30</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-32">32</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-34">34</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-36">36</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-38">38</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-40">40</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-42">42</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-44">44</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-46">46</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-48">48</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-50">50</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-52">52</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-54">54</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-56">56</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-58">58</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-60">60</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-62">62</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-64">64</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-66">66</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-68">68</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-70">70</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-72">72</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-74">74</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-76">76</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-78">78</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-80">80</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-82">82</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-84">84</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-86">86</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-88">88</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-90">90</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-92">92</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-94">94</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-96">96</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-98">98</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-100">100</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-102">102</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-104">104</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-106">106</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-108">108</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-110">110</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-112">112</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-114">114</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-116">116</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-118">118</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-120">120</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-122">122</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-124">124</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-126">126</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-128">128</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-130">130</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-132">132</div><div class="crayon-num" data-line="crayon-5c0c9e4ad414c334562307-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad414c334562307-134">134</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-1"><span class="crayon-p"># univariate multi-step cnn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-14"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-15"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-16"><span class="crayon-h"> </span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-17"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-18"><span class="crayon-h"> </span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-19"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-20"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-22"> </div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-23"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-24"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-25"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-26"><span class="crayon-h"> </span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-27"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-28"><span class="crayon-h"> </span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-29"><span class="crayon-h"> </span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-30"><span class="crayon-h"> </span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-31"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-32"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-33"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-34"><span class="crayon-h"> </span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-35"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-36"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-37"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-38"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-39"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-40"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-41"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-42"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-43"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-44"><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-45"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-46"> </div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-47"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-48"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-49"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-50"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-51"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-52"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-53"><span class="crayon-h"> </span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-54"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-55"><span class="crayon-h"> </span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-56"><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-57"><span class="crayon-e"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-58"><span class="crayon-h"> </span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-59"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-60"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-61"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-62"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-63"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-64"><span class="crayon-h"> </span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-65"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-66"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-67"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-68"><span class="crayon-p"># train the model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-69"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-70"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-71"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-72"><span class="crayon-h"> </span><span class="crayon-p"># define parameters</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-73"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-74"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-75"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-76"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-77"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">16</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-78"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-79"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-80"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-81"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-82"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-83"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-84"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-85"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-86"> </div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-87"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-88"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-89"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-90"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-91"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-92"><span class="crayon-h"> </span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-93"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-94"><span class="crayon-h"> </span><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-95"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-96"><span class="crayon-h"> </span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-97"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-98"><span class="crayon-h"> </span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-99"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-100"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-101"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-102"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-103"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-104"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-105"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-106"><span class="crayon-h"> </span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-107"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-108"><span class="crayon-h"> </span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-109"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-110"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-111"><span class="crayon-h"> </span><span class="crayon-p"># predict the week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-112"><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-113"><span class="crayon-h"> </span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-114"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-115"><span class="crayon-h"> </span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-116"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-117"><span class="crayon-h"> </span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-118"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-119"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-120"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-121"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-122"><span class="crayon-p"># load the new file</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-123"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-124"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-125"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-126"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-127"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-128"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-129"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-130"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'cnn'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-131"><span class="crayon-p"># plot scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-132"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad414c334562307-133"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'cnn'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad414c334562307-134"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0074 seconds] -->
<p>Running the example fits and evaluates the model, printing the overall RMSE across all seven days, and the per-day RMSE for each lead time.</p>
<p>Your specific results may vary given the stochastic nature of the algorithm. You may want to try running the example a few times.</p>
<p>We can see that in this case, the model was skillful as compared to a naive forecast, achieving an overall RMSE of about 404 kilowatts, less than 465 kilowatts achieved by a naive model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad414e638589151" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
cnn: [404.411] 436.1, 400.6, 346.2, 388.2, 405.5, 326.0, 502.9</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad414e638589151-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad414e638589151-1">cnn: [404.411] 436.1, 400.6, 346.2, 388.2, 405.5, 326.0, 502.9</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A plot of the daily RMSE is also created. The plot shows that perhaps Tuesdays and Fridays are easier days to forecast than the other days and that perhaps Saturday at the end of the standard week is the hardest day to forecast.</p>
<div class="wp-caption aligncenter" id="attachment_6279" style="width: 1290px"><img alt="Line Plot of RMSE per Day for Univariate CNN with 7-day Inputs" class="size-full wp-image-6279" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-7-day-Inputs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-7-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-7-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-7-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-7-day-Inputs-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plot of RMSE per Day for Univariate CNN with 7-day Inputs</p></div>
<p>We can increase the number of prior days to use as input from seven to 14 by changing the <em>n_input</em> variable.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4151049740576" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate model and get scores
n_input = 14</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4151049740576-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4151049740576-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4151049740576-1"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4151049740576-2"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Re-running the example with this change first prints a summary of the performance of the model.</p>
<p>Your specific results may vary; try running the example a few times.</p>
<p>In this case, we can see a further drop in the overall RMSE, suggesting that further tuning of the input size and perhaps the kernel size of the model may result in better performance.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4153158812713" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
cnn: [396.497] 392.2, 412.8, 384.0, 389.0, 387.3, 381.0, 427.1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4153158812713-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4153158812713-1">cnn: [396.497] 392.2, 412.8, 384.0, 389.0, 387.3, 381.0, 427.1</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Comparing the per-day RMSE scores, we see some are better and some are worse than using seventh inputs.</p>
<p>This may suggest a benefit in using the two different sized inputs in some way, such as an ensemble of the two approaches or perhaps a single model (e.g. a multi-headed model) that reads the training data in different ways.</p>
<div class="wp-caption aligncenter" id="attachment_6280" style="width: 1290px"><img alt="Line Plot of RMSE per Day for Univariate CNN with 14-day Inputs" class="size-full wp-image-6280" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-14-day-Inputs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-CNN-with-14-day-Inputs-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plot of RMSE per Day for Univariate CNN with 14-day Inputs</p></div>
<h2>Multi-step Time Series Forecasting With a Multichannel CNN</h2>
<p>In this section, we will update the CNN developed in the previous section to use each of the eight time series variables to predict the next standard week of daily total power consumption.</p>
<p>We will do this by providing each one-dimensional time series to the model as a separate channel of input.</p>
<p>The CNN will then use a separate kernel and read each input sequence onto a separate set of filter maps, essentially learning features from each input time series variable.</p>
<p>This is helpful for those problems where the output sequence is some function of the observations at prior time steps from multiple different features, not just (or including) the feature being forecasted. It is unclear whether this is the case in the power consumption problem, but we can explore it nonetheless.</p>
<p>First, we must update the preparation of the training data to include all of the eight features, not just the one total daily power consumed. It requires a single line:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4155945434148" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X.append(data[in_start:in_end, :])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4155945434148-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4155945434148-1"><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete <em>to_supervised()</em> function with this change is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4157803576585" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			X.append(data[in_start:in_end, :])
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4157803576585-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4157803576585-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-1"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-2"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-3"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-5"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-6"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-7"><span class="crayon-h"> </span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-9"><span class="crayon-h"> </span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-10"><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-11"><span class="crayon-e"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-12"><span class="crayon-h"> </span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-13"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-14"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-15"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-16"><span class="crayon-h"> </span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4157803576585-17"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4157803576585-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We also must update the function used to make forecasts with the fit model to use all eight features from the prior time steps. Again, another small change:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4158201466730" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# retrieve last observations for input data
input_x = data[-n_input:, :]
# reshape into [1, n_input, n]
input_x = input_x.reshape((1, input_x.shape[0], input_x.shape[1]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4158201466730-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4158201466730-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4158201466730-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4158201466730-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4158201466730-1"><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4158201466730-2"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4158201466730-3"><span class="crayon-p"># reshape into [1, n_input, n]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4158201466730-4"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The complete <em>forecast()</em> with this change is listed below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad415a762741972" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, :]
	# reshape into [1, n_input, n]
	input_x = input_x.reshape((1, input_x.shape[0], input_x.shape[1]))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad415a762741972-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415a762741972-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415a762741972-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415a762741972-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415a762741972-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415a762741972-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415a762741972-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415a762741972-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415a762741972-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415a762741972-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415a762741972-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415a762741972-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415a762741972-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415a762741972-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad415a762741972-1"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415a762741972-2"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415a762741972-3"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415a762741972-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415a762741972-5"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415a762741972-6"><span class="crayon-h"> </span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415a762741972-7"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415a762741972-8"><span class="crayon-h"> </span><span class="crayon-p"># reshape into [1, n_input, n]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415a762741972-9"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415a762741972-10"><span class="crayon-h"> </span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415a762741972-11"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415a762741972-12"><span class="crayon-h"> </span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415a762741972-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415a762741972-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We will use 14 days of prior observations across eight of the input variables as we did in the final section of the prior section that resulted in slightly better performance.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad415c869508875" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_input = 14</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad415c869508875-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad415c869508875-1"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Finally, the model used in the previous section does not perform well on this new framing of the problem.</p>
<p>The increase in the amount of data requires a larger and more sophisticated model that is trained for longer.</p>
<p>With a little trial and error, one model that performs well uses two convolutional layers with 32 filter maps followed by pooling, then another convolutional layer with 16 feature maps and pooling. The fully connected layer that interprets the features is increased to 100 nodes and the model is fit for 70 epochs with a batch size of 16 samples.</p>
<p>The updated <em>build_model()</em> function that defines and fits the model on the training dataset is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad415e373653213" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 70, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# define model
	model = Sequential()
	model.add(Conv1D(filters=32, kernel_size=3, activation='relu', input_shape=(n_timesteps,n_features)))
	model.add(Conv1D(filters=32, kernel_size=3, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Conv1D(filters=16, kernel_size=3, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad415e373653213-20">20</div><div class="crayon-num" data-line="crayon-5c0c9e4ad415e373653213-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-1"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-2"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-3"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-4"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-5"><span class="crayon-h"> </span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-6"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-7"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-8"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-9"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-10"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-11"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">16</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-17"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-19"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad415e373653213-20"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad415e373653213-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>We now have all of the elements required to develop a multi-channel CNN for multivariate input data to make multi-step time series forecasts.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4160813461701" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# multichannel multi-step cnn
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			X.append(data[in_start:in_end, :])
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 70, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# define model
	model = Sequential()
	model.add(Conv1D(filters=32, kernel_size=3, activation='relu', input_shape=(n_timesteps,n_features)))
	model.add(Conv1D(filters=32, kernel_size=3, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Conv1D(filters=16, kernel_size=3, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, :]
	# reshape into [1, n_input, n]
	input_x = input_x.reshape((1, input_x.shape[0], input_x.shape[1]))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# evaluate model and get scores
n_input = 14
score, scores = evaluate_model(train, test, n_input)
# summarize scores
summarize_scores('cnn', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='cnn')
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-20">20</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-22">22</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-24">24</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-26">26</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-28">28</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-30">30</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-32">32</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-34">34</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-36">36</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-38">38</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-40">40</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-42">42</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-44">44</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-46">46</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-48">48</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-50">50</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-52">52</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-54">54</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-56">56</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-58">58</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-60">60</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-62">62</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-64">64</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-66">66</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-68">68</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-70">70</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-72">72</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-74">74</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-76">76</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-78">78</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-80">80</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-82">82</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-84">84</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-86">86</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-88">88</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-90">90</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-92">92</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-94">94</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-96">96</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-98">98</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-100">100</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-102">102</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-104">104</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-106">106</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-108">108</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-110">110</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-112">112</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-114">114</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-116">116</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-118">118</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-120">120</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-122">122</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-124">124</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-126">126</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-128">128</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-130">130</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-132">132</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4160813461701-134">134</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4160813461701-135">135</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-1"><span class="crayon-p"># multichannel multi-step cnn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-14"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-15"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-16"><span class="crayon-h"> </span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-17"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-18"><span class="crayon-h"> </span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-19"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-20"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-22"> </div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-23"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-24"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-25"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-26"><span class="crayon-h"> </span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-27"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-28"><span class="crayon-h"> </span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-29"><span class="crayon-h"> </span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-30"><span class="crayon-h"> </span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-31"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-32"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-33"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-34"><span class="crayon-h"> </span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-35"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-36"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-37"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-38"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-39"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-40"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-41"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-42"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-43"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-44"><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-45"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-46"> </div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-47"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-48"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-49"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-50"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-51"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-52"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-53"><span class="crayon-h"> </span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-54"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-55"><span class="crayon-h"> </span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-56"><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-57"><span class="crayon-e"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-58"><span class="crayon-h"> </span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-59"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-60"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-61"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-62"><span class="crayon-h"> </span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-63"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-64"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-65"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-66"><span class="crayon-p"># train the model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-67"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-68"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-69"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-70"><span class="crayon-h"> </span><span class="crayon-p"># define parameters</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-71"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-72"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-73"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-74"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-75"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-76"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-77"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-78"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">16</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-79"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-80"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-81"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-82"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-83"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-84"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-85"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-86"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-88"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-89"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-90"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-91"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-92"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-93"><span class="crayon-h"> </span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-94"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-95"><span class="crayon-h"> </span><span class="crayon-p"># reshape into [1, n_input, n]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-96"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-97"><span class="crayon-h"> </span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-98"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-99"><span class="crayon-h"> </span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-100"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-101"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-102"> </div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-103"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-104"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-105"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-106"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-107"><span class="crayon-h"> </span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-108"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-109"><span class="crayon-h"> </span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-110"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-111"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-112"><span class="crayon-h"> </span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-113"><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-114"><span class="crayon-h"> </span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-115"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-116"><span class="crayon-h"> </span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-117"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-118"><span class="crayon-h"> </span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-119"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-120"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-121"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-122"> </div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-123"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-124"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-125"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-126"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-127"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-128"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-129"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-130"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-131"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'cnn'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-132"><span class="crayon-p"># plot scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-133"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4160813461701-134"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'cnn'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4160813461701-135"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0077 seconds] -->
<p>Running the example fits and evaluates the model, printing the overall RMSE across all seven days, and the per-day RMSE for each lead time.</p>
<p>Your specific results may vary given the stochastic nature of the algorithm. You may want to try running the example a few times.</p>
<p>We can see that in this case, the use of all eight input variables does result in another small drop in the overall RMSE score.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4162080387200" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
cnn: [385.711] 422.2, 363.5, 349.8, 393.1, 357.1, 318.8, 474.3</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4162080387200-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4162080387200-1">cnn: [385.711] 422.2, 363.5, 349.8, 393.1, 357.1, 318.8, 474.3</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>For the daily RMSE scores, we do see that some are better and some are worse than the univariate CNN from the previous section.</p>
<p>The final day, Saturday, remains a challenging day to forecast, and Friday an easy day to forecast. There may be some benefit in designing models to focus specifically on reducing the error of the harder to forecast days.</p>
<p>It may be interesting to see if the variance across daily scores could be further reduced with a tuned model or perhaps an ensemble of multiple different models. It may also be interesting to compare the performance for a model that uses seven or even 21 days of input data to see if further gains can be made.</p>
<div class="wp-caption aligncenter" id="attachment_6281" style="width: 1290px"><img alt="Line Plot of RMSE per Day for a Multichannel CNN with 14-day Inputs" class="size-full wp-image-6281" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multichannel-CNN-with-14-day-Inputs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multichannel-CNN-with-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multichannel-CNN-with-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multichannel-CNN-with-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multichannel-CNN-with-14-day-Inputs-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plot of RMSE per Day for a Multichannel CNN with 14-day Inputs</p></div>
<h2>Multi-step Time Series Forecasting With a Multihead CNN</h2>
<p>We can further extend the CNN model to have a separate sub-CNN model or head for each input variable, which we can refer to as a multi-headed CNN model.</p>
<p>This requires a modification to the preparation of the model, and in turn, modification to the preparation of the training and test datasets.</p>
<p>Starting with the model, we must define a separate CNN model for each of the eight input variables.</p>
<p>The configuration of the model, including the number of layers and their hyperparameters, were also modified to better suit the new approach. The new configuration is not optimal and was found with a little trial and error.</p>
<p>The multi-headed model is specified using the more flexible <a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/">functional API for defining Keras models</a>.</p>
<p>We can loop over each variable and create a sub-model that takes a one-dimensional sequence of 14 days of data and outputs a flat vector containing a summary of the learned features from the sequence. Each of these vectors can be merged via concatenation to make one very long vector that is then interpreted by some fully connected layers before a prediction is made.</p>
<p>As we build up the submodels, we keep track of the input layers and flatten layers in lists. This is so that we can specify the inputs in the definition of the model object and use the list of flatten layers in the merge layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4165066290404" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a channel for each variable
in_layers, out_layers = list(), list()
for i in range(n_features):
	inputs = Input(shape=(n_timesteps,1))
	conv1 = Conv1D(filters=32, kernel_size=3, activation='relu')(inputs)
	conv2 = Conv1D(filters=32, kernel_size=3, activation='relu')(conv1)
	pool1 = MaxPooling1D(pool_size=2)(conv2)
	flat = Flatten()(pool1)
	# store layers
	in_layers.append(inputs)
	out_layers.append(flat)
# merge heads
merged = concatenate(out_layers)
# interpretation
dense1 = Dense(200, activation='relu')(merged)
dense2 = Dense(100, activation='relu')(dense1)
outputs = Dense(n_outputs)(dense2)
model = Model(inputs=in_layers, outputs=outputs)
# compile model
model.compile(loss='mse', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4165066290404-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4165066290404-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-1"><span class="crayon-p"># create a channel for each variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-2"><span class="crayon-v">in_layers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">out_layers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-4"><span class="crayon-h"> </span><span class="crayon-v">inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-5"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-6"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-7"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-8"><span class="crayon-h"> </span><span class="crayon-v">flat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-9"><span class="crayon-h"> </span><span class="crayon-p"># store layers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-10"><span class="crayon-h"> </span><span class="crayon-v">in_layers</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-11"><span class="crayon-h"> </span><span class="crayon-v">out_layers</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">flat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-12"><span class="crayon-p"># merge heads</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-13"><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-v">out_layers</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-14"><span class="crayon-p"># interpretation</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-15"><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-16"><span class="crayon-v">dense2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-17"><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-18"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-v">in_layers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4165066290404-19"><span class="crayon-p"># compile model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4165066290404-20"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>When the model is used, it will require eight arrays as input: one for each of the submodels.</p>
<p>This is required when training the model, when evaluating the model, and when making predictions with a final model.</p>
<p>We can achieve this by creating a list of 3D arrays, where each 3D array contains [<em>samples, timesteps, 1</em>], with one feature.</p>
<p>We can prepare the training dataset in this format as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4167891579324" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
input_data = [train_x[:,:,i].reshape((train_x.shape[0],n_timesteps,1)) for i in range(n_features)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4167891579324-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4167891579324-1"><span class="crayon-v">input_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The updated <em>build_model()</em> function with these changes is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad4169447225973" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 25, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# create a channel for each variable
	in_layers, out_layers = list(), list()
	for i in range(n_features):
		inputs = Input(shape=(n_timesteps,1))
		conv1 = Conv1D(filters=32, kernel_size=3, activation='relu')(inputs)
		conv2 = Conv1D(filters=32, kernel_size=3, activation='relu')(conv1)
		pool1 = MaxPooling1D(pool_size=2)(conv2)
		flat = Flatten()(pool1)
		# store layers
		in_layers.append(inputs)
		out_layers.append(flat)
	# merge heads
	merged = concatenate(out_layers)
	# interpretation
	dense1 = Dense(200, activation='relu')(merged)
	dense2 = Dense(100, activation='relu')(dense1)
	outputs = Dense(n_outputs)(dense2)
	model = Model(inputs=in_layers, outputs=outputs)
	# compile model
	model.compile(loss='mse', optimizer='adam')
	# plot the model
	plot_model(model, show_shapes=True, to_file='multiheaded_cnn.png')
	# fit network
	input_data = [train_x[:,:,i].reshape((train_x.shape[0],n_timesteps,1)) for i in range(n_features)]
	model.fit(input_data, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-20">20</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-22">22</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-24">24</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-26">26</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-28">28</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-30">30</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad4169447225973-32">32</div><div class="crayon-num" data-line="crayon-5c0c9e4ad4169447225973-33">33</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-1"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-2"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-3"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-4"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-5"><span class="crayon-h"> </span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-6"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-7"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-8"><span class="crayon-h"> </span><span class="crayon-p"># create a channel for each variable</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-9"><span class="crayon-h"> </span><span class="crayon-v">in_layers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">out_layers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-10"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-11"><span class="crayon-h"> </span><span class="crayon-v">inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-12"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-13"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-14"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-15"><span class="crayon-h"> </span><span class="crayon-v">flat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-16"><span class="crayon-h"> </span><span class="crayon-p"># store layers</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-17"><span class="crayon-h"> </span><span class="crayon-v">in_layers</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-18"><span class="crayon-h"> </span><span class="crayon-v">out_layers</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">flat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-19"><span class="crayon-h"> </span><span class="crayon-p"># merge heads</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-20"><span class="crayon-h"> </span><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-v">out_layers</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-21"><span class="crayon-h"> </span><span class="crayon-p"># interpretation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-22"><span class="crayon-h"> </span><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-23"><span class="crayon-h"> </span><span class="crayon-v">dense2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-24"><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-25"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-v">in_layers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-26"><span class="crayon-h"> </span><span class="crayon-p"># compile model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-27"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-28"><span class="crayon-h"> </span><span class="crayon-p"># plot the model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-29"><span class="crayon-h"> </span><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'multiheaded_cnn.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-30"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-31"><span class="crayon-h"> </span><span class="crayon-v">input_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad4169447225973-32"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">input_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad4169447225973-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>When the model is built, a diagram of the structure of the model is created and saved to file.</p>
<p>Note: the call to plot_model() requires that pygraphviz and pydot are installed. If this is a problem, you can comment out this line.</p>
<p>The structure of the network looks as follows.</p>
<div class="wp-caption aligncenter" id="attachment_6282" style="width: 3250px"><img alt="Structure of the Multi Headed Convolutional Neural Network" class="size-full wp-image-6282" height="959" sizes="(max-width: 3240px) 100vw, 3240px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Structure-of-the-Multiheaded-Convolutional-Neural-Network.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Structure-of-the-Multiheaded-Convolutional-Neural-Network.png 3240w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Structure-of-the-Multiheaded-Convolutional-Neural-Network-300x89.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Structure-of-the-Multiheaded-Convolutional-Neural-Network-768x227.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Structure-of-the-Multiheaded-Convolutional-Neural-Network-1024x303.png 1024w" width="3240"/><p class="wp-caption-text">Structure of the Multi Headed Convolutional Neural Network</p></div>
<p>Next, we can update the preparation of input samples when making a prediction for the test dataset.</p>
<p>We must perform the same change, where an input array of [1, 14, 8] must be transformed into a list of eight 3D arrays each with [1, 14, 1].</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad416b255651202" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
input_x = [input_x[:,i].reshape((1,input_x.shape[0],1)) for i in range(input_x.shape[1])]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad416b255651202-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad416b255651202-1"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">input_x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The <em>forecast()</em> function with this change is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad41a4561676007" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, :]
	# reshape into n input arrays
	input_x = [input_x[:,i].reshape((1,input_x.shape[0],1)) for i in range(input_x.shape[1])]
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad41a4561676007-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a4561676007-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a4561676007-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a4561676007-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a4561676007-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a4561676007-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a4561676007-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a4561676007-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a4561676007-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a4561676007-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a4561676007-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a4561676007-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a4561676007-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a4561676007-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad41a4561676007-1"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a4561676007-2"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a4561676007-3"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a4561676007-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a4561676007-5"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a4561676007-6"><span class="crayon-h"> </span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a4561676007-7"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a4561676007-8"><span class="crayon-h"> </span><span class="crayon-p"># reshape into n input arrays</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a4561676007-9"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">input_x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a4561676007-10"><span class="crayon-h"> </span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a4561676007-11"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a4561676007-12"><span class="crayon-h"> </span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a4561676007-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a4561676007-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>That’s it.</p>
<p>We can tie all of this together; the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad41a8001270124" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# multi headed multi-step cnn
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D
from keras.models import Model
from keras.layers import Input
from keras.layers.merge import concatenate

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			X.append(data[in_start:in_end, :])
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# plot training history
def plot_history(history):
	# plot loss
	pyplot.subplot(2, 1, 1)
	pyplot.plot(history.history['loss'], label='train')
	pyplot.plot(history.history['val_loss'], label='test')
	pyplot.title('loss', y=0, loc='center')
	pyplot.legend()
	# plot rmse
	pyplot.subplot(2, 1, 2)
	pyplot.plot(history.history['rmse'], label='train')
	pyplot.plot(history.history['val_rmse'], label='test')
	pyplot.title('rmse', y=0, loc='center')
	pyplot.legend()
	pyplot.show()

# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 25, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# create a channel for each variable
	in_layers, out_layers = list(), list()
	for i in range(n_features):
		inputs = Input(shape=(n_timesteps,1))
		conv1 = Conv1D(filters=32, kernel_size=3, activation='relu')(inputs)
		conv2 = Conv1D(filters=32, kernel_size=3, activation='relu')(conv1)
		pool1 = MaxPooling1D(pool_size=2)(conv2)
		flat = Flatten()(pool1)
		# store layers
		in_layers.append(inputs)
		out_layers.append(flat)
	# merge heads
	merged = concatenate(out_layers)
	# interpretation
	dense1 = Dense(200, activation='relu')(merged)
	dense2 = Dense(100, activation='relu')(dense1)
	outputs = Dense(n_outputs)(dense2)
	model = Model(inputs=in_layers, outputs=outputs)
	# compile model
	model.compile(loss='mse', optimizer='adam')
	# fit network
	input_data = [train_x[:,:,i].reshape((train_x.shape[0],n_timesteps,1)) for i in range(n_features)]
	model.fit(input_data, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, :]
	# reshape into n input arrays
	input_x = [input_x[:,i].reshape((1,input_x.shape[0],1)) for i in range(input_x.shape[1])]
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# evaluate model and get scores
n_input = 14
score, scores = evaluate_model(train, test, n_input)
# summarize scores
summarize_scores('cnn', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='cnn')
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-2">2</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-4">4</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-6">6</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-8">8</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-10">10</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-12">12</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-14">14</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-16">16</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-18">18</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-20">20</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-22">22</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-24">24</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-26">26</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-28">28</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-30">30</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-32">32</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-34">34</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-36">36</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-38">38</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-40">40</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-42">42</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-44">44</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-46">46</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-48">48</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-50">50</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-52">52</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-54">54</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-56">56</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-58">58</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-60">60</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-62">62</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-64">64</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-66">66</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-68">68</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-70">70</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-72">72</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-74">74</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-76">76</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-78">78</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-80">80</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-82">82</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-84">84</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-86">86</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-88">88</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-90">90</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-92">92</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-94">94</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-96">96</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-98">98</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-100">100</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-102">102</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-104">104</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-106">106</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-108">108</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-110">110</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-112">112</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-114">114</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-116">116</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-118">118</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-120">120</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-122">122</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-124">124</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-126">126</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-128">128</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-130">130</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-132">132</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-134">134</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-136">136</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-138">138</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-140">140</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-142">142</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-144">144</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-146">146</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-148">148</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-150">150</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-152">152</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-154">154</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-156">156</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-158">158</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-160">160</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-162">162</div><div class="crayon-num" data-line="crayon-5c0c9e4ad41a8001270124-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9e4ad41a8001270124-164">164</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-1"><span class="crayon-p"># multi headed multi-step cnn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">MaxPooling1D</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-14"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-15"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">merge </span><span class="crayon-e">import </span><span class="crayon-v">concatenate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-16"> </div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-17"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-18"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-19"><span class="crayon-h"> </span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-20"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-21"><span class="crayon-h"> </span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-22"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-23"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-24"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-25"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-26"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-27"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-28"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-29"><span class="crayon-h"> </span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-30"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-31"><span class="crayon-h"> </span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-32"><span class="crayon-h"> </span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-33"><span class="crayon-h"> </span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-34"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-35"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-36"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-37"><span class="crayon-h"> </span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-38"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-40"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-41"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-42"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-44"> </div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-45"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-46"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-47"><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-48"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-50"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-51"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-52"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-53"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-54"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-55"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-56"><span class="crayon-h"> </span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-57"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-58"><span class="crayon-h"> </span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-59"><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-60"><span class="crayon-e"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-61"><span class="crayon-h"> </span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-62"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-63"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-64"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-65"><span class="crayon-h"> </span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-66"><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-67"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-68"> </div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-69"><span class="crayon-p"># plot training history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-70"><span class="crayon-e">def </span><span class="crayon-e">plot_history</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-71"><span class="crayon-h"> </span><span class="crayon-p"># plot loss</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-72"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-73"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'train'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-74"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'test'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-75"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-o">=</span><span class="crayon-s">'center'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-76"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-77"><span class="crayon-h"> </span><span class="crayon-p"># plot rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-78"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-79"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'rmse'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'train'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-80"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'val_rmse'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'test'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-81"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'rmse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-o">=</span><span class="crayon-s">'center'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-82"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-83"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-84"> </div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-85"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-86"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-87"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-88"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-89"><span class="crayon-h"> </span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-90"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-91"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-92"><span class="crayon-h"> </span><span class="crayon-p"># create a channel for each variable</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-93"><span class="crayon-h"> </span><span class="crayon-v">in_layers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">out_layers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-94"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-95"><span class="crayon-h"> </span><span class="crayon-v">inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-96"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-97"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-98"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-99"><span class="crayon-h"> </span><span class="crayon-v">flat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-100"><span class="crayon-h"> </span><span class="crayon-p"># store layers</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-101"><span class="crayon-h"> </span><span class="crayon-v">in_layers</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-102"><span class="crayon-h"> </span><span class="crayon-v">out_layers</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">flat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-103"><span class="crayon-h"> </span><span class="crayon-p"># merge heads</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-104"><span class="crayon-h"> </span><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-v">out_layers</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-105"><span class="crayon-h"> </span><span class="crayon-p"># interpretation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-106"><span class="crayon-h"> </span><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-107"><span class="crayon-h"> </span><span class="crayon-v">dense2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-108"><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-109"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-v">in_layers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-110"><span class="crayon-h"> </span><span class="crayon-p"># compile model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-111"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-112"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-113"><span class="crayon-h"> </span><span class="crayon-v">input_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-114"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">input_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-115"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-116"> </div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-117"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-118"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-119"><span class="crayon-h"> </span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-120"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-121"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-122"><span class="crayon-h"> </span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-123"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-124"><span class="crayon-h"> </span><span class="crayon-p"># reshape into n input arrays</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-125"><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">input_x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-126"><span class="crayon-h"> </span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-127"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-128"><span class="crayon-h"> </span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-129"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-130"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-131"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-132"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-133"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-134"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-135"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-136"><span class="crayon-h"> </span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-137"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-138"><span class="crayon-h"> </span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-139"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-140"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-141"><span class="crayon-h"> </span><span class="crayon-p"># predict the week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-142"><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-143"><span class="crayon-h"> </span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-144"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-145"><span class="crayon-h"> </span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-146"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-147"><span class="crayon-h"> </span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-148"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-149"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-150"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-151"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-152"><span class="crayon-p"># load the new file</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-153"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-154"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-155"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-156"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-157"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-158"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-159"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-160"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'cnn'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-161"><span class="crayon-p"># plot scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-162"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9e4ad41a8001270124-163"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'cnn'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9e4ad41a8001270124-164"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0098 seconds] -->
<p>Running the example fits and evaluates the model, printing the overall RMSE across all seven days, and the per-day RMSE for each lead time.</p>
<p>Your specific results may vary given the stochastic nature of the algorithm. You may want to try running the example a few times.</p>
<p>We can see that in this case, the overall RMSE is skillful compared to a naive forecast, but with the chosen configuration may not perform better than the multi-channel model in the previous section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9e4ad41ad015874173" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
cnn: [396.116] 414.5, 385.5, 377.2, 412.1, 371.1, 380.6, 428.1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9e4ad41ad015874173-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9e4ad41ad015874173-1">cnn: [396.116] 414.5, 385.5, 377.2, 412.1, 371.1, 380.6, 428.1</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can also see a different, more pronounced profile for the daily RMSE scores where perhaps Mon-Tue and Thu-Fri are easier for the model to predict than the other forecast days.</p>
<p>These results may be useful when combined with another forecast model.</p>
<p>It may be interesting to explore alternate methods in the architecture for merging the output of each sub-model.</p>
<div class="wp-caption aligncenter" id="attachment_6283" style="width: 1290px"><img alt="Line Plot of RMSE per Day for a Multi-head CNN with 14-day Inputs" class="size-full wp-image-6283" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multi-head-CNN-with-14-day-Inputs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multi-head-CNN-with-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multi-head-CNN-with-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multi-head-CNN-with-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-a-Multi-head-CNN-with-14-day-Inputs-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plot of RMSE per Day for a Multi-head CNN with 14-day Inputs</p></div>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Size of Input</strong>. Explore more or fewer numbers of days used as input for the model, such as three days, 21 days, 30 days and more.</li>
<li><strong>Model Tuning</strong>. Tune the structure and hyperparameters for a model and further lift model performance on average.</li>
<li><strong>Data Scaling</strong>. Explore whether data scaling, such as standardization and normalization, can be used to improve the performance of any of the CNN models.</li>
<li><strong>Learning Diagnostics</strong>. Use diagnostics such as learning curves for the train and validation loss and mean squared error to help tune the structure and hyperparameters of a CNN model.</li>
<li><strong>Vary Kernel Size</strong>. Combine the multichannel CNN with the multi-headed CNN and use a different kernel size for each head to see if this configuration can further improve performance.</li>
</ul>
<p>If you explore any of these extensions, I’d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>API</h3>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">pandas.read_csv API</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">pandas.DataFrame.resample API</a></li>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">Resample Offset Aliases</a></li>
<li><a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">sklearn.metrics.mean_squared_error API</a></li>
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.split.html">numpy.split API</a></li>
</ul>
<h3>Articles</h3>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/individual+household+electric+power+consumption">Individual household electric power consumption Data Set, UCI Machine Learning Repository</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/AC_power">AC power, Wikipedia</a>.</li>
<li><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/">4 Strategies for Multi-Step Time Series Forecasting</a></li>
<li><a href="https://machinelearningmastery.com/crash-course-convolutional-neural-networks/">Crash Course in Convolutional Neural Networks for Machine Learning</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop 1D convolutional neural networks for multi-step time series forecasting.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a CNN for multi-step time series forecasting model for univariate data.</li>
<li>How to develop a multichannel multi-step time series forecasting model for multivariate data.</li>
<li>How to develop a multi-headed multi-step time series forecasting model for multivariate data.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img align="left" alt="Deep Learning for Time Series Forecasting" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br/>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6278 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+Convolutional+Neural+Networks+for+Multi-Step+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/" rel="prev"><i class="fa fa-angle-left"></i> Multi-step Time Series Forecasting with Machine Learning for Household Electricity Consumption</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" rel="next">How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">25 Responses to <em>How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-450990">
<div class="comment-container" id="li-comment-450990">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c60154ace44cfe4ce118d5c92bc1cc5a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c60154ace44cfe4ce118d5c92bc1cc5a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Channing</span>
<span class="date">October 8, 2018 at 6:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-450990" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the tutorial. One naive question: for last complete code, how to make prediction fixed / reproducible ? I tried “from numpy.random import seed” “seed(1)”, but the scores are still varied when running twice.</p>
<div class="reply">
<a aria-label="Reply to Channing" class="comment-reply-link" href="#comment-450990" onclick='return addComment.moveForm( "comment-450990", "450990", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451050">
<div class="comment-container" id="li-comment-451050">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 9, 2018 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451050" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a common question that I answer here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/what-value-should-i-set-for-the-random-number-seed" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/what-value-should-i-set-for-the-random-number-seed</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451050" onclick='return addComment.moveForm( "comment-451050", "451050", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-451155">
<div class="comment-container" id="li-comment-451155">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b8f95417f5d5bba3306c284714711bc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b8f95417f5d5bba3306c284714711bc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jim Avazpour</span>
<span class="date">October 10, 2018 at 4:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451155" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great article – thank you for the code examples.  I really enjoy looking at your work since I’m trying to learn ML/DL.  Question – what if I wanted to forecast out all of the variables separately rather than one total daily power consumption?  </p>
<p>Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to Jim Avazpour" class="comment-reply-link" href="#comment-451155" onclick='return addComment.moveForm( "comment-451155", "451155", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451182">
<div class="comment-container" id="li-comment-451182">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 10, 2018 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451182" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This would be a multi-step multi-variate problem. I show how in my book.</p>
<p>I would recommend treating it like a seq2seq problem and forecast n variables for each step in the output sequence. An encoder-decoder model would be appropriate with a CNN or LSTM input model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451182" onclick='return addComment.moveForm( "comment-451182", "451182", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-451316">
<div class="comment-container" id="li-comment-451316">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b8f95417f5d5bba3306c284714711bc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b8f95417f5d5bba3306c284714711bc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jim Avazpour</span>
<span class="date">October 11, 2018 at 10:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451316" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the response Jason.  Which one of your books are you referring to?</p>
<div class="reply">
<a aria-label="Reply to Jim Avazpour" class="comment-reply-link" href="#comment-451316" onclick='return addComment.moveForm( "comment-451316", "451316", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451335">
<div class="comment-container" id="li-comment-451335">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 11, 2018 at 4:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451335" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This book:<br/>
<a href="https://machinelearningmastery.com/deep-learning-for-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/deep-learning-for-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451335" onclick='return addComment.moveForm( "comment-451335", "451335", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-451405">
<div class="comment-container" id="li-comment-451405">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/afc2983eeff3a5e5d5f61df10631ce20?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/afc2983eeff3a5e5d5f61df10631ce20?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Iain</span>
<span class="date">October 12, 2018 at 8:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451405" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi. When you increase the number of training example by overlapping your data, do you not run the risk of overfitting your model? You are essentially giving the model the same data multiple times.</p>
<div class="reply">
<a aria-label="Reply to Iain" class="comment-reply-link" href="#comment-451405" onclick='return addComment.moveForm( "comment-451405", "451405", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451419">
<div class="comment-container" id="li-comment-451419">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 12, 2018 at 11:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451419" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may, this is why we are so reliant on the model validation method.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451419" onclick='return addComment.moveForm( "comment-451419", "451419", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-451477">
<div class="comment-container" id="li-comment-451477">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/08eee6bc0c86791d1a89bf8a97f23b1c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/08eee6bc0c86791d1a89bf8a97f23b1c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">litost</span>
<span class="date">October 12, 2018 at 7:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451477" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Please teach us capsnet.</p>
<div class="reply">
<a aria-label="Reply to litost" class="comment-reply-link" href="#comment-451477" onclick='return addComment.moveForm( "comment-451477", "451477", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451517">
<div class="comment-container" id="li-comment-451517">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 13, 2018 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451517" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion. </p>
<p>Why do you want to use capsule networks? They seem fringe to me.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451517" onclick='return addComment.moveForm( "comment-451517", "451517", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-451528">
<div class="comment-container" id="li-comment-451528">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b8f95417f5d5bba3306c284714711bc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b8f95417f5d5bba3306c284714711bc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jim Avazpour</span>
<span class="date">October 13, 2018 at 7:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451528" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you – I have purchased your ebook.</p>
<div class="reply">
<a aria-label="Reply to Jim Avazpour" class="comment-reply-link" href="#comment-451528" onclick='return addComment.moveForm( "comment-451528", "451528", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451575">
<div class="comment-container" id="li-comment-451575">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 14, 2018 at 5:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451575" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your support Jim.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451575" onclick='return addComment.moveForm( "comment-451575", "451575", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-451693">
<div class="comment-container" id="li-comment-451693">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6c63aec1e690c372955fc5277281696f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6c63aec1e690c372955fc5277281696f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kim</span>
<span class="date">October 15, 2018 at 9:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451693" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For the multi channel model (using 8 inputs, with 2 convo layers pooling , 1 convo and pooling), you actually get an error when using n_input = 7. Do you have any idea?</p>
<p>The error is actually</p>
<p> Negative dimension size caused by subtracting 3 from 1 for ‘conv1d_55/convolution/Conv2D’ (op: ‘Conv2D’) with input shapes: [?,1,1,32], [1,3,32,16].</p>
<div class="reply">
<a aria-label="Reply to kim" class="comment-reply-link" href="#comment-451693" onclick='return addComment.moveForm( "comment-451693", "451693", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451735">
<div class="comment-container" id="li-comment-451735">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2018 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451735" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps the configuration of the model requires change in concert with changes to the input?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451735" onclick='return addComment.moveForm( "comment-451735", "451735", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-451764">
<div class="comment-container" id="li-comment-451764">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6c63aec1e690c372955fc5277281696f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6c63aec1e690c372955fc5277281696f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kim</span>
<span class="date">October 16, 2018 at 2:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451764" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason, i believe that the feature map is too small for the layers, which resulted in the error. </p>
<p>Also, one point to note is that my multi channel model is not doing as well as your example. (stochastic). However, it is actually doing worst than the single variable model with n_input = 21!</p>
<div class="reply">
<a aria-label="Reply to kim" class="comment-reply-link" href="#comment-451764" onclick='return addComment.moveForm( "comment-451764", "451764", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451770">
<div class="comment-container" id="li-comment-451770">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2018 at 2:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451770" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451770" onclick='return addComment.moveForm( "comment-451770", "451770", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-451926">
<div class="comment-container" id="li-comment-451926">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ae670c5bfcdbbb46ed5f99698b847b4f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ae670c5bfcdbbb46ed5f99698b847b4f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andrea</span>
<span class="date">October 18, 2018 at 2:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451926" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
First of all congratulations and many thanks for the tutorials! I have some question:<br/>
In the first example with the univariate CNN in evaluate_model function you wrote          “history = [x for x in train]”. Why? Shouldn’t be something like “history = [x for x in test]” since we want to evaluate the model? </p>
<p>If I use the to_supervised function also for the test set and then make prediction as follows:</p>
<p>test_x, test_y = array(X), array(y)<br/>
# forecast the next week<br/>
yhat = model.predict(test_x, verbose=0)<br/>
…………<br/>
………..<br/>
score, scores = evaluate_forecasts(test_y, yhat)</p>
<p>Would it be correct?</p>
<p>Thanks<br/>
Andrea</p>
<div class="reply">
<a aria-label="Reply to Andrea" class="comment-reply-link" href="#comment-451926" onclick='return addComment.moveForm( "comment-451926", "451926", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451951">
<div class="comment-container" id="li-comment-451951">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 18, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-451951" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but we need input for the first prediction of the test set, which will/may come from the end of the training set.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451951" onclick='return addComment.moveForm( "comment-451951", "451951", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-452052">
<div class="comment-container" id="li-comment-452052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ae670c5bfcdbbb46ed5f99698b847b4f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ae670c5bfcdbbb46ed5f99698b847b4f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andrea</span>
<span class="date">October 19, 2018 at 5:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-452052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the reply!</p>
<div class="reply">
<a aria-label="Reply to Andrea" class="comment-reply-link" href="#comment-452052" onclick='return addComment.moveForm( "comment-452052", "452052", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-452987">
<div class="comment-container" id="li-comment-452987">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d0691e150cae4d1eab9db63eecde3391?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d0691e150cae4d1eab9db63eecde3391?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hannah</span>
<span class="date">October 29, 2018 at 3:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-452987" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi jason! how to download “household_power_consumption.zip” ?<br/>
because when i click that, the website cannot be open.</p>
<div class="reply">
<a aria-label="Reply to hannah" class="comment-reply-link" href="#comment-452987" onclick='return addComment.moveForm( "comment-452987", "452987", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-453009">
<div class="comment-container" id="li-comment-453009">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 29, 2018 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-453009" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The link works for me.</p>
<p>Here is a second download location:<br/>
<a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/household_power_consumption.zip" rel="nofollow">https://raw.githubusercontent.com/jbrownlee/Datasets/master/household_power_consumption.zip</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453009" onclick='return addComment.moveForm( "comment-453009", "453009", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-453056">
<div class="comment-container" id="li-comment-453056">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d23cf3d19182299f95ffbd1abac33ed3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d23cf3d19182299f95ffbd1abac33ed3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vu Le</span>
<span class="date">October 29, 2018 at 9:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-453056" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>As my understanding, song classification is a case of  Time Series data right? Can you write a topic about that?</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Vu Le" class="comment-reply-link" href="#comment-453056" onclick='return addComment.moveForm( "comment-453056", "453056", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-453095">
<div class="comment-container" id="li-comment-453095">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2018 at 6:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-453095" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453095" onclick='return addComment.moveForm( "comment-453095", "453095", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-453222">
<div class="comment-container" id="li-comment-453222">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/26ee862e8a82ef140a415111ea847274?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/26ee862e8a82ef140a415111ea847274?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mad</span>
<span class="date">October 31, 2018 at 8:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-453222" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, as always great tutorial ! I had a question concerning the multi-head CNN, would it be a good idea to use different CNN architecture instead of using the same one ? </p>
<p>Thank you<br/>
Madriss</p>
<div class="reply">
<a aria-label="Reply to Mad" class="comment-reply-link" href="#comment-453222" onclick='return addComment.moveForm( "comment-453222", "453222", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-453238">
<div class="comment-container" id="li-comment-453238">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2018 at 2:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#comment-453238" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It really depends on the problem. Perhaps try it and compare results.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453238" onclick='return addComment.moveForm( "comment-453238", "453238", "respond", "6278" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="6278"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="66c96a71df"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="92"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-51"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for Time Series</strong><br/>
Forecast the future with MLPs, CNNs, and LSTMs.
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>