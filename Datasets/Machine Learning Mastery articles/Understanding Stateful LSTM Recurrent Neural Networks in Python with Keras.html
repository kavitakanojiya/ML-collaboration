<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras</title>
<link href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras" property="og:title"/>
<meta content="A powerful and popular recurrent neural network is the long short-term model network or LSTM. It is widely used because the architecture overcomes the vanishing and exposing gradient problem that plagues all recurrent neural networks, allowing very large and very deep networks to be created. Like other recurrent neural networks, LSTM networks maintain state, and …" property="og:description"/>
<meta content="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning" property="article:section"/>
<meta content="2016-07-27T19:00:09+00:00" property="article:published_time"/>
<meta content="2018-08-09T21:49:25+00:00" property="article:modified_time"/>
<meta content="2018-08-09T21:49:25+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Understanding-Stateful-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Understanding-Stateful-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="425" property="og:image:height"/>
<meta content="Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/feed/" rel="alternate" title="Machine Learning Mastery » Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=2941" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Funderstanding-stateful-lstm-recurrent-neural-networks-python-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Funderstanding-stateful-lstm-recurrent-neural-networks-python-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-2941 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-32"> <div class="textwidget"><p>Want help with deep learning? <a href="https://machinelearningmastery.lpages.co/deep-learning-with-python-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-2941 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning">
<header>
<h1 class="title entry-title">Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2016-07-28T05:00:09+1100">July 28, 2016</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning/" title="View all items in Deep Learning">Deep Learning</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-2941 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=Understanding+Stateful+LSTM+Recurrent+Neural+Networks+in+Python+with+Keras&amp;url=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>A powerful and popular recurrent neural network is the long short-term model network or LSTM.</p>
<p>It is widely used because the architecture overcomes the vanishing and exposing gradient problem that plagues all recurrent neural networks, allowing very large and very deep networks to be created.</p>
<p>Like other recurrent neural networks, LSTM networks maintain state, and the specifics of how this is implemented in Keras framework can be confusing.</p>
<p>In this post you will discover exactly how state is maintained in LSTM networks by the Keras deep learning library.</p>
<p>After reading this post you will know:</p>
<ul>
<li>How to develop a naive LSTM network for a sequence prediction problem.</li>
<li>How to carefully manage state through batches and features with an LSTM network.</li>
<li>Hot to manually manage state in an LSTM network for stateful prediction.</li>
</ul>
<p>Let’s get started.</p>
<ul>
<li><strong>Update Mar/2017</strong>: Updated example for Keras 2.0.2, TensorFlow 1.0.1 and Theano 0.9.0.</li>
<li><strong>Update Aug/2018</strong>: Updated exampels for Python 3, updated stateful example to get 100% accuracy.</li>
</ul>
<div class="wp-caption aligncenter" id="attachment_2942" style="width: 650px"><img alt="Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras" class="size-full wp-image-2942" height="425" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Understanding-Stateful-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Understanding-Stateful-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Understanding-Stateful-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-300x199.jpg 300w" width="640"/><p class="wp-caption-text">Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras<br/>Photo by <a href="https://www.flickr.com/photos/twicepix/7923674788/">Martin Abegglen</a>, some rights reserved.</p></div>
<h2>Problem Description: Learn the Alphabet</h2>
<p>In this tutorial we are going to develop and contrast a number of different LSTM recurrent neural network models.</p>
<p>The context of these comparisons will be a simple sequence prediction problem of learning the alphabet. That is, given a letter of the alphabet, predict the next letter of the alphabet.</p>
<p>This is a simple sequence prediction problem that once understood can be generalized to other sequence prediction problems like time series prediction and sequence classification.</p>
<p>Let’s prepare the problem with some python code that we can reuse from example to example.</p>
<p>Firstly, let’s import all of the classes and functions we plan to use in this tutorial.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d68c638660822" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.utils import np_utils</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d68c638660822-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d68c638660822-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d68c638660822-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d68c638660822-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d68c638660822-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d68c638660822-1"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d68c638660822-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d68c638660822-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d68c638660822-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d68c638660822-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we can seed the random number generator to ensure that the results are the same each time the code is executed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d694042744627" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fix random seed for reproducibility
numpy.random.seed(7)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d694042744627-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d694042744627-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d694042744627-1"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d694042744627-2"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can now define our dataset, the alphabet. We define the alphabet in uppercase characters for readability.</p>
<p>Neural networks model numbers, so we need to map the letters of the alphabet to integer values. We can do this easily by creating a dictionary (map) of the letter index to the character. We can also create a reverse lookup for converting predictions back into characters to be used later.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d696611129770" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define the raw dataset
alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
# create mapping of characters to integers (0-25) and the reverse
char_to_int = dict((c, i) for i, c in enumerate(alphabet))
int_to_char = dict((i, c) for i, c in enumerate(alphabet))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d696611129770-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d696611129770-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d696611129770-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d696611129770-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d696611129770-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d696611129770-1"><span class="crayon-p"># define the raw dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d696611129770-2"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d696611129770-3"><span class="crayon-p"># create mapping of characters to integers (0-25) and the reverse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d696611129770-4"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d696611129770-5"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Now we need to create our input and output pairs on which to train our neural network. We can do this by defining an input sequence length, then reading sequences from the input alphabet sequence.</p>
<p>For example we use an input length of 1. Starting at the beginning of the raw input data, we can read off the first letter “A” and the next letter as the prediction “B”. We move along one character and repeat until we reach a prediction of “Z”.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d698907841488" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare the dataset of input to output pairs encoded as integers
seq_length = 1
dataX = []
dataY = []
for i in range(0, len(alphabet) - seq_length, 1):
	seq_in = alphabet[i:i + seq_length]
	seq_out = alphabet[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
	print(seq_in, '-&gt;', seq_out)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d698907841488-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d698907841488-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d698907841488-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d698907841488-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d698907841488-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d698907841488-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d698907841488-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d698907841488-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d698907841488-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d698907841488-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d698907841488-1"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d698907841488-2"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d698907841488-3"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d698907841488-4"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d698907841488-5"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d698907841488-6"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d698907841488-7"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d698907841488-8"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d698907841488-9"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d698907841488-10"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We also print out the input pairs for sanity checking.</p>
<p>Running the code to this point will produce the following output, summarizing input sequences of length 1 and a single output character.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d69a711634376" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
A -&gt; B
B -&gt; C
C -&gt; D
D -&gt; E
E -&gt; F
F -&gt; G
G -&gt; H
H -&gt; I
I -&gt; J
J -&gt; K
K -&gt; L
L -&gt; M
M -&gt; N
N -&gt; O
O -&gt; P
P -&gt; Q
Q -&gt; R
R -&gt; S
S -&gt; T
T -&gt; U
U -&gt; V
V -&gt; W
W -&gt; X
X -&gt; Y
Y -&gt; Z</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69a711634376-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d69a711634376-25">25</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-1">A -&gt; B</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-2">B -&gt; C</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-3">C -&gt; D</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-4">D -&gt; E</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-5">E -&gt; F</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-6">F -&gt; G</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-7">G -&gt; H</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-8">H -&gt; I</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-9">I -&gt; J</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-10">J -&gt; K</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-11">K -&gt; L</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-12">L -&gt; M</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-13">M -&gt; N</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-14">N -&gt; O</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-15">O -&gt; P</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-16">P -&gt; Q</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-17">Q -&gt; R</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-18">R -&gt; S</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-19">S -&gt; T</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-20">T -&gt; U</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-21">U -&gt; V</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-22">V -&gt; W</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-23">W -&gt; X</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69a711634376-24">X -&gt; Y</div><div class="crayon-line" id="crayon-5c0c9f2c8d69a711634376-25">Y -&gt; Z</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We need to reshape the NumPy array into a format expected by the LSTM networks, that is [<em>samples, time steps, features</em>].</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d69b479978302" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (len(dataX), seq_length, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d69b479978302-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69b479978302-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d69b479978302-1"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69b479978302-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Once reshaped, we can then normalize the input integers to the range 0-to-1, the range of the sigmoid activation functions used by the LSTM network.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d69d926526593" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# normalize
X = X / float(len(alphabet))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d69d926526593-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69d926526593-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d69d926526593-1"><span class="crayon-p"># normalize</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69d926526593-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Finally, we can think of this problem as a sequence classification task, where each of the 26 letters represents a different class. As such, we can convert the output (y) to a one hot encoding, using the Keras built-in function <strong>to_categorical()</strong>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d69f977242499" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# one hot encode the output variable
y = np_utils.to_categorical(dataY)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d69f977242499-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d69f977242499-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d69f977242499-1"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d69f977242499-2"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We are now ready to fit different LSTM models.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning in Python?</h3>
<p>Take my free 2-week email course and discover MLPs, CNNs and LSTMs (with code).</p>
<p>Click to sign-up now and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.leadpages.co/leadbox/142d6e873f72a2%3A164f8be4f346dc/5657382461898752/" rel="noopener" style="color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.247059) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.498039) 0px 1px 3px inset, rgba(0, 0, 0, 0.498039) 0px 1px 3px; background: #ffce0a;" target="_blank">Start Your FREE Mini-Course Now!</a> <script data-config="%7B%7D" data-leadbox="142d6e873f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.leadpages.co/leadbox/142d6e873f72a2%3A164f8be4f346dc/5657382461898752/" src="https://machinelearningmastery.leadpages.co/leadbox-1463166699.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Naive LSTM for Learning One-Char to One-Char Mapping</h2>
<p>Let’s start off by designing a simple LSTM to learn how to predict the next character in the alphabet given the context of just one character.</p>
<p>We will frame the problem as a random collection of one-letter input to one-letter output pairs. As we will see this is a difficult framing of the problem for the LSTM to learn.</p>
<p>Let’s define an LSTM network with 32 units and an output layer with a softmax activation function for making predictions. Because this is a multi-class classification problem, we can use the log loss function (called “<strong>categorical_crossentropy</strong>” in Keras), and optimize the network using the ADAM optimization function.</p>
<p>The model is fit over 500 epochs with a batch size of 1.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6a0535395111" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create and fit the model
model = Sequential()
model.add(LSTM(32, input_shape=(X.shape[1], X.shape[2])))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
model.fit(X, y, epochs=500, batch_size=1, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a0535395111-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a0535395111-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a0535395111-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a0535395111-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a0535395111-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a0535395111-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6a0535395111-1"><span class="crayon-p"># create and fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a0535395111-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a0535395111-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a0535395111-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a0535395111-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a0535395111-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>After we fit the model we can evaluate and summarize the performance on the entire training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6a2091942356" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize performance of the model
scores = model.evaluate(X, y, verbose=0)
print("Model Accuracy: %.2f%%" % (scores[1]*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a2091942356-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a2091942356-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a2091942356-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6a2091942356-1"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a2091942356-2"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a2091942356-3"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can then re-run the training data through the network and generate predictions, converting both the input and output pairs back into their original character format to get a visual idea of how well the network learned the problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6a4788622694" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# demonstrate some model predictions
for pattern in dataX:
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	print(seq_in, "-&gt;", result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a4788622694-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a4788622694-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a4788622694-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a4788622694-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a4788622694-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a4788622694-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a4788622694-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a4788622694-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a4788622694-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6a4788622694-1"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a4788622694-2"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a4788622694-3"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a4788622694-4"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a4788622694-5"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a4788622694-6"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a4788622694-7"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a4788622694-8"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a4788622694-9"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>The entire code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6a5172652654" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Naive LSTM to learn one-char to one-char mapping
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.utils import np_utils
# fix random seed for reproducibility
numpy.random.seed(7)
# define the raw dataset
alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
# create mapping of characters to integers (0-25) and the reverse
char_to_int = dict((c, i) for i, c in enumerate(alphabet))
int_to_char = dict((i, c) for i, c in enumerate(alphabet))
# prepare the dataset of input to output pairs encoded as integers
seq_length = 1
dataX = []
dataY = []
for i in range(0, len(alphabet) - seq_length, 1):
	seq_in = alphabet[i:i + seq_length]
	seq_out = alphabet[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
	print(seq_in, '-&gt;', seq_out)
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (len(dataX), seq_length, 1))
# normalize
X = X / float(len(alphabet))
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# create and fit the model
model = Sequential()
model.add(LSTM(32, input_shape=(X.shape[1], X.shape[2])))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
model.fit(X, y, epochs=500, batch_size=1, verbose=2)
# summarize performance of the model
scores = model.evaluate(X, y, verbose=0)
print("Model Accuracy: %.2f%%" % (scores[1]*100))
# demonstrate some model predictions
for pattern in dataX:
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	print(seq_in, "-&gt;", result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-32">32</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-34">34</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-36">36</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-38">38</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-40">40</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-42">42</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-44">44</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a5172652654-46">46</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a5172652654-47">47</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-1"><span class="crayon-p"># Naive LSTM to learn one-char to one-char mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-7"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-8"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-9"><span class="crayon-p"># define the raw dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-10"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-11"><span class="crayon-p"># create mapping of characters to integers (0-25) and the reverse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-12"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-13"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-14"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-15"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-16"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-17"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-18"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-19"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-20"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-21"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-22"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-23"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-24"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-25"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-26"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-27"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-28"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-29"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-30"><span class="crayon-p"># create and fit the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-31"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-32"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-33"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-34"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-35"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-36"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-37"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-38"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-39"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-40"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-41"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-42"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-43"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-44"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-45"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a5172652654-46"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6a5172652654-47"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0032 seconds] -->
<p>Running this example produces the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6a7260215592" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Model Accuracy: 84.00%
['A'] -&gt; B
['B'] -&gt; C
['C'] -&gt; D
['D'] -&gt; E
['E'] -&gt; F
['F'] -&gt; G
['G'] -&gt; H
['H'] -&gt; I
['I'] -&gt; J
['J'] -&gt; K
['K'] -&gt; L
['L'] -&gt; M
['M'] -&gt; N
['N'] -&gt; O
['O'] -&gt; P
['P'] -&gt; Q
['Q'] -&gt; R
['R'] -&gt; S
['S'] -&gt; T
['T'] -&gt; U
['U'] -&gt; W
['V'] -&gt; Y
['W'] -&gt; Z
['X'] -&gt; Z
['Y'] -&gt; Z</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a7260215592-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a7260215592-26">26</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-1">Model Accuracy: 84.00%</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-2">['A'] -&gt; B</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-3">['B'] -&gt; C</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-4">['C'] -&gt; D</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-5">['D'] -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-6">['E'] -&gt; F</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-7">['F'] -&gt; G</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-8">['G'] -&gt; H</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-9">['H'] -&gt; I</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-10">['I'] -&gt; J</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-11">['J'] -&gt; K</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-12">['K'] -&gt; L</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-13">['L'] -&gt; M</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-14">['M'] -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-15">['N'] -&gt; O</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-16">['O'] -&gt; P</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-17">['P'] -&gt; Q</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-18">['Q'] -&gt; R</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-19">['R'] -&gt; S</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-20">['S'] -&gt; T</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-21">['T'] -&gt; U</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-22">['U'] -&gt; W</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-23">['V'] -&gt; Y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-24">['W'] -&gt; Z</div><div class="crayon-line" id="crayon-5c0c9f2c8d6a7260215592-25">['X'] -&gt; Z</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a7260215592-26">['Y'] -&gt; Z</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see that this problem is indeed difficult for the network to learn.</p>
<p>The reason is, the poor LSTM units do not have any context to work with. Each input-output pattern is shown to the network in a random order and the state of the network is reset after each pattern (each batch where each batch contains one pattern).</p>
<p>This is abuse of the LSTM network architecture, treating it like a standard multilayer Perceptron.</p>
<p>Next, let’s try a different framing of the problem in order to provide more sequence to the network from which to learn.</p>
<h2>Naive LSTM for a Three-Char Feature Window to One-Char Mapping</h2>
<p>A popular approach to adding more context to data for multilayer Perceptrons is to use the window method.</p>
<p>This is where previous steps in the sequence are provided as additional input features to the network. We can try the same trick to provide more context to the LSTM network.</p>
<p>Here, we increase the sequence length from 1 to 3, for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6a9923220552" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare the dataset of input to output pairs encoded as integers
seq_length = 3</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6a9923220552-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6a9923220552-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6a9923220552-1"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6a9923220552-2"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Which creates training patterns like:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6ab322381336" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
ABC -&gt; D
BCD -&gt; E
CDE -&gt; F</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6ab322381336-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6ab322381336-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6ab322381336-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6ab322381336-1">ABC -&gt; D</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6ab322381336-2">BCD -&gt; E</div><div class="crayon-line" id="crayon-5c0c9f2c8d6ab322381336-3">CDE -&gt; F</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Each element in the sequence is then provided as a new input feature to the network. This requires a modification of how the input sequences reshaped in the data preparation step:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6b3559823988" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (len(dataX), 1, seq_length))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b3559823988-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b3559823988-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6b3559823988-1"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b3559823988-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>It also requires a modification for how the sample patterns are reshaped when demonstrating predictions from the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6b4269685494" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
x = numpy.reshape(pattern, (1, 1, len(pattern)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b4269685494-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6b4269685494-1"><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The entire code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6b6422056584" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Naive LSTM to learn three-char window to one-char mapping
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.utils import np_utils
# fix random seed for reproducibility
numpy.random.seed(7)
# define the raw dataset
alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
# create mapping of characters to integers (0-25) and the reverse
char_to_int = dict((c, i) for i, c in enumerate(alphabet))
int_to_char = dict((i, c) for i, c in enumerate(alphabet))
# prepare the dataset of input to output pairs encoded as integers
seq_length = 3
dataX = []
dataY = []
for i in range(0, len(alphabet) - seq_length, 1):
	seq_in = alphabet[i:i + seq_length]
	seq_out = alphabet[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
	print(seq_in, '-&gt;', seq_out)
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (len(dataX), 1, seq_length))
# normalize
X = X / float(len(alphabet))
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# create and fit the model
model = Sequential()
model.add(LSTM(32, input_shape=(X.shape[1], X.shape[2])))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
model.fit(X, y, epochs=500, batch_size=1, verbose=2)
# summarize performance of the model
scores = model.evaluate(X, y, verbose=0)
print("Model Accuracy: %.2f%%" % (scores[1]*100))
# demonstrate some model predictions
for pattern in dataX:
	x = numpy.reshape(pattern, (1, 1, len(pattern)))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	print(seq_in, "-&gt;", result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-32">32</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-34">34</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-36">36</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-38">38</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-40">40</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-42">42</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-44">44</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b6422056584-46">46</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b6422056584-47">47</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-1"><span class="crayon-p"># Naive LSTM to learn three-char window to one-char mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-7"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-8"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-9"><span class="crayon-p"># define the raw dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-10"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-11"><span class="crayon-p"># create mapping of characters to integers (0-25) and the reverse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-12"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-13"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-14"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-15"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-16"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-17"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-18"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-19"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-20"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-21"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-22"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-23"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-24"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-25"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-26"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-27"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-28"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-29"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-30"><span class="crayon-p"># create and fit the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-31"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-32"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-33"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-34"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-35"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-36"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-37"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-38"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-39"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-40"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-41"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-42"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-43"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-44"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-45"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b6422056584-46"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6b6422056584-47"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0033 seconds] -->
<p>Running this example provides the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6b8580553675" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Model Accuracy: 86.96%
['A', 'B', 'C'] -&gt; D
['B', 'C', 'D'] -&gt; E
['C', 'D', 'E'] -&gt; F
['D', 'E', 'F'] -&gt; G
['E', 'F', 'G'] -&gt; H
['F', 'G', 'H'] -&gt; I
['G', 'H', 'I'] -&gt; J
['H', 'I', 'J'] -&gt; K
['I', 'J', 'K'] -&gt; L
['J', 'K', 'L'] -&gt; M
['K', 'L', 'M'] -&gt; N
['L', 'M', 'N'] -&gt; O
['M', 'N', 'O'] -&gt; P
['N', 'O', 'P'] -&gt; Q
['O', 'P', 'Q'] -&gt; R
['P', 'Q', 'R'] -&gt; S
['Q', 'R', 'S'] -&gt; T
['R', 'S', 'T'] -&gt; U
['S', 'T', 'U'] -&gt; V
['T', 'U', 'V'] -&gt; Y
['U', 'V', 'W'] -&gt; Z
['V', 'W', 'X'] -&gt; Z
['W', 'X', 'Y'] -&gt; Z</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6b8580553675-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6b8580553675-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-1">Model Accuracy: 86.96%</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-2">['A', 'B', 'C'] -&gt; D</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-3">['B', 'C', 'D'] -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-4">['C', 'D', 'E'] -&gt; F</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-5">['D', 'E', 'F'] -&gt; G</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-6">['E', 'F', 'G'] -&gt; H</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-7">['F', 'G', 'H'] -&gt; I</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-8">['G', 'H', 'I'] -&gt; J</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-9">['H', 'I', 'J'] -&gt; K</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-10">['I', 'J', 'K'] -&gt; L</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-11">['J', 'K', 'L'] -&gt; M</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-12">['K', 'L', 'M'] -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-13">['L', 'M', 'N'] -&gt; O</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-14">['M', 'N', 'O'] -&gt; P</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-15">['N', 'O', 'P'] -&gt; Q</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-16">['O', 'P', 'Q'] -&gt; R</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-17">['P', 'Q', 'R'] -&gt; S</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-18">['Q', 'R', 'S'] -&gt; T</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-19">['R', 'S', 'T'] -&gt; U</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-20">['S', 'T', 'U'] -&gt; V</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-21">['T', 'U', 'V'] -&gt; Y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-22">['U', 'V', 'W'] -&gt; Z</div><div class="crayon-line" id="crayon-5c0c9f2c8d6b8580553675-23">['V', 'W', 'X'] -&gt; Z</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6b8580553675-24">['W', 'X', 'Y'] -&gt; Z</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see a small lift in performance that may or may not be real. This is a simple problem that we were still not able to learn with LSTMs even with the window method.</p>
<p>Again, this is a misuse of the LSTM network by a poor framing of the problem. Indeed, the sequences of letters are time steps of one feature rather than one time step of separate features. We have given more context to the network, but not more sequence as it expected.</p>
<p>In the next section, we will give more context to the network in the form of time steps.</p>
<h2>Naive LSTM for a Three-Char Time Step Window to One-Char Mapping</h2>
<p>In Keras, the intended use of LSTMs is to provide context in the form of time steps, rather than windowed features like with other network types.</p>
<p>We can take our first example and simply change the sequence length from 1 to 3.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6ba266563223" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
seq_length = 3</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6ba266563223-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6ba266563223-1"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Again, this creates input-output pairs that look like:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6be194270631" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
ABC -&gt; D
BCD -&gt; E
CDE -&gt; F
DEF -&gt; G</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6be194270631-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6be194270631-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6be194270631-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6be194270631-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6be194270631-1">ABC -&gt; D</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6be194270631-2">BCD -&gt; E</div><div class="crayon-line" id="crayon-5c0c9f2c8d6be194270631-3">CDE -&gt; F</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6be194270631-4">DEF -&gt; G</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The difference is that the reshaping of the input data takes the sequence as a time step sequence of one feature, rather than a single time step of multiple features.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6c0612788707" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (len(dataX), seq_length, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c0612788707-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c0612788707-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6c0612788707-1"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c0612788707-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>This is the correct intended use of providing sequence context to your LSTM in Keras. The full code example is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6c2883387934" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Naive LSTM to learn three-char time steps to one-char mapping
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.utils import np_utils
# fix random seed for reproducibility
numpy.random.seed(7)
# define the raw dataset
alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
# create mapping of characters to integers (0-25) and the reverse
char_to_int = dict((c, i) for i, c in enumerate(alphabet))
int_to_char = dict((i, c) for i, c in enumerate(alphabet))
# prepare the dataset of input to output pairs encoded as integers
seq_length = 3
dataX = []
dataY = []
for i in range(0, len(alphabet) - seq_length, 1):
	seq_in = alphabet[i:i + seq_length]
	seq_out = alphabet[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
	print(seq_in, '-&gt;', seq_out)
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (len(dataX), seq_length, 1))
# normalize
X = X / float(len(alphabet))
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# create and fit the model
model = Sequential()
model.add(LSTM(32, input_shape=(X.shape[1], X.shape[2])))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
model.fit(X, y, epochs=500, batch_size=1, verbose=2)
# summarize performance of the model
scores = model.evaluate(X, y, verbose=0)
print("Model Accuracy: %.2f%%" % (scores[1]*100))
# demonstrate some model predictions
for pattern in dataX:
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	print(seq_in, "-&gt;", result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-32">32</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-34">34</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-36">36</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-38">38</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-40">40</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-42">42</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-44">44</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c2883387934-46">46</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c2883387934-47">47</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-1"><span class="crayon-p"># Naive LSTM to learn three-char time steps to one-char mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-7"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-8"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-9"><span class="crayon-p"># define the raw dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-10"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-11"><span class="crayon-p"># create mapping of characters to integers (0-25) and the reverse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-12"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-13"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-14"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-15"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-16"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-17"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-18"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-19"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-20"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-21"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-22"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-23"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-24"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-25"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-26"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-27"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-28"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-29"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-30"><span class="crayon-p"># create and fit the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-31"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-32"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-33"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-34"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-35"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-36"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-37"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-38"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-39"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-40"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-41"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-42"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-43"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-44"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-45"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c2883387934-46"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c2883387934-47"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0032 seconds] -->
<p>Running this example provides the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6c4450752771" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Model Accuracy: 100.00%
['A', 'B', 'C'] -&gt; D
['B', 'C', 'D'] -&gt; E
['C', 'D', 'E'] -&gt; F
['D', 'E', 'F'] -&gt; G
['E', 'F', 'G'] -&gt; H
['F', 'G', 'H'] -&gt; I
['G', 'H', 'I'] -&gt; J
['H', 'I', 'J'] -&gt; K
['I', 'J', 'K'] -&gt; L
['J', 'K', 'L'] -&gt; M
['K', 'L', 'M'] -&gt; N
['L', 'M', 'N'] -&gt; O
['M', 'N', 'O'] -&gt; P
['N', 'O', 'P'] -&gt; Q
['O', 'P', 'Q'] -&gt; R
['P', 'Q', 'R'] -&gt; S
['Q', 'R', 'S'] -&gt; T
['R', 'S', 'T'] -&gt; U
['S', 'T', 'U'] -&gt; V
['T', 'U', 'V'] -&gt; W
['U', 'V', 'W'] -&gt; X
['V', 'W', 'X'] -&gt; Y
['W', 'X', 'Y'] -&gt; Z</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c4450752771-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c4450752771-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-1">Model Accuracy: 100.00%</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-2">['A', 'B', 'C'] -&gt; D</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-3">['B', 'C', 'D'] -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-4">['C', 'D', 'E'] -&gt; F</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-5">['D', 'E', 'F'] -&gt; G</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-6">['E', 'F', 'G'] -&gt; H</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-7">['F', 'G', 'H'] -&gt; I</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-8">['G', 'H', 'I'] -&gt; J</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-9">['H', 'I', 'J'] -&gt; K</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-10">['I', 'J', 'K'] -&gt; L</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-11">['J', 'K', 'L'] -&gt; M</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-12">['K', 'L', 'M'] -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-13">['L', 'M', 'N'] -&gt; O</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-14">['M', 'N', 'O'] -&gt; P</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-15">['N', 'O', 'P'] -&gt; Q</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-16">['O', 'P', 'Q'] -&gt; R</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-17">['P', 'Q', 'R'] -&gt; S</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-18">['Q', 'R', 'S'] -&gt; T</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-19">['R', 'S', 'T'] -&gt; U</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-20">['S', 'T', 'U'] -&gt; V</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-21">['T', 'U', 'V'] -&gt; W</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-22">['U', 'V', 'W'] -&gt; X</div><div class="crayon-line" id="crayon-5c0c9f2c8d6c4450752771-23">['V', 'W', 'X'] -&gt; Y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c4450752771-24">['W', 'X', 'Y'] -&gt; Z</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that the model learns the problem perfectly as evidenced by the model evaluation and the example predictions.</p>
<p>But it has learned a simpler problem. Specifically, it has learned to predict the next letter from a sequence of three letters in the alphabet. It can be shown any random sequence of three letters from the alphabet and predict the next letter.</p>
<p>It can not actually enumerate the alphabet. I expect that a larger enough multilayer perception network might be able to learn the same mapping using the window method.</p>
<p>The LSTM networks are stateful. They should be able to learn the whole alphabet sequence, but by default the Keras implementation resets the network state after each training batch.</p>
<h2>LSTM State Within A Batch</h2>
<p>The Keras implementation of LSTMs resets the state of the network after each batch.</p>
<p>This suggests that if we had a batch size large enough to hold all input patterns and if all the input patterns were ordered sequentially, that the LSTM could use the context of the sequence within the batch to better learn the sequence.</p>
<p>We can demonstrate this easily by modifying the first example for learning a one-to-one mapping and increasing the batch size from 1 to the size of the training dataset.</p>
<p>Additionally, Keras shuffles the training dataset before each training epoch. To ensure the training data patterns remain sequential, we can disable this shuffling.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6c6503341492" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.fit(X, y, epochs=5000, batch_size=len(dataX), verbose=2, shuffle=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c6503341492-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6c6503341492-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">5000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The network will learn the mapping of characters using the the within-batch sequence, but this context will not be available to the network when making predictions. We can evaluate both the ability of the network to make predictions randomly and in sequence.</p>
<p>The full code example is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6c9747028950" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Naive LSTM to learn one-char to one-char mapping with all data in each batch
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.utils import np_utils
from keras.preprocessing.sequence import pad_sequences
# fix random seed for reproducibility
numpy.random.seed(7)
# define the raw dataset
alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
# create mapping of characters to integers (0-25) and the reverse
char_to_int = dict((c, i) for i, c in enumerate(alphabet))
int_to_char = dict((i, c) for i, c in enumerate(alphabet))
# prepare the dataset of input to output pairs encoded as integers
seq_length = 1
dataX = []
dataY = []
for i in range(0, len(alphabet) - seq_length, 1):
	seq_in = alphabet[i:i + seq_length]
	seq_out = alphabet[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
	print(seq_in, '-&gt;', seq_out)
# convert list of lists to array and pad sequences if needed
X = pad_sequences(dataX, maxlen=seq_length, dtype='float32')
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (X.shape[0], seq_length, 1))
# normalize
X = X / float(len(alphabet))
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# create and fit the model
model = Sequential()
model.add(LSTM(16, input_shape=(X.shape[1], X.shape[2])))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
model.fit(X, y, epochs=5000, batch_size=len(dataX), verbose=2, shuffle=False)
# summarize performance of the model
scores = model.evaluate(X, y, verbose=0)
print("Model Accuracy: %.2f%%" % (scores[1]*100))
# demonstrate some model predictions
for pattern in dataX:
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	print(seq_in, "-&gt;", result)
# demonstrate predicting random patterns
print("Test a Random Pattern:")
for i in range(0,20):
	pattern_index = numpy.random.randint(len(dataX))
	pattern = dataX[pattern_index]
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	print(seq_in, "-&gt;", result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-32">32</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-34">34</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-36">36</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-38">38</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-40">40</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-42">42</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-44">44</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-46">46</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-48">48</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-50">50</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-52">52</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-54">54</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-56">56</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-58">58</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-60">60</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6c9747028950-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6c9747028950-62">62</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-1"><span class="crayon-p"># Naive LSTM to learn one-char to one-char mapping with all data in each batch</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">np_utils</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-v">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-8"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-9"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-10"><span class="crayon-p"># define the raw dataset</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-11"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-12"><span class="crayon-p"># create mapping of characters to integers (0-25) and the reverse</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-13"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-14"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-15"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-16"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-17"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-18"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-19"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-20"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-21"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-22"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-23"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-24"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-25"><span class="crayon-p"># convert list of lists to array and pad sequences if needed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-26"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-27"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-28"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-29"><span class="crayon-p"># normalize</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-30"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-31"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-32"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-33"><span class="crayon-p"># create and fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-34"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-35"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">16</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-36"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-37"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-38"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">5000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-39"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-40"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-41"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-42"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-43"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-44"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-45"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-46"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-47"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-48"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-49"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-50"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-51"><span class="crayon-p"># demonstrate predicting random patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-52"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Test a Random Pattern:"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-53"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-54"><span class="crayon-h"> </span><span class="crayon-v">pattern_index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-55"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">pattern_index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-56"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-57"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-58"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-59"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-60"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6c9747028950-61"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6c9747028950-62"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0043 seconds] -->
<p>Running the example provides the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6cb173738319" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Model Accuracy: 100.00%
['A'] -&gt; B
['B'] -&gt; C
['C'] -&gt; D
['D'] -&gt; E
['E'] -&gt; F
['F'] -&gt; G
['G'] -&gt; H
['H'] -&gt; I
['I'] -&gt; J
['J'] -&gt; K
['K'] -&gt; L
['L'] -&gt; M
['M'] -&gt; N
['N'] -&gt; O
['O'] -&gt; P
['P'] -&gt; Q
['Q'] -&gt; R
['R'] -&gt; S
['S'] -&gt; T
['T'] -&gt; U
['U'] -&gt; V
['V'] -&gt; W
['W'] -&gt; X
['X'] -&gt; Y
['Y'] -&gt; Z
Test a Random Pattern:
['T'] -&gt; U
['V'] -&gt; W
['M'] -&gt; N
['Q'] -&gt; R
['D'] -&gt; E
['V'] -&gt; W
['T'] -&gt; U
['U'] -&gt; V
['J'] -&gt; K
['F'] -&gt; G
['N'] -&gt; O
['B'] -&gt; C
['M'] -&gt; N
['F'] -&gt; G
['F'] -&gt; G
['P'] -&gt; Q
['A'] -&gt; B
['K'] -&gt; L
['W'] -&gt; X
['E'] -&gt; F</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-32">32</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-34">34</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-36">36</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-38">38</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-40">40</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-42">42</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-44">44</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cb173738319-46">46</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cb173738319-47">47</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-1">Model Accuracy: 100.00%</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-2">['A'] -&gt; B</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-3">['B'] -&gt; C</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-4">['C'] -&gt; D</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-5">['D'] -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-6">['E'] -&gt; F</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-7">['F'] -&gt; G</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-8">['G'] -&gt; H</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-9">['H'] -&gt; I</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-10">['I'] -&gt; J</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-11">['J'] -&gt; K</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-12">['K'] -&gt; L</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-13">['L'] -&gt; M</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-14">['M'] -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-15">['N'] -&gt; O</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-16">['O'] -&gt; P</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-17">['P'] -&gt; Q</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-18">['Q'] -&gt; R</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-19">['R'] -&gt; S</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-20">['S'] -&gt; T</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-21">['T'] -&gt; U</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-22">['U'] -&gt; V</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-23">['V'] -&gt; W</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-24">['W'] -&gt; X</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-25">['X'] -&gt; Y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-26">['Y'] -&gt; Z</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-27">Test a Random Pattern:</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-28">['T'] -&gt; U</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-29">['V'] -&gt; W</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-30">['M'] -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-31">['Q'] -&gt; R</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-32">['D'] -&gt; E</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-33">['V'] -&gt; W</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-34">['T'] -&gt; U</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-35">['U'] -&gt; V</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-36">['J'] -&gt; K</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-37">['F'] -&gt; G</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-38">['N'] -&gt; O</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-39">['B'] -&gt; C</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-40">['M'] -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-41">['F'] -&gt; G</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-42">['F'] -&gt; G</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-43">['P'] -&gt; Q</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-44">['A'] -&gt; B</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-45">['K'] -&gt; L</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cb173738319-46">['W'] -&gt; X</div><div class="crayon-line" id="crayon-5c0c9f2c8d6cb173738319-47">['E'] -&gt; F</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>As we expected, the network is able to use the within-sequence context to learn the alphabet, achieving 100% accuracy on the training data.</p>
<p>Importantly, the network can make accurate predictions for the next letter in the alphabet for randomly selected characters. Very impressive.</p>
<h2>Stateful LSTM for a One-Char to One-Char Mapping</h2>
<p>We have seen that we can break-up our raw data into fixed size sequences and that this representation can be learned by the LSTM, but only to learn random mappings of 3 characters to 1 character.</p>
<p>We have also seen that we can pervert batch size to offer more sequence to the network, but only during training.</p>
<p>Ideally, we want to expose the network to the entire sequence and let it learn the inter-dependencies, rather than us define those dependencies explicitly in the framing of the problem.</p>
<p>We can do this in Keras by making the LSTM layers stateful and manually resetting the state of the network at the end of the epoch, which is also the end of the training sequence.</p>
<p>This is truly how the LSTM networks are intended to be used. We find that by allowing the network itself to learn the dependencies between the characters, that we need a smaller network (half the number of units) and fewer training epochs (almost half).</p>
<p>We first need to define our LSTM layer as stateful. In so doing, we must explicitly specify the batch size as a dimension on the input shape. This also means that when we evaluate the network or make predictions, we must also specify and adhere to this same batch size. This is not a problem now as we are using a batch size of 1. This could introduce difficulties when making predictions when the batch size is not one as predictions will need to be made in batch and in sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6cd390234101" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
batch_size = 1
model.add(LSTM(50, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cd390234101-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cd390234101-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6cd390234101-1"><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cd390234101-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>An important difference in training the stateful LSTM is that we train it manually one epoch at a time and reset the state after each epoch. We can do this in a for loop. Again, we do not shuffle the input, preserving the sequence in which the input training data was created.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6cf086692466" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
for i in range(300):
	model.fit(X, y, epochs=1, batch_size=batch_size, verbose=2, shuffle=False)
	model.reset_states()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cf086692466-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6cf086692466-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6cf086692466-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6cf086692466-1"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">300</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6cf086692466-2"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6cf086692466-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>As mentioned, we specify the batch size when evaluating the performance of the network on the entire training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6d1183560053" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize performance of the model
scores = model.evaluate(X, y, batch_size=batch_size, verbose=0)
model.reset_states()
print("Model Accuracy: %.2f%%" % (scores[1]*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d1183560053-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d1183560053-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d1183560053-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d1183560053-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6d1183560053-1"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d1183560053-2"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d1183560053-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d1183560053-4"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Finally, we can demonstrate that the network has indeed learned the entire alphabet. We can seed it with the first letter “A”, request a prediction, feed the prediction back in as an input, and repeat the process all the way to “Z”.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6d3618493048" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# demonstrate some model predictions
seed = [char_to_int[alphabet[0]]]
for i in range(0, len(alphabet)-1):
	x = numpy.reshape(seed, (1, len(seed), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	print(int_to_char[seed[0]], "-&gt;", int_to_char[index])
	seed = [index]
model.reset_states()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d3618493048-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d3618493048-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d3618493048-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d3618493048-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d3618493048-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d3618493048-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d3618493048-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d3618493048-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d3618493048-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d3618493048-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6d3618493048-1"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d3618493048-2"><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d3618493048-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d3618493048-4"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d3618493048-5"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d3618493048-6"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d3618493048-7"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d3618493048-8"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">seed</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d3618493048-9"><span class="crayon-h"> </span><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d3618493048-10"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We can also see if the network can make predictions starting from an arbitrary letter.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6d4270653742" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# demonstrate a random starting point
letter = "K"
seed = [char_to_int[letter]]
print("New start: ", letter)
for i in range(0, 5):
	x = numpy.reshape(seed, (1, len(seed), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	print(int_to_char[seed[0]], "-&gt;", int_to_char[index])
	seed = [index]
model.reset_states()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d4270653742-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d4270653742-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d4270653742-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d4270653742-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d4270653742-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d4270653742-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d4270653742-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d4270653742-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d4270653742-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d4270653742-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d4270653742-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d4270653742-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6d4270653742-1"><span class="crayon-p"># demonstrate a random starting point</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d4270653742-2"><span class="crayon-v">letter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"K"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d4270653742-3"><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">letter</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d4270653742-4"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"New start: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">letter</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d4270653742-5"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d4270653742-6"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d4270653742-7"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d4270653742-8"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d4270653742-9"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d4270653742-10"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">seed</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d4270653742-11"><span class="crayon-h"> </span><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d4270653742-12"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>The entire code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6d6567638325" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Stateful LSTM to learn one-char to one-char mapping
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.utils import np_utils
# fix random seed for reproducibility
numpy.random.seed(7)
# define the raw dataset
alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
# create mapping of characters to integers (0-25) and the reverse
char_to_int = dict((c, i) for i, c in enumerate(alphabet))
int_to_char = dict((i, c) for i, c in enumerate(alphabet))
# prepare the dataset of input to output pairs encoded as integers
seq_length = 1
dataX = []
dataY = []
for i in range(0, len(alphabet) - seq_length, 1):
	seq_in = alphabet[i:i + seq_length]
	seq_out = alphabet[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
	print(seq_in, '-&gt;', seq_out)
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (len(dataX), seq_length, 1))
# normalize
X = X / float(len(alphabet))
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# create and fit the model
batch_size = 1
model = Sequential()
model.add(LSTM(50, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
for i in range(300):
	model.fit(X, y, epochs=1, batch_size=batch_size, verbose=2, shuffle=False)
	model.reset_states()
# summarize performance of the model
scores = model.evaluate(X, y, batch_size=batch_size, verbose=0)
model.reset_states()
print("Model Accuracy: %.2f%%" % (scores[1]*100))
# demonstrate some model predictions
seed = [char_to_int[alphabet[0]]]
for i in range(0, len(alphabet)-1):
	x = numpy.reshape(seed, (1, len(seed), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	print(int_to_char[seed[0]], "-&gt;", int_to_char[index])
	seed = [index]
model.reset_states()
# demonstrate a random starting point
letter = "K"
seed = [char_to_int[letter]]
print("New start: ", letter)
for i in range(0, 5):
	x = numpy.reshape(seed, (1, len(seed), 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	print(int_to_char[seed[0]], "-&gt;", int_to_char[index])
	seed = [index]
model.reset_states()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-32">32</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-34">34</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-36">36</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-38">38</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-40">40</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-42">42</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-44">44</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-46">46</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-48">48</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-50">50</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-52">52</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-54">54</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-56">56</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-58">58</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-60">60</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-62">62</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d6567638325-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d6567638325-64">64</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-1"><span class="crayon-p"># Stateful LSTM to learn one-char to one-char mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-7"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-8"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-9"><span class="crayon-p"># define the raw dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-10"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-11"><span class="crayon-p"># create mapping of characters to integers (0-25) and the reverse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-12"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-13"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-14"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-15"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-16"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-17"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-18"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-19"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-20"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-21"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-22"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-23"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-24"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-25"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-26"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-27"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-28"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-29"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-30"><span class="crayon-p"># create and fit the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-31"><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-32"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-33"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-34"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-35"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-36"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">300</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-37"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-38"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-39"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-40"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-42"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-43"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-44"><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-45"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-46"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-47"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-48"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-49"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-50"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">seed</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-51"><span class="crayon-h"> </span><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-52"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-53"><span class="crayon-p"># demonstrate a random starting point</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-54"><span class="crayon-v">letter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"K"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-55"><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">letter</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-56"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"New start: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">letter</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-57"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-58"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">seed</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-59"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-60"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-61"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-62"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">seed</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6d6567638325-63"><span class="crayon-h"> </span><span class="crayon-v">seed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d6567638325-64"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0044 seconds] -->
<p>Running the example provides the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6d9767402368" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Model Accuracy: 100.00%
A -&gt; B
B -&gt; C
C -&gt; D
D -&gt; E
E -&gt; F
F -&gt; G
G -&gt; H
H -&gt; I
I -&gt; J
J -&gt; K
K -&gt; L
L -&gt; M
M -&gt; N
N -&gt; O
O -&gt; P
P -&gt; Q
Q -&gt; R
R -&gt; S
S -&gt; T
T -&gt; U
U -&gt; V
V -&gt; W
W -&gt; X
X -&gt; Y
Y -&gt; Z
New start:  K
K -&gt; B
B -&gt; C
C -&gt; D
D -&gt; E
E -&gt; F</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6d9767402368-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6d9767402368-32">32</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-1">Model Accuracy: 100.00%</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-2">A -&gt; B</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-3">B -&gt; C</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-4">C -&gt; D</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-5">D -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-6">E -&gt; F</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-7">F -&gt; G</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-8">G -&gt; H</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-9">H -&gt; I</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-10">I -&gt; J</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-11">J -&gt; K</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-12">K -&gt; L</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-13">L -&gt; M</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-14">M -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-15">N -&gt; O</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-16">O -&gt; P</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-17">P -&gt; Q</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-18">Q -&gt; R</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-19">R -&gt; S</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-20">S -&gt; T</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-21">T -&gt; U</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-22">U -&gt; V</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-23">V -&gt; W</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-24">W -&gt; X</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-25">X -&gt; Y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-26">Y -&gt; Z</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-27">New start:  K</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-28">K -&gt; B</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-29">B -&gt; C</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-30">C -&gt; D</div><div class="crayon-line" id="crayon-5c0c9f2c8d6d9767402368-31">D -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6d9767402368-32">E -&gt; F</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that the network has memorized the entire alphabet perfectly. It used the context of the samples themselves and learned whatever dependency it needed to predict the next character in the sequence.</p>
<p>We can also see that if we seed the network with the first letter, that it can correctly rattle off the rest of the alphabet.</p>
<p>We can also see that it has only learned the full alphabet sequence and that from a cold start. When asked to predict the next letter from “K” that it predicts “B” and falls back into regurgitating the entire alphabet.</p>
<p>To truly predict “K” the state of the network would need to be warmed up iteratively fed the letters from “A” to “J”. This tells us that we could achieve the same effect with a “stateless” LSTM by preparing training data like:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6db850944240" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
---a -&gt; b
--ab -&gt; c
-abc -&gt; d
abcd -&gt; e</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6db850944240-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6db850944240-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6db850944240-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6db850944240-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6db850944240-1"><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">b</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6db850944240-2"><span class="crayon-o">--</span><span class="crayon-v">ab</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">c</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6db850944240-3"><span class="crayon-o">-</span><span class="crayon-v">abc</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-i">d</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6db850944240-4"><span class="crayon-v">abcd</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">e</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p><span style="line-height: 1.5;">Where the input sequence is fixed at 25 (a-to-y to predict z) and patterns are prefixed with zero-padding.</span></p>
<p>Finally, this raises the question of training an LSTM network using variable length input sequences to predict the next character.</p>
<h2>LSTM with Variable-Length Input to One-Char Output</h2>
<p>In the previous section, we discovered that the Keras “stateful” LSTM was really only a shortcut to replaying the first n-sequences, but didn’t really help us learn a generic model of the alphabet.</p>
<p>In this section we explore a variation of the “stateless” LSTM that learns random subsequences of the alphabet and an effort to build a model that can be given arbitrary letters or subsequences of letters and predict the next letter in the alphabet.</p>
<p>Firstly, we are changing the framing of the problem. To simplify we will define a maximum input sequence length and set it to a small value like 5 to speed up training. This defines the maximum length of subsequences of the alphabet will be drawn for training. In extensions, this could just as set to the full alphabet (26) or longer if we allow looping back to the start of the sequence.</p>
<p>We also need to define the number of random sequences to create, in this case 1000. This too could be more or less. I expect less patterns are actually required.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6dd001514806" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare the dataset of input to output pairs encoded as integers
num_inputs = 1000
max_len = 5
dataX = []
dataY = []
for i in range(num_inputs):
	start = numpy.random.randint(len(alphabet)-2)
	end = numpy.random.randint(start, min(start+max_len,len(alphabet)-1))
	sequence_in = alphabet[start:end+1]
	sequence_out = alphabet[end + 1]
	dataX.append([char_to_int[char] for char in sequence_in])
	dataY.append(char_to_int[sequence_out])
	print(sequence_in, '-&gt;', sequence_out)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6dd001514806-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6dd001514806-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6dd001514806-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6dd001514806-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6dd001514806-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6dd001514806-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6dd001514806-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6dd001514806-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6dd001514806-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6dd001514806-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6dd001514806-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6dd001514806-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6dd001514806-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6dd001514806-1"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6dd001514806-2"><span class="crayon-v">num_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6dd001514806-3"><span class="crayon-v">max_len</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6dd001514806-4"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6dd001514806-5"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6dd001514806-6"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">num_inputs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6dd001514806-7"><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6dd001514806-8"><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-v">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">min</span><span class="crayon-sy">(</span><span class="crayon-v">start</span><span class="crayon-o">+</span><span class="crayon-v">max_len</span><span class="crayon-sy">,</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6dd001514806-9"><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-o">:</span><span class="crayon-st">end</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6dd001514806-10"><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6dd001514806-11"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6dd001514806-12"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">sequence_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6dd001514806-13"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Running this code in the broader context will create input patterns that look like the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6df649445656" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
PQRST -&gt; U
W -&gt; X
O -&gt; P
OPQ -&gt; R
IJKLM -&gt; N
QRSTU -&gt; V
ABCD -&gt; E
X -&gt; Y
GHIJ -&gt; K</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6df649445656-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6df649445656-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6df649445656-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6df649445656-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6df649445656-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6df649445656-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6df649445656-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6df649445656-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6df649445656-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6df649445656-1">PQRST -&gt; U</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6df649445656-2">W -&gt; X</div><div class="crayon-line" id="crayon-5c0c9f2c8d6df649445656-3">O -&gt; P</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6df649445656-4">OPQ -&gt; R</div><div class="crayon-line" id="crayon-5c0c9f2c8d6df649445656-5">IJKLM -&gt; N</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6df649445656-6">QRSTU -&gt; V</div><div class="crayon-line" id="crayon-5c0c9f2c8d6df649445656-7">ABCD -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6df649445656-8">X -&gt; Y</div><div class="crayon-line" id="crayon-5c0c9f2c8d6df649445656-9">GHIJ -&gt; K</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The input sequences vary in length between 1 and <strong>max_len</strong> and therefore require zero padding. Here, we use left-hand-side (prefix) padding with the Keras built in <strong>pad_sequences()</strong> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6e1516160963" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X = pad_sequences(dataX, maxlen=max_len, dtype='float32')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e1516160963-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6e1516160963-1"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The trained model is evaluated on randomly selected input patterns. This could just as easily be new randomly generated sequences of characters. I also believe this could also be a linear sequence seeded with “A” with outputs fes back in as single character inputs.</p>
<p>The full code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6e2357507359" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# LSTM with Variable Length Input Sequences to One Character Output
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.utils import np_utils
from keras.preprocessing.sequence import pad_sequences
from theano.tensor.shared_randomstreams import RandomStreams
# fix random seed for reproducibility
numpy.random.seed(7)
# define the raw dataset
alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
# create mapping of characters to integers (0-25) and the reverse
char_to_int = dict((c, i) for i, c in enumerate(alphabet))
int_to_char = dict((i, c) for i, c in enumerate(alphabet))
# prepare the dataset of input to output pairs encoded as integers
num_inputs = 1000
max_len = 5
dataX = []
dataY = []
for i in range(num_inputs):
	start = numpy.random.randint(len(alphabet)-2)
	end = numpy.random.randint(start, min(start+max_len,len(alphabet)-1))
	sequence_in = alphabet[start:end+1]
	sequence_out = alphabet[end + 1]
	dataX.append([char_to_int[char] for char in sequence_in])
	dataY.append(char_to_int[sequence_out])
	print(sequence_in, '-&gt;', sequence_out)
# convert list of lists to array and pad sequences if needed
X = pad_sequences(dataX, maxlen=max_len, dtype='float32')
# reshape X to be [samples, time steps, features]
X = numpy.reshape(X, (X.shape[0], max_len, 1))
# normalize
X = X / float(len(alphabet))
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# create and fit the model
batch_size = 1
model = Sequential()
model.add(LSTM(32, input_shape=(X.shape[1], 1)))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
model.fit(X, y, epochs=500, batch_size=batch_size, verbose=2)
# summarize performance of the model
scores = model.evaluate(X, y, verbose=0)
print("Model Accuracy: %.2f%%" % (scores[1]*100))
# demonstrate some model predictions
for i in range(20):
	pattern_index = numpy.random.randint(len(dataX))
	pattern = dataX[pattern_index]
	x = pad_sequences([pattern], maxlen=max_len, dtype='float32')
	x = numpy.reshape(x, (1, max_len, 1))
	x = x / float(len(alphabet))
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	print(seq_in, "-&gt;", result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-22">22</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-24">24</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-26">26</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-28">28</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-30">30</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-32">32</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-34">34</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-36">36</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-38">38</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-40">40</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-42">42</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-44">44</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-46">46</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-48">48</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-50">50</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-52">52</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-54">54</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-56">56</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e2357507359-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e2357507359-58">58</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-1"><span class="crayon-p"># LSTM with Variable Length Input Sequences to One Character Output</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">np_utils</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-8"><span class="crayon-e">from </span><span class="crayon-v">theano</span><span class="crayon-sy">.</span><span class="crayon-v">tensor</span><span class="crayon-sy">.</span><span class="crayon-e">shared_randomstreams </span><span class="crayon-e">import </span><span class="crayon-v">RandomStreams</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-9"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-10"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-11"><span class="crayon-p"># define the raw dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-12"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-13"><span class="crayon-p"># create mapping of characters to integers (0-25) and the reverse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-14"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-15"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-16"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-17"><span class="crayon-v">num_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-18"><span class="crayon-v">max_len</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-19"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-20"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-21"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">num_inputs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-22"><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-23"><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-v">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">min</span><span class="crayon-sy">(</span><span class="crayon-v">start</span><span class="crayon-o">+</span><span class="crayon-v">max_len</span><span class="crayon-sy">,</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-24"><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-o">:</span><span class="crayon-st">end</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-25"><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">[</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-26"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-27"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">sequence_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-28"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-29"><span class="crayon-p"># convert list of lists to array and pad sequences if needed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-30"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-31"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-32"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-33"><span class="crayon-p"># normalize</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-34"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-35"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-36"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-37"><span class="crayon-p"># create and fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-38"><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-39"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-40"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-44"><span class="crayon-p"># summarize performance of the model</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-45"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-46"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Model Accuracy: %.2f%%"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-47"><span class="crayon-p"># demonstrate some model predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-48"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-49"><span class="crayon-h"> </span><span class="crayon-v">pattern_index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-50"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">pattern_index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-51"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-52"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-53"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-54"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-55"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-56"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9f2c8d6e2357507359-57"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e2357507359-58"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">seq_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"-&gt;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0042 seconds] -->
<p>Running this code produces the following output:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9f2c8d6e4496933857" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Model Accuracy: 98.90%
['Q', 'R'] -&gt; S
['W', 'X'] -&gt; Y
['W', 'X'] -&gt; Y
['C', 'D'] -&gt; E
['E'] -&gt; F
['S', 'T', 'U'] -&gt; V
['G', 'H', 'I', 'J', 'K'] -&gt; L
['O', 'P', 'Q', 'R', 'S'] -&gt; T
['C', 'D'] -&gt; E
['O'] -&gt; P
['N', 'O', 'P'] -&gt; Q
['D', 'E', 'F', 'G', 'H'] -&gt; I
['X'] -&gt; Y
['K'] -&gt; L
['M'] -&gt; N
['R'] -&gt; T
['K'] -&gt; L
['E', 'F', 'G'] -&gt; H
['Q'] -&gt; R
['Q', 'R', 'S'] -&gt; T</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-2">2</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-4">4</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-6">6</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-8">8</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-10">10</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-12">12</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-14">14</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-16">16</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-18">18</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9f2c8d6e4496933857-20">20</div><div class="crayon-num" data-line="crayon-5c0c9f2c8d6e4496933857-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-1">Model Accuracy: 98.90%</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-2">['Q', 'R'] -&gt; S</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-3">['W', 'X'] -&gt; Y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-4">['W', 'X'] -&gt; Y</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-5">['C', 'D'] -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-6">['E'] -&gt; F</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-7">['S', 'T', 'U'] -&gt; V</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-8">['G', 'H', 'I', 'J', 'K'] -&gt; L</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-9">['O', 'P', 'Q', 'R', 'S'] -&gt; T</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-10">['C', 'D'] -&gt; E</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-11">['O'] -&gt; P</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-12">['N', 'O', 'P'] -&gt; Q</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-13">['D', 'E', 'F', 'G', 'H'] -&gt; I</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-14">['X'] -&gt; Y</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-15">['K'] -&gt; L</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-16">['M'] -&gt; N</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-17">['R'] -&gt; T</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-18">['K'] -&gt; L</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-19">['E', 'F', 'G'] -&gt; H</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9f2c8d6e4496933857-20">['Q'] -&gt; R</div><div class="crayon-line" id="crayon-5c0c9f2c8d6e4496933857-21">['Q', 'R', 'S'] -&gt; T</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that although the model did not learn the alphabet perfectly from the randomly generated subsequences, it did very well. The model was not tuned and may require more training or a larger network, or both (an exercise for the reader).</p>
<p>This is a good natural extension to the “<em>all sequential input examples in each batch</em>” alphabet model learned above in that it can handle ad hoc queries, but this time of arbitrary sequence length (up to the max length).</p>
<h2>Summary</h2>
<p>In this post you discovered LSTM recurrent neural networks in Keras and how they manage state.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a naive LSTM network for one-character to one-character prediction.</li>
<li>How to configure a naive LSTM to learn a sequence across time steps within a sample.</li>
<li>How to configure an LSTM to learn a sequence across samples by manually managing state.</li>
</ul>
<p>Do you have any questions about managing LSTM state or about this post?<br/>
Ask your questions in the comment and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-35"> <div class="textwidget"><div class="woo-sc-hr"></div>
<h2 style="text-align: center;">Frustrated With Your Progress In Deep Learning?</h2>
<p><a href="/deep-learning-with-python/"><img align="left" alt="Deep Learning with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/05/DeepLearningWithPython-220.png" style="border: 0;"/></a></p>
<h4 style="text-align: center;"> What If You Could Develop A Network in Minutes</h4>
<p style="text-align: center;">…with just a few lines of Python</p>
<p style="text-align: center;">Discover how in my new Ebook: <a href="https://machinelearningmastery.com/deep-learning-with-python/">Deep Learning With Python</a></p>
<p style="text-align: center;">It covers <strong>self-study tutorials</strong> and <strong>end-to-end projects</strong> on topics like:<br/>
<em>Multilayer Perceptrons</em>, <em>Convolutional Nets</em> and <em>Recurrent Neural Nets</em>, and more…</p>
<h4 style="text-align: center;">Finally Bring Deep Learning To<br/>
Your Own Projects</h4>
<p style="text-align: center;">Skip the Academics. Just Results.</p>
<p style="text-align: center;"><a href="https://machinelearningmastery.com/deep-learning-with-python/">Click to learn more</a>.</p>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-2941 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=Understanding+Stateful+LSTM+Recurrent+Neural+Networks+in+Python+with+Keras&amp;url=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/use-ensemble-machine-learning-algorithms-weka/" rel="prev"><i class="fa fa-angle-left"></i> How to Use Ensemble Machine Learning Algorithms in Weka</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/compare-performance-machine-learning-algorithms-weka/" rel="next">How To Compare the Performance of Machine Learning Algorithms in Weka <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">131 Responses to <em>Understanding Stateful LSTM Recurrent Neural Networks in Python with Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-358237">
<div class="comment-container" id="li-comment-358237">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dc4a938ef4794e3fa1d596e75547a784?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dc4a938ef4794e3fa1d596e75547a784?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mark</span>
<span class="date">July 28, 2016 at 6:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-358237" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great series of posts on LSTM networks recently. Keep up the good work</p>
<div class="reply">
<a aria-label="Reply to Mark" class="comment-reply-link" href="#comment-358237" onclick='return addComment.moveForm( "comment-358237", "358237", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-358269">
<div class="comment-container" id="li-comment-358269">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 29, 2016 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-358269" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Mark.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-358269" onclick='return addComment.moveForm( "comment-358269", "358269", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-411832">
<div class="comment-container" id="li-comment-411832">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/288fb0eda48fabad401e08071f3b51a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/288fb0eda48fabad401e08071f3b51a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.mlowl.com" rel="external nofollow">Kilian</a></span>
<span class="date">August 31, 2017 at 4:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-411832" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For anyone, who wants to try out trained LSTMs, there is an interactive chat box: <a href="http://www.mlowl.com/post/character-language-model-lstm-tensorflow/" rel="nofollow">http://www.mlowl.com/post/character-language-model-lstm-tensorflow/</a> </p>
<p>It offers models trained on Wikipedia, Congress speeches, Sherlock Holmes, South Park and Goethe.</p>
<p>I can also recommend the tensorlm package on GitHub: <a href="https://github.com/batzner/tensorlm" rel="nofollow">https://github.com/batzner/tensorlm</a></p>
<div class="reply">
<a aria-label="Reply to Kilian" class="comment-reply-link" href="#comment-411832" onclick='return addComment.moveForm( "comment-411832", "411832", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-411857">
<div class="comment-container" id="li-comment-411857">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-411857" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-411857" onclick='return addComment.moveForm( "comment-411857", "411857", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-358292">
<div class="comment-container" id="li-comment-358292">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c451248e578fd6a3ffffed35589cd285?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c451248e578fd6a3ffffed35589cd285?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Atlant</span>
<span class="date">July 29, 2016 at 4:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-358292" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I like this post, it gave me many enlightenment.</p>
<div class="reply">
<a aria-label="Reply to Atlant" class="comment-reply-link" href="#comment-358292" onclick='return addComment.moveForm( "comment-358292", "358292", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-358294">
<div class="comment-container" id="li-comment-358294">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 29, 2016 at 4:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-358294" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Atlant.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-358294" onclick='return addComment.moveForm( "comment-358294", "358294", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-360309">
<div class="comment-container" id="li-comment-360309">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/191cca8423652ed590483bd483f08787?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/191cca8423652ed590483bd483f08787?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">shanbe</span>
<span class="date">August 17, 2016 at 9:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-360309" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m probably missing something here but could you please explain why LSTM units are needed in the alphabet example where any output depends directly on the input letter and there is no confusion between different input -&gt; output pairs at all?</p>
<div class="reply">
<a aria-label="Reply to shanbe" class="comment-reply-link" href="#comment-360309" onclick='return addComment.moveForm( "comment-360309", "360309", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-360356">
<div class="comment-container" id="li-comment-360356">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2016 at 7:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-360356" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is a demonstration of the algorithms ability to learn a sequence. Not just input-output pairs, but input-output pairs over time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-360356" onclick='return addComment.moveForm( "comment-360356", "360356", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-366095">
<div class="comment-container" id="li-comment-366095">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Randy</span>
<span class="date">October 2, 2016 at 8:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-366095" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi, I got a little confused there. What does the LSTM units mean?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Randy" class="comment-reply-link" href="#comment-366095" onclick='return addComment.moveForm( "comment-366095", "366095", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-366116">
<div class="comment-container" id="li-comment-366116">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 3, 2016 at 5:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-366116" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Randy, the LSTM units are the “memory units” or you can just call them the neurons.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-366116" onclick='return addComment.moveForm( "comment-366116", "366116", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-418427">
<div class="comment-container" id="li-comment-418427">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/48ebe2e45f23c320df163a633df2f1d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/48ebe2e45f23c320df163a633df2f1d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">David Petit</span>
<span class="date">October 30, 2017 at 9:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-418427" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you very much for your fantastic tutorials. I learnt a lot through them.<br/>
Reccurent networks are quite complex and confusing to use. And like Shanbe, I am a bit confused with the examples as each output does not seem to have a dependency to the previous inputs but just a direct link to the current input. I am probably missing something too, but I don’t see how it demonstrates the benefits of using a memory rather than a direct Dense layer.<br/>
Actually the 100% accuracy can be achieved by just using the last layer and removing the LSTM layer (but it takes a bit more epoch).</p>
<p>I think the confusion is coming from the fact that the letters are encoded into integers. This would not be the case if the neural network could handle letters directly. In this example, they are encoded in the same order and therefore there is a direct relationship between the numbers. We are just teaching the network that the output equals the input+constant. Which is easy to obtain with a simple regression with one cell. But we still need the 26 outputs for the decoding at the end. </p>
<p>Maybe I am lost, but I think the demonstration would make more sense if the letters were scrambled (to avoid the possibility to have a simple linear combination which is solved by regression with one cell) and if we were trying to predict a previous letter rather than the next one. The use of a memory would be meaningful. But I didn’t try.<br/>
Nevertheless, the examples are still very interesting to show different approaches to the problem.</p>
<div class="reply">
<a aria-label="Reply to David Petit" class="comment-reply-link" href="#comment-418427" onclick='return addComment.moveForm( "comment-418427", "418427", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-361463">
<div class="comment-container" id="li-comment-361463">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c4a1008b4a6cd11dcf829c752b764070?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c4a1008b4a6cd11dcf829c752b764070?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">dolaameng</span>
<span class="date">August 24, 2016 at 10:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-361463" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for sharing these educational examples! Appreciate it if you can elaborate on the “LSTM State Within A Batch” example. The confusing part is on the explanation “that the LSTM could use the context of the sequence within the batch to better learn the sequence.”, which may imply that the states of LSTM are reused within the training of a batch, and this motivated the setting of parameter shuffle as False. </p>
<p>But my understanding of Keras’s implementation is that the LSTM won’t reuse the states within a batch. In fact, the sequences in a batch is kinda like triggering the LSTM “in parallel” – in fact the states of LSM should be of shape (nsamples, nout) for both gates – separate states for each sequence – this is what id described [Keras document](<a href="https://keras.io/getting-started/faq/#how-can-i-use-stateful-rnns" rel="nofollow">https://keras.io/getting-started/faq/#how-can-i-use-stateful-rnns</a>): states are reused by the ith instance for successive batchs. </p>
<p>This means that even parameter shuffle is set as True, it will still give you the observed performance. This also explains why the predictions on random patterns were also good, which was opposite to the observations in the next example “Stateful LSTM for a One-Char to One-Char Mapping”. The reason why setting a bigger batch size resulted in better performance than the first example, could be the bigger nb_epoch used. </p>
<p>Appreciate your opinions on this! It’s a great article anyway!</p>
<div class="reply">
<a aria-label="Reply to dolaameng" class="comment-reply-link" href="#comment-361463" onclick='return addComment.moveForm( "comment-361463", "361463", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-368532">
<div class="comment-container" id="li-comment-368532">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/36e27beda271db3f176435ebacb4ea29?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/36e27beda271db3f176435ebacb4ea29?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rodrigo Pinto</span>
<span class="date">October 29, 2016 at 4:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-368532" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You are right, that state from sequence to sequence inside one batch.</p>
<div class="reply">
<a aria-label="Reply to Rodrigo Pinto" class="comment-reply-link" href="#comment-368532" onclick='return addComment.moveForm( "comment-368532", "368532", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-418541">
<div class="comment-container" id="li-comment-418541">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e1ea30b7d3d8c70ce3d61214482ff14b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e1ea30b7d3d8c70ce3d61214482ff14b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Neeraj Agrawal</span>
<span class="date">October 31, 2017 at 6:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-418541" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I do agree. Better result came with large batch size, because it reaches minima faster and achieve good accuracy in 5000 epochs. If we increase number of epochs when batch_size =1, we can get 100% accuracy.</p>
<div class="reply">
<a aria-label="Reply to Neeraj Agrawal" class="comment-reply-link" href="#comment-418541" onclick='return addComment.moveForm( "comment-418541", "418541", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-443835">
<div class="comment-container" id="li-comment-443835">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mrinal verma</span>
<span class="date">July 19, 2018 at 2:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443835" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think the accuracy increased because there was no resetting of the network as all the samples were fitted in the batch size and as the default resetting of the network takes place after a batch size no of samples whereas in those with batch size=1 the resetting of the network was taking place after each batch size which was actually equal to 1 sample</p>
<div class="reply">
<a aria-label="Reply to mrinal verma" class="comment-reply-link" href="#comment-443835" onclick='return addComment.moveForm( "comment-443835", "443835", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-363580">
<div class="comment-container" id="li-comment-363580">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d7481313fbaecce9fac553caabeb9d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d7481313fbaecce9fac553caabeb9d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hadi</span>
<span class="date">September 5, 2016 at 2:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-363580" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your amazing tutorial.<br/>
However, what if I want to predict a sequence of outputs? If I add a dimension to the output it is gonna be like a features window and the model will not consider the outputs as  a sequence of outputs. It is like outputs are independent. How can I fix that issue and have a model which for example generates “FGH” when I give it “BCDE”.</p>
<div class="reply">
<a aria-label="Reply to Hadi" class="comment-reply-link" href="#comment-363580" onclick='return addComment.moveForm( "comment-363580", "363580", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-392122">
<div class="comment-container" id="li-comment-392122">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7b945128388c475de2fe5b3bfdf23ffc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7b945128388c475de2fe5b3bfdf23ffc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Wes</span>
<span class="date">March 11, 2017 at 1:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-392122" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hadi, I use a “one-hot” encoding for my features. This causes the output to be a probability distribution over the features. You may then use a sampling technique to choose “next” features, similar to the “Unreasonable Effectiveness of RNN” article. This method includes a “temperature” parameter that you can tune to produce outputs with more or less adherence to the LSTM’s predictions.</p>
<div class="reply">
<a aria-label="Reply to Wes" class="comment-reply-link" href="#comment-392122" onclick='return addComment.moveForm( "comment-392122", "392122", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-392194">
<div class="comment-container" id="li-comment-392194">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7b945128388c475de2fe5b3bfdf23ffc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7b945128388c475de2fe5b3bfdf23ffc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Wes</span>
<span class="date">March 11, 2017 at 9:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-392194" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One more follow-up to this problem… you may be interested in a different type of network, such as a Generative Adversarial Network (GAN) <a href="https://github.com/jacobgil/keras-dcgan" rel="nofollow">https://github.com/jacobgil/keras-dcgan</a></p>
<div class="reply">
<a aria-label="Reply to Wes" class="comment-reply-link" href="#comment-392194" onclick='return addComment.moveForm( "comment-392194", "392194", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-364542">
<div class="comment-container" id="li-comment-364542">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b9f336cf3b115520c53e0c530b3085f0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b9f336cf3b115520c53e0c530b3085f0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">September 15, 2016 at 5:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-364542" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Also for my part than you for the tutorial. </p>
<p>However, I have a few related questions (also posted in StackOverflow, <a href="http://stackoverflow.com/questions/39457744/backpropagation-through-time-in-stateful-rnns" rel="nofollow">http://stackoverflow.com/questions/39457744/backpropagation-through-time-in-stateful-rnns</a>): If I have a stateful RNN with just one timestep per batch, how is backpropagation handled? Will it handle only this one timestep or does it accumulate updates for the entire sequence? I fear that it updates only the timesteps per batch and nothing further back. If so, do you think this is a major drawback? Or do you know a way to overcome this?</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="#comment-364542" onclick='return addComment.moveForm( "comment-364542", "364542", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-364622">
<div class="comment-container" id="li-comment-364622">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 16, 2016 at 9:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-364622" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Alex,</p>
<p>I believe updates are performed after each batch. This can be a downside of having a small batch. A batch size of 1 will essentially perform online gradient descent (I would guess). Developers more familiar with Keras internals may be able to give you a more concrete answer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-364622" onclick='return addComment.moveForm( "comment-364622", "364622", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-364683">
<div class="comment-container" id="li-comment-364683">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b9f336cf3b115520c53e0c530b3085f0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b9f336cf3b115520c53e0c530b3085f0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">September 17, 2016 at 3:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-364683" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>thank you very much for your answer. </p>
<p>I posed my question wrongly because I mixed up “batch size” and “time steps”. If I have sequences of shape (nb_samples, n, dims) and I process them one time step after the other with a stateful LSTM (feeding batches of shape (batch_size, 1, dims) to the network), will backpropagation go through the entire sequences as it would if I processed the entire sequence at once?</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="#comment-364683" onclick='return addComment.moveForm( "comment-364683", "364683", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-364707">
<div class="comment-container" id="li-comment-364707">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 17, 2016 at 9:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-364707" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The answer does not change, updates happen after each batch.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-364707" onclick='return addComment.moveForm( "comment-364707", "364707", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-365158">
<div class="comment-container" id="li-comment-365158">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6e5854357c24b24c01330cd25700f91a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6e5854357c24b24c01330cd25700f91a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vishal</span>
<span class="date">September 21, 2016 at 11:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-365158" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>“The Keras implementation of LSTMs resets the state of the network after each batch.”</p>
<p>Could you please explain what you mean by “resets the state”? What happens to the network state after each epoch?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Vishal" class="comment-reply-link" href="#comment-365158" onclick='return addComment.moveForm( "comment-365158", "365158", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-365227">
<div class="comment-container" id="li-comment-365227">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 22, 2016 at 8:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-365227" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t know if it is clear or just unreliable. But it is gone. </p>
<p>Your network will not behave as you expect.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-365227" onclick='return addComment.moveForm( "comment-365227", "365227", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-443836">
<div class="comment-container" id="li-comment-443836">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mrinal verma</span>
<span class="date">July 19, 2018 at 2:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443836" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>it means all the memory inside a neuron that it has learned over a batch size will be lost and the new sequence or sample will be trained with fresh neurons or cells which are having no state</p>
<div class="reply">
<a aria-label="Reply to mrinal verma" class="comment-reply-link" href="#comment-443836" onclick='return addComment.moveForm( "comment-443836", "443836", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-365199">
<div class="comment-container" id="li-comment-365199">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://N/A" rel="external nofollow">Arnold</a></span>
<span class="date">September 21, 2016 at 10:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-365199" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>first, thanks for the amazing tutorial!</p>
<p>I got two quick questions:</p>
<p>   1) if I want to train “LSTM with Variable Length Input to One-Char Output” on much simpler sequence (with inserted repetitive pattern):</p>
<p>seq_1 = “aaaabbbccdaaaabbbccdaaaabbbccd….”</p>
<p>or even </p>
<p>se1_2 = “ababababababababababababababab…”</p>
<p>I can’t do any better than 50% of accuracy. What’s wrong?</p>
<p>   2) If I want to amend your code to N-Char-Output, how is it possible? So, given a sequence “abcd” -&gt; “ef” ?</p>
<p>Many thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Arnold" class="comment-reply-link" href="#comment-365199" onclick='return addComment.moveForm( "comment-365199", "365199", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-365200">
<div class="comment-container" id="li-comment-365200">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://N/A" rel="external nofollow">Arnold</a></span>
<span class="date">September 21, 2016 at 10:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-365200" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I found my mistake: the char-integer encoding should be:</p>
<p>chars = sorted(list(set(alphabet)))<br/>
char_to_int = dict((c, i) for i, c in enumerate(chars))<br/>
int_to_char = dict((i, c) for i, c in enumerate(chars))</p>
<p>but, it does not help too much.</p>
<p>Also, I’m very curious to know how to predict N-characters</p>
<div class="reply">
<a aria-label="Reply to Arnold" class="comment-reply-link" href="#comment-365200" onclick='return addComment.moveForm( "comment-365200", "365200", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-365235">
<div class="comment-container" id="li-comment-365235">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 22, 2016 at 8:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-365235" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Arnold,</p>
<p>Nice change. No idea why it’s not learning it. Perhaps you need more nodes/layers or longer training? Maybe stateful or stateless?<br/>
Perhaps it’s the framing of the problem?</p>
<p>This is a sequence to sequence problem. I expect you can just change the output node from 1 neuron to the number you would like.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-365235" onclick='return addComment.moveForm( "comment-365235", "365235", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-365499">
<div class="comment-container" id="li-comment-365499">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arnold</span>
<span class="date">September 25, 2016 at 8:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-365499" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thanks for your suggestions. I will try.</p>
<div class="reply">
<a aria-label="Reply to Arnold" class="comment-reply-link" href="#comment-365499" onclick='return addComment.moveForm( "comment-365499", "365499", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-367640">
<div class="comment-container" id="li-comment-367640">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/491b706b68d04115e827a07b5c12e9b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/491b706b68d04115e827a07b5c12e9b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Riccardo Folloni</span>
<span class="date">October 20, 2016 at 9:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-367640" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Arnold,</p>
<p>have you acheived that kind of implementation? 🙂<br/>
i’m also interested</p>
<div class="reply">
<a aria-label="Reply to Riccardo Folloni" class="comment-reply-link" href="#comment-367640" onclick='return addComment.moveForm( "comment-367640", "367640", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-365202">
<div class="comment-container" id="li-comment-365202">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e46fd92818e28a9bea206d013b96e18?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arnold</span>
<span class="date">September 21, 2016 at 11:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-365202" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thanks for the amazing tutorial and other posts!</p>
<p>How to amend your code to predict N-next characters and not only one?</p>
<p>something like: “LSTM with Variable Length Input to N-Char Output”</p>
<div class="reply">
<a aria-label="Reply to Arnold" class="comment-reply-link" href="#comment-365202" onclick='return addComment.moveForm( "comment-365202", "365202", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-366259">
<div class="comment-container" id="li-comment-366259">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d0ae7a3d906b223fc7508a5b02ee6b64?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d0ae7a3d906b223fc7508a5b02ee6b64?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Madhav</span>
<span class="date">October 4, 2016 at 5:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-366259" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great tutorial as always. It was fun to run through your code line by line, work with a smaller alphabet (like “ABCDE”), change the sequence length etc just to figure out how the model behaves. I think I’m growing fond of LSTMs these days.</p>
<p>I have a very basic question about the shape of the input tensor. Keras requires our input to have the form [samples, time_steps, features]. Could you tell me what the attribute features exactly means? </p>
<p>Also, consider a scenario for training an LSTM network for binary classification of audio. Suppose I have a collection of 1000 files and for each file, I have extracted 13 features (MFCC values). Also suppose that every file is 500 frames long and I set the time_steps to 1.</p>
<p>What would be my input shape?</p>
<p>1. [Number of files, time_steps, features] = [1000, 1, 13]</p>
<p>or</p>
<p>2. [Number of files * frames_per_file, time_steps, features] = [1000*500, 1, 13]</p>
<p>Any answer is greatly appreciated !! Thanks.</p>
<div class="reply">
<a aria-label="Reply to Madhav" class="comment-reply-link" href="#comment-366259" onclick='return addComment.moveForm( "comment-366259", "366259", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-366292">
<div class="comment-container" id="li-comment-366292">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2016 at 8:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-366292" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Madhav.</p>
<p>The features in the input refers to attributes or columns in your data.</p>
<p>Yes, your framing of the problem looks right to me [1000, 1, 13] or [samples, timesteps, features]</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-366292" onclick='return addComment.moveForm( "comment-366292", "366292", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-367829">
<div class="comment-container" id="li-comment-367829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/82c3c40c4a831f67ea18b0cb5511a914?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/82c3c40c4a831f67ea18b0cb5511a914?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rob</span>
<span class="date">October 22, 2016 at 12:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-367829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the enlightening series of articles on LSTMs!<br/>
Just a minor detail, the complete code for the final example is missing an import for pad_sequences:<br/>
from keras.preprocessing.sequence import pad_sequences</p>
<div class="reply">
<a aria-label="Reply to Rob" class="comment-reply-link" href="#comment-367829" onclick='return addComment.moveForm( "comment-367829", "367829", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-367862">
<div class="comment-container" id="li-comment-367862">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 22, 2016 at 7:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-367862" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fixed.</p>
<p>Thanks for pointing that out Rob!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-367862" onclick='return addComment.moveForm( "comment-367862", "367862", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-369822">
<div class="comment-container" id="li-comment-369822">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b60348768efe1a794030dc279addfabd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b60348768efe1a794030dc279addfabd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Panand</span>
<span class="date">November 8, 2016 at 2:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-369822" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason</p>
<p>What if I want to predict a non sequential network.(eg:- the next state of A may be B,C,Z or A itself depending on  the previous values before A). Can I use this same logic for that problem?</p>
<div class="reply">
<a aria-label="Reply to Panand" class="comment-reply-link" href="#comment-369822" onclick='return addComment.moveForm( "comment-369822", "369822", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-369869">
<div class="comment-container" id="li-comment-369869">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 8, 2016 at 9:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-369869" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes Panand, LSTMs can learn arbitrary complex sequences, although you may need to scale up memory units and layers to account for problem complexity.</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-369869" onclick='return addComment.moveForm( "comment-369869", "369869", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-370722">
<div class="comment-container" id="li-comment-370722">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/175d01f2db965995995aaa618032e3e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/175d01f2db965995995aaa618032e3e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Veronica</span>
<span class="date">November 16, 2016 at 4:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-370722" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thank you for your tutorials, I learn a lot from them.<br/>
However, I still don’t quite understand the meaning of batch size. In the last example you set batch_size to be 1, but the network still learned the next letter in the sequence based on the whole sequence, or was it just based on the last letter every time?<br/>
What would have happened if you set batch_size=3 and all the sequences would be at minimal length 3?<br/>
Thank you</p>
<div class="reply">
<a aria-label="Reply to Veronica" class="comment-reply-link" href="#comment-370722" onclick='return addComment.moveForm( "comment-370722", "370722", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-443842">
<div class="comment-container" id="li-comment-443842">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mrinal verma</span>
<span class="date">July 19, 2018 at 3:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443842" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>batch size is the number of samples after which the system weights are updated and the network is reset,  in this example, the sample is a single alphabet.</p>
<div class="reply">
<a aria-label="Reply to mrinal verma" class="comment-reply-link" href="#comment-443842" onclick='return addComment.moveForm( "comment-443842", "443842", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-375188">
<div class="comment-container" id="li-comment-375188">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3b36675bfa41523ad4e9d253800cf02f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3b36675bfa41523ad4e9d253800cf02f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manisha</span>
<span class="date">December 14, 2016 at 6:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-375188" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason ,</p>
<p>Thank you for this wonderful tutorial.<br/>
Motivated by this I got myself trying to generate a sine wave using RNN in theano</p>
<p>After running the code below</p>
<p> the sine curve predicted in green is generated well when I give an input to all the time steps at prediction</p>
<p>but the curve in blue is not predicted well where I give the input to only the first time step while prediction (This kind of prediction is you have used for character sequence generation)</p>
<p>Is there a way I could make that work. Cause I need a model for generating captions.</p>
<p>#Learning Sine wave<br/>
import theano<br/>
import numpy as np<br/>
import matplotlib.pyplot as plt<br/>
import theano.tensor as T<br/>
import math<br/>
theano.config.floatX = ‘float64’</p>
<p>##  data<br/>
step_radians = 0.01<br/>
steps_of_history = 200<br/>
steps_in_future = 1<br/>
index = 0</p>
<p>x = np.sin(np.arange(0, 20*math.pi, step_radians))</p>
<p>seq = []<br/>
next_val = []</p>
<p>for i in range(0, len(x)-steps_of_history, steps_of_history):<br/>
    seq.append(x[i: i + steps_of_history])<br/>
    next_val.append(x[i+1:i + steps_of_history+1])</p>
<p>seq = np.reshape(seq, [-1, steps_of_history, 1])<br/>
next_val = np.reshape(next_val, [-1, steps_of_history, 1])</p>
<p>trainX = np.array(seq)<br/>
trainY = np.array(next_val)</p>
<p>## model<br/>
n = 50<br/>
nin = 1<br/>
nout = 1</p>
<p>u = T.matrix()</p>
<p>t = T.matrix()</p>
<p>h0 = T.vector()<br/>
h_in = np.zeros(n).astype(theano.config.floatX)<br/>
lr = T.scalar()</p>
<p>W = theano.shared(np.random.uniform(size=(3,n, n), low=-.01, high=.01).astype(theano.config.floatX))<br/>
W_in = theano.shared(np.random.uniform(size=(nin, n), low=-.01, high=.01).astype(theano.config.floatX))<br/>
W_out = theano.shared(np.random.uniform(size=(n, nout), low=-.01, high=.01).astype(theano.config.floatX))</p>
<p>def step(u_t, h_tm1, W, W_in, W_out):<br/>
	h_t = T.tanh(T.dot(u_t, W_in) + T.dot(h_tm1, W[0]))<br/>
	h_t1 = T.tanh(T.dot(h_t, W[1]) + T.dot(h_tm1, W[2]))<br/>
    	y_t = T.dot(h_t1, W_out)<br/>
    	return h_t, y_t</p>
<p>[h, y], _ = theano.scan(step,<br/>
                        sequences=u,<br/>
                        outputs_info=[h0, None],<br/>
                        non_sequences=[W, W_in, W_out])</p>
<p>error = ((y – t) ** 2).sum()<br/>
prediction = y<br/>
gW, gW_in, gW_out = T.grad(error, [W, W_in, W_out])</p>
<p>fn = theano.function([h0, u, t, lr],<br/>
                     error,<br/>
                     updates={W: W – lr * gW,<br/>
                             W_in: W_in – lr * gW_in,<br/>
                             W_out: W_out – lr * gW_out})<br/>
predict = theano.function([h0, u], prediction)</p>
<p>for e in range(10):<br/>
	for i in range(len(trainX)):<br/>
		fn(h_in,trainX[i],trainY[i],0.001)</p>
<p>print(‘End of training’)</p>
<p>x = np.sin(np.arange(20*math.pi, 24*math.pi, step_radians))</p>
<p>seq = []</p>
<p>for i in range(0, len(x)-steps_of_history, steps_of_history):<br/>
    seq.append(x[i: i + steps_of_history])</p>
<p>seq = np.reshape(seq, [-1, steps_of_history, 1])<br/>
testX = np.array(seq)</p>
<p># Predict the future values<br/>
predictY = []<br/>
for i in range(len(testX)):<br/>
	p = testX[i][0].reshape(1,1)<br/>
	for j in range(len(testX[i])):<br/>
		p = predict(h_in, p)<br/>
		predictY= predictY + p.tolist()<br/>
print(predictY)<br/>
# Plot the results</p>
<p>plt.plot(x, ‘r-‘, label=’Actual’)<br/>
plt.plot(np.asarray(predictY), ‘gx’, label=’Predicted’)<br/>
predictY = []<br/>
for i in range(len(testX)):<br/>
	predictY= predictY + predict(h_in, testX[i]).tolist()<br/>
plt.plot(np.asarray(predictY), ‘bo’, label=’Predicted’)</p>
<p>plt.show()</p>
<p>Many Thanks</p>
<div class="reply">
<a aria-label="Reply to Manisha" class="comment-reply-link" href="#comment-375188" onclick='return addComment.moveForm( "comment-375188", "375188", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-375916">
<div class="comment-container" id="li-comment-375916">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a6f2fe83e615fc585661f0fc281db77d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a6f2fe83e615fc585661f0fc281db77d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Louis Abraham</span>
<span class="date">December 19, 2016 at 4:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-375916" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>I think there is a mistake in the paragraph “LSTM State Within A Batch”.<br/>
You say “The Keras implementation of LSTMs resets the state of the network after each batch.”.<br/>
But the fact is that it resets its state event between the inputs of a batch.<br/>
You can see the poor performances (around .5) of this LSTM that tries to remember its last input : <a href="http://pastebin.com/u5NnAx9r" rel="nofollow">http://pastebin.com/u5NnAx9r</a></p>
<p>As a comparison, here is a stateful LSTM that performs well : <a href="http://pastebin.com/qEKBVqJJ" rel="nofollow">http://pastebin.com/qEKBVqJJ</a></p>
<div class="reply">
<a aria-label="Reply to Louis Abraham" class="comment-reply-link" href="#comment-375916" onclick='return addComment.moveForm( "comment-375916", "375916", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-416399">
<div class="comment-container" id="li-comment-416399">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f66a4cdea44a792c70315604f60f0a4c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f66a4cdea44a792c70315604f60f0a4c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dima</span>
<span class="date">October 12, 2017 at 9:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-416399" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think you are right.  it resets the state after each input.  But it holds the state between timesteps within one input.</p>
<div class="reply">
<a aria-label="Reply to Dima" class="comment-reply-link" href="#comment-416399" onclick='return addComment.moveForm( "comment-416399", "416399", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-378783">
<div class="comment-container" id="li-comment-378783">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mazen</span>
<span class="date">December 30, 2016 at 8:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-378783" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you very much.<br/>
It is the best description I’ve ever seen about LSTM. I got a lot of benefits from your post!</p>
<div class="reply">
<a aria-label="Reply to Mazen" class="comment-reply-link" href="#comment-378783" onclick='return addComment.moveForm( "comment-378783", "378783", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-378904">
<div class="comment-container" id="li-comment-378904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 31, 2016 at 7:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-378904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Mazen.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-378904" onclick='return addComment.moveForm( "comment-378904", "378904", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-382502">
<div class="comment-container" id="li-comment-382502">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3e7670f99caf88a98f45853147678fee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3e7670f99caf88a98f45853147678fee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fernando</span>
<span class="date">January 17, 2017 at 4:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-382502" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all, thaks for create this easy but very useful example to learn and understand better how the LSTM nets work.</p>
<p>I just want to ask you something about the first part, why do we use 32 units? was it a random decision or does it have a theoric fundament?</p>
<p>I will thank you your answer.</p>
<div class="reply">
<a aria-label="Reply to Fernando" class="comment-reply-link" href="#comment-382502" onclick='return addComment.moveForm( "comment-382502", "382502", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-382537">
<div class="comment-container" id="li-comment-382537">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 17, 2017 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-382537" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>An ad hoc choice Fernando. Great question.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-382537" onclick='return addComment.moveForm( "comment-382537", "382537", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-382659">
<div class="comment-container" id="li-comment-382659">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63e5c02aa1601e858855189d0e5a37d6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63e5c02aa1601e858855189d0e5a37d6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">leila</span>
<span class="date">January 18, 2017 at 12:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-382659" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>thanks for the amazing tutorial!</p>
<div class="reply">
<a aria-label="Reply to leila" class="comment-reply-link" href="#comment-382659" onclick='return addComment.moveForm( "comment-382659", "382659", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-382741">
<div class="comment-container" id="li-comment-382741">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 18, 2017 at 10:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-382741" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad you found it useful leila.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-382741" onclick='return addComment.moveForm( "comment-382741", "382741", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-383930">
<div class="comment-container" id="li-comment-383930">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/98724999c49dcb4e93c095ba080458d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/98724999c49dcb4e93c095ba080458d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">floyd</span>
<span class="date">January 25, 2017 at 2:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-383930" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for this post but i am a beginner and i have a question<br/>
you said “the state of the network is reset after each pattern” what does that mean?</p>
<div class="reply">
<a aria-label="Reply to floyd" class="comment-reply-link" href="#comment-383930" onclick='return addComment.moveForm( "comment-383930", "383930", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-384014">
<div class="comment-container" id="li-comment-384014">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 25, 2017 at 10:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-384014" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs maintain an internal state, it is a benefit of using them.</p>
<p>This internal state can be reset automatically (after each batch) or manually when setting the “stateful” argument.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-384014" onclick='return addComment.moveForm( "comment-384014", "384014", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-393210">
<div class="comment-container" id="li-comment-393210">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bfb93f7c355edfcc674711277cbb2088?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bfb93f7c355edfcc674711277cbb2088?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">atmaere</span>
<span class="date">March 18, 2017 at 8:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-393210" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial. Question: Is it possible to do a stateful LSTM with variable input (like the last example in the tutorial)? I am curious why you used a naive stateless LSTM for that.</p>
<div class="reply">
<a aria-label="Reply to atmaere" class="comment-reply-link" href="#comment-393210" onclick='return addComment.moveForm( "comment-393210", "393210", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-393254">
<div class="comment-container" id="li-comment-393254">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 19, 2017 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-393254" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes you can.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-393254" onclick='return addComment.moveForm( "comment-393254", "393254", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-395238">
<div class="comment-container" id="li-comment-395238">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2160843c93f5f33180394bfa85b4d2a1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2160843c93f5f33180394bfa85b4d2a1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bikram Gupta</span>
<span class="date">April 3, 2017 at 1:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-395238" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the amazing tutorial. The walkthrough (starting with simple and building on it) really helped.</p>
<div class="reply">
<a aria-label="Reply to Bikram Gupta" class="comment-reply-link" href="#comment-395238" onclick='return addComment.moveForm( "comment-395238", "395238", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-395329">
<div class="comment-container" id="li-comment-395329">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 4, 2017 at 9:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-395329" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome Bikram.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-395329" onclick='return addComment.moveForm( "comment-395329", "395329", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-397926">
<div class="comment-container" id="li-comment-397926">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83b2d6ae6340fafb98cb155dc1031eca?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83b2d6ae6340fafb98cb155dc1031eca?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">selfdrivingvehicle</span>
<span class="date">April 28, 2017 at 9:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-397926" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have one question in regards to the LSTM. I asked this question in details here on reddit, and after than came to know about your tutorial here.</p>
<p>I feel that with stateful LSTMs, I am getting the gist of the RNNs, but still has it been ever successfully used for video processing — like the problem I described here <a href="https://www.reddit.com/r/AskReddit/comments/681c76/understanding_lstm_stateful_stateless_how_to_go/" rel="nofollow">https://www.reddit.com/r/AskReddit/comments/681c76/understanding_lstm_stateful_stateless_how_to_go/</a></p>
<p>Basically, here, with stateful LSTM when the network was fed “K”, it predicted B, which is wrong. Does it mean that it is just memorized sequence and will always predict B irrespective of what is fed. How can we extend it to general video prediction tasks. Please look at the link above.</p>
<p>thanks in advance</p>
<div class="reply">
<a aria-label="Reply to selfdrivingvehicle" class="comment-reply-link" href="#comment-397926" onclick='return addComment.moveForm( "comment-397926", "397926", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397967">
<div class="comment-container" id="li-comment-397967">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 29, 2017 at 7:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-397967" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The link does not appear to work.</p>
<p>LSTMs require a very careful framing of your sequence problem in order to learn effectively. They also ofter require a much larger network trained for much longer than intuitions on MLPs may suggest.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-397967" onclick='return addComment.moveForm( "comment-397967", "397967", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-398944">
<div class="comment-container" id="li-comment-398944">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7d3ca64088d2568070df0e580aa3ffab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7d3ca64088d2568070df0e580aa3ffab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Melih</span>
<span class="date">May 8, 2017 at 1:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-398944" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello.</p>
<p>I have a question about RNN-LSTM network, how can we decide input_shape size? how can we draw shape of RNN about this problem?</p>
<div class="reply">
<a aria-label="Reply to Melih" class="comment-reply-link" href="#comment-398944" onclick='return addComment.moveForm( "comment-398944", "398944", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-398965">
<div class="comment-container" id="li-comment-398965">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 8, 2017 at 7:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-398965" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>The LSTMs in keras expect the shape to be [samples, timesteps, features]. </p>
<p>Each sample is a separate sequence. The sequence steps are time steps. Each observation measurement is a feature.</p>
<p>If you have one very long sequence, you can break it up into multiple smaller sequences.</p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-398965" onclick='return addComment.moveForm( "comment-398965", "398965", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-399020">
<div class="comment-container" id="li-comment-399020">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6555ea328cfb3f0a86bc89631f0a73c9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6555ea328cfb3f0a86bc89631f0a73c9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Penhchet</span>
<span class="date">May 8, 2017 at 6:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-399020" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could we use the LSTMS RNN in Keras to create the Chatbot Conversation Model.</p>
<div class="reply">
<a aria-label="Reply to Penhchet" class="comment-reply-link" href="#comment-399020" onclick='return addComment.moveForm( "comment-399020", "399020", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-399087">
<div class="comment-container" id="li-comment-399087">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2017 at 7:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-399087" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps, I do not have an example sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-399087" onclick='return addComment.moveForm( "comment-399087", "399087", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-400246">
<div class="comment-container" id="li-comment-400246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dffb490febf85825bd9f4399e1c79673?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dffb490febf85825bd9f4399e1c79673?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yuanliang Meng</span>
<span class="date">May 22, 2017 at 8:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-400246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sometimes it is helpful to extract LSTM outputs from certain time steps. For example, we may want to get the outputs corresponding to the last 30 words from a text, or the 100th~200th words from a text body. It would be great to write an instruction about it.</p>
<div class="reply">
<a aria-label="Reply to Yuanliang Meng" class="comment-reply-link" href="#comment-400246" onclick='return addComment.moveForm( "comment-400246", "400246", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-400296">
<div class="comment-container" id="li-comment-400296">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 23, 2017 at 7:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-400296" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion.</p>
<p>Can you give an example of what you mean?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-400296" onclick='return addComment.moveForm( "comment-400296", "400296", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-400737">
<div class="comment-container" id="li-comment-400737">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/201c487c6290c27b9764954e581fb78d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/201c487c6290c27b9764954e581fb78d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Farooq Zaman</span>
<span class="date">May 29, 2017 at 3:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-400737" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dear Sir (Jason) .</p>
<p>i want to use LSTM for words instead of alphabets. how can i implement that. more over can i use that part of speech tagging ? part of speech tagging is also a sequential problem because it also dependent on context.<br/>
thanks</p>
<div class="reply">
<a aria-label="Reply to Farooq Zaman" class="comment-reply-link" href="#comment-400737" onclick='return addComment.moveForm( "comment-400737", "400737", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-401178">
<div class="comment-container" id="li-comment-401178">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-401178" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can, but I do not have any examples sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-401178" onclick='return addComment.moveForm( "comment-401178", "401178", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-401060">
<div class="comment-container" id="li-comment-401060">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8f550c6c3b9face8ab00d72a5b32f014?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8f550c6c3b9face8ab00d72a5b32f014?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Carlos</span>
<span class="date">June 1, 2017 at 11:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-401060" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for this great tutorial. I really appreciated going through your LSTM code.<br/>
I have one question about the “features”: you are mentionning them but I don’t see where you are including them. Do they represent a multivariate problem? How do we handle that?</p>
<p>Many thanks,<br/>
Carlos</p>
<div class="reply">
<a aria-label="Reply to Carlos" class="comment-reply-link" href="#comment-401060" onclick='return addComment.moveForm( "comment-401060", "401060", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-401237">
<div class="comment-container" id="li-comment-401237">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 1:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-401237" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I do not have a multivariate example at this stage, but you can specify features in the input. The format is [samples, timesteps, features].</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-401237" onclick='return addComment.moveForm( "comment-401237", "401237", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-402680">
<div class="comment-container" id="li-comment-402680">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihaneh</span>
<span class="date">June 16, 2017 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-402680" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this great tutorial!<br/>
I have a  question. I am deadling with kinda same problem. However, each character in a sequence is a vector of features in my input data.<br/>
Instead of [‘A’, ‘B’, ‘C’] -&gt; D I have [[0, 0,1, 1.3], [6,3,1,1.5], [6, 4, 1.4, 4.5]] -&gt; [1, 3, 4]</p>
<p>So considering all sequences, my data is in 3d shape.<br/>
Could someone help me how to configure the input for LSTM?</p>
<div class="reply">
<a aria-label="Reply to Reihaneh" class="comment-reply-link" href="#comment-402680" onclick='return addComment.moveForm( "comment-402680", "402680", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-402709">
<div class="comment-container" id="li-comment-402709">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 16, 2017 at 8:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-402709" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTM input must be 3D, the structure is [samples, timesteps, features].</p>
<p>If you one hot encode, then the number of labels (length of binary vectors) is the number of features.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-402709" onclick='return addComment.moveForm( "comment-402709", "402709", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-402799">
<div class="comment-container" id="li-comment-402799">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihaneh</span>
<span class="date">June 17, 2017 at 2:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-402799" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It does! for clarification:<br/>
If I have 2000 sentences (sequence of words)<br/>
Each sentence is having 3 words,<br/>
and each word is converted into a vector of length 5 (5 features):</p>
<p>X1 = [[1, 2, 3, 4, 5], [6, 7, 8, 9, 10], [11, 12,13,14,15]], ….., X2000<br/>
Data_X = [X1, …, X2000]</p>
<p>So my X_train is gonna be like this?<br/>
X = numpy.reshape(Data_X, (2000, 3, 5))</p>
<div class="reply">
<a aria-label="Reply to Reihaneh" class="comment-reply-link" href="#comment-402799" onclick='return addComment.moveForm( "comment-402799", "402799", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-402844">
<div class="comment-container" id="li-comment-402844">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 17, 2017 at 7:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-402844" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<p>But don’t be afraid to explore other representations that may result in better skill on your problem. e.g. maybe it makes sense to provide n sentences as time steps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-402844" onclick='return addComment.moveForm( "comment-402844", "402844", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-403238">
<div class="comment-container" id="li-comment-403238">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihaneh Amini</span>
<span class="date">June 21, 2017 at 3:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-403238" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason!</p>
<p>I really appreciate your attempt in these tutorials.</p>
<p>I am working with a huge imbalanced sequential file, do you have any suggestion regarding improving these type of imbalanced files?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-403267">
<div class="comment-container" id="li-comment-403267">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 21, 2017 at 8:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-403267" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I do not have experience with imbalanced sequence data.</p>
<p>Perhaps methods for imbalanced non-sequence data will give you some ideas:<br/>
<a href="http://machinelearningmastery.com/tactics-to-combat-imbalanced-classes-in-your-machine-learning-dataset/" rel="nofollow">http://machinelearningmastery.com/tactics-to-combat-imbalanced-classes-in-your-machine-learning-dataset/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-402800">
<div class="comment-container" id="li-comment-402800">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihaneh</span>
<span class="date">June 17, 2017 at 2:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-402800" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>btw, assuming that the output is not high dimentional:<br/>
Y1 = [11, 22, 33]</p>
<div class="reply">
<a aria-label="Reply to Reihaneh" class="comment-reply-link" href="#comment-402800" onclick='return addComment.moveForm( "comment-402800", "402800", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-403973">
<div class="comment-container" id="li-comment-403973">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b7a355eb3c976aaf540f757b790c4731?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b7a355eb3c976aaf540f757b790c4731?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fiora</span>
<span class="date">June 27, 2017 at 12:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-403973" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, In this example you were able to go from ABC -&gt; D (3 to 1)<br/>
Is there a way there Train a model to go from ABC -&gt; BCD<br/>
or perhaps some other pattern like ABC- &gt;CBA( switching first and last)</p>
<div class="reply">
<a aria-label="Reply to Fiora" class="comment-reply-link" href="#comment-403973" onclick='return addComment.moveForm( "comment-403973", "403973", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-404041">
<div class="comment-container" id="li-comment-404041">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2017 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-404041" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can have 3 neurons in the output layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-404041" onclick='return addComment.moveForm( "comment-404041", "404041", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-408421">
<div class="comment-container" id="li-comment-408421">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bff49830aae227cafb186e36e039e563?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bff49830aae227cafb186e36e039e563?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Puzzled</span>
<span class="date">August 3, 2017 at 8:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-408421" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial and one that has come closest to ending my confusion. However I still not 100% clear. If I have time-series training data of length 5000, and each row of data consists of two features, can I shape my input data (x) as a single batch of 5000,1,2? And if this is the case — under what circumstances would I ever need to increase the time step to more than 1? I’m struggling to see the value the time step dimension is adding if the LSTM remembers across an entire batch (which in my above scenario would be like a time step of 5000 right?)</p>
<div class="reply">
<a aria-label="Reply to Puzzled" class="comment-reply-link" href="#comment-408421" onclick='return addComment.moveForm( "comment-408421", "408421", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408473">
<div class="comment-container" id="li-comment-408473">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 4, 2017 at 7:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-408473" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<p>The number of time steps should be equal to the number of time steps in your input sequence. Setting time steps to 1 is generally not a good idea in practice beyond demonstrations.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-408473" onclick='return addComment.moveForm( "comment-408473", "408473", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-408843">
<div class="comment-container" id="li-comment-408843">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a990930ae18135ad671617e4eb51fe25?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a990930ae18135ad671617e4eb51fe25?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Liuwei</span>
<span class="date">August 7, 2017 at 6:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-408843" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for your tutorials, I just have a confusion on stateful LSTM in keras.<br/>
I know the hidden state will pass through different timesteps. Will the hidden state pass among one batch？<br/>
Or  samples in one batch have different initialized hidden states?</p>
<div class="reply">
<a aria-label="Reply to Liuwei" class="comment-reply-link" href="#comment-408843" onclick='return addComment.moveForm( "comment-408843", "408843", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408899">
<div class="comment-container" id="li-comment-408899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 8, 2017 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-408899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The internal state is reset at the end of each batch.</p>
<p>You can carry the state across batches by making the layer stateful and taking control of when the state is reset.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-408899" onclick='return addComment.moveForm( "comment-408899", "408899", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410110">
<div class="comment-container" id="li-comment-410110">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e8679f0ffb02fc026807d71e87701ce5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e8679f0ffb02fc026807d71e87701ce5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Aiy</span>
<span class="date">August 18, 2017 at 6:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-410110" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Is one hot encoder needed for X? Since they are also categorical.</p>
<div class="reply">
<a aria-label="Reply to Aiy" class="comment-reply-link" href="#comment-410110" onclick='return addComment.moveForm( "comment-410110", "410110", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410177">
<div class="comment-container" id="li-comment-410177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 19, 2017 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-410177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the input can be one hot encoded.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-410177" onclick='return addComment.moveForm( "comment-410177", "410177", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410865">
<div class="comment-container" id="li-comment-410865">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/184eb5c66ab29253b44d6802e171870d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/184eb5c66ab29253b44d6802e171870d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nick Shawn</span>
<span class="date">August 24, 2017 at 1:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-410865" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It’s a awesome tutorial, but I still have some problem.When we use a LSTM/RNN, we usually initialize the state of LSTM/RNN with some random way like Orthogonal, therefore, when we use the LSTM for predicting, the initial state may be or must be different from training, how can it get the right prediction always.Even more, when we train a LSTM with stateful=False, the initial state will be reset, which means initialize randomly, how can it always get a right model?<br/>
wait for your answer, thank you!</p>
<div class="reply">
<a aria-label="Reply to Nick Shawn" class="comment-reply-link" href="#comment-410865" onclick='return addComment.moveForm( "comment-410865", "410865", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410886">
<div class="comment-container" id="li-comment-410886">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 4:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-410886" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post for advice on how to evaluate neural nets like LSTMs given their stochastic nature:<br/>
<a href="https://machinelearningmastery.com/evaluate-skill-deep-learning-models/" rel="nofollow">https://machinelearningmastery.com/evaluate-skill-deep-learning-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-410886" onclick='return addComment.moveForm( "comment-410886", "410886", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-411779">
<div class="comment-container" id="li-comment-411779">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/000b71fb827140eef02a19418028d6de?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/000b71fb827140eef02a19418028d6de?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Viktor</span>
<span class="date">August 30, 2017 at 7:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-411779" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have experiments with all the examples. It seemes for me that only one example “Stateful LSTM for a One-Char to One-Char Mapping” showing the nature of LSTM/RNN. All other examples simply work line ordinary Dense networks.<br/>
I’ve tried to work with sequence “ABCDEFABCXYZ”<br/>
It learned well on Stateful network.<br/>
Model Accuracy: 100.00%<br/>
[‘A’] -&gt; B<br/>
[‘B’] -&gt; C<br/>
[‘C’] -&gt; D<br/>
[‘D’] -&gt; E<br/>
[‘E’] -&gt; F<br/>
[‘F’] -&gt; A<br/>
[‘A’] -&gt; B<br/>
[‘B’] -&gt; C<br/>
[‘C’] -&gt; X<br/>
[‘X’] -&gt; Y<br/>
[‘Y’] -&gt; Z<br/>
But in random test it makes mistakes:<br/>
Test a Random Pattern:<br/>
[‘Y’] -&gt; B<br/>
[‘A’] -&gt; C<br/>
[‘C’] -&gt; D<br/>
[‘A’] -&gt; E<br/>
[‘X’] -&gt; F<br/>
[‘Y’] -&gt; A<br/>
[‘D’] -&gt; B<br/>
[‘B’] -&gt; C<br/>
[‘A’] -&gt; X<br/>
[‘A’] -&gt; Y<br/>
[‘B’] -&gt; Z<br/>
[‘C’] -&gt; Z<br/>
[‘E’] -&gt; Z<br/>
[‘B’] -&gt; Z<br/>
[‘C’] -&gt; Z<br/>
[‘C’] -&gt; A<br/>
[‘B’] -&gt; A<br/>
[‘C’] -&gt; A<br/>
[‘A’] -&gt; B<br/>
[‘F’] -&gt; B<br/>
How to fix that?</p>
<div class="reply">
<a aria-label="Reply to Viktor" class="comment-reply-link" href="#comment-411779" onclick='return addComment.moveForm( "comment-411779", "411779", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411843">
<div class="comment-container" id="li-comment-411843">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-411843" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>A more generic model needs to be developed, perhaps one that uses the context for the last n characters (time steps) to predict the next character.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-411843" onclick='return addComment.moveForm( "comment-411843", "411843", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-411956">
<div class="comment-container" id="li-comment-411956">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DrMcCleod</span>
<span class="date">September 1, 2017 at 2:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-411956" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In the final example with variable length inputs, are the vectors generated by the call to pad_sequences() sensible?<br/>
For example:</p>
<p>RS -&gt; T</p>
<p>Becomes</p>
<p>[[0], [0], [0], [17], [18]]</p>
<p>which is the equivalent of</p>
<p>AAARS -&gt; T</p>
<p>Is that really what is wanted?</p>
<div class="reply">
<a aria-label="Reply to DrMcCleod" class="comment-reply-link" href="#comment-411956" onclick='return addComment.moveForm( "comment-411956", "411956", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411998">
<div class="comment-container" id="li-comment-411998">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 1, 2017 at 6:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-411998" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That might be a fault. Thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-411998" onclick='return addComment.moveForm( "comment-411998", "411998", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-412078">
<div class="comment-container" id="li-comment-412078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DrMcCleod</span>
<span class="date">September 1, 2017 at 10:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-412078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yeah, I can’t work out if it is a good thing or a bad thing. </p>
<p>In its favour, it does train (and eventually approaches 100% accuracy if you up the batch size and epochs a bit).<br/>
On the other hand, it does seem that the training data is wrong and that it is learning the correct result in spite of it. I have tried an alternative dataset where the padded data is a random selection of letters. It doesn’t work particularly well for sequences of only 1 letter, but longer sequences seem OK.<br/>
I have pasted the new version below. Note that I have increased the dataset size, batch size and training epochs.</p>
<p>This LSTM business is a bit more subtle than I initially thought…. thanks for posting this tutorial though, I really like the “this is how to do it wrong” style of the first few examples. Very useful.</p>
<p>import numpy<br/>
from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from keras.layers import LSTM<br/>
from keras.utils import np_utils<br/>
from keras.preprocessing.sequence import pad_sequences</p>
<p># fix random seed for reproducibility<br/>
numpy.random.seed(7)</p>
<p># define the raw dataset<br/>
alphabet = “ABCDEFGHIJKLMNOPQRSTUVWXYZ”<br/>
# create mapping of characters to integers (0-25) and the reverse<br/>
char_to_int = dict((c, i) for i, c in enumerate(alphabet))<br/>
int_to_char = dict((i, c) for i, c in enumerate(alphabet))</p>
<p># prepare the dataset of input to output pairs encoded as integers<br/>
num_inputs = 10000<br/>
max_len = 5<br/>
dataX = []<br/>
dataY = []<br/>
for i in range(num_inputs):<br/>
	start = numpy.random.randint(len(alphabet)-2)<br/>
	end = numpy.random.randint(start, min(start+max_len,len(alphabet)-1))<br/>
	sequence_in = alphabet[start:end+1]<br/>
	sequence_out = alphabet[end + 1]<br/>
	dataX.append([char_to_int[char] for char in sequence_in])<br/>
	dataY.append(char_to_int[sequence_out])<br/>
	print(sequence_in, ‘-&gt;’, sequence_out)</p>
<p>for n in range(len(dataX)):<br/>
    while len(dataX[n]) “, result)</p>
<p>#test arbitrary patterns<br/>
pattern = [20, 21, 22]<br/>
while len(pattern) “, result)</p>
<div class="reply">
<a aria-label="Reply to DrMcCleod" class="comment-reply-link" href="#comment-412078" onclick='return addComment.moveForm( "comment-412078", "412078", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-412080">
<div class="comment-container" id="li-comment-412080">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DrMcCleod</span>
<span class="date">September 1, 2017 at 10:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-412080" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Did that listing get trimmed?</p>
<p>import numpy<br/>
from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from keras.layers import LSTM<br/>
from keras.utils import np_utils<br/>
from keras.preprocessing.sequence import pad_sequences</p>
<p># fix random seed for reproducibility<br/>
numpy.random.seed(7)</p>
<p># define the raw dataset<br/>
alphabet = “ABCDEFGHIJKLMNOPQRSTUVWXYZ”<br/>
# create mapping of characters to integers (0-25) and the reverse<br/>
char_to_int = dict((c, i) for i, c in enumerate(alphabet))<br/>
int_to_char = dict((i, c) for i, c in enumerate(alphabet))</p>
<p># prepare the dataset of input to output pairs encoded as integers<br/>
num_inputs = 10000<br/>
max_len = 5<br/>
dataX = []<br/>
dataY = []<br/>
for i in range(num_inputs):<br/>
	start = numpy.random.randint(len(alphabet)-2)<br/>
	end = numpy.random.randint(start, min(start+max_len,len(alphabet)-1))<br/>
	sequence_in = alphabet[start:end+1]<br/>
	sequence_out = alphabet[end + 1]<br/>
	dataX.append([char_to_int[char] for char in sequence_in])<br/>
	dataY.append(char_to_int[sequence_out])<br/>
	print(sequence_in, ‘-&gt;’, sequence_out)</p>
<p>for n in range(len(dataX)):<br/>
    while len(dataX[n]) “, result)</p>
<p>#test arbitrary patterns<br/>
pattern = [20, 21, 22]<br/>
while len(pattern) “, result)</p>
<div class="reply">
<a aria-label="Reply to DrMcCleod" class="comment-reply-link" href="#comment-412080" onclick='return addComment.moveForm( "comment-412080", "412080", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-412081">
<div class="comment-container" id="li-comment-412081">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/572d422b37b13941dfd1adee86ec8c05?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DrMcCleod</span>
<span class="date">September 1, 2017 at 10:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-412081" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hmm, I don’t seem to be able to post the full listing. Sorry.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-412119">
<div class="comment-container" id="li-comment-412119">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 2, 2017 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-412119" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Consider using pre HTML tags when posting code.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-412118">
<div class="comment-container" id="li-comment-412118">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 2, 2017 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-412118" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think the pure solution is to re-map the letters in the range 1-26 and reserve 0 for padding.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-412118" onclick='return addComment.moveForm( "comment-412118", "412118", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414886">
<div class="comment-container" id="li-comment-414886">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d8a3eaf396b5f05a001be39f8236090e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d8a3eaf396b5f05a001be39f8236090e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dan DeDora</span>
<span class="date">September 27, 2017 at 4:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-414886" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Prof Brownlee,</p>
<p>You do great work. I appreciate the diligent and detailed tutorials – thank you very much.</p>
<p>My question pertains to how lstm states might apply to non-“sequential” (but still time dependent) data, a la your air pollution tutorial –<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<p>1) Does setting an LSTM to [stateful = false] and using batch size 1 basically turn an LSTM into a more complicated Feedforward net, i.e., a neural net with no memory or knowledge of sequence? </p>
<p>2) After training a “stateful” model above, you reset the states and then make predictions. This means (wrt to the standard lstm equations, found here – <a href="https://en.wikipedia.org/wiki/Long_short-term_memory" rel="nofollow">https://en.wikipedia.org/wiki/Long_short-term_memory</a>) that the previous cell state, and the hidden state are zero. You can see this by using something like model.get_layer(index = 1).states[0].eval(). This is also true of a non-stateful model – the states are listed as [none] in keras. The confusing part is that resetting the state makes the forget gate and the “U” weights zero-out (as per the equations). Yet, as we see in your above tutorial, you can still make accurate predictions! It makes me wonder why we have a forget gate and U weights at all? </p>
<p>If my questions are confusing in any way, please let me know. Thanks ahead of time for your attention, and for these awesome tutorials.</p>
<div class="reply">
<a aria-label="Reply to Dan DeDora" class="comment-reply-link" href="#comment-414886" onclick='return addComment.moveForm( "comment-414886", "414886", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414904">
<div class="comment-container" id="li-comment-414904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 27, 2017 at 5:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-414904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dan, great questions.</p>
<p>No, LSTM memory units are still very different to simple neurons in a feed-forward network.</p>
<p>See this tutorial that forces the model to only use the internal state to predict the outcome:<br/>
<a href="https://machinelearningmastery.com/memory-in-a-long-short-term-memory-network/" rel="nofollow">https://machinelearningmastery.com/memory-in-a-long-short-term-memory-network/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-414904" onclick='return addComment.moveForm( "comment-414904", "414904", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421006">
<div class="comment-container" id="li-comment-421006">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4a948307f0c797ecc2afee0fcacb2c84?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4a948307f0c797ecc2afee0fcacb2c84?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shirin</span>
<span class="date">November 24, 2017 at 1:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-421006" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason;<br/>
Thanks for your useful tutorials. I have question regarding the ‘Accuracy’. As we see in first example “Naive LSTM”, accuracy is 84% but non of predictions are correct. My question is how this accuracy has been calculated?</p>
<div class="reply">
<a aria-label="Reply to Shirin" class="comment-reply-link" href="#comment-421006" onclick='return addComment.moveForm( "comment-421006", "421006", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421026">
<div class="comment-container" id="li-comment-421026">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.etherpros.com" rel="external nofollow">John Strong</a></span>
<span class="date">November 24, 2017 at 8:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-421026" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fantastic post, as always Jason. I especially appreciate the way you took time to show downside of alternatives to a stateless model, like piling in extra features. You say you are not a professor, but you think like a teacher, and not many are bothering to do that with such recent technologies.</p>
<p>I have a question about the requirement that we specify the batch size when an LSTM is stateful. In his blogpost on this subject (<a href="http://philipperemy.github.io/keras-stateful-lstm/" rel="nofollow">http://philipperemy.github.io/keras-stateful-lstm/</a>) Philippe Remy says (my paraphrase) that:</p>
<p>* For each observation (row) in the input data Keras saves output_dim states (where output_dim = the number of cells in the LSTM), so that<br/>
* After processing a batch, it will have collected an array of state information of size (batch_size, output_dim)<br/>
* Since state straddles batch boundaries, we must specify the shape of that state array (batch_size, output_dim) in the model definition.</p>
<p>My questions:<br/>
* Is that an accurate description?<br/>
* May I infer that state information straddles observations (rows of ip data, sequences, whatever you want to call it)?<br/>
* May I infer that state information straddles observations even in “stateless” LSTMs? (even though it does *not* straddle batches)<br/>
* If the LSTM keeps old state information around for the entire sequence, does that mean that it could potentially operate on an old state (say the state held 4, 5 or 50 cells ago)?<br/>
* If so, does that make LSTMs resemble autoregressive routines with a *huge* look back, which are thus directly (not just implicitly) dependent on state values that occurred many steps before?<br/>
* Is that explained in the original LSTM paper by Hochreiter?</p>
<div class="reply">
<a aria-label="Reply to John Strong" class="comment-reply-link" href="#comment-421026" onclick='return addComment.moveForm( "comment-421026", "421026", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421054">
<div class="comment-container" id="li-comment-421054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-421054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks John.</p>
<p>I cannot speak to that post, I have not read it.</p>
<p>A batch is a group of samples. After a batch the weights are updated and state is reset. One epoch is comprised of 1 or more batches.</p>
<p>LSTMs are poor at autoregression. They are not learning a static function on lag observations, instead, they learn a more complex function with the internal state acting as internal variables to the function. Past observations are not inputs to the function directly, rather they influence the internal state and t-1 output.</p>
<p>Not sure if that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421054" onclick='return addComment.moveForm( "comment-421054", "421054", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-421061">
<div class="comment-container" id="li-comment-421061">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">John Strong</span>
<span class="date">November 24, 2017 at 12:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-421061" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it helps, because it eliminates the possibility of past states (older than t – 1) directly influencing current state. But then why does the LSTM algorithm keep state information for each and every sample (sequence) in the batch?</p>
<p>And if it is not true that it keeps past state information for each sample, then why does the stateful LSTM need to know the batch size?</p>
<div class="reply">
<a aria-label="Reply to John Strong" class="comment-reply-link" href="#comment-421061" onclick='return addComment.moveForm( "comment-421061", "421061", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-421072">
<div class="comment-container" id="li-comment-421072">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 3:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-421072" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The LSTM accumulates state over the exposure to each sample, it does not keep state for each separate sample.</p>
<p>The stateful LSTM only needs to know the batch size for Keras reasons, e.g. efficiency of the implementation when running on different hardware.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421072" onclick='return addComment.moveForm( "comment-421072", "421072", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421290">
<div class="comment-container" id="li-comment-421290">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4a948307f0c797ecc2afee0fcacb2c84?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4a948307f0c797ecc2afee0fcacb2c84?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shirin Shadman</span>
<span class="date">November 27, 2017 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-421290" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason;<br/>
Thanks for your useful tutorials. I have question regarding the ‘Accuracy’. As we see in first example “Naive LSTM”, accuracy is 84% but non of predictions are correct. My question is how this accuracy has been calculated?</p>
<div class="reply">
<a aria-label="Reply to Shirin Shadman" class="comment-reply-link" href="#comment-421290" onclick='return addComment.moveForm( "comment-421290", "421290", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423703">
<div class="comment-container" id="li-comment-423703">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/575e3f6b73896d53cf5e13a56c7a875a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/575e3f6b73896d53cf5e13a56c7a875a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">atgc1984</span>
<span class="date">December 18, 2017 at 1:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-423703" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason,</p>
<p>I tried your code on Stateful LSTM for a One-Char to One-Char Mapping and the acc is surprisingly low during training (like ~30%). Is there anything wrong? However I can reach 100% by changing the batch size to 25 and switch the iteration number to a much larger one (like 3000), but I guess that’s not your purpose on this one.<br/>
Also, if we manually reset the states after each epoch, how can the model to remember things?</p>
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to atgc1984" class="comment-reply-link" href="#comment-423703" onclick='return addComment.moveForm( "comment-423703", "423703", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423725">
<div class="comment-container" id="li-comment-423725">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 3:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-423725" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend playing with the configuration and re-run examples multiple times to overcome the stochastic nature of the algorithm.</p>
<p>We want to reset memory between samples, generally. Learn more about BPTT here:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-423725" onclick='return addComment.moveForm( "comment-423725", "423725", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-425045">
<div class="comment-container" id="li-comment-425045">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b1cb5cb4b8e7778f0764cb1d1d9f9a2b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b1cb5cb4b8e7778f0764cb1d1d9f9a2b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sangwon Chae</span>
<span class="date">December 28, 2017 at 6:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-425045" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, Jason.</p>
<p>In the Keras Stateful model I want to put batch_size more than 2.</p>
<p>I want to learn a number of independent datasets in one model. To do this, batch_size must be set to the number of independent datasets.</p>
<p>But I can only think of it like this and I do not know how to put data into the model.</p>
<p>If you have a good website or example code, please share it.</p>
<p>I always appreciate fantastic posting and seeing well.</p>
<div class="reply">
<a aria-label="Reply to Sangwon Chae" class="comment-reply-link" href="#comment-425045" onclick='return addComment.moveForm( "comment-425045", "425045", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425073">
<div class="comment-container" id="li-comment-425073">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 29, 2017 at 5:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-425073" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The batch size and state reset are decoupled when you make the LSTM stateful. The batch size will only control when weights are updated.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425073" onclick='return addComment.moveForm( "comment-425073", "425073", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427985">
<div class="comment-container" id="li-comment-427985">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mazen</span>
<span class="date">January 31, 2018 at 3:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-427985" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hallo Jason,<br/>
I’m wondering whether there is a relation between sequence_length and number_units!!<br/>
I’d imagine that number_units should be greater than (or at least equal) to sequence_length in order to make LSTM able to handle a sample of length = sequence_length without losing sequential information.<br/>
For example, if we have samples, each of length = 30 (from t0 to t29), then number_units=32 can be suitable because first unit handles t0, second unit handles t1 taking the first unit’s output into account, …. and unit 30 handles the last time step t29 taking all elapsed time steps (i.e. t0 to t28) into account. Thus, if we choose hereby e.g. number_units=20, then last ten time steps (i.e. t20 to t29) will not be handled by the LSTM, and thus the model will lose sequential information this way.<br/>
Is this correct?</p>
<p>Many thanks for your help,<br/>
Best regards,<br/>
Mazen</p>
<div class="reply">
<a aria-label="Reply to Mazen" class="comment-reply-link" href="#comment-427985" onclick='return addComment.moveForm( "comment-427985", "427985", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-428022">
<div class="comment-container" id="li-comment-428022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 31, 2018 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-428022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No relation (other than vague notions of network capacity).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428022" onclick='return addComment.moveForm( "comment-428022", "428022", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-428462">
<div class="comment-container" id="li-comment-428462">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mazen</span>
<span class="date">February 5, 2018 at 8:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-428462" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you.<br/>
Ok, for compilation and running the model there exits no relation. But for having a suitable model that can handle the entire expected sequential data, should num_units &gt;= sequence_length? Because each LSTM-Unit handles a time step and thus if num_units  num_units) will not be handled and their sequential information will be lost!!<br/>
Is this understanding correct?</p>
<div class="reply">
<a aria-label="Reply to Mazen" class="comment-reply-link" href="#comment-428462" onclick='return addComment.moveForm( "comment-428462", "428462", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-428463">
<div class="comment-container" id="li-comment-428463">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mazen</span>
<span class="date">February 5, 2018 at 8:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-428463" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a correction for mistyping:<br/>
…. Because each LSTM-Unit handles a time step and thus if num_units  num_units) will not be handled and their sequential information will be lost!!<br/>
Is this understanding correct?</p>
<div class="reply">
<a aria-label="Reply to Mazen" class="comment-reply-link" href="#comment-428463" onclick='return addComment.moveForm( "comment-428463", "428463", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-428464">
<div class="comment-container" id="li-comment-428464">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/715c0d8daf0f8ab959923bbef25955d3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mazen</span>
<span class="date">February 5, 2018 at 8:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-428464" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I apologize that my comments are always somehow corrupted when I submitted them 🙁<br/>
So, what I mean is whether my understanding is accurate or not:<br/>
For example, if we have samples, each of length = 30 (from t0 to t29), then number_units=32 can be suitable because first unit handles t0, second unit handles t1 taking the first unit’s output into account, …. and unit 30 handles the last time step t29 taking all elapsed time steps (i.e. t0 to t28) into account. Thus, if we choose hereby e.g. number_units=20, then last ten time steps (i.e. t20 to t29) will not be handled by the LSTM, and thus the model will lose sequential information this way.<br/>
Is my understanding correct?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-428545">
<div class="comment-container" id="li-comment-428545">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 6, 2018 at 9:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-428545" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The number of units and sequence length are unrelated.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428545" onclick='return addComment.moveForm( "comment-428545", "428545", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-428593">
<div class="comment-container" id="li-comment-428593">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5c6e2602a54b394a1b4f82c91ca6454f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5c6e2602a54b394a1b4f82c91ca6454f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jo Kanghui</span>
<span class="date">February 6, 2018 at 7:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-428593" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi. Jason.</p>
<p>I want to know why you reshape ‘X’ and ‘x’ like above, when you use the window method.</p>
<p>I mean, When you design the simple LSTM model (one char to one char mapping) you reshape ‘dataX’ to ‘X’. And ‘X’ has an arrangement of ( len(dataX), seq_length, 1). </p>
<p>However, when you design the LSTM model using the window method, you reshape ‘X’ as an array of ( len(dataX), 1, seq_length).</p>
<p>And I wonder what is the difference between these arrays. </p>
<p>I’m sorry that I am a newbie of machine learning and even in Python. </p>
<p>So could you explain specifically ,please? Thank you.</p>
<div class="reply">
<a aria-label="Reply to Jo Kanghui" class="comment-reply-link" href="#comment-428593" onclick='return addComment.moveForm( "comment-428593", "428593", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-428645">
<div class="comment-container" id="li-comment-428645">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 7, 2018 at 9:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-428645" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post may help:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428645" onclick='return addComment.moveForm( "comment-428645", "428645", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-430158">
<div class="comment-container" id="li-comment-430158">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cbb5def8f20e924e2d60dee09609b1a8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cbb5def8f20e924e2d60dee09609b1a8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">McKracken</span>
<span class="date">February 22, 2018 at 2:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-430158" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>thanks for the tutorial. I tried your code with several other time series datasets, and I have the feeling that it working “too well”. I’m not an expert in NN, but I know ML quite well to say that there “might” be something wrong in my predictions – overfitting or similar (e.g. also on the dataset you use, the results I get are definitely better than yours, but this might depend on different versions of Keras, as well as different splitting of the data, etc…). So, I’m trying to figure out things.</p>
<p>My question is then about the stateful mode of the LSTM. Does it affect also the prediction? Or better, is the model stateful also in prediction mode?<br/>
For example, assume my test set is made of 100 time points (sequential examples), and I give them to the network one by one in the right sequence, as you do. Then, when the model predicts a value for the i-th example, is it storing or taking into account that, so far, the sequence has been of the examples from 1 to i-1? Does it preserve and use this historical information somehow for the i-th prediction?  </p>
<p>PS: sorry if this answer has been already asked. It tried to search in the thread, but it was quite long.</p>
<div class="reply">
<a aria-label="Reply to McKracken" class="comment-reply-link" href="#comment-430158" onclick='return addComment.moveForm( "comment-430158", "430158", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430204">
<div class="comment-container" id="li-comment-430204">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 22, 2018 at 11:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-430204" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>My best advice would be to test and find out whether stateful LSTMs make a difference on your dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430204" onclick='return addComment.moveForm( "comment-430204", "430204", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-433948">
<div class="comment-container" id="li-comment-433948">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9558225fd083abbfccc151053578c266?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9558225fd083abbfccc151053578c266?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rubin</span>
<span class="date">April 3, 2018 at 3:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-433948" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial. Hi Jason i got a sequence with variable input and output like ABC-&gt;DEF, AB-&gt;CDEF, C-&gt;DEFG etc. can you help me with it.</p>
<p>Thank you 🙂</p>
<div class="reply">
<a aria-label="Reply to Rubin" class="comment-reply-link" href="#comment-433948" onclick='return addComment.moveForm( "comment-433948", "433948", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-433972">
<div class="comment-container" id="li-comment-433972">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 3, 2018 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-433972" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you can use the above post as a starting point?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433972" onclick='return addComment.moveForm( "comment-433972", "433972", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-434454">
<div class="comment-container" id="li-comment-434454">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f98d65f9ac1355b786c2988e619e9834?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f98d65f9ac1355b786c2988e619e9834?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michael Du</span>
<span class="date">April 8, 2018 at 2:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-434454" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, your posts have been amazing for helping me understand LSTM. I just have a question about stateful.</p>
<p>Lets assume the following setup:<br/>
time_steps = 10<br/>
batch_size = 5</p>
<p>This means that within each batch, I have 5 samples, each with 10 rows of sequential data (for a total 50 rows).</p>
<p>I know that setting Stateful=True means that the hidden states are transferred from one batch to another, but how about within each batch?</p>
<p>According to the keras documentation, “If True, the last state for each sample at index i in a batch will be used as initial state for the sample of index i in the following batch.”</p>
<p>This sounds like the hidden state for the first sample of batch 1 gets used in the first sample of batch 2, and the hidden states for the 2nd sample of the first batch gets used in the 2nd sample of the second batch.</p>
<p>Does this mean that the hidden states don’t transfer between samples WITHIN a batch? i.e. the hidden states from the first timesteps of my batch don’t transfer to the second sample.</p>
<p>Under this assumption, it seems that my batch size should be 1 when working with time series data.</p>
<p>Thank you!</p>
<div class="reply">
<a aria-label="Reply to Michael Du" class="comment-reply-link" href="#comment-434454" onclick='return addComment.moveForm( "comment-434454", "434454", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434491">
<div class="comment-container" id="li-comment-434491">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2018 at 6:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-434491" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, it means that the state is accumulated over samples within the batch and used as the first state on the next batch.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434491" onclick='return addComment.moveForm( "comment-434491", "434491", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-437330">
<div class="comment-container" id="li-comment-437330">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a519128c40fc69b848c672ac35ea0b9b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a519128c40fc69b848c672ac35ea0b9b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rabin</span>
<span class="date">May 12, 2018 at 1:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-437330" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Actually in the “Stateful LSTM for a One-Char to One-Char Mapping” section, the network already shows signs of overfitting.</p>
<p>When you start the new seed ‘K’, the network predict the next character as ‘B’ instead of ‘L’. I haven’t tried this network myself yet, but I have the feeling that no matter what seed you feed in, it will always predict the next character as ‘B’.</p>
<p>Any way to fix this problem?</p>
<div class="reply">
<a aria-label="Reply to Rabin" class="comment-reply-link" href="#comment-437330" onclick='return addComment.moveForm( "comment-437330", "437330", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437369">
<div class="comment-container" id="li-comment-437369">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 13, 2018 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-437369" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps less training or a larger training set.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437369" onclick='return addComment.moveForm( "comment-437369", "437369", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-441432">
<div class="comment-container" id="li-comment-441432">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/61c9a761bb6dcc5bd03b7af750e8f526?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/61c9a761bb6dcc5bd03b7af750e8f526?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Min</span>
<span class="date">June 20, 2018 at 6:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-441432" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I directly copy your code for stateful LSTM to learn one-char to one-char mapping, but the code does not output the same result shown in your article. I do not understand where is the problem. The accuracy of the model is very pool.<br/>
Model Accuracy: 36.00%<br/>
A -&gt; B<br/>
B -&gt; C<br/>
C -&gt; C<br/>
C -&gt; D<br/>
D -&gt; E<br/>
E -&gt; F<br/>
F -&gt; G<br/>
G -&gt; H<br/>
H -&gt; I<br/>
I -&gt; I<br/>
I -&gt; L<br/>
L -&gt; L<br/>
L -&gt; M<br/>
M -&gt; O<br/>
O -&gt; P<br/>
P -&gt; P<br/>
P -&gt; R<br/>
R -&gt; S<br/>
S -&gt; S<br/>
S -&gt; U<br/>
U -&gt; U<br/>
U -&gt; U<br/>
U -&gt; Y<br/>
Y -&gt; Z<br/>
Z -&gt; Z<br/>
New start:  K<br/>
K -&gt; B<br/>
B -&gt; C<br/>
C -&gt; C<br/>
C -&gt; D<br/>
D -&gt; D</p>
<div class="reply">
<a aria-label="Reply to Min" class="comment-reply-link" href="#comment-441432" onclick='return addComment.moveForm( "comment-441432", "441432", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441485">
<div class="comment-container" id="li-comment-441485">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 21, 2018 at 6:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-441485" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try running the example a few times?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441485" onclick='return addComment.moveForm( "comment-441485", "441485", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-442258">
<div class="comment-container" id="li-comment-442258">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9d3a95046cdcfefec43776c0988b50dc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9d3a95046cdcfefec43776c0988b50dc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kemal</span>
<span class="date">June 28, 2018 at 7:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-442258" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>First of all thank you very much for your blogs. I benefited from the ones especially which are about LSTM very much. I appreciate your contributions very much. </p>
<p>However I have some difficulties while practicing what I have learned.</p>
<p>I try to predict device faults one day before by using alarm data. Let me summarize data in short.</p>
<p>Train data is 100*1000 array which includes only 0 and 1. Rows represent the index of the day (sequential 100 days).<br/>
Columns size is the dictionary of the alarms which means there are 1000 different kinds of alarms. And if the alarm occurs I keep it is 1 otherwise as 0.<br/>
To be more clear, if an alarm (which is the one corresponding to column index 200) occurs at day i, X[i,200] = 1</p>
<p>As Y values (labels), lets say I have an array sized as (100*50). Y values represents the device faults. There are 50 different kinds of device faults which I try to predict.<br/>
I keep the distributions of device faults per day like [0, 0, 0, 1, 0, 1, …] just like similar as train data. </p>
<p>So I want to predict device faults which occur day 101 by using the data of first 100 days alarm and device fault data.<br/>
I think it is a kind of sequence to sequence prediction. For that kinds of problem, should I use a stateful LSTM additionaly return_sequence = True? And how can I shape input and output data?<br/>
Or designing 50 different LSTM which make binary classification for each device fault is a better approach?</p>
<p>If you give me any advice, I really appreciate it.</p>
<p>Thanks in advance.</p>
<div class="reply">
<a aria-label="Reply to kemal" class="comment-reply-link" href="#comment-442258" onclick='return addComment.moveForm( "comment-442258", "442258", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442291">
<div class="comment-container" id="li-comment-442291">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 29, 2018 at 5:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-442291" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question.</p>
<p>We cannot know the best model for the problem. I recommend testing a suite of different framings and modeling methods to see what works best.</p>
<p>I would suggest trying one model over multiple models to allow the opportunity to generalize across cases.</p>
<p>If it is a time series classification problem, which it does sound like, perhaps try 1D CNNs. I have found them to be very effective.</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442291" onclick='return addComment.moveForm( "comment-442291", "442291", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-443627">
<div class="comment-container" id="li-comment-443627">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mrinal verma</span>
<span class="date">July 16, 2018 at 11:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443627" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>can someone tell what is the correct meaning for time_step in numpy.reshape(dataX, (len(dataX), 1, seq_length))</p>
<div class="reply">
<a aria-label="Reply to mrinal verma" class="comment-reply-link" href="#comment-443627" onclick='return addComment.moveForm( "comment-443627", "443627", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-443666">
<div class="comment-container" id="li-comment-443666">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 17, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443666" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One series is one sample comprised of multiple time steps where an observation is recorded at each time step.</p>
<p>Perhaps this will help:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443666" onclick='return addComment.moveForm( "comment-443666", "443666", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-443837">
<div class="comment-container" id="li-comment-443837">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mrinal verma</span>
<span class="date">July 19, 2018 at 2:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443837" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks for the reply. thanks for the great tutorial</p>
<div class="reply">
<a aria-label="Reply to mrinal verma" class="comment-reply-link" href="#comment-443837" onclick='return addComment.moveForm( "comment-443837", "443837", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-443840">
<div class="comment-container" id="li-comment-443840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29785fd5cd6ba6827c9421d563e2bbf0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mrinal verma</span>
<span class="date">July 19, 2018 at 2:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason, I implemented your code for Stateful LSTM for a One-Char to One-Char Mapping but I was not able to achieve accuracy greater than 32% can you tell me what I might be doing wrong, and also when we are training the model inside ‘for’ loop the statement “model.reset_states()” this will reset the model after the training was done for the current epoch and before the training for the next epoch is done in the ‘for’ loop, so in between this states will be reset and the current states of the LSTM will not be available for the next epoch so it will not behave as a stateful LSTM, can you tell me what I am assuming wrong</p>
<div class="reply">
<a aria-label="Reply to mrinal verma" class="comment-reply-link" href="#comment-443840" onclick='return addComment.moveForm( "comment-443840", "443840", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-443864">
<div class="comment-container" id="li-comment-443864">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 19, 2018 at 7:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-443864" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That is correct.</p>
<p>I have some suggestions here that may help:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443864" onclick='return addComment.moveForm( "comment-443864", "443864", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-454100">
<div class="comment-container" id="li-comment-454100">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6e61c2c55539061ed8a5d09760512b64?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6e61c2c55539061ed8a5d09760512b64?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://amitness.com" rel="external nofollow">Amit Chaudhary</a></span>
<span class="date">November 9, 2018 at 4:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-454100" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Simplest introduction to LSTM on the internet. Thanks a lot.</p>
<div class="reply">
<a aria-label="Reply to Amit Chaudhary" class="comment-reply-link" href="#comment-454100" onclick='return addComment.moveForm( "comment-454100", "454100", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-454117">
<div class="comment-container" id="li-comment-454117">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 9, 2018 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#comment-454117" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-454117" onclick='return addComment.moveForm( "comment-454117", "454117", "respond", "2941" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/understanding-stateful-lstm-recurrent-neural-networks-python-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="2941"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="649f1eb3e2"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="47"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-6"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning with Python</strong><br/>
No math, just tutorials and working code.
<p><a href="/deep-learning-with-python/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/05/DeepLearningWithPython-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>