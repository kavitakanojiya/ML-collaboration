<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop RNN Models for Human Activity Recognition Time Series Classification</title>
<link href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop RNN Models for Human Activity Recognition Time Series Classification" property="og:title"/>
<meta content="Human activity recognition is the problem of classifying sequences of accelerometer data recorded by specialized harnesses or smart phones into known well-defined movements. Classical approaches to the problem involve hand crafting features from the time series data based on fixed-sized windows and training machine learning models, such as ensembles of decision trees. The difficulty is …" property="og:description"/>
<meta content="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Time Series" property="article:section"/>
<meta content="2018-09-23T19:00:42+00:00" property="article:published_time"/>
<meta content="2018-12-03T03:31:44+00:00" property="article:modified_time"/>
<meta content="2018-12-03T03:31:44+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/How-to-Develop-RNN-Models-for-Human-Activity-Recognition-Time-Series-Classification.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/How-to-Develop-RNN-Models-for-Human-Activity-Recognition-Time-Series-Classification.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="427" property="og:image:height"/>
<meta content="How to Develop RNN Models for Human Activity Recognition Time Series Classification" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop RNN Models for Human Activity Recognition Time Series Classification Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=6210" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-rnn-models-for-human-activity-recognition-time-series-classification%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-rnn-models-for-human-activity-recognition-time-series-classification%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-6210 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-53"> <div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-6210 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
<header>
<h1 class="title entry-title">How to Develop RNN Models for Human Activity Recognition Time Series Classification</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-09-24T05:00:42+1100">September 24, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6210 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+RNN+Models+for+Human+Activity+Recognition+Time+Series+Classification&amp;url=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Human activity recognition is the problem of classifying sequences of accelerometer data recorded by specialized harnesses or smart phones into known well-defined movements.</p>
<p>Classical approaches to the problem involve hand crafting features from the time series data based on fixed-sized windows and training machine learning models, such as ensembles of decision trees. The difficulty is that this feature engineering requires strong expertise in the field.</p>
<p>Recently, deep learning methods such as recurrent neural networks like as LSTMs and variations that make use of one-dimensional convolutional neural networks or CNNs have been shown to provide state-of-the-art results on challenging activity recognition tasks with little or no data feature engineering, instead using feature learning on raw data.</p>
<p>In this tutorial, you will discover three recurrent neural network architectures for modeling an activity recognition time series classification problem.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a Long Short-Term Memory Recurrent Neural Network for human activity recognition.</li>
<li>How to develop a one-dimensional Convolutional Neural Network LSTM, or CNN-LSTM, model.</li>
<li>How to develop a one-dimensional Convolutional LSTM, or ConvLSTM, model for the same problem.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_6214" style="width: 650px"><img alt="How to Develop RNN Models for Human Activity Recognition Time Series Classification" class="size-full wp-image-6214" height="427" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/How-to-Develop-RNN-Models-for-Human-Activity-Recognition-Time-Series-Classification.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/How-to-Develop-RNN-Models-for-Human-Activity-Recognition-Time-Series-Classification.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/How-to-Develop-RNN-Models-for-Human-Activity-Recognition-Time-Series-Classification-300x200.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop RNN Models for Human Activity Recognition Time Series Classification<br/>Photo by <a href="https://www.flickr.com/photos/icetsarina/25033478158/">Bonnie Moreland</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into four parts; they are:</p>
<ol>
<li>Activity Recognition Using Smartphones Dataset</li>
<li>Develop an LSTM Network Model</li>
<li>Develop a CNN-LSTM Network Model</li>
<li>Develop a ConvLSTM Network Model</li>
</ol>
<h2>Activity Recognition Using Smartphones Dataset</h2>
<p><a href="https://en.wikipedia.org/wiki/Activity_recognition">Human Activity Recognition</a>, or HAR for short, is the problem of predicting what a person is doing based on a trace of their movement using sensors.</p>
<p>A standard human activity recognition dataset is the ‘Activity Recognition Using Smart Phones Dataset’ made available in 2012.</p>
<p>It was prepared and made available by Davide Anguita, et al. from the University of Genova, Italy and is described in full in their 2013 paper “<a href="https://upcommons.upc.edu/handle/2117/20897">A Public Domain Dataset for Human Activity Recognition Using Smartphones</a>.” The dataset was modeled with machine learning algorithms in their 2012 paper titled “<a href="https://link.springer.com/chapter/10.1007/978-3-642-35395-6_30">Human Activity Recognition on Smartphones using a Multiclass Hardware-Friendly Support Vector Machine</a>.”</p>
<p>The dataset was made available and can be downloaded for free from the UCI Machine Learning Repository:</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/human+activity+recognition+using+smartphones">Human Activity Recognition Using Smartphones Data Set, UCI Machine Learning Repository</a></li>
</ul>
<p>The data was collected from 30 subjects aged between 19 and 48 years old performing one of six standard activities while wearing a waist-mounted smartphone that recorded the movement data. Video was recorded of each subject performing the activities and the movement data was labeled manually from these videos.</p>
<p>Below is an example video of a subject performing the activities while their movement data is being recorded.</p>
<p><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="375" src="https://www.youtube.com/embed/XOEN9W05_4A?feature=oembed" width="500"></iframe></p>
<p>The six activities performed were as follows:</p>
<ol>
<li>Walking</li>
<li>Walking Upstairs</li>
<li>Walking Downstairs</li>
<li>Sitting</li>
<li>Standing</li>
<li>Laying</li>
</ol>
<p>The movement data recorded was the x, y, and z accelerometer data (linear acceleration) and gyroscopic data (angular velocity) from the smart phone, specifically a Samsung Galaxy S II. Observations were recorded at 50 Hz (i.e. 50 data points per second). Each subject performed the sequence of activities twice; once with the device on their left-hand-side and once with the device on their right-hand side.</p>
<p>The raw data is not available. Instead, a pre-processed version of the dataset was made available. The pre-processing steps included:</p>
<ul>
<li>Pre-processing accelerometer and gyroscope using noise filters.</li>
<li>Splitting data into fixed windows of 2.56 seconds (128 data points) with 50% overlap.Splitting of accelerometer data into gravitational (total) and body motion components.</li>
</ul>
<p>Feature engineering was applied to the window data, and a copy of the data with these engineered features was made available.</p>
<p>A number of time and frequency features commonly used in the field of human activity recognition were extracted from each window. The result was a 561 element vector of features.</p>
<p>The dataset was split into train (70%) and test (30%) sets based on data for subjects, e.g. 21 subjects for train and nine for test.</p>
<p>Experiment results with a support vector machine intended for use on a smartphone (e.g. fixed-point arithmetic) resulted in a predictive accuracy of 89% on the test dataset, achieving similar results as an unmodified SVM implementation.</p>
<p>The dataset is freely available and can be downloaded from the UCI Machine Learning repository.</p>
<p>The data is provided as a single zip file that is about 58 megabytes in size. The direct link for this download is below:</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/machine-learning-databases/00240/UCI%20HAR%20Dataset.zip">UCI HAR Dataset.zip</a></li>
</ul>
<p>Download the dataset and unzip all files into a new directory in your current working directory named “HARDataset”.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Download Your FREE Mini-Course</a><script data-config="%7B%7D" data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Develop an LSTM Network Model</h2>
<p>In this section, we will develop a Long Short-Term Memory network model (LSTM) for the human activity recognition dataset.</p>
<p>LSTM network models are a type of recurrent neural network that are able to learn and remember over long sequences of input data. They are intended for use with data that is comprised of long sequences of data, up to 200 to 400 time steps. They may be a good fit for this problem.</p>
<p>The model can support multiple parallel sequences of input data, such as each axis of the accelerometer and gyroscope data. The model learns to extract features from sequences of observations and how to map the internal features to different activity types.</p>
<p>The benefit of using LSTMs for sequence classification is that they can learn from the raw time series data directly, and in turn do not require domain expertise to manually engineer input features. The model can learn an internal representation of the time series data and ideally achieve comparable performance to models fit on a version of the dataset with engineered features.</p>
<p>This section is divided into four parts; they are:</p>
<ol>
<li>Load Data</li>
<li>Fit and Evaluate Model</li>
<li>Summarize Results</li>
<li>Complete Example</li>
</ol>
<h2>Load Data</h2>
<p>The first step is to load the raw dataset into memory.</p>
<p>There are three main signal types in the raw data: total acceleration, body acceleration, and body gyroscope. Each has 3 axises of data. This means that there are a total of nine variables for each time step.</p>
<p>Further, each series of data has been partitioned into overlapping windows of 2.56 seconds of data, or 128 time steps. These windows of data correspond to the windows of engineered features (rows) in the previous section.</p>
<p>This means that one row of data has (128 * 9), or 1,152 elements. This is a little less than double the size of the 561 element vectors in the previous section and it is likely that there is some redundant data.</p>
<p>The signals are stored in the /<em>Inertial Signals</em>/ directory under the train and test subdirectories. Each axis of each signal is stored in a separate file, meaning that each of the train and test datasets have nine input files to load and one output file to load. We can batch the loading of these files into groups given the consistent directory structures and file naming conventions.</p>
<p>The input data is in CSV format where columns are separated by whitespace. Each of these files can be loaded as a NumPy array. The <em>load_file()</em> function below loads a dataset given the fill path to the file and returns the loaded data as a NumPy array.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df87784697261" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load a single file as a numpy array
def load_file(filepath):
	dataframe = read_csv(filepath, header=None, delim_whitespace=True)
	return dataframe.values</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df87784697261-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df87784697261-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6df87784697261-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df87784697261-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df87784697261-1"><span class="crayon-p"># load a single file as a numpy array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df87784697261-2"><span class="crayon-e">def </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6df87784697261-3"><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delim_whitespace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df87784697261-4"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can then load all data for a given group (train or test) into a single three-dimensional NumPy array, where the dimensions of the array are [<em>samples, time steps, features</em>].</p>
<p>To make this clearer, there are 128 time steps and nine features, where the number of samples is the number of rows in any given raw signal data file.</p>
<p>The <em>load_group()</em> function below implements this behavior. The <a href="https://docs.scipy.org/doc/numpy-1.14.0/reference/generated/numpy.dstack.html">dstack() NumPy function</a> allows us to stack each of the loaded 3D arrays into a single 3D array where the variables are separated on the third dimension (features).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df92984424649" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load a list of files into a 3D array of [samples, timesteps, features]
def load_group(filenames, prefix=''):
	loaded = list()
	for name in filenames:
		data = load_file(prefix + name)
		loaded.append(data)
	# stack group so that features are the 3rd dimension
	loaded = dstack(loaded)
	return loaded</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df92984424649-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df92984424649-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6df92984424649-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df92984424649-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6df92984424649-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df92984424649-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6df92984424649-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df92984424649-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6df92984424649-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df92984424649-1"><span class="crayon-p"># load a list of files into a 3D array of [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df92984424649-2"><span class="crayon-e">def </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6df92984424649-3"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df92984424649-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">name </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6df92984424649-5"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df92984424649-6"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df92984424649-7"><span class="crayon-h"> </span><span class="crayon-p"># stack group so that features are the 3rd dimension</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df92984424649-8"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dstack</span><span class="crayon-sy">(</span><span class="crayon-v">loaded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df92984424649-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">loaded</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can use this function to load all input signal data for a given group, such as train or test.</p>
<p>The <em>load_dataset_group()</em> function below loads all input signal data and the output data for a single group using the consistent naming conventions between the directories.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df95274163779" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load a dataset group, such as train or test
def load_dataset_group(group, prefix=''):
	filepath = prefix + group + '/Inertial Signals/'
	# load all 9 files as a single array
	filenames = list()
	# total acceleration
	filenames += ['total_acc_x_'+group+'.txt', 'total_acc_y_'+group+'.txt', 'total_acc_z_'+group+'.txt']
	# body acceleration
	filenames += ['body_acc_x_'+group+'.txt', 'body_acc_y_'+group+'.txt', 'body_acc_z_'+group+'.txt']
	# body gyroscope
	filenames += ['body_gyro_x_'+group+'.txt', 'body_gyro_y_'+group+'.txt', 'body_gyro_z_'+group+'.txt']
	# load input data
	X = load_group(filenames, filepath)
	# load class output
	y = load_file(prefix + group + '/y_'+group+'.txt')
	return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6df95274163779-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df95274163779-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-1"><span class="crayon-p"># load a dataset group, such as train or test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-2"><span class="crayon-e">def </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-v">group</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-3"><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/Inertial Signals/'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-4"><span class="crayon-h"> </span><span class="crayon-p"># load all 9 files as a single array</span></div><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-5"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-6"><span class="crayon-h"> </span><span class="crayon-p"># total acceleration</span></div><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-7"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'total_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-8"><span class="crayon-h"> </span><span class="crayon-p"># body acceleration</span></div><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-9"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-10"><span class="crayon-h"> </span><span class="crayon-p"># body gyroscope</span></div><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-11"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_gyro_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-12"><span class="crayon-h"> </span><span class="crayon-p"># load input data</span></div><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-13"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-14"><span class="crayon-h"> </span><span class="crayon-p"># load class output</span></div><div class="crayon-line" id="crayon-5c0c9aae6df95274163779-15"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df95274163779-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Finally, we can load each of the train and test datasets.</p>
<p>The output data is defined as an integer for the class number. We must one hot encode these class integers so that the data is suitable for fitting a neural network multi-class classification model. We can do this by calling the <a href="https://keras.io/utils/#to_categorical">to_categorical() Keras function</a>.</p>
<p>The <em>load_dataset()</em> function below implements this behavior and returns the train and test X and y elements ready for fitting and evaluating the defined models.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df97308250682" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load the dataset, returns train and test X and y elements
def load_dataset(prefix=''):
	# load all train
	trainX, trainy = load_dataset_group('train', prefix + 'HARDataset/')
	print(trainX.shape, trainy.shape)
	# load all test
	testX, testy = load_dataset_group('test', prefix + 'HARDataset/')
	print(testX.shape, testy.shape)
	# zero-offset class values
	trainy = trainy - 1
	testy = testy - 1
	# one hot encode y
	trainy = to_categorical(trainy)
	testy = to_categorical(testy)
	print(trainX.shape, trainy.shape, testX.shape, testy.shape)
	return trainX, trainy, testX, testy</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6df97308250682-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df97308250682-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-1"><span class="crayon-p"># load the dataset, returns train and test X and y elements</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-2"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-3"><span class="crayon-h"> </span><span class="crayon-p"># load all train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-4"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'train'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-5"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-6"><span class="crayon-h"> </span><span class="crayon-p"># load all test</span></div><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-7"><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'test'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-8"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-9"><span class="crayon-h"> </span><span class="crayon-p"># zero-offset class values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-10"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-11"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-12"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode y</span></div><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-13"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">trainy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-14"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df97308250682-15"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df97308250682-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<h3>Fit and Evaluate Model</h3>
<p>Now that we have the data loaded into memory ready for modeling, we can define, fit, and evaluate an LSTM model.</p>
<p>We can define a function named <em>evaluate_model()</em> that takes the train and test dataset, fits a model on the training dataset, evaluates it on the test dataset, and returns an estimate of the model’s performance.</p>
<p>First, we must define the LSTM model using the Keras deep learning library. The model requires a three-dimensional input with [<em>samples, time steps, features</em>].</p>
<p>This is exactly how we have loaded the data, where one sample is one window of the time series data, each window has 128 time steps, and a time step has nine variables or features.</p>
<p>The output for the model will be a six-element vector containing the probability of a given window belonging to each of the six activity types.</p>
<p>Thees input and output dimensions are required when fitting the model, and we can extract them from the provided training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df98488211844" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_timesteps, n_features, n_outputs = trainX.shape[1], trainX.shape[2], trainy.shape[1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df98488211844-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df98488211844-1"><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The model is defined as a Sequential Keras model, for simplicity.</p>
<p>We will define the model as having a single LSTM hidden layer. This is followed by a dropout layer intended to reduce overfitting of the model to the training data. Finally, a dense fully connected layer is used to interpret the features extracted by the LSTM hidden layer, before a final output layer is used to make predictions.</p>
<p>The efficient <a href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/">Adam version of stochastic gradient descent</a> will be used to optimize the network, and the categorical cross entropy loss function will be used given that we are learning a multi-class classification problem.</p>
<p>The definition of the model is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df9a120009696" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = Sequential()
model.add(LSTM(100, input_shape=(n_timesteps,n_features)))
model.add(Dropout(0.5))
model.add(Dense(100, activation='relu'))
model.add(Dense(n_outputs, activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df9a120009696-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9a120009696-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9a120009696-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9a120009696-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9a120009696-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9a120009696-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df9a120009696-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9a120009696-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9a120009696-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9a120009696-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9a120009696-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9a120009696-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The model is fit for a fixed number of epochs, in this case 15, and a batch size of 64 samples will be used, where 64 windows of data will be exposed to the model before the weights of the model are updated.</p>
<p>Once the model is fit, it is evaluated on the test dataset and the accuracy of the fit model on the test dataset is returned.</p>
<p>Note, it is common to not shuffle sequence data when fitting an LSTM. Here we do shuffle the windows of input data during training (the default). In this problem, we are interested in harnessing the LSTMs ability to learn and extract features across the time steps in a window, not across windows.</p>
<p>The complete <em>evaluate_model()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df9c337452586" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit and evaluate a model
def evaluate_model(trainX, trainy, testX, testy):
	verbose, epochs, batch_size = 0, 15, 64
	n_timesteps, n_features, n_outputs = trainX.shape[1], trainX.shape[2], trainy.shape[1]
	model = Sequential()
	model.add(LSTM(100, input_shape=(n_timesteps,n_features)))
	model.add(Dropout(0.5))
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs, activation='softmax'))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
	# fit network
	model.fit(trainX, trainy, epochs=epochs, batch_size=batch_size, verbose=verbose)
	# evaluate model
	_, accuracy = model.evaluate(testX, testy, batch_size=batch_size, verbose=0)
	return accuracy</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9c337452586-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9c337452586-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9c337452586-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9c337452586-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9c337452586-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9c337452586-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9c337452586-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9c337452586-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-1"><span class="crayon-p"># fit and evaluate a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9c337452586-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-3"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9c337452586-4"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9c337452586-6"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9c337452586-8"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-9"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9c337452586-10"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-11"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9c337452586-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-13"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9c337452586-14"><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9c337452586-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>There is nothing special about the network structure or chosen hyperparameters, they are just a starting point for this problem.</p>
<h3>Summarize Results</h3>
<p>We cannot judge the skill of the model from a single evaluation.</p>
<p>The reason for this is that neural networks are stochastic, meaning that a different specific model will result when training the same model configuration on the same data.</p>
<p>This is a feature of the network in that it gives the model its adaptive ability, but requires a slightly more complicated evaluation of the model.</p>
<p>We will repeat the evaluation of the model multiple times, then summarize the performance of the model across each of those runs. For example, we can call <em>evaluate_model()</em> a total of 10 times. This will result in a population of model evaluation scores that must be summarized.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6df9e820307150" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# repeat experiment
scores = list()
for r in range(repeats):
	score = evaluate_model(trainX, trainy, testX, testy)
	score = score * 100.0
	print('&gt;#%d: %.3f' % (r+1, score))
	scores.append(score)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6df9e820307150-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9e820307150-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9e820307150-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9e820307150-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9e820307150-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6df9e820307150-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6df9e820307150-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6df9e820307150-1"><span class="crayon-p"># repeat experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9e820307150-2"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9e820307150-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9e820307150-4"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9e820307150-5"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">score *</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6df9e820307150-6"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;#%d: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6df9e820307150-7"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">score</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can summarize the sample of scores by calculating and reporting the mean and standard deviation of the performance. The mean gives the average accuracy of the model on the dataset, whereas the standard deviation gives the average variance of the accuracy from the mean.</p>
<p>The function <em>summarize_results()</em> below summarizes the results of a run.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfa0551601872" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize scores
def summarize_results(scores):
	print(scores)
	m, s = mean(scores), std(scores)
	print('Accuracy: %.3f%% (+/-%.3f)' % (m, s))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfa0551601872-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa0551601872-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa0551601872-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa0551601872-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa0551601872-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfa0551601872-1"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa0551601872-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa0551601872-3"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa0551601872-4"><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa0551601872-5"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.3f%% (+/-%.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can bundle up the repeated evaluation, gathering of results, and summarization of results into a main function for the experiment, called <em>run_experiment()</em>, listed below.</p>
<p>By default, the model is evaluated 10 times before the performance of the model is reported.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfa2676531402" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# run an experiment
def run_experiment(repeats=10):
	# load data
	trainX, trainy, testX, testy = load_dataset()
	# repeat experiment
	scores = list()
	for r in range(repeats):
		score = evaluate_model(trainX, trainy, testX, testy)
		score = score * 100.0
		print('&gt;#%d: %.3f' % (r+1, score))
		scores.append(score)
	# summarize results
	summarize_results(scores)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfa2676531402-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa2676531402-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa2676531402-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa2676531402-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa2676531402-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa2676531402-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa2676531402-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa2676531402-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa2676531402-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa2676531402-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa2676531402-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa2676531402-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa2676531402-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfa2676531402-1"><span class="crayon-p"># run an experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa2676531402-2"><span class="crayon-e">def </span><span class="crayon-e">run_experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa2676531402-3"><span class="crayon-h"> </span><span class="crayon-p"># load data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa2676531402-4"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa2676531402-5"><span class="crayon-h"> </span><span class="crayon-p"># repeat experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa2676531402-6"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa2676531402-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa2676531402-8"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa2676531402-9"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">score *</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa2676531402-10"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;#%d: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa2676531402-11"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">score</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa2676531402-12"><span class="crayon-h"> </span><span class="crayon-p"># summarize results</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa2676531402-13"><span class="crayon-h"> </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>Now that we have all of the pieces, we can tie them together into a worked example.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfa4228740163" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# lstm model
from numpy import mean
from numpy import std
from numpy import dstack
from pandas import read_csv
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Dropout
from keras.layers import LSTM
from keras.utils import to_categorical
from matplotlib import pyplot

# load a single file as a numpy array
def load_file(filepath):
	dataframe = read_csv(filepath, header=None, delim_whitespace=True)
	return dataframe.values

# load a list of files and return as a 3d numpy array
def load_group(filenames, prefix=''):
	loaded = list()
	for name in filenames:
		data = load_file(prefix + name)
		loaded.append(data)
	# stack group so that features are the 3rd dimension
	loaded = dstack(loaded)
	return loaded

# load a dataset group, such as train or test
def load_dataset_group(group, prefix=''):
	filepath = prefix + group + '/Inertial Signals/'
	# load all 9 files as a single array
	filenames = list()
	# total acceleration
	filenames += ['total_acc_x_'+group+'.txt', 'total_acc_y_'+group+'.txt', 'total_acc_z_'+group+'.txt']
	# body acceleration
	filenames += ['body_acc_x_'+group+'.txt', 'body_acc_y_'+group+'.txt', 'body_acc_z_'+group+'.txt']
	# body gyroscope
	filenames += ['body_gyro_x_'+group+'.txt', 'body_gyro_y_'+group+'.txt', 'body_gyro_z_'+group+'.txt']
	# load input data
	X = load_group(filenames, filepath)
	# load class output
	y = load_file(prefix + group + '/y_'+group+'.txt')
	return X, y

# load the dataset, returns train and test X and y elements
def load_dataset(prefix=''):
	# load all train
	trainX, trainy = load_dataset_group('train', prefix + 'HARDataset/')
	print(trainX.shape, trainy.shape)
	# load all test
	testX, testy = load_dataset_group('test', prefix + 'HARDataset/')
	print(testX.shape, testy.shape)
	# zero-offset class values
	trainy = trainy - 1
	testy = testy - 1
	# one hot encode y
	trainy = to_categorical(trainy)
	testy = to_categorical(testy)
	print(trainX.shape, trainy.shape, testX.shape, testy.shape)
	return trainX, trainy, testX, testy

# fit and evaluate a model
def evaluate_model(trainX, trainy, testX, testy):
	verbose, epochs, batch_size = 0, 15, 64
	n_timesteps, n_features, n_outputs = trainX.shape[1], trainX.shape[2], trainy.shape[1]
	model = Sequential()
	model.add(LSTM(100, input_shape=(n_timesteps,n_features)))
	model.add(Dropout(0.5))
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs, activation='softmax'))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
	# fit network
	model.fit(trainX, trainy, epochs=epochs, batch_size=batch_size, verbose=verbose)
	# evaluate model
	_, accuracy = model.evaluate(testX, testy, batch_size=batch_size, verbose=0)
	return accuracy

# summarize scores
def summarize_results(scores):
	print(scores)
	m, s = mean(scores), std(scores)
	print('Accuracy: %.3f%% (+/-%.3f)' % (m, s))

# run an experiment
def run_experiment(repeats=10):
	# load data
	trainX, trainy, testX, testy = load_dataset()
	# repeat experiment
	scores = list()
	for r in range(repeats):
		score = evaluate_model(trainX, trainy, testX, testy)
		score = score * 100.0
		print('&gt;#%d: %.3f' % (r+1, score))
		scores.append(score)
	# summarize results
	summarize_results(scores)

# run the experiment
run_experiment()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-16">16</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-18">18</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-20">20</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-22">22</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-24">24</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-26">26</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-28">28</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-30">30</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-32">32</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-34">34</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-36">36</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-38">38</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-40">40</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-42">42</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-44">44</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-46">46</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-48">48</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-50">50</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-52">52</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-54">54</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-56">56</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-58">58</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-60">60</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-62">62</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-64">64</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-66">66</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-68">68</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-70">70</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-72">72</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-74">74</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-76">76</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-78">78</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-80">80</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-82">82</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-84">84</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-86">86</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-88">88</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-90">90</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-92">92</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-94">94</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-96">96</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-98">98</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa4228740163-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa4228740163-100">100</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-1"><span class="crayon-p"># lstm model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">dstack</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-12"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-14"><span class="crayon-p"># load a single file as a numpy array</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-15"><span class="crayon-e">def </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-16"><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delim_whitespace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-18"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-19"><span class="crayon-p"># load a list of files and return as a 3d numpy array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-20"><span class="crayon-e">def </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-21"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-22"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">name </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-23"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-24"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-25"><span class="crayon-h"> </span><span class="crayon-p"># stack group so that features are the 3rd dimension</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-26"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dstack</span><span class="crayon-sy">(</span><span class="crayon-v">loaded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">loaded</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-28"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-29"><span class="crayon-p"># load a dataset group, such as train or test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-30"><span class="crayon-e">def </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-v">group</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-31"><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/Inertial Signals/'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-32"><span class="crayon-h"> </span><span class="crayon-p"># load all 9 files as a single array</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-33"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-34"><span class="crayon-h"> </span><span class="crayon-p"># total acceleration</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-35"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'total_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-36"><span class="crayon-h"> </span><span class="crayon-p"># body acceleration</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-37"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-38"><span class="crayon-h"> </span><span class="crayon-p"># body gyroscope</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-39"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_gyro_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-40"><span class="crayon-h"> </span><span class="crayon-p"># load input data</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-41"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-42"><span class="crayon-h"> </span><span class="crayon-p"># load class output</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-43"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-44"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-45"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-46"><span class="crayon-p"># load the dataset, returns train and test X and y elements</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-47"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-48"><span class="crayon-h"> </span><span class="crayon-p"># load all train</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-49"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'train'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-50"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-51"><span class="crayon-h"> </span><span class="crayon-p"># load all test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-52"><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'test'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-53"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-54"><span class="crayon-h"> </span><span class="crayon-p"># zero-offset class values</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-55"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-56"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-57"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-58"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">trainy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-59"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-60"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-61"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-62"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-63"><span class="crayon-p"># fit and evaluate a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-64"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-65"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-66"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-67"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-68"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-69"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-70"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-71"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-72"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-73"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-74"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-75"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-76"><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-77"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-78"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-79"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-80"><span class="crayon-e">def </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-81"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-82"><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-83"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.3f%% (+/-%.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-84"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-85"><span class="crayon-p"># run an experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-86"><span class="crayon-e">def </span><span class="crayon-e">run_experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-87"><span class="crayon-h"> </span><span class="crayon-p"># load data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-88"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-89"><span class="crayon-h"> </span><span class="crayon-p"># repeat experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-90"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-91"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-92"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-93"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">score *</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-94"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;#%d: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-95"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">score</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-96"><span class="crayon-h"> </span><span class="crayon-p"># summarize results</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-97"><span class="crayon-h"> </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-98"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfa4228740163-99"><span class="crayon-p"># run the experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa4228740163-100"><span class="crayon-e">run_experiment</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0051 seconds] -->
<p>Running the example first prints the shape of the loaded dataset, then the shape of the train and test sets and the input and output elements. This confirms the number of samples, time steps, and variables, as well as the number of classes.</p>
<p>Next, models are created and evaluated and a debug message is printed for each.</p>
<p>Finally, the sample of scores is printed, followed by the mean and standard deviation. We can see that the model performed well, achieving a classification accuracy of about 89.7% trained on the raw dataset, with a standard deviation of about 1.3.</p>
<p>This is a good result, considering that the original paper published a result of 89%, trained on the dataset with heavy domain-specific feature engineering, not the raw dataset.</p>
<p>Note: given the stochastic nature of the algorithm, your specific results may vary. If so, try running the code a few times.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfa6203086853" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(7352, 128, 9) (7352, 1)
(2947, 128, 9) (2947, 1)
(7352, 128, 9) (7352, 6) (2947, 128, 9) (2947, 6)

&gt;#1: 90.058
&gt;#2: 85.918
&gt;#3: 90.974
&gt;#4: 89.515
&gt;#5: 90.159
&gt;#6: 91.110
&gt;#7: 89.718
&gt;#8: 90.295
&gt;#9: 89.447
&gt;#10: 90.024

[90.05768578215134, 85.91788259246692, 90.97387173396675, 89.51476077366813, 90.15948422124194, 91.10960298608755, 89.71835765184933, 90.29521547336275, 89.44689514760775, 90.02375296912113]

Accuracy: 89.722% (+/-1.371)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-16">16</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa6203086853-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa6203086853-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-1">(7352, 128, 9) (7352, 1)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-2">(2947, 128, 9) (2947, 1)</div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-3">(7352, 128, 9) (7352, 6) (2947, 128, 9) (2947, 6)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-4"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-5">&gt;#1: 90.058</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-6">&gt;#2: 85.918</div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-7">&gt;#3: 90.974</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-8">&gt;#4: 89.515</div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-9">&gt;#5: 90.159</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-10">&gt;#6: 91.110</div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-11">&gt;#7: 89.718</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-12">&gt;#8: 90.295</div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-13">&gt;#9: 89.447</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-14">&gt;#10: 90.024</div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-16">[90.05768578215134, 85.91788259246692, 90.97387173396675, 89.51476077366813, 90.15948422124194, 91.10960298608755, 89.71835765184933, 90.29521547336275, 89.44689514760775, 90.02375296912113]</div><div class="crayon-line" id="crayon-5c0c9aae6dfa6203086853-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa6203086853-18">Accuracy: 89.722% (+/-1.371)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Now that we have seen how to develop an LSTM model for time series classification, let’s look at how we can develop a more sophisticated CNN LSTM model.</p>
<h2>Develop a CNN-LSTM Network Model</h2>
<p>The CNN LSTM architecture involves using Convolutional Neural Network (CNN) layers for feature extraction on input data combined with LSTMs to support sequence prediction.</p>
<p>CNN LSTMs were developed for visual time series prediction problems and the application of generating textual descriptions from sequences of images (e.g. videos). Specifically, the problems of:</p>
<ul>
<li><strong>Activity Recognition</strong>: Generating a textual description of an activity demonstrated in a sequence of images.</li>
<li><strong>Image Description</strong>: Generating a textual description of a single image.</li>
<li><strong>Video Description</strong>: Generating a textual description of a sequence of images.</li>
</ul>
<p>You can learn more about the CNN LSTM architecture in the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/">CNN Long Short-Term Memory Networks</a></li>
</ul>
<p>To learn more about the consequences of combining these models, see the paper:</p>
<ul>
<li><a href="https://ieeexplore.ieee.org/document/7178838/">Convolutional, Long Short-Term Memory, fully connected Deep Neural Networks</a>, 2015.</li>
</ul>
<p>The CNN LSTM model will read subsequences of the main sequence in as blocks, extract features from each block, then allow the LSTM to interpret the features extracted from each block.</p>
<p>One approach to implementing this model is to split each window of 128 time steps into subsequences for the CNN model to process. For example, the 128 time steps in each window can be split into four subsequences of 32 time steps.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfa8446261035" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape data into time steps of sub-sequences
n_steps, n_length = 4, 32
trainX = trainX.reshape((trainX.shape[0], n_steps, n_length, n_features))
testX = testX.reshape((testX.shape[0], n_steps, n_length, n_features))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfa8446261035-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa8446261035-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfa8446261035-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfa8446261035-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfa8446261035-1"><span class="crayon-p"># reshape data into time steps of sub-sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa8446261035-2"><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">32</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfa8446261035-3"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfa8446261035-4"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can then define a CNN model that expects to read in sequences with a length of 32 time steps and nine features.</p>
<p>The entire CNN model can be wrapped in a <a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/">TimeDistributed</a> layer to allow the same CNN model to read in each of the four subsequences in the window. The extracted features are then flattened and provided to the LSTM model to read, extracting its own features before a final mapping to an activity is made.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfaa458755918" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(TimeDistributed(Conv1D(filters=64, kernel_size=3, activation='relu'), input_shape=(None,n_length,n_features)))
model.add(TimeDistributed(Conv1D(filters=64, kernel_size=3, activation='relu')))
model.add(TimeDistributed(Dropout(0.5)))
model.add(TimeDistributed(MaxPooling1D(pool_size=2)))
model.add(TimeDistributed(Flatten()))
model.add(LSTM(100))
model.add(Dropout(0.5))
model.add(Dense(100, activation='relu'))
model.add(Dense(n_outputs, activation='softmax'))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfaa458755918-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaa458755918-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaa458755918-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaa458755918-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaa458755918-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaa458755918-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaa458755918-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaa458755918-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaa458755918-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaa458755918-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaa458755918-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfaa458755918-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaa458755918-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfaa458755918-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaa458755918-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfaa458755918-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaa458755918-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfaa458755918-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaa458755918-8"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfaa458755918-9"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaa458755918-10"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfaa458755918-11"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>It is common to use two consecutive CNN layers followed by dropout and a max pooling layer, and that is the simple structure used in the CNN LSTM model here.</p>
<p>The updated <em>evaluate_model()</em> is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfac409875021" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit and evaluate a model
def evaluate_model(trainX, trainy, testX, testy):
	# define model
	verbose, epochs, batch_size = 0, 25, 64
	n_timesteps, n_features, n_outputs = trainX.shape[1], trainX.shape[2], trainy.shape[1]
	# reshape data into time steps of sub-sequences
	n_steps, n_length = 4, 32
	trainX = trainX.reshape((trainX.shape[0], n_steps, n_length, n_features))
	testX = testX.reshape((testX.shape[0], n_steps, n_length, n_features))
	# define model
	model = Sequential()
	model.add(TimeDistributed(Conv1D(filters=64, kernel_size=3, activation='relu'), input_shape=(None,n_length,n_features)))
	model.add(TimeDistributed(Conv1D(filters=64, kernel_size=3, activation='relu')))
	model.add(TimeDistributed(Dropout(0.5)))
	model.add(TimeDistributed(MaxPooling1D(pool_size=2)))
	model.add(TimeDistributed(Flatten()))
	model.add(LSTM(100))
	model.add(Dropout(0.5))
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs, activation='softmax'))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
	# fit network
	model.fit(trainX, trainy, epochs=epochs, batch_size=batch_size, verbose=verbose)
	# evaluate model
	_, accuracy = model.evaluate(testX, testy, batch_size=batch_size, verbose=0)
	return accuracy</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-16">16</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-18">18</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-20">20</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-22">22</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-24">24</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfac409875021-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfac409875021-26">26</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-1"><span class="crayon-p"># fit and evaluate a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-3"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-4"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-5"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-6"><span class="crayon-h"> </span><span class="crayon-p"># reshape data into time steps of sub-sequences</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-7"><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">32</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-8"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-9"><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-10"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-11"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-17"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-19"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-20"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-21"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-22"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-23"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-24"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfac409875021-25"><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfac409875021-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>We can evaluate this model as we did the straight LSTM model in the previous section.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfad715898494" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# cnn lstm model
from numpy import mean
from numpy import std
from numpy import dstack
from pandas import read_csv
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Dropout
from keras.layers import LSTM
from keras.layers import TimeDistributed
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D
from keras.utils import to_categorical
from matplotlib import pyplot

# load a single file as a numpy array
def load_file(filepath):
	dataframe = read_csv(filepath, header=None, delim_whitespace=True)
	return dataframe.values

# load a list of files and return as a 3d numpy array
def load_group(filenames, prefix=''):
	loaded = list()
	for name in filenames:
		data = load_file(prefix + name)
		loaded.append(data)
	# stack group so that features are the 3rd dimension
	loaded = dstack(loaded)
	return loaded

# load a dataset group, such as train or test
def load_dataset_group(group, prefix=''):
	filepath = prefix + group + '/Inertial Signals/'
	# load all 9 files as a single array
	filenames = list()
	# total acceleration
	filenames += ['total_acc_x_'+group+'.txt', 'total_acc_y_'+group+'.txt', 'total_acc_z_'+group+'.txt']
	# body acceleration
	filenames += ['body_acc_x_'+group+'.txt', 'body_acc_y_'+group+'.txt', 'body_acc_z_'+group+'.txt']
	# body gyroscope
	filenames += ['body_gyro_x_'+group+'.txt', 'body_gyro_y_'+group+'.txt', 'body_gyro_z_'+group+'.txt']
	# load input data
	X = load_group(filenames, filepath)
	# load class output
	y = load_file(prefix + group + '/y_'+group+'.txt')
	return X, y

# load the dataset, returns train and test X and y elements
def load_dataset(prefix=''):
	# load all train
	trainX, trainy = load_dataset_group('train', prefix + 'HARDataset/')
	print(trainX.shape, trainy.shape)
	# load all test
	testX, testy = load_dataset_group('test', prefix + 'HARDataset/')
	print(testX.shape, testy.shape)
	# zero-offset class values
	trainy = trainy - 1
	testy = testy - 1
	# one hot encode y
	trainy = to_categorical(trainy)
	testy = to_categorical(testy)
	print(trainX.shape, trainy.shape, testX.shape, testy.shape)
	return trainX, trainy, testX, testy

# fit and evaluate a model
def evaluate_model(trainX, trainy, testX, testy):
	# define model
	verbose, epochs, batch_size = 0, 25, 64
	n_timesteps, n_features, n_outputs = trainX.shape[1], trainX.shape[2], trainy.shape[1]
	# reshape data into time steps of sub-sequences
	n_steps, n_length = 4, 32
	trainX = trainX.reshape((trainX.shape[0], n_steps, n_length, n_features))
	testX = testX.reshape((testX.shape[0], n_steps, n_length, n_features))
	# define model
	model = Sequential()
	model.add(TimeDistributed(Conv1D(filters=64, kernel_size=3, activation='relu'), input_shape=(None,n_length,n_features)))
	model.add(TimeDistributed(Conv1D(filters=64, kernel_size=3, activation='relu')))
	model.add(TimeDistributed(Dropout(0.5)))
	model.add(TimeDistributed(MaxPooling1D(pool_size=2)))
	model.add(TimeDistributed(Flatten()))
	model.add(LSTM(100))
	model.add(Dropout(0.5))
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs, activation='softmax'))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
	# fit network
	model.fit(trainX, trainy, epochs=epochs, batch_size=batch_size, verbose=verbose)
	# evaluate model
	_, accuracy = model.evaluate(testX, testy, batch_size=batch_size, verbose=0)
	return accuracy

# summarize scores
def summarize_results(scores):
	print(scores)
	m, s = mean(scores), std(scores)
	print('Accuracy: %.3f%% (+/-%.3f)' % (m, s))

# run an experiment
def run_experiment(repeats=10):
	# load data
	trainX, trainy, testX, testy = load_dataset()
	# repeat experiment
	scores = list()
	for r in range(repeats):
		score = evaluate_model(trainX, trainy, testX, testy)
		score = score * 100.0
		print('&gt;#%d: %.3f' % (r+1, score))
		scores.append(score)
	# summarize results
	summarize_results(scores)

# run the experiment
run_experiment()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-16">16</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-18">18</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-20">20</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-22">22</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-24">24</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-26">26</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-28">28</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-30">30</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-32">32</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-34">34</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-36">36</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-38">38</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-40">40</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-42">42</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-44">44</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-46">46</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-48">48</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-50">50</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-52">52</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-54">54</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-56">56</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-58">58</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-60">60</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-62">62</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-64">64</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-66">66</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-68">68</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-70">70</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-72">72</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-74">74</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-76">76</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-78">78</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-80">80</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-82">82</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-84">84</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-86">86</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-88">88</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-90">90</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-92">92</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-94">94</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-96">96</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-98">98</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-100">100</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-102">102</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-104">104</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-106">106</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-108">108</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-110">110</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-112">112</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfad715898494-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfad715898494-114">114</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-1"><span class="crayon-p"># cnn lstm model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">dstack</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-14"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-15"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-16"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-17"><span class="crayon-p"># load a single file as a numpy array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-18"><span class="crayon-e">def </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-19"><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delim_whitespace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-22"><span class="crayon-p"># load a list of files and return as a 3d numpy array</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-23"><span class="crayon-e">def </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-24"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-25"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">name </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-26"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-27"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-28"><span class="crayon-h"> </span><span class="crayon-p"># stack group so that features are the 3rd dimension</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-29"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dstack</span><span class="crayon-sy">(</span><span class="crayon-v">loaded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">loaded</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-32"><span class="crayon-p"># load a dataset group, such as train or test</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-33"><span class="crayon-e">def </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-v">group</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-34"><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/Inertial Signals/'</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-35"><span class="crayon-h"> </span><span class="crayon-p"># load all 9 files as a single array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-36"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-37"><span class="crayon-h"> </span><span class="crayon-p"># total acceleration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-38"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'total_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-39"><span class="crayon-h"> </span><span class="crayon-p"># body acceleration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-40"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-41"><span class="crayon-h"> </span><span class="crayon-p"># body gyroscope</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-42"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_gyro_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-43"><span class="crayon-h"> </span><span class="crayon-p"># load input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-44"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-45"><span class="crayon-h"> </span><span class="crayon-p"># load class output</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-46"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-47"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-48"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-49"><span class="crayon-p"># load the dataset, returns train and test X and y elements</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-50"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-51"><span class="crayon-h"> </span><span class="crayon-p"># load all train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-52"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'train'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-53"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-54"><span class="crayon-h"> </span><span class="crayon-p"># load all test</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-55"><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'test'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-56"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-57"><span class="crayon-h"> </span><span class="crayon-p"># zero-offset class values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-58"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-59"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-60"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode y</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-61"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">trainy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-62"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-63"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-64"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-65"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-66"><span class="crayon-p"># fit and evaluate a model</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-67"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-68"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-69"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-70"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-71"><span class="crayon-h"> </span><span class="crayon-p"># reshape data into time steps of sub-sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-72"><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">32</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-73"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-74"><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-75"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-76"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-77"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-78"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-79"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-80"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-81"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-82"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-83"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-84"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-85"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-86"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-87"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-88"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-89"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-90"><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-91"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-92"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-93"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-94"><span class="crayon-e">def </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-95"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-96"><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-97"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.3f%% (+/-%.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-98"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-99"><span class="crayon-p"># run an experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-100"><span class="crayon-e">def </span><span class="crayon-e">run_experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-101"><span class="crayon-h"> </span><span class="crayon-p"># load data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-102"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-103"><span class="crayon-h"> </span><span class="crayon-p"># repeat experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-104"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-105"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-106"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-107"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">score *</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-108"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;#%d: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-109"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">score</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-110"><span class="crayon-h"> </span><span class="crayon-p"># summarize results</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-111"><span class="crayon-h"> </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-112"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfad715898494-113"><span class="crayon-p"># run the experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfad715898494-114"><span class="crayon-e">run_experiment</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0062 seconds] -->
<p>Running the example summarizes the model performance for each of the 10 runs before a final summary of the models performance on the test set is reported.</p>
<p>We can see that the model achieved a performance of about 90.6% with a standard deviation of about 1%.</p>
<p>Note: given the stochastic nature of the algorithm, your specific results may vary. If so, try running the code a few times.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfaf530970651" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
&gt;#1: 91.517
&gt;#2: 91.042
&gt;#3: 90.804
&gt;#4: 92.263
&gt;#5: 89.684
&gt;#6: 88.666
&gt;#7: 91.381
&gt;#8: 90.804
&gt;#9: 89.379
&gt;#10: 91.347

[91.51679674244994, 91.04173736002714, 90.80420766881574, 92.26331862911435, 89.68442483881914, 88.66644044791313, 91.38106549032915, 90.80420766881574, 89.37902952154734, 91.34713267729894]

Accuracy: 90.689% (+/-1.051)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfaf530970651-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaf530970651-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaf530970651-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaf530970651-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaf530970651-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaf530970651-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaf530970651-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaf530970651-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaf530970651-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaf530970651-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaf530970651-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaf530970651-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfaf530970651-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfaf530970651-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfaf530970651-1">&gt;#1: 91.517</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaf530970651-2">&gt;#2: 91.042</div><div class="crayon-line" id="crayon-5c0c9aae6dfaf530970651-3">&gt;#3: 90.804</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaf530970651-4">&gt;#4: 92.263</div><div class="crayon-line" id="crayon-5c0c9aae6dfaf530970651-5">&gt;#5: 89.684</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaf530970651-6">&gt;#6: 88.666</div><div class="crayon-line" id="crayon-5c0c9aae6dfaf530970651-7">&gt;#7: 91.381</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaf530970651-8">&gt;#8: 90.804</div><div class="crayon-line" id="crayon-5c0c9aae6dfaf530970651-9">&gt;#9: 89.379</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaf530970651-10">&gt;#10: 91.347</div><div class="crayon-line" id="crayon-5c0c9aae6dfaf530970651-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaf530970651-12">[91.51679674244994, 91.04173736002714, 90.80420766881574, 92.26331862911435, 89.68442483881914, 88.66644044791313, 91.38106549032915, 90.80420766881574, 89.37902952154734, 91.34713267729894]</div><div class="crayon-line" id="crayon-5c0c9aae6dfaf530970651-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfaf530970651-14">Accuracy: 90.689% (+/-1.051)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Develop a ConvLSTM Network Model</h2>
<p>A further extension of the CNN LSTM idea is to perform the convolutions of the CNN (e.g. how the CNN reads the input sequence data) as part of the LSTM.</p>
<p>This combination is called a Convolutional LSTM, or ConvLSTM for short, and like the CNN LSTM is also used for spatio-temporal data.</p>
<p>Unlike an LSTM that reads the data in directly in order to calculate internal state and state transitions, and unlike the CNN LSTM that is interpreting the output from CNN models, the ConvLSTM is using convolutions directly as part of reading input into the LSTM units themselves.</p>
<p>For more information for how the equations for the ConvLSTM are calculated within the LSTM unit, see the paper:</p>
<ul>
<li><a href="https://arxiv.org/abs/1506.04214v1">Convolutional LSTM Network: A Machine Learning Approach for Precipitation Nowcasting</a>, 2015.</li>
</ul>
<p>The Keras library provides the <a href="https://keras.io/layers/recurrent/#convlstm2d">ConvLSTM2D class</a> that supports the ConvLSTM model for 2D data. It can be configured for 1D multivariate time series classification.</p>
<p>The ConvLSTM2D class, by default, expects input data to have the shape:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfb2442502878" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(samples, time, rows, cols, channels)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfb2442502878-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfb2442502878-1">(samples, time, rows, cols, channels)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Where each time step of data is defined as an image of (rows * columns) data points.</p>
<p>In the previous section, we divided a given window of data (128 time steps) into four subsequences of 32 time steps. We can use this same subsequence approach in defining the ConvLSTM2D input where the number of time steps is the number of subsequences in the window, the number of rows is 1 as we are working with one-dimensional data, and the number of columns represents the number of time steps in the subsequence, in this case 32.</p>
<p>For this chosen framing of the problem, the input for the ConvLSTM2D would therefore be:</p>
<ul>
<li><strong>Samples</strong>: n, for the number of windows in the dataset.</li>
<li><strong>Time</strong>: 4, for the four subsequences that we split a window of 128 time steps into.</li>
<li><strong>Rows</strong>: 1, for the one-dimensional shape of each subsequence.</li>
<li><strong>Columns</strong>: 32, for the 32 time steps in an input subsequence.</li>
<li><strong>Channels</strong>: 9, for the nine input variables.</li>
</ul>
<p>We can now prepare the data for the ConvLSTM2D model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfb4184472642" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_timesteps, n_features, n_outputs = trainX.shape[1], trainX.shape[2], trainy.shape[1]
# reshape into subsequences (samples, time steps, rows, cols, channels)
n_steps, n_length = 4, 32
trainX = trainX.reshape((trainX.shape[0], n_steps, 1, n_length, n_features))
testX = testX.reshape((testX.shape[0], n_steps, 1, n_length, n_features))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfb4184472642-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb4184472642-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb4184472642-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb4184472642-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb4184472642-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfb4184472642-1"><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb4184472642-2"><span class="crayon-p"># reshape into subsequences (samples, time steps, rows, cols, channels)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb4184472642-3"><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">32</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb4184472642-4"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb4184472642-5"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>The ConvLSTM2D class requires configuration both in terms of the CNN and the LSTM. This includes specifying the number of filters (e.g. 64), the two-dimensional kernel size, in this case (1 row and 3 columns of the subsequence time steps), and the activation function, in this case rectified linear.</p>
<p>As with a CNN or LSTM model, the output must be flattened into one long vector before it can be interpreted by a dense layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfb6297374519" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(ConvLSTM2D(filters=64, kernel_size=(1,3), activation='relu', input_shape=(n_steps, 1, n_length, n_features)))
model.add(Dropout(0.5))
model.add(Flatten())
model.add(Dense(100, activation='relu'))
model.add(Dense(n_outputs, activation='softmax'))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfb6297374519-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb6297374519-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb6297374519-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb6297374519-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb6297374519-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb6297374519-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb6297374519-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfb6297374519-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb6297374519-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb6297374519-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb6297374519-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb6297374519-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb6297374519-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb6297374519-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can then evaluate the model as we did the LSTM and CNN LSTM models before it.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfb7379093693" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convlstm model
from numpy import mean
from numpy import std
from numpy import dstack
from pandas import read_csv
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Dropout
from keras.layers import LSTM
from keras.layers import TimeDistributed
from keras.layers import ConvLSTM2D
from keras.utils import to_categorical
from matplotlib import pyplot

# load a single file as a numpy array
def load_file(filepath):
	dataframe = read_csv(filepath, header=None, delim_whitespace=True)
	return dataframe.values

# load a list of files and return as a 3d numpy array
def load_group(filenames, prefix=''):
	loaded = list()
	for name in filenames:
		data = load_file(prefix + name)
		loaded.append(data)
	# stack group so that features are the 3rd dimension
	loaded = dstack(loaded)
	return loaded

# load a dataset group, such as train or test
def load_dataset_group(group, prefix=''):
	filepath = prefix + group + '/Inertial Signals/'
	# load all 9 files as a single array
	filenames = list()
	# total acceleration
	filenames += ['total_acc_x_'+group+'.txt', 'total_acc_y_'+group+'.txt', 'total_acc_z_'+group+'.txt']
	# body acceleration
	filenames += ['body_acc_x_'+group+'.txt', 'body_acc_y_'+group+'.txt', 'body_acc_z_'+group+'.txt']
	# body gyroscope
	filenames += ['body_gyro_x_'+group+'.txt', 'body_gyro_y_'+group+'.txt', 'body_gyro_z_'+group+'.txt']
	# load input data
	X = load_group(filenames, filepath)
	# load class output
	y = load_file(prefix + group + '/y_'+group+'.txt')
	return X, y

# load the dataset, returns train and test X and y elements
def load_dataset(prefix=''):
	# load all train
	trainX, trainy = load_dataset_group('train', prefix + 'HARDataset/')
	print(trainX.shape, trainy.shape)
	# load all test
	testX, testy = load_dataset_group('test', prefix + 'HARDataset/')
	print(testX.shape, testy.shape)
	# zero-offset class values
	trainy = trainy - 1
	testy = testy - 1
	# one hot encode y
	trainy = to_categorical(trainy)
	testy = to_categorical(testy)
	print(trainX.shape, trainy.shape, testX.shape, testy.shape)
	return trainX, trainy, testX, testy

# fit and evaluate a model
def evaluate_model(trainX, trainy, testX, testy):
	# define model
	verbose, epochs, batch_size = 0, 25, 64
	n_timesteps, n_features, n_outputs = trainX.shape[1], trainX.shape[2], trainy.shape[1]
	# reshape into subsequences (samples, time steps, rows, cols, channels)
	n_steps, n_length = 4, 32
	trainX = trainX.reshape((trainX.shape[0], n_steps, 1, n_length, n_features))
	testX = testX.reshape((testX.shape[0], n_steps, 1, n_length, n_features))
	# define model
	model = Sequential()
	model.add(ConvLSTM2D(filters=64, kernel_size=(1,3), activation='relu', input_shape=(n_steps, 1, n_length, n_features)))
	model.add(Dropout(0.5))
	model.add(Flatten())
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs, activation='softmax'))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
	# fit network
	model.fit(trainX, trainy, epochs=epochs, batch_size=batch_size, verbose=verbose)
	# evaluate model
	_, accuracy = model.evaluate(testX, testy, batch_size=batch_size, verbose=0)
	return accuracy

# summarize scores
def summarize_results(scores):
	print(scores)
	m, s = mean(scores), std(scores)
	print('Accuracy: %.3f%% (+/-%.3f)' % (m, s))

# run an experiment
def run_experiment(repeats=10):
	# load data
	trainX, trainy, testX, testy = load_dataset()
	# repeat experiment
	scores = list()
	for r in range(repeats):
		score = evaluate_model(trainX, trainy, testX, testy)
		score = score * 100.0
		print('&gt;#%d: %.3f' % (r+1, score))
		scores.append(score)
	# summarize results
	summarize_results(scores)

# run the experiment
run_experiment()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-14">14</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-16">16</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-18">18</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-20">20</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-22">22</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-24">24</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-26">26</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-28">28</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-30">30</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-32">32</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-34">34</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-36">36</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-38">38</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-40">40</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-42">42</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-44">44</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-46">46</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-48">48</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-50">50</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-52">52</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-54">54</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-56">56</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-58">58</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-60">60</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-62">62</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-64">64</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-66">66</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-68">68</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-70">70</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-72">72</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-74">74</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-76">76</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-78">78</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-80">80</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-82">82</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-84">84</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-86">86</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-88">88</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-90">90</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-92">92</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-94">94</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-96">96</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-98">98</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-100">100</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-102">102</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-104">104</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-106">106</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfb7379093693-108">108</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfb7379093693-109">109</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-1"><span class="crayon-p"># convlstm model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">dstack</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">ConvLSTM2D</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-14"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-16"><span class="crayon-p"># load a single file as a numpy array</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-17"><span class="crayon-e">def </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-18"><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delim_whitespace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-20"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-21"><span class="crayon-p"># load a list of files and return as a 3d numpy array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-22"><span class="crayon-e">def </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-23"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">name </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-25"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-26"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-27"><span class="crayon-h"> </span><span class="crayon-p"># stack group so that features are the 3rd dimension</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-28"><span class="crayon-h"> </span><span class="crayon-v">loaded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dstack</span><span class="crayon-sy">(</span><span class="crayon-v">loaded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">loaded</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-30"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-31"><span class="crayon-p"># load a dataset group, such as train or test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-32"><span class="crayon-e">def </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-v">group</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-33"><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/Inertial Signals/'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-34"><span class="crayon-h"> </span><span class="crayon-p"># load all 9 files as a single array</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-35"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-36"><span class="crayon-h"> </span><span class="crayon-p"># total acceleration</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-37"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'total_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'total_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-38"><span class="crayon-h"> </span><span class="crayon-p"># body acceleration</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-39"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_acc_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_acc_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-40"><span class="crayon-h"> </span><span class="crayon-p"># body gyroscope</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-41"><span class="crayon-h"> </span><span class="crayon-v">filenames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'body_gyro_x_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'body_gyro_z_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-42"><span class="crayon-h"> </span><span class="crayon-p"># load input data</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-43"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_group</span><span class="crayon-sy">(</span><span class="crayon-v">filenames</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filepath</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-44"><span class="crayon-h"> </span><span class="crayon-p"># load class output</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-45"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_file</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/y_'</span><span class="crayon-o">+</span><span class="crayon-v">group</span><span class="crayon-o">+</span><span class="crayon-s">'.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-46"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-47"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-48"><span class="crayon-p"># load the dataset, returns train and test X and y elements</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-49"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">prefix</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-50"><span class="crayon-h"> </span><span class="crayon-p"># load all train</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-51"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'train'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-52"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-53"><span class="crayon-h"> </span><span class="crayon-p"># load all test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-54"><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset_group</span><span class="crayon-sy">(</span><span class="crayon-s">'test'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">prefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'HARDataset/'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-55"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-56"><span class="crayon-h"> </span><span class="crayon-p"># zero-offset class values</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-57"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-58"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-59"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-60"><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">trainy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-61"><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-62"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-63"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-64"> </div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-65"><span class="crayon-p"># fit and evaluate a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-66"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-67"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-68"><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-69"><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-70"><span class="crayon-h"> </span><span class="crayon-p"># reshape into subsequences (samples, time steps, rows, cols, channels)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-71"><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">32</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-72"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-73"><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-74"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-75"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-76"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-77"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-78"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-79"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-80"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-81"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-82"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-83"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-84"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-85"><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-86"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">accuracy</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-88"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-89"><span class="crayon-e">def </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-90"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-91"><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-92"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.3f%% (+/-%.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-93"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-94"><span class="crayon-p"># run an experiment</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-95"><span class="crayon-e">def </span><span class="crayon-e">run_experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-96"><span class="crayon-h"> </span><span class="crayon-p"># load data</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-97"><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-98"><span class="crayon-h"> </span><span class="crayon-p"># repeat experiment</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-99"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-100"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-101"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-102"><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">score *</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-103"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;#%d: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-104"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">score</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-105"><span class="crayon-h"> </span><span class="crayon-p"># summarize results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-106"><span class="crayon-h"> </span><span class="crayon-e">summarize_results</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-107"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfb7379093693-108"><span class="crayon-p"># run the experiment</span></div><div class="crayon-line" id="crayon-5c0c9aae6dfb7379093693-109"><span class="crayon-e">run_experiment</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0060 seconds] -->
<p>As with the prior experiments, running the model prints the performance of the model each time it is fit and evaluated. A summary of the final model performance is presented at the end of the run.</p>
<p>We can see that the model does consistently perform well on the problem achieving an accuracy of about 90%, perhaps with fewer resources than the larger CNN LSTM model.</p>
<p>Note: given the stochastic nature of the algorithm, your specific results may vary. If so, try running the code a few times.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9aae6dfba734288865" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
&gt;#1: 90.092
&gt;#2: 91.619
&gt;#3: 92.128
&gt;#4: 90.533
&gt;#5: 89.243
&gt;#6: 90.940
&gt;#7: 92.026
&gt;#8: 91.008
&gt;#9: 90.499
&gt;#10: 89.922

[90.09161859518154, 91.61859518154056, 92.12758737699356, 90.53274516457415, 89.24329826942655, 90.93993892093654, 92.02578893790296, 91.00780454699695, 90.49881235154395, 89.92195453003053]

Accuracy: 90.801% (+/-0.886)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9aae6dfba734288865-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfba734288865-2">2</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfba734288865-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfba734288865-4">4</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfba734288865-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfba734288865-6">6</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfba734288865-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfba734288865-8">8</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfba734288865-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfba734288865-10">10</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfba734288865-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfba734288865-12">12</div><div class="crayon-num" data-line="crayon-5c0c9aae6dfba734288865-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9aae6dfba734288865-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9aae6dfba734288865-1">&gt;#1: 90.092</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfba734288865-2">&gt;#2: 91.619</div><div class="crayon-line" id="crayon-5c0c9aae6dfba734288865-3">&gt;#3: 92.128</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfba734288865-4">&gt;#4: 90.533</div><div class="crayon-line" id="crayon-5c0c9aae6dfba734288865-5">&gt;#5: 89.243</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfba734288865-6">&gt;#6: 90.940</div><div class="crayon-line" id="crayon-5c0c9aae6dfba734288865-7">&gt;#7: 92.026</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfba734288865-8">&gt;#8: 91.008</div><div class="crayon-line" id="crayon-5c0c9aae6dfba734288865-9">&gt;#9: 90.499</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfba734288865-10">&gt;#10: 89.922</div><div class="crayon-line" id="crayon-5c0c9aae6dfba734288865-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfba734288865-12">[90.09161859518154, 91.61859518154056, 92.12758737699356, 90.53274516457415, 89.24329826942655, 90.93993892093654, 92.02578893790296, 91.00780454699695, 90.49881235154395, 89.92195453003053]</div><div class="crayon-line" id="crayon-5c0c9aae6dfba734288865-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9aae6dfba734288865-14">Accuracy: 90.801% (+/-0.886)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Data Preparation</strong>. Consider exploring whether simple data scaling schemes can further lift model performance, such as normalization, standardization, and power transforms.</li>
<li><strong>LSTM Variations</strong>. There are variations of the LSTM architecture that may achieve better performance on this problem, such as stacked LSTMs and Bidirectional LSTMs.</li>
<li><strong>Hyperparameter Tuning</strong>. Consider exploring tuning of model hyperparameters such as the number of units, training epochs, batch size, and more.</li>
</ul>
<p>If you explore any of these extensions, I’d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>Papers</h3>
<ul>
<li><a href="https://upcommons.upc.edu/handle/2117/20897">A Public Domain Dataset for Human Activity Recognition Using Smartphones</a>, 2013.</li>
<li><a href="https://link.springer.com/chapter/10.1007/978-3-642-35395-6_30">Human Activity Recognition on Smartphones using a Multiclass Hardware-Friendly Support Vector Machine</a>, 2012.</li>
<li><a href="https://ieeexplore.ieee.org/document/7178838/">Convolutional, Long Short-Term Memory, fully connected Deep Neural Networks</a>, 2015.</li>
<li><a href="https://arxiv.org/abs/1506.04214v1">Convolutional LSTM Network: A Machine Learning Approach for Precipitation Nowcasting</a>, 2015.</li>
</ul>
<h3>Articles</h3>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/human+activity+recognition+using+smartphones">Human Activity Recognition Using Smartphones Data Set, UCI Machine Learning Repository</a></li>
<li><a href="https://en.wikipedia.org/wiki/Activity_recognition">Activity recognition, Wikipedia</a></li>
<li><a href="https://www.youtube.com/watch?v=XOEN9W05_4A">Activity Recognition Experiment Using Smartphone Sensors, Video</a>.</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered three recurrent neural network architectures for modeling an activity recognition time series classification problem.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a Long Short-Term Memory Recurrent Neural Network for human activity recognition.</li>
<li>How to develop a one-dimensional Convolutional Neural Network LSTM, or CNN LSTM, model.</li>
<li>How to develop a one-dimensional Convolutional LSTM, or ConvLSTM, model for the same problem.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img align="left" alt="Deep Learning for Time Series Forecasting" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br/>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6210 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+RNN+Models+for+Human+Activity+Recognition+Time+Series+Classification&amp;url=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/cnn-models-for-human-activity-recognition-time-series-classification/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop 1D Convolutional Neural Network Models for Human Activity Recognition</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/deep-learning-models-for-human-activity-recognition/" rel="next">Deep Learning Models for Human Activity Recognition <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">16 Responses to <em>How to Develop RNN Models for Human Activity Recognition Time Series Classification</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-450022">
<div class="comment-container" id="li-comment-450022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8cd9067dbed519ef13d39f71d7fe9200?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8cd9067dbed519ef13d39f71d7fe9200?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tin</span>
<span class="date">September 28, 2018 at 9:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-450022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>So enjoy reading with your stuff, very helpful. As we can use CNN+LSTM to predict the spatial-temporal data, can we reverse the architecture as LSTM+CNN to do the same job? Any examples for LSTM + CNN?</p>
<div class="reply">
<a aria-label="Reply to Tin" class="comment-reply-link" href="#comment-450022" onclick='return addComment.moveForm( "comment-450022", "450022", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-450060">
<div class="comment-container" id="li-comment-450060">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 28, 2018 at 2:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-450060" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not that I have seen. What application did you have in mind exactly? Sequence to image?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-450060" onclick='return addComment.moveForm( "comment-450060", "450060", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-453027">
<div class="comment-container" id="li-comment-453027">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bb705c0ed766c9fcfa5221fdebb3fb9a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bb705c0ed766c9fcfa5221fdebb3fb9a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Akilesh</span>
<span class="date">October 29, 2018 at 12:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-453027" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Can you please explain the choice of parameters for the LSTM network?<br/>
Especially the LSTM layer and the dense layer?<br/>
What does the value 100 signify?</p>
<div class="reply">
<a aria-label="Reply to Akilesh" class="comment-reply-link" href="#comment-453027" onclick='return addComment.moveForm( "comment-453027", "453027", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453034">
<div class="comment-container" id="li-comment-453034">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 29, 2018 at 2:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-453034" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model was configured via trial and error.</p>
<p>There is no analytical way to calculate how to configure a neural network model, more details here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/how-many-layers-and-nodes-do-i-need-in-my-neural-network" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-many-layers-and-nodes-do-i-need-in-my-neural-network</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453034" onclick='return addComment.moveForm( "comment-453034", "453034", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-453268">
<div class="comment-container" id="li-comment-453268">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dc8f1d156484a23d077cb928fad631c2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dc8f1d156484a23d077cb928fad631c2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amir</span>
<span class="date">October 31, 2018 at 8:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-453268" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for such a comprehensive tutorial<br/>
I try it and it worked as expressed in the tutorial.</p>
<p>Now, I’m going to try it with my data that comes from a single axis accelerometer. It means I have only one feature so I don’t need a 3D array but a 2D.<br/>
You mentioned “The model (RNN LSTM) requires a three-dimensional input with [samples, time steps, features]. This is exactly how we have loaded the data.”<br/>
Then, it means that it won’t work with a 2D array? or I can consider a 3D array but the 3rd dimension has only one member?</p>
<p>and my second question is:<br/>
I need the model for a real-time classification, so I need to train once and then save the model and use it in my web application.<br/>
how can I save the model after training and use it?</p>
<div class="reply">
<a aria-label="Reply to Amir" class="comment-reply-link" href="#comment-453268" onclick='return addComment.moveForm( "comment-453268", "453268", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453301">
<div class="comment-container" id="li-comment-453301">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2018 at 6:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-453301" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, even if the 3rd dimension has 1 parameter, it is still a 3D array.</p>
<p>You can call model.save() to save the model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453301" onclick='return addComment.moveForm( "comment-453301", "453301", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-455706">
<div class="comment-container" id="li-comment-455706">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b2cb3458e8baa0f621528baf5d734ff4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b2cb3458e8baa0f621528baf5d734ff4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel Aguilera Garcia</span>
<span class="date">November 21, 2018 at 10:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-455706" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason.</p>
<p>In my case I have 2 time series from EGG and I have to diseign a model that classify in two types de signal. I dont understand exactly how should i reshape the data. </p>
<p>The freq is 256 values per second so i could divide in windows like you did before. The problem is that i dont know how to put the 3rd dimension of caracteristics. From each window I have 7 caracteristics not from each moment (max, min, std, fft bandwidths, fft centroids, Arima 1, Arima 2)</p>
<p>Please, how could I do what you mean [samples, time steps, features] in my case??</p>
<div class="reply">
<a aria-label="Reply to Daniel Aguilera Garcia" class="comment-reply-link" href="#comment-455706" onclick='return addComment.moveForm( "comment-455706", "455706", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455725">
<div class="comment-container" id="li-comment-455725">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 21, 2018 at 2:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-455725" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps those 7 characteristics are 7 features.</p>
<p>If you have 256 samples per section, you can choose how many samples/seconds to use as time steps and perhaps change the resolution via averaging or removing samples.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455725" onclick='return addComment.moveForm( "comment-455725", "455725", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-455750">
<div class="comment-container" id="li-comment-455750">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3e1dc9b417bfb5fcb9d4239dbd5e9d36?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3e1dc9b417bfb5fcb9d4239dbd5e9d36?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel Aguilera Garcia</span>
<span class="date">November 21, 2018 at 9:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-455750" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Let’s see im going to make an easy example:</p>
<p>channel1 (values in one second)=2,5,6,8,54,2,8,4,7,8,…,5,7,8 (in total 256 values per second)</p>
<p>channel2 (values in one second)=2,5,6,8,54,2,8,4,7,8,…,5,7,8 (in total 256 values per second)</p>
<p>7 diferent features</p>
<p>[samples,timesteps,features]=[2, 256, 7]?</p>
<p>and another questions, for example the mean feature:</p>
<p>chanel 1:</p>
<p>feat_mean[0]=2<br/>
feat_mean[1]=(2+5)/2=3.5<br/>
feat_mean[2]=(2+5+6)/3=4.33<br/>
etc…</p>
<p>is it correct? what I understood is that I have to substract features for each each moment?</p>
<div class="reply">
<a aria-label="Reply to Daniel Aguilera Garcia" class="comment-reply-link" href="#comment-455750" onclick='return addComment.moveForm( "comment-455750", "455750", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-455792">
<div class="comment-container" id="li-comment-455792">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2018 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-455792" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, for one second of obs, that looks right.</p>
<p>You can use Pandas to up/downsample the series:<br/>
<a href="https://machinelearningmastery.com/resample-interpolate-time-series-data-python/" rel="nofollow">https://machinelearningmastery.com/resample-interpolate-time-series-data-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455792" onclick='return addComment.moveForm( "comment-455792", "455792", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-455841">
<div class="comment-container" id="li-comment-455841">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8cedec6b999fc126a290c3cf097dbf68?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8cedec6b999fc126a290c3cf097dbf68?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">coolyj</span>
<span class="date">November 22, 2018 at 5:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-455841" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>where does the “561 element vector of features” apply to?</p>
<div class="reply">
<a aria-label="Reply to coolyj" class="comment-reply-link" href="#comment-455841" onclick='return addComment.moveForm( "comment-455841", "455841", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455883">
<div class="comment-container" id="li-comment-455883">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2018 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-455883" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That vector was the pre-processed data, prepared by the authors of the study that we do not use in this tutorial.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455883" onclick='return addComment.moveForm( "comment-455883", "455883", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-456218">
<div class="comment-container" id="li-comment-456218">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3e1dc9b417bfb5fcb9d4239dbd5e9d36?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3e1dc9b417bfb5fcb9d4239dbd5e9d36?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel Aguilera Garcia</span>
<span class="date">November 26, 2018 at 8:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-456218" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello jason!</p>
<p>should we normalize each feature??</p>
<div class="reply">
<a aria-label="Reply to Daniel Aguilera Garcia" class="comment-reply-link" href="#comment-456218" onclick='return addComment.moveForm( "comment-456218", "456218", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-456273">
<div class="comment-container" id="li-comment-456273">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-456273" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try it and evaluate how it impacts model performance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456273" onclick='return addComment.moveForm( "comment-456273", "456273", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-457054">
<div class="comment-container" id="li-comment-457054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/918ca81cd79ccaf980d9757024350769?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/918ca81cd79ccaf980d9757024350769?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leon</span>
<span class="date">December 3, 2018 at 7:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-457054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the great article.<br/>
I notice in your load data section, you probably mean 2.56 seconds instead of  2.65, since 128(time step) * 1/50(record sampling rate) = 2.56.</p>
<div class="reply">
<a aria-label="Reply to Leon" class="comment-reply-link" href="#comment-457054" onclick='return addComment.moveForm( "comment-457054", "457054", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457087">
<div class="comment-container" id="li-comment-457087">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 3, 2018 at 2:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#comment-457087" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, yes that is a typo. Fixed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457087" onclick='return addComment.moveForm( "comment-457087", "457087", "respond", "6210" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="6210"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="0d9f27c937"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="70"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-51"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for Time Series</strong><br/>
Forecast the future with MLPs, CNNs, and LSTMs.
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
<script type="text/javascript">		var ssb_admin_ajax = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
		var ssb_post_id = 6210 ;
		var ssb_post_url = 'https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/';
		var ssb_alternate_post_url = 'http://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/';
		jQuery( document ).ready(function(){
		var is_ssb_used = jQuery('.simplesocialbuttons');
		if( is_ssb_used ) {

			var data = {
			'action': 'ssb_fetch_data',
			'postID': ssb_post_id
		};
			jQuery.post(ssb_admin_ajax, data, function(data, textStatus, xhr) {
				var array = JSON.parse(data);

				jQuery.each( array, function( index, value ){

					if( index == 'total' ){
						jQuery('.ssb_'+ index +'_counter').html(value + '<span>Shares</span>');
					}else{
						jQuery('.ssb_'+ index +'_counter').html(value);
					}
				});

			});
		}
		})

		document.addEventListener("DOMContentLoaded", function() {
			var if_ssb_exist = document.getElementsByClassName( "simplesocialbuttons" ).length > 0;
			if (if_ssb_exist) {
				ssbPlugin.fetchFacebookShares();
			}
		});;
		</script></body>
</html>