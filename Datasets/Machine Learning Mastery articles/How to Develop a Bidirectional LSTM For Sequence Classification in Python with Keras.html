<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop a Bidirectional LSTM For Sequence Classification in Python with Keras</title>
<link href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop a Bidirectional LSTM For Sequence Classification in Python with Keras" property="og:title"/>
<meta content="Bidirectional LSTMs are an extension of traditional LSTMs that can improve model performance on sequence classification problems. In problems where all timesteps of the input sequence are available, Bidirectional LSTMs train two instead of one LSTMs on the input sequence. The first on the input sequence as-is and the second on a reversed copy of …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-06-15T19:00:32+00:00" property="article:published_time"/>
<meta content="2017-07-19T22:51:07+00:00" property="article:modified_time"/>
<meta content="2017-07-19T22:51:07+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-of-Log-Loss-for-an-LSTM-Reversed-LSTM-and-a-Bidirectional-LSTM.png" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-of-Log-Loss-for-an-LSTM-Reversed-LSTM-and-a-Bidirectional-LSTM.png" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="480" property="og:image:height"/>
<meta content="Line Plot of Log Loss for an LSTM, Reversed LSTM and a Bidirectional LSTM" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop a Bidirectional LSTM For Sequence Classification in Python with Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4081" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-bidirectional-lstm-sequence-classification-python-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-bidirectional-lstm-sequence-classification-python-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4081 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Want help with LSTMs? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4081 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">How to Develop a Bidirectional LSTM For Sequence Classification in Python with Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-06-16T05:00:32+1100">June 16, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4081 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+a+Bidirectional+LSTM+For+Sequence+Classification+in+Python+with+Keras&amp;url=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Bidirectional LSTMs are an extension of traditional LSTMs that can improve model performance on sequence classification problems.</p>
<p>In problems where all timesteps of the input sequence are available, Bidirectional LSTMs train two instead of one LSTMs on the input sequence. The first on the input sequence as-is and the second on a reversed copy of the input sequence. This can provide additional context to the network and result in faster and even fuller learning on the problem.</p>
<p>In this tutorial, you will discover how to develop Bidirectional LSTMs for sequence classification in Python with the Keras deep learning library.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a small contrived and configurable sequence classification problem.</li>
<li>How to develop an LSTM and Bidirectional LSTM for sequence classification.</li>
<li>How to compare the performance of the merge mode used in Bidirectional LSTMs.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4084" style="width: 650px"><img alt="How to Develop a Bidirectional LSTM For Sequence Classification in Python with Keras" class="size-full wp-image-4084" height="259" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Develop-a-Bidirectional-LSTM-For-Sequence-Classification-in-Python-with-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Develop-a-Bidirectional-LSTM-For-Sequence-Classification-in-Python-with-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Develop-a-Bidirectional-LSTM-For-Sequence-Classification-in-Python-with-Keras-300x121.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop a Bidirectional LSTM For Sequence Classification in Python with Keras<br/>Photo by <a href="https://www.flickr.com/photos/helloninja/15333087540/">Cristiano Medeiros Dalbem</a>, some rights reserved.</p></div>
<h2>Overview</h2>
<p>This tutorial is divided into 6 parts; they are:</p>
<ol>
<li>Bidirectional LSTMs</li>
<li>Sequence Classification Problem</li>
<li>LSTM For Sequence Classification</li>
<li>Bidirectional LSTM For Sequence Classification</li>
<li>Compare LSTM to Bidirectional LSTM</li>
<li>Comparing Bidirectional LSTM Merge Modes</li>
</ol>
<h3>Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this example.</p>
<p>This tutorial assumes you have Keras (v2.0.4+) installed with either the TensorFlow (v1.1.0+) or Theano (v0.9+) backend.</p>
<p>This tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help setting up your Python environment, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div>
<h2>Bidirectional LSTMs</h2>
<p>The idea of Bidirectional Recurrent Neural Networks (RNNs) is straightforward.</p>
<p>It involves duplicating the first recurrent layer in the network so that there are now two layers side-by-side, then providing the input sequence as-is as input to the first layer and providing a reversed copy of the input sequence to the second.</p>
<blockquote><p>To overcome the limitations of a regular RNN […] we propose a bidirectional recurrent neural network (BRNN) that can be trained using all available input information in the past and future of a specific time frame.</p>
<p>…</p>
<p>The idea is to split the state neurons of a regular RNN in a part that is responsible for the positive time direction (forward states) and a part for the negative time direction (backward states)</p></blockquote>
<p>— Mike Schuster and Kuldip K. Paliwal, <a href="https://maxwell.ict.griffith.edu.au/spl/publications/papers/ieeesp97_schuster.pdf">Bidirectional Recurrent Neural Networks</a>, 1997</p>
<p>This approach has been used to great effect with Long Short-Term Memory (LSTM) Recurrent Neural Networks.</p>
<p>The use of providing the sequence bi-directionally was initially justified in the domain of speech recognition because there is evidence that the context of the whole utterance is used to interpret what is being said rather than a linear interpretation.</p>
<blockquote><p>… relying on knowledge of the future seems at first sight to violate causality. How can we base our understanding of what we’ve heard on something that hasn’t been said yet? However, human listeners do exactly that. Sounds, words, and even whole sentences that at first mean nothing are found to make sense in the light of future context. What we must remember is the distinction between tasks that are truly online – requiring an output after every input – and those where outputs are only needed at the end of some input segment.</p></blockquote>
<p>— Alex Graves and Jurgen Schmidhuber, <a href="ftp://ftp.idsia.ch/pub/juergen/nn_2005.pdf">Framewise Phoneme Classification with Bidirectional LSTM and Other Neural Network Architectures</a>, 2005</p>
<p>The use of bidirectional LSTMs may not make sense for all sequence prediction problems, but can offer some benefit in terms of better results to those domains where it is appropriate.</p>
<blockquote><p>We have found that bidirectional networks are significantly more effective than unidirectional ones…</p></blockquote>
<p>— Alex Graves and Jurgen Schmidhuber, <a href="ftp://ftp.idsia.ch/pub/juergen/nn_2005.pdf">Framewise Phoneme Classification with Bidirectional LSTM and Other Neural Network Architectures</a>, 2005</p>
<p>To be clear, timesteps in the input sequence are still processed one at a time, it is just the network steps through the input sequence in both directions at the same time.</p>
<h3>Bidirectional LSTMs in Keras</h3>
<p>Bidirectional LSTMs are supported in Keras via the <a href="https://keras.io/layers/wrappers/#bidirectional">Bidirectional</a> layer wrapper.</p>
<p>This wrapper takes a recurrent layer (e.g. the first LSTM layer) as an argument.</p>
<p>It also allows you to specify the merge mode, that is how the forward and backward outputs should be combined before being passed on to the next layer. The options are:</p>
<ul>
<li>‘<em>sum</em>‘: The outputs are added together.</li>
<li>‘<em>mul</em>‘: The outputs are multiplied together.</li>
<li>‘<em>concat</em>‘: The outputs are concatenated together (the default), providing double the number of outputs to the next layer.</li>
<li>‘<em>ave</em>‘: The average of the outputs is taken.</li>
</ul>
<p>The default mode is to concatenate, and this is the method often used in studies of bidirectional LSTMs.</p>
<h2>Sequence Classification Problem</h2>
<p>We will define a simple sequence classification problem to explore bidirectional LSTMs.</p>
<p>The problem is defined as a sequence of random values between 0 and 1. This sequence is taken as input for the problem with each number provided one per timestep.</p>
<p>A binary label (0 or 1) is associated with each input. The output values are all 0. Once the cumulative sum of the input values in the sequence exceeds a threshold, then the output value flips from 0 to 1.</p>
<p>A threshold of 1/4 the sequence length is used.</p>
<p>For example, below is a sequence of 10 input timesteps (X):</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e3874dc476664091" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0.63144003 0.29414551 0.91587952 0.95189228 0.32195638 0.60742236 0.83895793 0.18023048 0.84762691 0.29165514</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e3874dc476664091-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e3874dc476664091-1">0.63144003 0.29414551 0.91587952 0.95189228 0.32195638 0.60742236 0.83895793 0.18023048 0.84762691 0.29165514</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The corresponding classification output (y) would be:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e3874f0153847606" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0 0 0 1 1 1 1 1 1 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e3874f0153847606-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e3874f0153847606-1">0 0 0 1 1 1 1 1 1 1</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can implement this in Python.</p>
<p>The first step is to generate a sequence of random values. We can use the <a href="https://docs.python.org/3/library/random.html">random() function</a> from the random module.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e3874f3430338435" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a sequence of random numbers in [0,1]
X = array([random() for _ in range(10)])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e3874f3430338435-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874f3430338435-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e3874f3430338435-1"><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874f3430338435-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can define the threshold as one-quarter the length of the input sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e3874f6664095477" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# calculate cut-off value to change class values
limit = 10/4.0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e3874f6664095477-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874f6664095477-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e3874f6664095477-1"><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874f6664095477-2"><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The cumulative sum of the input sequence can be calculated using the <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.cumsum.html">cumsum() NumPy function</a>. This function returns a sequence of cumulative sum values, e.g.:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e3874f9890223661" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
pos1, pos1+pos2, pos1+pos2+pos3, ...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e3874f9890223661-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e3874f9890223661-1">pos1, pos1+pos2, pos1+pos2+pos3, ...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can then calculate the output sequence as whether each cumulative sum value exceeded the threshold.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e3874fc051395111" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# determine the class outcome for each item in cumulative sequence
y = array([0 if x &lt; limit else 1 for x in cumsum(X)])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e3874fc051395111-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874fc051395111-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e3874fc051395111-1"><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874fc051395111-2"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">limit </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">cumsum</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The function below, named get_sequence(), draws all of this together, taking as input the length of the sequence, and returns the X and y components of a new problem case.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e3874ff419683565" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import random
from numpy import array
from numpy import cumsum

# create a sequence classification instance
def get_sequence(n_timesteps):
	# create a sequence of random numbers in [0,1]
	X = array([random() for _ in range(n_timesteps)])
	# calculate cut-off value to change class values
	limit = n_timesteps/4.0
	# determine the class outcome for each item in cumulative sequence
	y = array([0 if x &lt; limit else 1 for x in cumsum(X)])
	return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e3874ff419683565-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874ff419683565-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e3874ff419683565-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874ff419683565-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e3874ff419683565-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874ff419683565-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e3874ff419683565-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874ff419683565-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e3874ff419683565-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874ff419683565-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e3874ff419683565-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e3874ff419683565-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e3874ff419683565-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e3874ff419683565-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">random</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874ff419683565-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7e3874ff419683565-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-v">cumsum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874ff419683565-4"> </div><div class="crayon-line" id="crayon-5c0ca7e3874ff419683565-5"><span class="crayon-p"># create a sequence classification instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874ff419683565-6"><span class="crayon-e">def </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e3874ff419683565-7"><span class="crayon-h"> </span><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874ff419683565-8"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e3874ff419683565-9"><span class="crayon-h"> </span><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874ff419683565-10"><span class="crayon-h"> </span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div><div class="crayon-line" id="crayon-5c0ca7e3874ff419683565-11"><span class="crayon-h"> </span><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e3874ff419683565-12"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">limit </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">cumsum</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e3874ff419683565-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>We can test this function with a new 10 timestep sequence as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387501250576530" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X, y = get_sequence(10)
print(X)
print(y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387501250576530-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387501250576530-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387501250576530-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387501250576530-1"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387501250576530-2"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387501250576530-3"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Running the example first prints the generated input sequence followed by the matching output sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387504421349372" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[ 0.22228819 0.26882207 0.069623 0.91477783 0.02095862 0.71322527
0.90159654 0.65000306 0.88845226 0.4037031 ]
[0 0 0 0 0 0 1 1 1 1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387504421349372-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387504421349372-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387504421349372-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387504421349372-1">[ 0.22228819 0.26882207 0.069623 0.91477783 0.02095862 0.71322527</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387504421349372-2">0.90159654 0.65000306 0.88845226 0.4037031 ]</div><div class="crayon-line" id="crayon-5c0ca7e387504421349372-3">[0 0 0 0 0 0 1 1 1 1]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>LSTM For Sequence Classification</h2>
<p>We can start off by developing a traditional LSTM for the sequence classification problem.</p>
<p>Firstly, we must update the get_sequence() function to reshape the input and output sequences to be 3-dimensional to meet the expectations of the LSTM. The expected structure has the dimensions [samples, timesteps, features]. The classification problem has 1 sample (e.g. one sequence), a configurable number of timesteps, and one feature per timestep.</p>
<p>The classification problem has 1 sample (e.g. one sequence), a configurable number of timesteps, and one feature per timestep.</p>
<p>Therefore, we can reshape the sequences as follows.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387507803633222" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape input and output data to be suitable for LSTMs
X = X.reshape(1, n_timesteps, 1)
y = y.reshape(1, n_timesteps, 1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387507803633222-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387507803633222-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387507803633222-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387507803633222-1"><span class="crayon-p"># reshape input and output data to be suitable for LSTMs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387507803633222-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387507803633222-3"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The updated get_sequence() function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387509305057112" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a sequence classification instance
def get_sequence(n_timesteps):
	# create a sequence of random numbers in [0,1]
	X = array([random() for _ in range(n_timesteps)])
	# calculate cut-off value to change class values
	limit = n_timesteps/4.0
	# determine the class outcome for each item in cumulative sequence
	y = array([0 if x &lt; limit else 1 for x in cumsum(X)])
	# reshape input and output data to be suitable for LSTMs
	X = X.reshape(1, n_timesteps, 1)
	y = y.reshape(1, n_timesteps, 1)
	return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387509305057112-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387509305057112-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387509305057112-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387509305057112-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387509305057112-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387509305057112-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e387509305057112-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387509305057112-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e387509305057112-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387509305057112-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e387509305057112-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387509305057112-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387509305057112-1"><span class="crayon-p"># create a sequence classification instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387509305057112-2"><span class="crayon-e">def </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e387509305057112-3"><span class="crayon-h"> </span><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387509305057112-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387509305057112-5"><span class="crayon-h"> </span><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387509305057112-6"><span class="crayon-h"> </span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div><div class="crayon-line" id="crayon-5c0ca7e387509305057112-7"><span class="crayon-h"> </span><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387509305057112-8"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">limit </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">cumsum</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387509305057112-9"><span class="crayon-h"> </span><span class="crayon-p"># reshape input and output data to be suitable for LSTMs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387509305057112-10"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387509305057112-11"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387509305057112-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We will define the sequences as having 10 timesteps.</p>
<p>Next, we can define an LSTM for the problem. The input layer will have 10 timesteps with 1 feature a piece, input_shape=(10, 1).</p>
<p>The first hidden layer will have 20 memory units and the output layer will be a fully connected layer that outputs one value per timestep. A sigmoid activation function is used on the output to predict the binary value.</p>
<p>A TimeDistributed wrapper layer is used around the output layer so that one value per timestep can be predicted given the full sequence provided as input. This requires that the LSTM hidden layer returns a sequence of values (one per timestep) rather than a single value for the whole input sequence.</p>
<p>Finally, because this is a binary classification problem, the binary log loss (binary_crossentropy in Keras) is used. The efficient ADAM optimization algorithm is used to find the weights and the accuracy metric is calculated and reported each epoch.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e38750c686085901" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define LSTM
model = Sequential()
model.add(LSTM(20, input_shape=(10, 1), return_sequences=True))
model.add(TimeDistributed(Dense(1, activation='sigmoid')))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['acc'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e38750c686085901-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38750c686085901-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e38750c686085901-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38750c686085901-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e38750c686085901-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e38750c686085901-1"><span class="crayon-p"># define LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38750c686085901-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38750c686085901-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38750c686085901-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38750c686085901-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>The LSTM will be trained for 1,000 epochs. A new random input sequence will be generated each epoch for the network to be fit on. This ensures that the model does not memorize a single sequence and instead can generalize a solution to solve all possible random input sequences for this problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e38750f307946705" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train LSTM
for epoch in range(1000):
	# generate new random sequence
	X,y = get_sequence(n_timesteps)
	# fit model for one epoch on this sequence
	model.fit(X, y, epochs=1, batch_size=1, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e38750f307946705-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38750f307946705-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e38750f307946705-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38750f307946705-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e38750f307946705-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38750f307946705-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e38750f307946705-1"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38750f307946705-2"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e38750f307946705-3"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38750f307946705-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38750f307946705-5"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38750f307946705-6"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Once trained, the network will be evaluated on yet another random sequence. The predictions will be then compared to the expected output sequence to provide a concrete example of the skill of the system.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387512053801553" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate LSTM
X,y = get_sequence(n_timesteps)
yhat = model.predict_classes(X, verbose=0)
for i in range(n_timesteps):
	print('Expected:', y[0, i], 'Predicted', yhat[0, i])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387512053801553-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387512053801553-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387512053801553-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387512053801553-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387512053801553-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387512053801553-1"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387512053801553-2"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387512053801553-3"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict_classes</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387512053801553-4"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e387512053801553-5"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Predicted'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387514000927221" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import random
from numpy import array
from numpy import cumsum
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import TimeDistributed

# create a sequence classification instance
def get_sequence(n_timesteps):
	# create a sequence of random numbers in [0,1]
	X = array([random() for _ in range(n_timesteps)])
	# calculate cut-off value to change class values
	limit = n_timesteps/4.0
	# determine the class outcome for each item in cumulative sequence
	y = array([0 if x &lt; limit else 1 for x in cumsum(X)])
	# reshape input and output data to be suitable for LSTMs
	X = X.reshape(1, n_timesteps, 1)
	y = y.reshape(1, n_timesteps, 1)
	return X, y

# define problem properties
n_timesteps = 10
# define LSTM
model = Sequential()
model.add(LSTM(20, input_shape=(n_timesteps, 1), return_sequences=True))
model.add(TimeDistributed(Dense(1, activation='sigmoid')))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['acc'])
# train LSTM
for epoch in range(1000):
	# generate new random sequence
	X,y = get_sequence(n_timesteps)
	# fit model for one epoch on this sequence
	model.fit(X, y, epochs=1, batch_size=1, verbose=2)
# evaluate LSTM
X,y = get_sequence(n_timesteps)
yhat = model.predict_classes(X, verbose=0)
for i in range(n_timesteps):
	print('Expected:', y[0, i], 'Predicted', yhat[0, i])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387514000927221-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7e387514000927221-39">39</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387514000927221-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">random</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">cumsum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-8"> </div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-9"><span class="crayon-p"># create a sequence classification instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-10"><span class="crayon-e">def </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-11"><span class="crayon-h"> </span><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-13"><span class="crayon-h"> </span><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-14"><span class="crayon-h"> </span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-15"><span class="crayon-h"> </span><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-16"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">limit </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">cumsum</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-17"><span class="crayon-h"> </span><span class="crayon-p"># reshape input and output data to be suitable for LSTMs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-18"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-19"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-22"><span class="crayon-p"># define problem properties</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-23"><span class="crayon-v">n_timesteps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-24"><span class="crayon-p"># define LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-25"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-26"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-27"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-28"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-29"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-30"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-31"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-33"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-34"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-35"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-36"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-37"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict_classes</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387514000927221-38"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e387514000927221-39"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Predicted'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0022 seconds] -->
<p>Running the example prints the log loss and classification accuracy on the random sequences each epoch.</p>
<p>This provides a clear idea of how well the model has generalized a solution to the sequence classification problem.</p>
<p>We can see that the model does well, achieving a final accuracy that hovers around 90% and 100% accurate. Not perfect, but good for our purposes.</p>
<p>The predictions for a new random sequence are compared to the expected values, showing a mostly correct result with a single error.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387517981583877" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 1/1
0s - loss: 0.2039 - acc: 0.9000
Epoch 1/1
0s - loss: 0.2985 - acc: 0.9000
Epoch 1/1
0s - loss: 0.1219 - acc: 1.0000
Epoch 1/1
0s - loss: 0.2031 - acc: 0.9000
Epoch 1/1
0s - loss: 0.1698 - acc: 0.9000
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [0] Predicted [1]
Expected: [1] Predicted [1]
Expected: [1] Predicted [1]
Expected: [1] Predicted [1]
Expected: [1] Predicted [1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387517981583877-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e387517981583877-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387517981583877-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-2">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-3">0s - loss: 0.2039 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-4">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-5">0s - loss: 0.2985 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-6">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-7">0s - loss: 0.1219 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-8">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-9">0s - loss: 0.2031 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-10">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-11">0s - loss: 0.1698 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-12">Expected: [0] Predicted [0]</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-13">Expected: [0] Predicted [0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-14">Expected: [0] Predicted [0]</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-15">Expected: [0] Predicted [0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-16">Expected: [0] Predicted [0]</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-17">Expected: [0] Predicted [1]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-18">Expected: [1] Predicted [1]</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-19">Expected: [1] Predicted [1]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387517981583877-20">Expected: [1] Predicted [1]</div><div class="crayon-line" id="crayon-5c0ca7e387517981583877-21">Expected: [1] Predicted [1]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Bidirectional LSTM For Sequence Classification</h2>
<p>Now that we know how to develop an LSTM for the sequence classification problem, we can extend the example to demonstrate a Bidirectional LSTM.</p>
<p>We can do this by wrapping the LSTM hidden layer with a Bidirectional layer, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e38751f498725451" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(Bidirectional(LSTM(20, return_sequences=True), input_shape=(n_timesteps, 1)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e38751f498725451-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e38751f498725451-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Bidirectional</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>This will create two copies of the hidden layer, one fit in the input sequences as-is and one on a reversed copy of the input sequence. By default, the output values from these LSTMs will be concatenated.</p>
<p>That means that instead of the TimeDistributed layer receiving 10 timesteps of 20 outputs, it will now receive 10 timesteps of 40 (20 units + 20 units) outputs.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387522860401755" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import random
from numpy import array
from numpy import cumsum
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import TimeDistributed
from keras.layers import Bidirectional

# create a sequence classification instance
def get_sequence(n_timesteps):
	# create a sequence of random numbers in [0,1]
	X = array([random() for _ in range(n_timesteps)])
	# calculate cut-off value to change class values
	limit = n_timesteps/4.0
	# determine the class outcome for each item in cumulative sequence
	y = array([0 if x &lt; limit else 1 for x in cumsum(X)])
	# reshape input and output data to be suitable for LSTMs
	X = X.reshape(1, n_timesteps, 1)
	y = y.reshape(1, n_timesteps, 1)
	return X, y

# define problem properties
n_timesteps = 10
# define LSTM
model = Sequential()
model.add(Bidirectional(LSTM(20, return_sequences=True), input_shape=(n_timesteps, 1)))
model.add(TimeDistributed(Dense(1, activation='sigmoid')))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['acc'])
# train LSTM
for epoch in range(1000):
	# generate new random sequence
	X,y = get_sequence(n_timesteps)
	# fit model for one epoch on this sequence
	model.fit(X, y, epochs=1, batch_size=1, verbose=2)
# evaluate LSTM
X,y = get_sequence(n_timesteps)
yhat = model.predict_classes(X, verbose=0)
for i in range(n_timesteps):
	print('Expected:', y[0, i], 'Predicted', yhat[0, i])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7e387522860401755-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387522860401755-40">40</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387522860401755-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">random</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">cumsum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Bidirectional</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-10"><span class="crayon-p"># create a sequence classification instance</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-11"><span class="crayon-e">def </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-12"><span class="crayon-h"> </span><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-13"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-14"><span class="crayon-h"> </span><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-15"><span class="crayon-h"> </span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-16"><span class="crayon-h"> </span><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-17"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">limit </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">cumsum</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-18"><span class="crayon-h"> </span><span class="crayon-p"># reshape input and output data to be suitable for LSTMs</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-19"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-20"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-22"> </div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-23"><span class="crayon-p"># define problem properties</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-24"><span class="crayon-v">n_timesteps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-25"><span class="crayon-p"># define LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-26"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-27"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Bidirectional</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-28"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-29"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-30"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-31"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-32"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-33"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-34"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-35"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-36"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-37"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-38"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict_classes</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387522860401755-39"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387522860401755-40"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Predicted'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0022 seconds] -->
<p>Running the example, we see a similar output as in the previous example.</p>
<p>The use of bidirectional LSTMs have the effect of allowing the LSTM to learn the problem faster.</p>
<p>This is not apparent from looking at the skill of the model at the end of the run, but instead, the skill of the model over time.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387525072879459" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 1/1
0s - loss: 0.0967 - acc: 0.9000
Epoch 1/1
0s - loss: 0.0865 - acc: 1.0000
Epoch 1/1
0s - loss: 0.0905 - acc: 0.9000
Epoch 1/1
0s - loss: 0.2460 - acc: 0.9000
Epoch 1/1
0s - loss: 0.1458 - acc: 0.9000
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [0] Predicted [0]
Expected: [1] Predicted [1]
Expected: [1] Predicted [1]
Expected: [1] Predicted [1]
Expected: [1] Predicted [1]
Expected: [1] Predicted [1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387525072879459-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e387525072879459-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387525072879459-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-2">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-3">0s - loss: 0.0967 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-4">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-5">0s - loss: 0.0865 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-6">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-7">0s - loss: 0.0905 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-8">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-9">0s - loss: 0.2460 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-10">Epoch 1/1</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-11">0s - loss: 0.1458 - acc: 0.9000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-12">Expected: [0] Predicted [0]</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-13">Expected: [0] Predicted [0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-14">Expected: [0] Predicted [0]</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-15">Expected: [0] Predicted [0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-16">Expected: [0] Predicted [0]</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-17">Expected: [1] Predicted [1]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-18">Expected: [1] Predicted [1]</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-19">Expected: [1] Predicted [1]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387525072879459-20">Expected: [1] Predicted [1]</div><div class="crayon-line" id="crayon-5c0ca7e387525072879459-21">Expected: [1] Predicted [1]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Compare LSTM to Bidirectional LSTM</h2>
<p>In this example, we will compare the performance of traditional LSTMs to a Bidirectional LSTM over time while the models are being trained.</p>
<p>We will adjust the experiment so that the models are only trained for 250 epochs. This is so that we can get a clear idea of how learning unfolds for each model and how the learning behavior differs with bidirectional LSTMs.</p>
<p>We will compare three different models; specifically:</p>
<ol>
<li>LSTM (as-is)</li>
<li>LSTM with reversed input sequences (e.g. you can do this by setting the “go_backwards” argument to he LSTM layer to “True”)</li>
<li>Bidirectional LSTM</li>
</ol>
<p>This comparison will help to show that bidirectional LSTMs can in fact add something more than simply reversing the input sequence.</p>
<p>We will define a function to create and return an LSTM with either forward or backward input sequences, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387528402589764" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def get_lstm_model(n_timesteps, backwards):
	model = Sequential()
	model.add(LSTM(20, input_shape=(n_timesteps, 1), return_sequences=True, go_backwards=backwards))
	model.add(TimeDistributed(Dense(1, activation='sigmoid')))
	model.compile(loss='binary_crossentropy', optimizer='adam')
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387528402589764-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387528402589764-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387528402589764-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387528402589764-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387528402589764-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387528402589764-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387528402589764-1"><span class="crayon-e">def </span><span class="crayon-e">get_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backwards</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387528402589764-2"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387528402589764-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">go_backwards</span><span class="crayon-o">=</span><span class="crayon-v">backwards</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387528402589764-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387528402589764-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387528402589764-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can develop a similar function for bidirectional LSTMs where the merge mode can be specified as an argument. The default of concatenation can be specified by setting the merge mode to the value ‘concat’.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e38752b799848253" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def get_bi_lstm_model(n_timesteps, mode):
	model = Sequential()
	model.add(Bidirectional(LSTM(20, return_sequences=True), input_shape=(n_timesteps, 1), merge_mode=mode))
	model.add(TimeDistributed(Dense(1, activation='sigmoid')))
	model.compile(loss='binary_crossentropy', optimizer='adam')
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e38752b799848253-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38752b799848253-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e38752b799848253-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38752b799848253-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e38752b799848253-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38752b799848253-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e38752b799848253-1"><span class="crayon-e">def </span><span class="crayon-e">get_bi_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38752b799848253-2"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38752b799848253-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Bidirectional</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">merge_mode</span><span class="crayon-o">=</span><span class="crayon-v">mode</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38752b799848253-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38752b799848253-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38752b799848253-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Finally, we define a function to fit a model and retrieve and store the loss each training epoch, then return a list of the collected loss values after the model is fit. This is so that we can graph the log loss from each model configuration and compare them.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e38752e169334948" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def train_model(model, n_timesteps):
	loss = list()
	for _ in range(250):
		# generate new random sequence
		X,y = get_sequence(n_timesteps)
		# fit model for one epoch on this sequence
		hist = model.fit(X, y, epochs=1, batch_size=1, verbose=0)
		loss.append(hist.history['loss'][0])
	return loss</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e38752e169334948-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38752e169334948-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e38752e169334948-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38752e169334948-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e38752e169334948-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38752e169334948-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e38752e169334948-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38752e169334948-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e38752e169334948-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e38752e169334948-1"><span class="crayon-e">def </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38752e169334948-2"><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38752e169334948-3"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">250</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38752e169334948-4"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e38752e169334948-5"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38752e169334948-6"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e38752e169334948-7"><span class="crayon-h"> </span><span class="crayon-v">hist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38752e169334948-8"><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">hist</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38752e169334948-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">loss</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Putting this all together, the complete example is listed below.</p>
<p>First a traditional LSTM is created and fit and the log loss values plot. This is repeated with an LSTM with reversed input sequences and finally an LSTM with a concatenated merge.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387531686778974" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import random
from numpy import array
from numpy import cumsum
from matplotlib import pyplot
from pandas import DataFrame
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import TimeDistributed
from keras.layers import Bidirectional

# create a sequence classification instance
def get_sequence(n_timesteps):
	# create a sequence of random numbers in [0,1]
	X = array([random() for _ in range(n_timesteps)])
	# calculate cut-off value to change class values
	limit = n_timesteps/4.0
	# determine the class outcome for each item in cumulative sequence
	y = array([0 if x &lt; limit else 1 for x in cumsum(X)])
	# reshape input and output data to be suitable for LSTMs
	X = X.reshape(1, n_timesteps, 1)
	y = y.reshape(1, n_timesteps, 1)
	return X, y

def get_lstm_model(n_timesteps, backwards):
	model = Sequential()
	model.add(LSTM(20, input_shape=(n_timesteps, 1), return_sequences=True, go_backwards=backwards))
	model.add(TimeDistributed(Dense(1, activation='sigmoid')))
	model.compile(loss='binary_crossentropy', optimizer='adam')
	return model

def get_bi_lstm_model(n_timesteps, mode):
	model = Sequential()
	model.add(Bidirectional(LSTM(20, return_sequences=True), input_shape=(n_timesteps, 1), merge_mode=mode))
	model.add(TimeDistributed(Dense(1, activation='sigmoid')))
	model.compile(loss='binary_crossentropy', optimizer='adam')
	return model

def train_model(model, n_timesteps):
	loss = list()
	for _ in range(250):
		# generate new random sequence
		X,y = get_sequence(n_timesteps)
		# fit model for one epoch on this sequence
		hist = model.fit(X, y, epochs=1, batch_size=1, verbose=0)
		loss.append(hist.history['loss'][0])
	return loss


n_timesteps = 10
results = DataFrame()
# lstm forwards
model = get_lstm_model(n_timesteps, False)
results['lstm_forw'] = train_model(model, n_timesteps)
# lstm backwards
model = get_lstm_model(n_timesteps, True)
results['lstm_back'] = train_model(model, n_timesteps)
# bidirectional concat
model = get_bi_lstm_model(n_timesteps, 'concat')
results['bilstm_con'] = train_model(model, n_timesteps)
# line plot of results
results.plot()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-42">42</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-44">44</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-46">46</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-48">48</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-50">50</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-52">52</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-54">54</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-56">56</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-58">58</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-60">60</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387531686778974-62">62</div><div class="crayon-num" data-line="crayon-5c0ca7e387531686778974-63">63</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387531686778974-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">random</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">cumsum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-4"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Bidirectional</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-12"><span class="crayon-p"># create a sequence classification instance</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-13"><span class="crayon-e">def </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-14"><span class="crayon-h"> </span><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-15"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-16"><span class="crayon-h"> </span><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-17"><span class="crayon-h"> </span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-18"><span class="crayon-h"> </span><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-19"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">limit </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">cumsum</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-20"><span class="crayon-h"> </span><span class="crayon-p"># reshape input and output data to be suitable for LSTMs</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-21"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-22"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-24"> </div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-25"><span class="crayon-e">def </span><span class="crayon-e">get_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backwards</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-26"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-27"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">go_backwards</span><span class="crayon-o">=</span><span class="crayon-v">backwards</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-28"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-29"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">model</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-32"><span class="crayon-e">def </span><span class="crayon-e">get_bi_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-33"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-34"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Bidirectional</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">merge_mode</span><span class="crayon-o">=</span><span class="crayon-v">mode</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-35"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-36"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-38"> </div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-39"><span class="crayon-e">def </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-40"><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-41"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">250</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-42"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-43"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-44"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-45"><span class="crayon-h"> </span><span class="crayon-v">hist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-46"><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">hist</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-47"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">loss</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-48"> </div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-50"><span class="crayon-v">n_timesteps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-51"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-52"><span class="crayon-p"># lstm forwards</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-53"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-54"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'lstm_forw'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-55"><span class="crayon-p"># lstm backwards</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-56"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-57"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'lstm_back'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-58"><span class="crayon-p"># bidirectional concat</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-59"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bi_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'concat'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-60"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'bilstm_con'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-61"><span class="crayon-p"># line plot of results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387531686778974-62"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387531686778974-63"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0033 seconds] -->
<p>Running the example creates a line plot.</p>
<p>Your specific plot may vary in the details, but will show the same trends.</p>
<p>We can see that the LSTM forward (blue) and LSTM backward (orange) show similar log loss over the 250 training epochs.</p>
<p>We can see that the Bidirectional LSTM log loss is different (green), going down sooner to a lower value and generally staying lower than the other two configurations.</p>
<div class="wp-caption aligncenter" id="attachment_4082" style="width: 650px"><img alt="Line Plot of Log Loss for an LSTM, Reversed LSTM and a Bidirectional LSTM" class="size-full wp-image-4082" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-of-Log-Loss-for-an-LSTM-Reversed-LSTM-and-a-Bidirectional-LSTM.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-of-Log-Loss-for-an-LSTM-Reversed-LSTM-and-a-Bidirectional-LSTM.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-of-Log-Loss-for-an-LSTM-Reversed-LSTM-and-a-Bidirectional-LSTM-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of Log Loss for an LSTM, Reversed LSTM and a Bidirectional LSTM</p></div>
<h2>Comparing Bidirectional LSTM Merge Modes</h2>
<p>There a 4 different merge modes that can be used to combine the outcomes of the Bidirectional LSTM layers.</p>
<p>They are concatenation (default), multiplication, average, and sum.</p>
<p>We can compare the behavior of different merge modes by updating the example from the previous section as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e387534286584356" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_timesteps = 10
results = DataFrame()
# sum merge
model = get_bi_lstm_model(n_timesteps, 'sum')
results['bilstm_sum'] = train_model(model, n_timesteps)
# mul merge
model = get_bi_lstm_model(n_timesteps, 'mul')
results['bilstm_mul'] = train_model(model, n_timesteps)
# avg merge
model = get_bi_lstm_model(n_timesteps, 'ave')
results['bilstm_ave'] = train_model(model, n_timesteps)
# concat merge
model = get_bi_lstm_model(n_timesteps, 'concat')
results['bilstm_con'] = train_model(model, n_timesteps)
# line plot of results
results.plot()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e387534286584356-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e387534286584356-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e387534286584356-1"><span class="crayon-v">n_timesteps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-2"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-3"><span class="crayon-p"># sum merge</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-4"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bi_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sum'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-5"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'bilstm_sum'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-6"><span class="crayon-p"># mul merge</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-7"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bi_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mul'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-8"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'bilstm_mul'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-9"><span class="crayon-p"># avg merge</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-10"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bi_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'ave'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-11"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'bilstm_ave'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-12"><span class="crayon-p"># concat merge</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-13"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_bi_lstm_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'concat'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-14"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'bilstm_con'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-15"><span class="crayon-p"># line plot of results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e387534286584356-16"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e387534286584356-17"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Running the example will create a line plot comparing the log loss of each merge mode.</p>
<p>Your specific plot may differ but will show the same behavioral trends.</p>
<p>The different merge modes result in different model performance, and this will vary depending on your specific sequence prediction problem.</p>
<p>In this case, we can see that perhaps a sum (blue) and concatenation (red) merge mode may result in better performance, or at least lower log loss.</p>
<div class="wp-caption aligncenter" id="attachment_4083" style="width: 650px"><img alt="Line Plot to Compare Merge Modes for Bidirectional LSTMs" class="size-full wp-image-4083" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-to-Compare-Merge-Modes-for-Bidirectional-LSTMs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-to-Compare-Merge-Modes-for-Bidirectional-LSTMs.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Line-Plot-to-Compare-Merge-Modes-for-Bidirectional-LSTMs-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot to Compare Merge Modes for Bidirectional LSTMs</p></div>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop Bidirectional LSTMs for sequence classification in Python with Keras.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a contrived sequence classification problem.</li>
<li>How to develop an LSTM and Bidirectional LSTM for sequence classification.</li>
<li>How to compare merge modes for Bidirectional LSTMs for sequence classification.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4081 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+a+Bidirectional+LSTM+For+Sequence+Classification+in+Python+with+Keras&amp;url=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/reproducible-results-neural-networks-keras/" rel="prev"><i class="fa fa-angle-left"></i> How to Get Reproducible Results with Keras</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/" rel="next">Data Preparation for Variable Length Input Sequences <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">110 Responses to <em>How to Develop a Bidirectional LSTM For Sequence Classification in Python with Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-402970">
<div class="comment-container" id="li-comment-402970">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bb10cf51dd0b2ea7640743552ac99181?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bb10cf51dd0b2ea7640743552ac99181?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Siddharth</span>
<span class="date">June 18, 2017 at 4:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-402970" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great post! Do you think bidirectional LSTMs can be used for time series prediciton problems?</p>
<div class="reply">
<a aria-label="Reply to Siddharth" class="comment-reply-link" href="#comment-402970" onclick='return addComment.moveForm( "comment-402970", "402970", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403020">
<div class="comment-container" id="li-comment-403020">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 19, 2017 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-403020" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the question is, can they lift performance on your problem. Try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-403020" onclick='return addComment.moveForm( "comment-403020", "403020", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-402978">
<div class="comment-container" id="li-comment-402978">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bc113f88db1ceb3b299e4c592fe46969?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bc113f88db1ceb3b299e4c592fe46969?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Orozcohsu</span>
<span class="date">June 18, 2017 at 6:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-402978" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Greatest ,thank you</p>
<div class="reply">
<a aria-label="Reply to Orozcohsu" class="comment-reply-link" href="#comment-402978" onclick='return addComment.moveForm( "comment-402978", "402978", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403025">
<div class="comment-container" id="li-comment-403025">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 19, 2017 at 8:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-403025" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad it helped!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-403025" onclick='return addComment.moveForm( "comment-403025", "403025", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-403053">
<div class="comment-container" id="li-comment-403053">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dbc112a220b4c0d6f974b07f7e032ff9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dbc112a220b4c0d6f974b07f7e032ff9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">truongtrang</span>
<span class="date">June 19, 2017 at 3:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-403053" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason,<br/>
In fact, I usually need to use multi thread ( multi worker) for load model Keras for improve performance for my system. But when I use multi thread to work with model Keras, its so error with graph, so I used multi process instead. I wana ask you have another solution for multi worker with Keras? Hope you can understand what i say.<br/>
Thank you.</p>
<div class="reply">
<a aria-label="Reply to truongtrang" class="comment-reply-link" href="#comment-403053" onclick='return addComment.moveForm( "comment-403053", "403053", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403120">
<div class="comment-container" id="li-comment-403120">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 20, 2017 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-403120" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I would recommend using GPUs on AWS:<br/>
<a href="http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/" rel="nofollow">http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-403120" onclick='return addComment.moveForm( "comment-403120", "403120", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-403071">
<div class="comment-container" id="li-comment-403071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7e27af22a567c6f5791d053052dae57f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7e27af22a567c6f5791d053052dae57f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yitzhak</span>
<span class="date">June 20, 2017 at 12:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-403071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, Jason, such a great post !</p>
<div class="reply">
<a aria-label="Reply to Yitzhak" class="comment-reply-link" href="#comment-403071" onclick='return addComment.moveForm( "comment-403071", "403071", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403125">
<div class="comment-container" id="li-comment-403125">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 20, 2017 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-403125" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome Yitzhak.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-403125" onclick='return addComment.moveForm( "comment-403125", "403125", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-404472">
<div class="comment-container" id="li-comment-404472">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4feb73ababfa797e7e5fa0ce0412ec95?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4feb73ababfa797e7e5fa0ce0412ec95?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">John Jaro</span>
<span class="date">July 2, 2017 at 12:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-404472" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason, thanks greatly for your work. I’ve read probably 50 of your blog articles! </p>
<p>I’m still struggling to understand how to reshape lagged data for LSTM and would greatly appreciate your help.</p>
<p>I’m working on sequence classification on time-series data over multiple days. I’ve lagged the data together (2D) and created differential features using code very similar to yours, and generated multiple look forward and look backward features over a window of about +5 and -4:</p>
<p><code></code><code><br/>
# frame a sequence as a supervised learning problem<br/>
def timeseries_to_supervised(data, lag=1):<br/>
	df = DataFrame(data)<br/>
	columns = [df.shift(i) for i in range(1, lag+1)]<br/>
	columns.append(df)<br/>
	df = concat(columns, axis=1)<br/>
	return df<br/>
</code><code></code></p>
<p>I’ve gotten decent results with Conv1D residual networks on my dataset, but my experiments with LSTM are total failures. </p>
<p>I reshape the data for Conv1D like so: <code>X = X.reshape(X.shape[0], X.shape[1], 1)</code></p>
<p>Is this same data shape appropriate for LSTM or Bidirectional LSTM? I think it needs to be different, but I cannot figure out how despite hours of searching. </p>
<p>Thanks for your assistance if any!</p>
<div class="reply">
<a aria-label="Reply to John Jaro" class="comment-reply-link" href="#comment-404472" onclick='return addComment.moveForm( "comment-404472", "404472", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-404474">
<div class="comment-container" id="li-comment-404474">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4feb73ababfa797e7e5fa0ce0412ec95?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4feb73ababfa797e7e5fa0ce0412ec95?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">John Jaro</span>
<span class="date">July 2, 2017 at 12:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-404474" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>By the way, my question is not a prediction task – it’s multi class classification: looking at a particular day’s data in combination with surrounding lagged/diff’d day’s data and saying it is one of 10 different types of events.</p>
<div class="reply">
<a aria-label="Reply to John Jaro" class="comment-reply-link" href="#comment-404474" onclick='return addComment.moveForm( "comment-404474", "404474", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-404503">
<div class="comment-container" id="li-comment-404503">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 2, 2017 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-404503" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great. Sequence classification.</p>
<p>One day might be one sequence and be comprised of lots of time steps for lots of features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-404503" onclick='return addComment.moveForm( "comment-404503", "404503", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404502">
<div class="comment-container" id="li-comment-404502">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 2, 2017 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-404502" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks John!</p>
<p>Are you working on a sequence classification problem or sequence regression problem? Do you want to classify a whole sequence or predict the next value in the sequence? This will determine the type of LSTM you want.</p>
<p>The input to LSTMs is 3d with the form [samples, time steps, features].</p>
<p>Samples are sequences.<br/>
Time steps are lag obs.<br/>
Features are things measured at each time step.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-404502" onclick='return addComment.moveForm( "comment-404502", "404502", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-404566">
<div class="comment-container" id="li-comment-404566">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/73add705b06c2dfdfcf07c1dc4ac1eb2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/73add705b06c2dfdfcf07c1dc4ac1eb2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jilian</span>
<span class="date">July 2, 2017 at 11:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-404566" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,<br/>
Thank you for this blog .<br/>
 i want to use  a 2D LSTM (the same as  gridlstm or multi diagonal LSTM)  after CNN,the input is image with 3D RGB (W * H * D)<br/>
does the keras develop GridLSTM or multi-directional LSTM.<br/>
 i saw the tensorflow develop the GridLSTM.can link it into keras?<br/>
Thank you.</p>
<div class="reply">
<a aria-label="Reply to jilian" class="comment-reply-link" href="#comment-404566" onclick='return addComment.moveForm( "comment-404566", "404566", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404584">
<div class="comment-container" id="li-comment-404584">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 3, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-404584" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use a CNN as a front-end model for LSTM.</p>
<p>Sorry, I’ve not heard of “grid lstm” or “multi-directional lstm”.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-404584" onclick='return addComment.moveForm( "comment-404584", "404584", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-408417">
<div class="comment-container" id="li-comment-408417">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c2f9508572917259dc0cc6d709295df5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c2f9508572917259dc0cc6d709295df5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Marianico</span>
<span class="date">August 3, 2017 at 7:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-408417" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice post, Jason! I have two questions:</p>
<p>1.- May Bidirectional() work in a regression model without TimeDistributed() wrapper?<br/>
2.- May I have two Bidirectional() layers, or the model would be a far too complex?<br/>
3.- Does Bidirectional() requires more input data to train?</p>
<p>Thank you in advance! 🙂</p>
<div class="reply">
<a aria-label="Reply to Marianico" class="comment-reply-link" href="#comment-408417" onclick='return addComment.moveForm( "comment-408417", "408417", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-408471">
<div class="comment-container" id="li-comment-408471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 4, 2017 at 6:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-408471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Marianico,</p>
<p>1. sure.<br/>
2. you can if you want, try it.<br/>
3. it may, test this assumption.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-408471" onclick='return addComment.moveForm( "comment-408471", "408471", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415017">
<div class="comment-container" id="li-comment-415017">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet Ali</span>
<span class="date">September 28, 2017 at 10:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-415017" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you so much Mr Jason!</p>
<div class="reply">
<a aria-label="Reply to Thabet Ali" class="comment-reply-link" href="#comment-415017" onclick='return addComment.moveForm( "comment-415017", "415017", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415042">
<div class="comment-container" id="li-comment-415042">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 29, 2017 at 5:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-415042" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-415042" onclick='return addComment.moveForm( "comment-415042", "415042", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417720">
<div class="comment-container" id="li-comment-417720">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ae870ec4ca954316607bbb2ff66b8ea?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ae870ec4ca954316607bbb2ff66b8ea?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zhong</span>
<span class="date">October 24, 2017 at 2:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-417720" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>very nice post, Jason. I am working on a CNN+LSTM problem atm. This post is really helpful.</p>
<p>By the way, do you have some experience of CNN + LSTM for sequence classification. The inputs are frames of medical scans over time. </p>
<p>We are experiencing a quick overfitting (95% accuracy after 5 epochs).</p>
<p>What is the best practice to slow down the overfitting?</p>
<div class="reply">
<a aria-label="Reply to Zhong" class="comment-reply-link" href="#comment-417720" onclick='return addComment.moveForm( "comment-417720", "417720", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417740">
<div class="comment-container" id="li-comment-417740">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 24, 2017 at 4:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-417740" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I have a small example in my book.</p>
<p>Consider dropout and other forms of regularization. Also try larger batch sizes.</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417740" onclick='return addComment.moveForm( "comment-417740", "417740", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-423140">
<div class="comment-container" id="li-comment-423140">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/079de89c587d1132d0dd201a227bf34a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/079de89c587d1132d0dd201a227bf34a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ed</span>
<span class="date">December 15, 2017 at 3:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-423140" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason! First of all congratulations on your work, I have been learning a lot through your posts.</p>
<p>Regarding this topic: I am handling a problem where I have time series with different size, and I want to binary classify each fixed-size window of each time series.</p>
<p>I know that n_timesteps should be the fixed-size of the window, but then I will have a different number of samples for each time series. A solution might be defining a fixed sample size and add “zero” windows to smaller time series, but I would like to know if there are other options. Do you have any suggestion to overcome this problem?</p>
<p>Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Ed" class="comment-reply-link" href="#comment-423140" onclick='return addComment.moveForm( "comment-423140", "423140", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423164">
<div class="comment-container" id="li-comment-423164">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 15, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-423164" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Ed, yes, use zero padding and a mask to ignore zero values.</p>
<p>If you know you need to make a prediction every n steps, consider splitting each group of n steps into separate samples of length n. It will make modeling so much easier.</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-423164" onclick='return addComment.moveForm( "comment-423164", "423164", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423250">
<div class="comment-container" id="li-comment-423250">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/56690550578ae3f13d8f938100b2ebbc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/56690550578ae3f13d8f938100b2ebbc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Saisaisun</span>
<span class="date">December 15, 2017 at 8:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-423250" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,<br/>
I have a question on how to output each timestep of a sequence using LSTM. My problem is 0-1 classification. All I want to do is for one sample (a sequence) to output many labels (corresponding to this sequence). My data are all 3D, including labels and input. But the output I got is wrong. All of them (predicted labels) were 0.<br/>
Here is my code:</p>
<p>###<br/>
        model = Sequential()<br/>
        model.add(Masking(mask_value= 0,input_shape=(maxlen,feature_dim)))<br/>
        model.add (LSTM(int(topos[0]), activation=act, kernel_initializer=’normal’, return_sequences=True))<br/>
        model.add(TimeDistributed(Dense(1, activation=’sigmoid’)))<br/>
        model.compile(loss=’binary_crossentropy’, optimizer=opt, metrics=[‘accuracy’])<br/>
        model.fit(x_train, y_train, batch_size=batch_size, epochs=epochs, verbose=1, callbacks=[tensorboard], validation_data=(x_val,y_val), shuffle=True, initial_epoch=0)<br/>
###</p>
<p>Is this right? Thank you so much.</p>
<div class="reply">
<a aria-label="Reply to Saisaisun" class="comment-reply-link" href="#comment-423250" onclick='return addComment.moveForm( "comment-423250", "423250", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423331">
<div class="comment-container" id="li-comment-423331">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-423331" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you need a larger model, more training, more data, etc… </p>
<p>Here are some ideas:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-423331" onclick='return addComment.moveForm( "comment-423331", "423331", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-425052">
<div class="comment-container" id="li-comment-425052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a4f5d627335ca1651a97fe8a9c1d181b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a4f5d627335ca1651a97fe8a9c1d181b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">devi</span>
<span class="date">December 28, 2017 at 9:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-425052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>very good post,I am trying to try it.</p>
<div class="reply">
<a aria-label="Reply to devi" class="comment-reply-link" href="#comment-425052" onclick='return addComment.moveForm( "comment-425052", "425052", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425075">
<div class="comment-container" id="li-comment-425075">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 29, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-425075" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425075" onclick='return addComment.moveForm( "comment-425075", "425075", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-425537">
<div class="comment-container" id="li-comment-425537">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8fed573c9282e4a45f152dd15b3ed8b3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8fed573c9282e4a45f152dd15b3ed8b3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Namrata</span>
<span class="date">January 3, 2018 at 11:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-425537" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Are we feeding one sequence value[i.e sequence[i]] at each time step into the LSTM? If this is true, does this sequence[i] go through all the memory units in the LSTM? Or does it progressively go through each memory unit as timesteps are incremented?</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Namrata" class="comment-reply-link" href="#comment-425537" onclick='return addComment.moveForm( "comment-425537", "425537", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425579">
<div class="comment-container" id="li-comment-425579">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 8:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-425579" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Each input is passed through all units in the layer at the same time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425579" onclick='return addComment.moveForm( "comment-425579", "425579", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427005">
<div class="comment-container" id="li-comment-427005">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/53f91359c1857ad825530aa606635e1c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/53f91359c1857ad825530aa606635e1c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jacob</span>
<span class="date">January 20, 2018 at 2:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427005" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great post, Jason. I learn best from examples. I bought a series of your books and feel like I have learned more from them then actual courses and am very satisfied with them.</p>
<div class="reply">
<a aria-label="Reply to Jacob" class="comment-reply-link" href="#comment-427005" onclick='return addComment.moveForm( "comment-427005", "427005", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427046">
<div class="comment-container" id="li-comment-427046">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2018 at 9:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427046" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jacob, I write to help people and it is great to hear that it is helping!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427046" onclick='return addComment.moveForm( "comment-427046", "427046", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427079">
<div class="comment-container" id="li-comment-427079">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2929b855a8a3073a65fdc8a0bdd28725?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2929b855a8a3073a65fdc8a0bdd28725?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ami Tabak</span>
<span class="date">January 22, 2018 at 12:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427079" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
I’m looking into predicting a cosine series based on input sine series<br/>
I tried redefining the get_sequence as follows:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e38b275357016072" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def get_sequence(n_timesteps):
    # create a sequence of random numbers in [0,1]
    start = (random() + n_timesteps) % (2 * math.pi)
    end = start + (2 * math.pi)
    X = np.sin((np.arange(start,end, (end - start) / n_timesteps))) 
    # calculate cut-off value to change class values
    limit = n_timesteps/4.0
    # determine the class outcome for each item in cumulative sequence
    y = np.cos(X)
    # reshape input and output data to be suitable for LSTMs
    X = X.reshape(1, n_timesteps, 1)
    y = y.reshape(1, n_timesteps, 1)
    return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e38b275357016072-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b275357016072-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e38b275357016072-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b275357016072-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e38b275357016072-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b275357016072-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e38b275357016072-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b275357016072-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e38b275357016072-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b275357016072-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e38b275357016072-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b275357016072-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e38b275357016072-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e38b275357016072-1"><span class="crayon-e">def </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b275357016072-2"><span class="crayon-h">    </span><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line" id="crayon-5c0ca7e38b275357016072-3"><span class="crayon-h">    </span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-v">pi</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b275357016072-4"><span class="crayon-h">    </span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-v">pi</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b275357016072-5"><span class="crayon-h">    </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">sin</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">arange</span><span class="crayon-sy">(</span><span class="crayon-v">start</span><span class="crayon-sy">,</span><span class="crayon-st">end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b275357016072-6"><span class="crayon-h">    </span><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line" id="crayon-5c0ca7e38b275357016072-7"><span class="crayon-h">    </span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b275357016072-8"><span class="crayon-h">    </span><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e38b275357016072-9"><span class="crayon-h">    </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b275357016072-10"><span class="crayon-h">    </span><span class="crayon-p"># reshape input and output data to be suitable for LSTMs</span></div><div class="crayon-line" id="crayon-5c0ca7e38b275357016072-11"><span class="crayon-h">    </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b275357016072-12"><span class="crayon-h">    </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b275357016072-13"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
<p>in the main i changed the loss function to use MSE as ‘binary_crossentropy’ to my understanding produces a 0/1 loss and I’m looking at a continues function use case<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’, metrics=[‘acc’])</p>
<p>Alas the model doesn’t converge and results in binary like results.</p>
<p>Expected: [ 0.55061242] Predicted [1]</p>
<p>Any suggestions ? </p>
<p>BR<br/>
Ami</p>
<p>Full modified code:<br/>
===============</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e38b281252754315" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import math
import numpy as np
from random import random
from numpy import array
from numpy import cumsum
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import TimeDistributed
 
# create a sequence classification instance
def get_sequence(n_timesteps):
    # create a sequence of random numbers in [0,1]
    start = (random() + n_timesteps) % (2 * math.pi)
    end = start + (2 * math.pi)
    X = np.sin((np.arange(start,end, (end - start) / n_timesteps))) 
    # calculate cut-off value to change class values
    limit = n_timesteps/4.0
    # determine the class outcome for each item in cumulative sequence
    y = np.cos(X)
    # reshape input and output data to be suitable for LSTMs
    X = X.reshape(1, n_timesteps, 1)
    y = y.reshape(1, n_timesteps, 1)
    return X, y
 
# define problem properties
n_timesteps = 100
# define LSTM
model = Sequential()
model.add(LSTM(20, input_shape=(n_timesteps, 1), return_sequences=True))
model.add(TimeDistributed(Dense(1, activation='sigmoid')))
model.compile(loss='mean_squared_error', optimizer='adam', metrics=['acc'])
# train LSTM
for epoch in range(1000):
    # generate new random sequence
    X,y = get_sequence(n_timesteps)
    # fit model for one epoch on this sequence
    model.fit(X, y, epochs=1, batch_size=1, verbose=2)
# evaluate LSTM
X,y = get_sequence(n_timesteps)
yhat = model.predict_classes(X, verbose=0)
for i in range(n_timesteps):
    print('Expected:', y[0, i], 'Predicted', yhat[0, i])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e38b281252754315-42">42</div><div class="crayon-num" data-line="crayon-5c0ca7e38b281252754315-43">43</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-1"><span class="crayon-e">import </span><span class="crayon-e">math</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-2"><span class="crayon-e">import </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-3"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">random</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">cumsum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-10"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-11"><span class="crayon-p"># create a sequence classification instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-12"><span class="crayon-e">def </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-13"><span class="crayon-h">    </span><span class="crayon-p"># create a sequence of random numbers in [0,1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-14"><span class="crayon-h">    </span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">random</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-v">pi</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-15"><span class="crayon-h">    </span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-v">pi</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-16"><span class="crayon-h">    </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">sin</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">arange</span><span class="crayon-sy">(</span><span class="crayon-v">start</span><span class="crayon-sy">,</span><span class="crayon-st">end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-17"><span class="crayon-h">    </span><span class="crayon-p"># calculate cut-off value to change class values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-18"><span class="crayon-h">    </span><span class="crayon-v">limit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-19"><span class="crayon-h">    </span><span class="crayon-p"># determine the class outcome for each item in cumulative sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-20"><span class="crayon-h">    </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-21"><span class="crayon-h">    </span><span class="crayon-p"># reshape input and output data to be suitable for LSTMs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-22"><span class="crayon-h">    </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-23"><span class="crayon-h">    </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-24"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-25"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-26"><span class="crayon-p"># define problem properties</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-27"><span class="crayon-v">n_timesteps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-28"><span class="crayon-p"># define LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-29"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-30"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-31"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-32"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-33"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-34"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-35"><span class="crayon-h">    </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-36"><span class="crayon-h">    </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-37"><span class="crayon-h">    </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-38"><span class="crayon-h">    </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-39"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-40"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-41"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict_classes</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e38b281252754315-42"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e38b281252754315-43"><span class="crayon-h">    </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Predicted'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0033 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Ami Tabak" class="comment-reply-link" href="#comment-427079" onclick='return addComment.moveForm( "comment-427079", "427079", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427092">
<div class="comment-container" id="li-comment-427092">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 22, 2018 at 4:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427092" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a long list of general ideas here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427092" onclick='return addComment.moveForm( "comment-427092", "427092", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427733">
<div class="comment-container" id="li-comment-427733">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harish Yadav</span>
<span class="date">January 27, 2018 at 5:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427733" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>we dont need to modify anything ….just put bidirectional layer…that’t it ….is there anything we have to modify in different problems like [Neural machine translation]…</p>
<div class="reply">
<a aria-label="Reply to Harish Yadav" class="comment-reply-link" href="#comment-427733" onclick='return addComment.moveForm( "comment-427733", "427733", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427770">
<div class="comment-container" id="li-comment-427770">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 28, 2018 at 8:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427770" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not really.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427770" onclick='return addComment.moveForm( "comment-427770", "427770", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427863">
<div class="comment-container" id="li-comment-427863">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harish Yadav</span>
<span class="date">January 29, 2018 at 8:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427863" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how to add attention layer in decoder…..that thing also one line of code i think…</p>
<div class="reply">
<a aria-label="Reply to Harish Yadav" class="comment-reply-link" href="#comment-427863" onclick='return addComment.moveForm( "comment-427863", "427863", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427912">
<div class="comment-container" id="li-comment-427912">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 30, 2018 at 9:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-427912" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See these posts:<br/>
<a href="https://machinelearningmastery.com/?s=attention&amp;submit=Search" rel="nofollow">https://machinelearningmastery.com/?s=attention&amp;submit=Search</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427912" onclick='return addComment.moveForm( "comment-427912", "427912", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-429211">
<div class="comment-container" id="li-comment-429211">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/abc7d70544983705a3d362d14248ee2e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/abc7d70544983705a3d362d14248ee2e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shivam</span>
<span class="date">February 12, 2018 at 9:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-429211" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,<br/>
Is bidirectional lstm and bidirectional rnn one and the same?</p>
<div class="reply">
<a aria-label="Reply to Shivam" class="comment-reply-link" href="#comment-429211" onclick='return addComment.moveForm( "comment-429211", "429211", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-429259">
<div class="comment-container" id="li-comment-429259">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 13, 2018 at 8:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-429259" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>A bidirectional LSTM is a bidirectional RNN. A bidirectional GRU is also a bidirectional RNN.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-429259" onclick='return addComment.moveForm( "comment-429259", "429259", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-429231">
<div class="comment-container" id="li-comment-429231">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7efbf017fbc772f5f08c030b2aa9bd55?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7efbf017fbc772f5f08c030b2aa9bd55?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ehud Schreiber</span>
<span class="date">February 13, 2018 at 2:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-429231" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>thanks for a very clear and informative post.</p>
<p>My data consists of many time-series of different lengths, which may be very different and grow quite large – from minutes to more than an hour of 1 Hz samples.</p>
<p>Is there a way, therefore, not to specify n_timesteps in the definition of the model, as it doesn’t really need it then, but only when fitting or predicting?</p>
<p>I really wouldn’t want to arbitrarily cut my sequences or pad them with a lot of unnecessary “zeros”.</p>
<p>By the way, I’m trying to detect rather rare occurrences of some event(s) along the sequence; hopefully a sigmoid predicted probability with an appropriate threshold would do the trick.</p>
<p>Thanks,<br/>
Ehud.</p>
<div class="reply">
<a aria-label="Reply to Ehud Schreiber" class="comment-reply-link" href="#comment-429231" onclick='return addComment.moveForm( "comment-429231", "429231", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-429266">
<div class="comment-container" id="li-comment-429266">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 13, 2018 at 8:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-429266" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can pad with zeros and use a Mask to ignore the zero values.</p>
<p>I have many examples on the blog.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-429266" onclick='return addComment.moveForm( "comment-429266", "429266", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-430515">
<div class="comment-container" id="li-comment-430515">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">shamsul</span>
<span class="date">February 26, 2018 at 12:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-430515" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sir, can bidirectional lstm be used for sequence or time series forecasting?</p>
<div class="reply">
<a aria-label="Reply to shamsul" class="comment-reply-link" href="#comment-430515" onclick='return addComment.moveForm( "comment-430515", "430515", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430524">
<div class="comment-container" id="li-comment-430524">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 26, 2018 at 2:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-430524" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps, try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430524" onclick='return addComment.moveForm( "comment-430524", "430524", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-431749">
<div class="comment-container" id="li-comment-431749">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ee454ed2aa1387fa0380f1c8b10c437d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ee454ed2aa1387fa0380f1c8b10c437d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Matthew</span>
<span class="date">March 10, 2018 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-431749" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Do you need the full data sequence at test time, or can it be run on each input online?</p>
<p>Another way of asking this is: is Bidirectional LSTM just a modification at training time, or does it limit you to having the full sequence for classification?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Matthew" class="comment-reply-link" href="#comment-431749" onclick='return addComment.moveForm( "comment-431749", "431749", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-431751">
<div class="comment-container" id="li-comment-431751">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 10, 2018 at 6:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-431751" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends what the model expects to receive as input in order to make a prediction.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431751" onclick='return addComment.moveForm( "comment-431751", "431751", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-434227">
<div class="comment-container" id="li-comment-434227">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/983fe659874c12c9be3012fe434766af?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/983fe659874c12c9be3012fe434766af?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">brent</span>
<span class="date">April 5, 2018 at 6:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-434227" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason. It’s great for me as a beginner of  LSTM. Thank you so much.<br/>
My RQ is about grammatical error detection, eg. people who are good at maths has more chances to succeed.  How to detect “has” in this sentence is wrong? This problem is quite different from the example you give.<br/>
My proposal is that: first find the verb “has” by a postagger, then vectorize the left context “people who are good at maths” and train lstm, then vectorize the right context backwords “more chances to succeed ” and train lstm. Finally, predcit the word “has” as 0 or 1. Is this a bi-lstm?<br/>
If it is, we have so many sentences with different length and the input size is changable, how to deal with this prob? Especially, samples are the total sentences, and what are the timesteps and features?</p>
<div class="reply">
<a aria-label="Reply to brent" class="comment-reply-link" href="#comment-434227" onclick='return addComment.moveForm( "comment-434227", "434227", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434265">
<div class="comment-container" id="li-comment-434265">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 6, 2018 at 6:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-434265" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like a fun project.</p>
<p>For variable length input sequences, I would recommend zero-padding and using a masking input layer to ignore the zero inputs.</p>
<p>More info here:<br/>
<a href="https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/" rel="nofollow">https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434265" onclick='return addComment.moveForm( "comment-434265", "434265", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-435633">
<div class="comment-container" id="li-comment-435633">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f7576917e487fea347e69d107c0f1c70?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f7576917e487fea347e69d107c0f1c70?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Willard</span>
<span class="date">April 22, 2018 at 12:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-435633" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When you train a model with the go_backwards flag set on the LSTM layer, is the prediction reversed when you make a prediction on the model?  Or does the prediction come out forwards?</p>
<div class="reply">
<a aria-label="Reply to Willard" class="comment-reply-link" href="#comment-435633" onclick='return addComment.moveForm( "comment-435633", "435633", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-435668">
<div class="comment-container" id="li-comment-435668">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 23, 2018 at 6:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-435668" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It comes out normally. </p>
<p>Think of the time series as a sequence used to predict the next step. We have the whole sequence in memory, so we can read it forward or backward or even in a stateless (time independent) way – all in order to predict the next step.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435668" onclick='return addComment.moveForm( "comment-435668", "435668", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-435730">
<div class="comment-container" id="li-comment-435730">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/561a16d6a33a47ab69136baf64c102fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/561a16d6a33a47ab69136baf64c102fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jeremiah</span>
<span class="date">April 24, 2018 at 12:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-435730" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good stuff it clearly explains how to use bidirectional lstm. Hope this code works with the current version of tensorflow and keras as of the time of this writing</p>
<div class="reply">
<a aria-label="Reply to Jeremiah" class="comment-reply-link" href="#comment-435730" onclick='return addComment.moveForm( "comment-435730", "435730", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-435768">
<div class="comment-container" id="li-comment-435768">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 24, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-435768" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<p>My code works fine. I keep all tutorials updated, when issues are pointed out.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435768" onclick='return addComment.moveForm( "comment-435768", "435768", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-436329">
<div class="comment-container" id="li-comment-436329">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/561a16d6a33a47ab69136baf64c102fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/561a16d6a33a47ab69136baf64c102fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jeremiah</span>
<span class="date">May 1, 2018 at 2:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-436329" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>why is it when doing model.add(TimeDistributed(Dense(2, activation=’sigmoid’)) doesn’t work.. Please explain</p>
<div class="reply">
<a aria-label="Reply to Jeremiah" class="comment-reply-link" href="#comment-436329" onclick='return addComment.moveForm( "comment-436329", "436329", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-436347">
<div class="comment-container" id="li-comment-436347">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 1, 2018 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-436347" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem?</p>
<p>Perhaps post your code and error to stackoverflow?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436347" onclick='return addComment.moveForm( "comment-436347", "436347", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-436333">
<div class="comment-container" id="li-comment-436333">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/561a16d6a33a47ab69136baf64c102fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/561a16d6a33a47ab69136baf64c102fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jeremiah</span>
<span class="date">May 1, 2018 at 4:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-436333" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Oops..sorry. Have reasoned it out. Thanks though for the tutorial.</p>
<div class="reply">
<a aria-label="Reply to Jeremiah" class="comment-reply-link" href="#comment-436333" onclick='return addComment.moveForm( "comment-436333", "436333", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-436349">
<div class="comment-container" id="li-comment-436349">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 1, 2018 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-436349" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436349" onclick='return addComment.moveForm( "comment-436349", "436349", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-437048">
<div class="comment-container" id="li-comment-437048">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sumeet</span>
<span class="date">May 9, 2018 at 9:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437048" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sir ,<br/>
I am working on an RNN that can tell word beginning and ending.<br/>
Let me explain.<br/>
For training, I have wav file containing a sentence (say I am a person) and a group of words. I also have information which says that word  ‘I’ appear in interval [20-30], am in [50-70] , ‘a’ in [85-90] and ‘person’ in [115-165] timsteps.<br/>
Now I want RNN to find word position in unknown sentence.<br/>
It does not have to tell what the word is , just the beginning and end of it.<br/>
So number of classes will be atleast three because a timestep can be classified as word_beginning,word_end,something_else.<br/>
Something_else may indicate silence zone or time inside a word.</p>
<p>So far , I have considered of splitting wav file into sequence of overlapping windows.<br/>
mfcc allows – successive 25 ms windows with overlap of 15ms by default so we can get 13 or 26 mfcc coefficients at each time step.</p>
<p>it is not a binary classification problem as there are multiple classes involved.<br/>
Need your thoughts on this .</p>
<p>Thanks for listening.</p>
<div class="reply">
<a aria-label="Reply to sumeet" class="comment-reply-link" href="#comment-437048" onclick='return addComment.moveForm( "comment-437048", "437048", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437082">
<div class="comment-container" id="li-comment-437082">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 10, 2018 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437082" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like a great problem and a good start. </p>
<p>I expect a lot of model tuning will be required.</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437082" onclick='return addComment.moveForm( "comment-437082", "437082", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-437327">
<div class="comment-container" id="li-comment-437327">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sumeet</span>
<span class="date">May 12, 2018 at 12:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437327" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sir , i need your expert opinion on this.<br/>
Currently i am casting it into binary classification.<br/>
Simply the data is split into middle (=frames inside a spoken word)and ending(=frames at word boundary)<br/>
I am hoping that silence between two words will be learnt as class ‘ending’.<br/>
But it is not working.<br/>
It seems that the neural network is classifying everything as ‘middle’ . Though I have given 38k samples of both classes in training folder.<br/>
I think , I am doing something basic wrong here.<br/>
here is the code<br/>
[code]<br/>
import math<br/>
import os<br/>
import random<br/>
from python_speech_features import mfcc<br/>
import scipy.io.wavfile as wav<br/>
import numpy as np<br/>
import tensorflow as tf<br/>
from scipy import stats<br/>
import re</p>
<p>WORD_LIST=[‘middle’,’ending’]<br/>
TEST_WORD_LIST=[‘middle’,’ending’]<br/>
MAX_STEPS=11<br/>
BATCH_SIZE=500<br/>
EPOCH=5000<br/>
INTERVAL=1</p>
<p>test_input=[]<br/>
train_input=[]<br/>
train_output=[]<br/>
test_output=[]<br/>
deviation_list=[]</p>
<p>def create_test_data(word):<br/>
    index = WORD_LIST.index(word) if word in WORD_LIST else -1<br/>
    files = os.listdir(‘/home/lxuser/test_data/’+word)<br/>
    length_of_folder=len(files)<br/>
    interval=INTERVAL<br/>
    j=0<br/>
    for i in range(int(length_of_folder/interval)):<br/>
        filecount=int(math.floor(j))<br/>
        (test_rate,test_sig) = wav.read(‘/home/lxuser/test_data/’+word+’/’+files[filecount])<br/>
        test_mfcc_feat = mfcc(test_sig,test_rate,numcep=26)<br/>
        sth=test_mfcc_feat.shape[0]<br/>
        test_padded_array=np.pad(test_mfcc_feat,[(MAX_STEPS-sth,0),(0,0)],’constant’)<br/>
        test_input.append(test_padded_array)<br/>
        temp_list = [0]*2<br/>
        temp_list[index]=1<br/>
        test_output.append(temp_list)<br/>
        if(word==’middle’):<br/>
            deviation_list.append(-1)<br/>
        else:<br/>
            value=int(re.search(r’\d+’,files[filecount]).group())<br/>
            deviation_list.append(value)<br/>
        j=j+interval<br/>
        if(j&gt;length_of_folder-1):<br/>
            j=0</p>
<p>def make_train_data(word):<br/>
    int_class = WORD_LIST.index(word) if word in WORD_LIST else -1<br/>
    files = os.listdir(‘/home/lxuser/train_dic/’+word)<br/>
    length_of_folder=len(files)<br/>
    interval=INTERVAL<br/>
    random.shuffle(files)<br/>
    j=0<br/>
    for i in range(int(length_of_folder/interval)):<br/>
        (train_rate,train_sig) = wav.read(‘/home/lxuser/train_dic/’+word+’/’+files[int(math.floor(j))])<br/>
#       print(word,files[int(math.floor(j))],’in training’)<br/>
        train_mfcc_feat = mfcc(train_sig,train_rate,numcep=26)<br/>
        train_test_mfcc_feat=train_mfcc_feat<br/>
        sth=train_mfcc_feat.shape[0]<br/>
        train_padded_array=np.pad(train_mfcc_feat,[(MAX_STEPS-sth,0),(0,0)],’constant’)<br/>
        train_input.append(train_padded_array)<br/>
        temp_list = [0]*2<br/>
        temp_list[int_class]=1<br/>
        train_output.append(temp_list)<br/>
        j=j+interval<br/>
        if(j&gt;length_of_folder-1):<br/>
            j=0</p>
<p>def shuffletrain():<br/>
    rng_state = np.random.get_state()<br/>
    np.random.shuffle(train_input)<br/>
    np.random.set_state(rng_state)<br/>
    np.random.shuffle(train_output)</p>
<p>if __name__== “__main__”:<br/>
    for i in WORD_LIST:<br/>
        make_train_data(i)<br/>
    for i in TEST_WORD_LIST:<br/>
        create_test_data(i)<br/>
    shuffletrain()<br/>
    print “test and training data loaded”<br/>
    data = tf.placeholder(tf.float32, [None, MAX_STEPS,26]) #Number of examples, number of input, dimension of each input<br/>
    target = tf.placeholder(tf.float32, [None, 2])<br/>
    num_hidden = 128<br/>
    cell = tf.nn.rnn_cell.LSTMCell(num_hidden,state_is_tuple=True)<br/>
    val, _ = tf.nn.dynamic_rnn(cell, data, dtype=tf.float32)<br/>
    val = tf.transpose(val, [1, 0, 2])<br/>
    last = tf.gather(val, int(val.get_shape()[0]) – 1)<br/>
    weight = tf.Variable(tf.truncated_normal([num_hidden, int(target.get_shape()[1])]))<br/>
    bias = tf.Variable(tf.constant(0.1, shape=[target.get_shape()[1]]))<br/>
    prediction = tf.nn.softmax(tf.matmul(last, weight) + bias)<br/>
    cross_entropy = -tf.reduce_sum(target * tf.log(tf.clip_by_value(prediction,1e-10,1.0)))<br/>
    optimizer = tf.train.AdamOptimizer()<br/>
    minimize = optimizer.minimize(cross_entropy)<br/>
    mistakes = tf.not_equal(tf.argmax(target, 1), tf.argmax(prediction, 1))<br/>
    error = tf.reduce_mean(tf.cast(mistakes, tf.float32))<br/>
    if True:<br/>
        print(‘starting fresh model’)<br/>
        init_op = tf.initialize_all_variables()<br/>
        saver = tf.train.Saver()<br/>
        sess = tf.Session()<br/>
        sess.run(init_op)<br/>
        #saver.restore(sess, “./1840frames-example-two-class-ten-from-each-model-2870.ckpt”)<br/>
        incorrect = sess.run(error,{data: train_input, target: train_output})<br/>
        print(‘Train error with now {:3.9f}%’.format(100 * incorrect))<br/>
        incorrect = sess.run(error,{data: test_input, target: test_output})<br/>
        print(‘test error with now {:3.9f}%’.format(100 * incorrect))<br/>
        batch_size = BATCH_SIZE<br/>
        no_of_batches = int(len(train_input)) / batch_size<br/>
        for i in range(1000000):<br/>
            print “Epoch “,str(i)<br/>
            ptr = 0<br/>
            for j in range(no_of_batches):<br/>
                inp, out = train_input[ptr:ptr+batch_size], train_output[ptr:ptr+batch_size]<br/>
                ptr+=batch_size<br/>
                sess.run(minimize,{data: inp, target: out})<br/>
            if((i!=0)and(i%10==0)):<br/>
                true_count=0<br/>
                false_count=0<br/>
                deviation=0<br/>
                for test_count in range(len(test_output)):<br/>
                    test_result_i=sess.run(prediction,{data:[test_input[test_count]]})<br/>
                    guess_class=np.argmax(test_result_i)<br/>
                    true_class=np.argmax(test_output[test_count])<br/>
                    print(‘true class guess class’,true_class,guess_class)<br/>
                    if(guess_class==true_class):<br/>
                        true_count+=1<br/>
                        if(true_class==1):<br/>
                            true_position=deviation_list[test_count]<br/>
                            predicted_position=920<br/>
                            deviation+=np.absolute(true_position-predicted_position)<br/>
                            #print(‘truepos’,true_position,’deviation so far’,deviation)<br/>
                    else:<br/>
                        false_count+=1<br/>
                print(‘true_count’,true_count,’false_count’,false_count,’deviation’,deviation)<br/>
                incorrect = sess.run(error,{data: train_input, target: train_output})<br/>
                print(‘Epoch {:2d} train error {:3.1f}%’.format(i , 100 * incorrect))<br/>
                incorrect = sess.run(error,{data: test_input, target: test_output})<br/>
                print(‘Epoch {:2d} test error {:3.1f}%’.format(i , 100 * incorrect))<br/>
                save_path = saver.save(sess, “./1840frames-example-true-two-class-ten-from-each-model-%d.ckpt” % i)<br/>
                print(“Model saved in path: %s” % save_path)<br/>
        sess.close()<br/>
[/code]</p>
<p>I am sure – you will point my mistake quickly .<br/>
Here I am loading data for each class from wav files in corresponding folder.<br/>
Deviation is simply for stats of result.<br/>
You can ignore that.<br/>
If my code is not understandable, please let me know.<br/>
Here neural network makes decision from 11 time steps each having 26 values.<br/>
Is hidden=128 okay ?<br/>
Thanks.</p>
<div class="reply">
<a aria-label="Reply to sumeet" class="comment-reply-link" href="#comment-437327" onclick='return addComment.moveForm( "comment-437327", "437327", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-437367">
<div class="comment-container" id="li-comment-437367">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 13, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437367" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here are some general ideas to try:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437367" onclick='return addComment.moveForm( "comment-437367", "437367", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-437328">
<div class="comment-container" id="li-comment-437328">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sumeet</span>
<span class="date">May 12, 2018 at 1:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437328" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>it seems to be memorising input so that train error falls to 0% quickly but in test it classifies everything as class zero .<br/>
thanks for listening.</p>
<div class="reply">
<a aria-label="Reply to sumeet" class="comment-reply-link" href="#comment-437328" onclick='return addComment.moveForm( "comment-437328", "437328", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437368">
<div class="comment-container" id="li-comment-437368">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 13, 2018 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437368" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like overfitting.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437368" onclick='return addComment.moveForm( "comment-437368", "437368", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-437331">
<div class="comment-container" id="li-comment-437331">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/53678d5d74de68231af30b8c97c69166?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sumeet</span>
<span class="date">May 12, 2018 at 1:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437331" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i want the network to understand that if it encounters data containing silence in any part then it should call it class 1 no matter even if all the other data suggests class 0 .<br/>
Sorry for frequent replies.</p>
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to sumeet" class="comment-reply-link" href="#comment-437331" onclick='return addComment.moveForm( "comment-437331", "437331", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437370">
<div class="comment-container" id="li-comment-437370">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 13, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437370" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps brainstorm different ways of framing this as a supervised learning problem first:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437370" onclick='return addComment.moveForm( "comment-437370", "437370", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-437343">
<div class="comment-container" id="li-comment-437343">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/abaa99146ddd0419bebddeea30638819?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/abaa99146ddd0419bebddeea30638819?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">May 12, 2018 at 7:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437343" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason, great post. What do you think about Bi-Directional LSTM models for sentiment analysis, like classify labels as positive, negative and neutral? There are a lot of research papers that use simple LSTM models for this, but there are barley no for BiLSTM models (mainly speech recognition). So is it not really worth it for this task?</p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="#comment-437343" onclick='return addComment.moveForm( "comment-437343", "437343", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437376">
<div class="comment-container" id="li-comment-437376">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 13, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-437376" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not really needed, see this post:<br/>
<a href="https://machinelearningmastery.com/best-practices-document-classification-deep-learning/" rel="nofollow">https://machinelearningmastery.com/best-practices-document-classification-deep-learning/</a></p>
<p>Nevertheless, run some experiments and try bidirectional. Experiments are cheap.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437376" onclick='return addComment.moveForm( "comment-437376", "437376", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-441558">
<div class="comment-container" id="li-comment-441558">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6c2d68be2a727047f17e09d9b59da366?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6c2d68be2a727047f17e09d9b59da366?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tessa</span>
<span class="date">June 21, 2018 at 7:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-441558" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!</p>
<p>Thanks for the post.</p>
<p>Does a bidirectional LSTM requires the whole series as input or only sequences?</p>
<p>series input: x[t] with t=[0..n] a complete measurement/simulation.</p>
<p>sequences input: x[t] with t=[0..10], [10..20], …[n-10, n], seq_length = 10.</p>
<p>In the second option, it can be used for online prediction tasks, where future inputs are unknown.</p>
<div class="reply">
<a aria-label="Reply to Tessa" class="comment-reply-link" href="#comment-441558" onclick='return addComment.moveForm( "comment-441558", "441558", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441601">
<div class="comment-container" id="li-comment-441601">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 22, 2018 at 6:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-441601" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs and Bidirectional LSTMs both that a single sample as input, which might be the sequence or a subsequence, depending on your prediction problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441601" onclick='return addComment.moveForm( "comment-441601", "441601", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-441993">
<div class="comment-container" id="li-comment-441993">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1b3b04ffee3cfc4f6395f3127d36304b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1b3b04ffee3cfc4f6395f3127d36304b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Franco</span>
<span class="date">June 25, 2018 at 6:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-441993" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Incredible work Jason!<br/>
– especially love the test LSTM vanilla vs. LSTM reversed vs. LSTM bidirectional.<br/>
– even 1 year later I see nobody covering this (Andrew Ng, Advanced NLP Udemy, Udacity NLP).<br/>
– your post made me just re-re-re-re-read your LSTM book </p>
<p>Franco</p>
<p>PS: interesting idea from Francois Chollet for NLP: 1D-CNN + LSTM Bidirectional for text classification where word order matters (otherwise no LSTM needed).</p>
<div class="reply">
<a aria-label="Reply to Franco" class="comment-reply-link" href="#comment-441993" onclick='return addComment.moveForm( "comment-441993", "441993", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442045">
<div class="comment-container" id="li-comment-442045">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 26, 2018 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-442045" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<p>Yes, I am currently writing about 1D cnns myself, they are very effective.</p>
<p>Also, I have a ton on them already, start here:<br/>
<a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" rel="nofollow">https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/</a></p>
<p>And here:<br/>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" rel="nofollow">https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/</a></p>
<p>And here:<br/>
<a href="https://machinelearningmastery.com/best-practices-document-classification-deep-learning/" rel="nofollow">https://machinelearningmastery.com/best-practices-document-classification-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442045" onclick='return addComment.moveForm( "comment-442045", "442045", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-442123">
<div class="comment-container" id="li-comment-442123">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3aee723cf76d17c42ed16607922e12a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3aee723cf76d17c42ed16607922e12a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.thuanxuannguyen.com" rel="external nofollow">Thuan Nguyen</a></span>
<span class="date">June 27, 2018 at 5:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-442123" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you your tutorial.</p>
<p>Could you please explain why the number of memory units is larger than the number of time steps. I suppose that they should be identical, because each input connects to each memory unit (<a href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="nofollow">https://colah.github.io/posts/2015-08-Understanding-LSTMs/</a>)</p>
<p>Best</p>
<div class="reply">
<a aria-label="Reply to Thuan Nguyen" class="comment-reply-link" href="#comment-442123" onclick='return addComment.moveForm( "comment-442123", "442123", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442145">
<div class="comment-container" id="li-comment-442145">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 27, 2018 at 8:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-442145" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Time steps and the number of units in the first hidden layer of the network are unrelated.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442145" onclick='return addComment.moveForm( "comment-442145", "442145", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-442178">
<div class="comment-container" id="li-comment-442178">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3aee723cf76d17c42ed16607922e12a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3aee723cf76d17c42ed16607922e12a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thuan Nguyen</span>
<span class="date">June 27, 2018 at 11:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-442178" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank for your quick reply.</p>
<p>I suppose that an input at timestep t, i.e. x(t), connects to a memory unit U(t). If the input sample contains N timesteps, N memory units are required correspondingly.</p>
<p>U(0)  -&gt; U(1)  -&gt; … -&gt; U(N-1)<br/>
  ^           ^                     ^<br/>
x(0)   -&gt;  x(1)  -&gt; … -&gt; x(N-1)</p>
<p>In your code, the number of units is 20, while the number of timesteps is 10. In this case, how do x connects to U?</p>
<p>Best,</p>
<div class="reply">
<a aria-label="Reply to Thuan Nguyen" class="comment-reply-link" href="#comment-442178" onclick='return addComment.moveForm( "comment-442178", "442178", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-442206">
<div class="comment-container" id="li-comment-442206">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2018 at 6:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-442206" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Each time step is processed one at a time by the model. </p>
<p>Each unit in the first hidden layer receives one time step of data at a time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442206" onclick='return addComment.moveForm( "comment-442206", "442206", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-442168">
<div class="comment-container" id="li-comment-442168">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c74ef26748e088bdab9daf3f2cf3f081?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c74ef26748e088bdab9daf3f2cf3f081?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Constanze</span>
<span class="date">June 27, 2018 at 8:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-442168" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the great explanation! My question:</p>
<p>It appears to me that the Backwards running RNN has no chance to solve the problem at all, or am I missing something? Only the forward running RNN sees the numbers and has a chance to figure out when the limit is exceeded. So why does the bidirectional RNN perform better than forward running RNN?</p>
<div class="reply">
<a aria-label="Reply to Constanze" class="comment-reply-link" href="#comment-442168" onclick='return addComment.moveForm( "comment-442168", "442168", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442201">
<div class="comment-container" id="li-comment-442201">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2018 at 6:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-442201" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The bidir model looks at the data twice, forwards and backwards (two perspectives) and gets more of a chance to interpret it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442201" onclick='return addComment.moveForm( "comment-442201", "442201", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-443468">
<div class="comment-container" id="li-comment-443468">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/139c9fe52067e3ac2c33b2c9feb26e09?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/139c9fe52067e3ac2c33b2c9feb26e09?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bastian</span>
<span class="date">July 14, 2018 at 5:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-443468" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks a lot for the great article.<br/>
I have general question regarding Bidirectional networks and predictions:</p>
<p>Assume I have a game with obstacles at every 3-5 seconds and where depending on the first 30 seconds of the player playing, I have to predict whether the user crashes in an obstacle _i  in the next 5 seconds.<br/>
I generate a lot of features at each obstacle, one of them being “did the user crash in the last obstacle”.<br/>
I now applied Bidirectional LSTM, and get a near 100% performance. </p>
<p>Am I correct that using BiLSTM in this scenario is some sort of “cheating”, because by also using the features of the future, I basically know whether he crashed into this obstacle _i because I can look at the feature “did the user crash into the last obstacle” right after this obstacle _i!</p>
<p>I should therefore not use Bidirectional Networks but rather stick to LSTM/RNNs. </p>
<p>I would greatly appreciate your help,<br/>
Bastian</p>
<div class="reply">
<a aria-label="Reply to Bastian" class="comment-reply-link" href="#comment-443468" onclick='return addComment.moveForm( "comment-443468", "443468", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-443512">
<div class="comment-container" id="li-comment-443512">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 15, 2018 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-443512" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It really depends on how you are framing the problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443512" onclick='return addComment.moveForm( "comment-443512", "443512", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-444632">
<div class="comment-container" id="li-comment-444632">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ed556c60cd3d7f3d6b8b8a9c270bc7c5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ed556c60cd3d7f3d6b8b8a9c270bc7c5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Constanze</span>
<span class="date">July 28, 2018 at 6:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444632" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Bastian,<br/>
I struggle with a similar problem, also trying to predict with a bidirectional LSTM and getting nearly 100% accuracy on training, but nonsense output on prediction. I too came to the conclusion that a bidirectional LSTM cannot be used that way. The example Jason gives here is somewhat misleading into that direction…<br/>
Best, Constanze</p>
<div class="reply">
<a aria-label="Reply to Constanze" class="comment-reply-link" href="#comment-444632" onclick='return addComment.moveForm( "comment-444632", "444632", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-444662">
<div class="comment-container" id="li-comment-444662">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 29, 2018 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444662" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like overfitting of the training data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444662" onclick='return addComment.moveForm( "comment-444662", "444662", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-444855">
<div class="comment-container" id="li-comment-444855">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7338246b65360cfba222b2e667603c1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7338246b65360cfba222b2e667603c1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam M</span>
<span class="date">July 31, 2018 at 7:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444855" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What clues might I look for to determine if over-fitting is happening?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Adam M" class="comment-reply-link" href="#comment-444855" onclick='return addComment.moveForm( "comment-444855", "444855", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-444884">
<div class="comment-container" id="li-comment-444884">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 31, 2018 at 2:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444884" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Performance on the train set is good and performance on the test set is bad.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-444520">
<div class="comment-container" id="li-comment-444520">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a388c0117da0a3ac0f49f286177fbc0e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a388c0117da0a3ac0f49f286177fbc0e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">guofeng</span>
<span class="date">July 27, 2018 at 12:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444520" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I want to ask how to set the initial state of Bidirectional RNN in Keras?The below is my code and the ‘initial_state’ is set in the third Bidirectional RNN:</p>
<p>encoder_input = ks.layers.Input(shape=(85,))<br/>
decoder_input = ks.layers.Input(shape=(85,))</p>
<p>encoder_inputs = Embedding(lenpinyin, 64, input_length=85, mask_zero=True)(encoder_input)</p>
<p>encoder = Bidirectional(LSTM(400, return_sequences=True), merge_mode=’concat’)(encoder_inputs)</p>
<p>encoder_outputs, forward_h, forward_c, backward_h, backward_c = Bidirectional(LSTM(400, return_sequences=True, return_state=True), merge_mode=’concat’)(encoder)</p>
<p>decoder_inputs = Embedding(lentext, 64, input_length=85, mask_zero=True)(decoder_input)</p>
<p>decoder = Bidirectional(LSTM(400, return_sequences=True), merge_mode=’concat’)(decoder_inputs, initial_state=[forward_h, forward_c, backward_h, backward_c])</p>
<p>decoder_outputs, _, _, _, _ = Bidirectional(LSTM(400, return_sequences=True, return_state=True), merge_mode=’concat’)(decoder)</p>
<p>decoder_outputs = TimeDistributed(Dense(lentext, activation=”softmax”))(decoder_outputs)</p>
<div class="reply">
<a aria-label="Reply to guofeng" class="comment-reply-link" href="#comment-444520" onclick='return addComment.moveForm( "comment-444520", "444520", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444581">
<div class="comment-container" id="li-comment-444581">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 28, 2018 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444581" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have an example here that might help:<br/>
<a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" rel="nofollow">https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444581" onclick='return addComment.moveForm( "comment-444581", "444581", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-444618">
<div class="comment-container" id="li-comment-444618">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7338246b65360cfba222b2e667603c1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7338246b65360cfba222b2e667603c1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam M</span>
<span class="date">July 28, 2018 at 10:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444618" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am struggling with a particular concept for sequence classification. Suppose I have a list of customer feedback sentences and want to use unsupervised training to group them by their nature (a customer complaint about a certain feature vs. question they ask vs. a general comment, etc.). I basically want to detect whatever their natural groupings might be.</p>
<p>All these models seem to talk about prediction along the timesteps of a sequence, but how does prediction lead to a meaningful grouping (classification) of a sentence? In other words, how do you go from predicting the next word in a sentence to discovering the sentence groups and determining that this sentence belongs to this group vs. another?</p>
<p>Thanks very much!</p>
<div class="reply">
<a aria-label="Reply to Adam M" class="comment-reply-link" href="#comment-444618" onclick='return addComment.moveForm( "comment-444618", "444618", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444657">
<div class="comment-container" id="li-comment-444657">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 29, 2018 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444657" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I generally don’t have material on unsupervised methods.</p>
<p>If you can get experts to label thousands of examples, you could then use a supervised learning method.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444657" onclick='return addComment.moveForm( "comment-444657", "444657", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-444986">
<div class="comment-container" id="li-comment-444986">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f4ecd0697f63e75d4b8fbc5e7a4f73b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f4ecd0697f63e75d4b8fbc5e7a4f73b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">J t</span>
<span class="date">August 1, 2018 at 2:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-444986" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason,<br/>
You are a godsend in lstms. Really appreciate it and been learning lots. </p>
<p>From looking at the code, can i confirm this is a multi step prediction of the same length as input sequence?</p>
<p>Is the time distributed layer the trick here?</p>
<p>I have been trying to find multi step predictions and i know you have a blog post that does it using stateful = True but i cant seem to use bidrectional with it and limited by batch size needing to be a multiple of training size. Same goes for prediction. </p>
<p>Any explanation would be deeply appreciated.</p>
<div class="reply">
<a aria-label="Reply to J t" class="comment-reply-link" href="#comment-444986" onclick='return addComment.moveForm( "comment-444986", "444986", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445022">
<div class="comment-container" id="li-comment-445022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2018 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-445022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I recommend this tutorial:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<p>You can simply change the first hidden layer to be a Bidirectional LSTM.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445022" onclick='return addComment.moveForm( "comment-445022", "445022", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-445614">
<div class="comment-container" id="li-comment-445614">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4abac6ac6decceb67fd3384612a603f6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4abac6ac6decceb67fd3384612a603f6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hamada</span>
<span class="date">August 9, 2018 at 12:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-445614" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason Thanks for your great article.<br/>
I noticed that every epoch you train with new sample. is this necessary?<br/>
1) can we train with all data inside each epoch?<br/>
2)  or at each epoch , I should select only a single sample of my data to fit and this implies that the number of samples=no. of epochs?</p>
<div class="reply">
<a aria-label="Reply to Hamada" class="comment-reply-link" href="#comment-445614" onclick='return addComment.moveForm( "comment-445614", "445614", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445645">
<div class="comment-container" id="li-comment-445645">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 9, 2018 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-445645" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can train the model with the same dataset on each epoch, the chosen problem was just a demonstration.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445645" onclick='return addComment.moveForm( "comment-445645", "445645", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-445991">
<div class="comment-container" id="li-comment-445991">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manish Sihag</span>
<span class="date">August 13, 2018 at 5:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-445991" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I have a question. Normally all inputs fed to BiLSTM are of shape [batch_size, time_steps, input_size]. I am working on a problem of Automatic Essay Grading in which there’s an extra dimension which is number of sentences in each essay. So in my case, a typical batch after embedding using word2vec, is of shape [2,16,25,300]. Here there are 2 essays in each batch (batch_size=2), each essay has 16 sentences, each sentence is 25 words long(time_step=25) and I’m using word2vec of 300 dimensions(input_size=300). So clearly I need to loop this batch over dimension 16 somehow. I have tried for a long time but I haven’t been able to find a way to do it. For example, if you make a loop over tf.nn.bidirectional_dynamic_rnn(), it’ll give error in second iteration saying that tf.nn.bidirectional_dynamic_rnn() kernel already exists. Can you please tell me if there’s any other way to do it? Thanks a lot in advance.</p>
<div class="reply">
<a aria-label="Reply to Manish Sihag" class="comment-reply-link" href="#comment-445991" onclick='return addComment.moveForm( "comment-445991", "445991", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446033">
<div class="comment-container" id="li-comment-446033">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 14, 2018 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446033" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you can combine the sentences from one document into a single sequence of words?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446033" onclick='return addComment.moveForm( "comment-446033", "446033", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-446059">
<div class="comment-container" id="li-comment-446059">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manish Sihag</span>
<span class="date">August 14, 2018 at 12:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446059" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No I can’t do that because I have to feed the data on sentence level. Is there any other way?</p>
<div class="reply">
<a aria-label="Reply to Manish Sihag" class="comment-reply-link" href="#comment-446059" onclick='return addComment.moveForm( "comment-446059", "446059", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-446062">
<div class="comment-container" id="li-comment-446062">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 14, 2018 at 1:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446062" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could use an autoencoder for the entire document.<br/>
You could make a forecast per sentence.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446062" onclick='return addComment.moveForm( "comment-446062", "446062", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-446083">
<div class="comment-container" id="li-comment-446083">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manish Sihag</span>
<span class="date">August 14, 2018 at 7:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446083" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’ll try that. Meanwhile, can we use tf.map_fn() somehow here? Like we take transpose of the batch and make it [16,2,25,300] and then use above function to send it to the bidirectional lstm. I am not really sure how would I do it though.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-446125">
<div class="comment-container" id="li-comment-446125">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2018 at 5:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446125" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have not done this, perhaps experiment and see what you can come up with.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-446249">
<div class="comment-container" id="li-comment-446249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manish Sihag</span>
<span class="date">August 16, 2018 at 8:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think the answer to my problem is pretty simple but I’m getting confused somewhere. If you get some time please do look at my code(<a href="https://codeshare.io/5NNB0r" rel="nofollow">https://codeshare.io/5NNB0r</a>). It’s a simple 10 line code so won’t take much of your time. I also tried tf.map_fn() but so far no success. Thanks.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-446280">
<div class="comment-container" id="li-comment-446280">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446280" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m eager to help, but I don’t have the capacity to review code. I get 100s of similar requests via email each day.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-446338">
<div class="comment-container" id="li-comment-446338">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/80706160bd88c664c8b7ad40c7423e60?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manish SIhag</span>
<span class="date">August 17, 2018 at 3:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446338" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I understand and thank you very much for all your help. You’ll also be glad to know that I managed to get that code working. I used tf.map_fn() to map whole batch to bilstm_layers. Thanks again.</p>
<div class="reply">
<a aria-label="Reply to Manish SIhag" class="comment-reply-link" href="#comment-446338" onclick='return addComment.moveForm( "comment-446338", "446338", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446377">
<div class="comment-container" id="li-comment-446377">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2018 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446377" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446377" onclick='return addComment.moveForm( "comment-446377", "446377", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-446864">
<div class="comment-container" id="li-comment-446864">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e8d835fc765ae6e64956acb6458dd064?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e8d835fc765ae6e64956acb6458dd064?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Osuman</span>
<span class="date">August 24, 2018 at 5:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446864" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason and Thank you for another cool post.</p>
<p>I was wondering if you had any good advice for using CNN-biLSTM to recognize action in videos. I’m trying to feed the flow extracted from sequences of 10 frames but the results are disappointing. One concern I have is the (Shuffle = True). I read it’s better to keep it this way but since my sequence is in order I cannot afford to shuffle when reading the input frames/flow. Also, when I try to finetune a CNN with my data the classfication accuracy is low (which is normal since it’s based on frames only) so I wonder if the accuracy matters or if I should just train on my data (regardless of the final accuracy), remove the top layer and use it in my CNN-LSTM ?<br/>
Any tips or tutorial on this matter will be super appreciated. Thanks a lot !!</p>
<div class="reply">
<a aria-label="Reply to Osuman" class="comment-reply-link" href="#comment-446864" onclick='return addComment.moveForm( "comment-446864", "446864", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446894">
<div class="comment-container" id="li-comment-446894">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 25, 2018 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-446894" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will help as a first step:<br/>
<a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/cnn-long-short-term-memory-networks/</a></p>
<p>I have a fuller example in my LSTM book:<br/>
<a href="https://machinelearningmastery.com/lstms-with-python/" rel="nofollow">https://machinelearningmastery.com/lstms-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446894" onclick='return addComment.moveForm( "comment-446894", "446894", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-447071">
<div class="comment-container" id="li-comment-447071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4d404a729ecc3b7270dd972ba7dc6b3b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4d404a729ecc3b7270dd972ba7dc6b3b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Phillip</span>
<span class="date">August 27, 2018 at 9:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-447071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I am designing a bird sound recognition tool for a University project. It is extracting features using the MFCC feature extraction method, but now I am struggling with the classification part. I have tried Back propagation neural networks but have not had success. Do you think recurrent networks, being good at classifying time series, would be a better solution? There are many repetitive patterns in the extracted features of the bird sounds.</p>
<div class="reply">
<a aria-label="Reply to Phillip" class="comment-reply-link" href="#comment-447071" onclick='return addComment.moveForm( "comment-447071", "447071", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-447098">
<div class="comment-container" id="li-comment-447098">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 28, 2018 at 6:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-447098" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend trying many different framings of the problem, many different preparations of the data and many different modeling algorithms in order to _discover_ what works best for your specific problem.</p>
<p>This process may help:<br/>
<a href="https://machinelearningmastery.com/start-here/#process" rel="nofollow">https://machinelearningmastery.com/start-here/#process</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447098" onclick='return addComment.moveForm( "comment-447098", "447098", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-447258">
<div class="comment-container" id="li-comment-447258">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/52ee5de8885587f4277fb43c9ffdaba5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/52ee5de8885587f4277fb43c9ffdaba5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Karine</span>
<span class="date">August 30, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-447258" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent post! It helped me to complete the Sequence Model course on Coursera! I was stuck for an hour at the last assignment, could not figure out the Bidirectional LSTM, came to your tutorial and it all made it clear for me. Thank you Jason!</p>
<div class="reply">
<a aria-label="Reply to Karine" class="comment-reply-link" href="#comment-447258" onclick='return addComment.moveForm( "comment-447258", "447258", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-447281">
<div class="comment-container" id="li-comment-447281">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-447281" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m happy that it helped!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447281" onclick='return addComment.moveForm( "comment-447281", "447281", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-447932">
<div class="comment-container" id="li-comment-447932">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e8a878f91203cfbf290b5422430f13fe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e8a878f91203cfbf290b5422430f13fe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leon</span>
<span class="date">September 5, 2018 at 10:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-447932" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, is your code example fit for a multiclass multi label opinion mining classification problem ?<br/>
And is it possible to give to the NN a w2v matrix as an input ?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Leon" class="comment-reply-link" href="#comment-447932" onclick='return addComment.moveForm( "comment-447932", "447932", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-447955">
<div class="comment-container" id="li-comment-447955">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 6, 2018 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-447955" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The above example is binary classification.</p>
<p>I have examples of multi-class classification. I don’t have examples of multi-label classification at this stage.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447955" onclick='return addComment.moveForm( "comment-447955", "447955", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-455917">
<div class="comment-container" id="li-comment-455917">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0aa71b4dac9a984ce126436b60c33a63?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0aa71b4dac9a984ce126436b60c33a63?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Min</span>
<span class="date">November 23, 2018 at 3:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-455917" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Good article. I have a question in your above example.</p>
<p>Since Y is (logically) determined by cumsum of the proceeding numbers (e.g. X1, X2, X3 ==&gt; Y3), how can a reverse of LSTM can predict (or benifit) the Y3 from later of the time steps (e.g. X4, X5, X6….), since they are irrelevant from the reverse order?<br/>
But from your above lost plot, it shows it does help.</p>
<p>Note: I understand in speech recognition, this concept really helps.</p>
<p>Thanks &amp; Regards,<br/>
M.</p>
<div class="reply">
<a aria-label="Reply to Min" class="comment-reply-link" href="#comment-455917" onclick='return addComment.moveForm( "comment-455917", "455917", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455972">
<div class="comment-container" id="li-comment-455972">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-455972" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The bidirectional layer doubles the capacity of the input and by processing the sequence forwards and backwards, it gives more opportunity for model to extract the serial correlation in the observations.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455972" onclick='return addComment.moveForm( "comment-455972", "455972", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-457275">
<div class="comment-container" id="li-comment-457275">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69035f37e722ffeedb1f9140fa8a536b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69035f37e722ffeedb1f9140fa8a536b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Avel</span>
<span class="date">December 5, 2018 at 1:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-457275" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is phenomenal, but I get a bit confused (my python is quite weak)  as I’m following this along with other tutorials and most people tend to do something like “xyz = model.fit(trainx, trainy, batch_size=batch_size, epochs=iterations, verbose=1, validation_data=(testx, testy),”<br/>
 which is not the case here.<br/>
I works great but I cannot find figure out any way to run diagnostics on it (since I can’t seem to connect it to tensorboard without “model.fit(…).” I also would love to be able to make a confusion matrix and a dataframe with actuals and predicted but every guide I’ve found on that seens to require I use the format “model.fit()”</p>
<div class="reply">
<a aria-label="Reply to Avel" class="comment-reply-link" href="#comment-457275" onclick='return addComment.moveForm( "comment-457275", "457275", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457316">
<div class="comment-container" id="li-comment-457316">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 5, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/#comment-457316" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The fit() function returns the model. </p>
<p>The predict() function returns predictions that you can then compare to true values, calculate performance and confusion matrices.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457316" onclick='return addComment.moveForm( "comment-457316", "457316", "respond", "4081" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-bidirectional-lstm-sequence-classification-python-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4081"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="34dc17de41"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="176"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center><br/>
<strong>Long Short-Term Memory Networks</strong><br/>
Develop sequence prediction models in Keras.
<p><a href="/lstms-with-python/">Click to Get Started Now!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>