<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Grid Search SARIMA Model Hyperparameters for Time Series Forecasting in Python</title>
<link href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Grid Search SARIMA Model Hyperparameters for Time Series Forecasting in Python" property="og:title"/>
<meta content="The Seasonal Autoregressive Integrated Moving Average, or SARIMA, model is an approach for modeling univariate time series data that may contain trend and seasonal components. It is an effective approach for time series forecasting, although it requires careful analysis and domain expertise in order to configure the seven or more model hyperparameters. An alternative approach …" property="og:description"/>
<meta content="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Time Series" property="article:section"/>
<meta content="2018-10-23T18:00:46+00:00" property="article:published_time"/>
<meta content="2018-08-30T00:35:08+00:00" property="article:modified_time"/>
<meta content="2018-08-30T00:35:08+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Mean-Temperatures-Dataset.png" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Mean-Temperatures-Dataset.png" property="og:image:secure_url"/>
<meta content="1454" property="og:image:width"/>
<meta content="766" property="og:image:height"/>
<meta content="Line Plot of the Monthly Mean Temperatures Dataset" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/feed/" rel="alternate" title="Machine Learning Mastery » How to Grid Search SARIMA Model Hyperparameters for Time Series Forecasting in Python Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=6357" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-6357 single-format-standard safari alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-53"> <div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-6357 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
<header>
<h1 class="title entry-title">How to Grid Search SARIMA Model Hyperparameters for Time Series Forecasting in Python</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-24T05:00:46+1100">October 24, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6357 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Grid+Search+SARIMA+Model+Hyperparameters+for+Time+Series+Forecasting+in+Python&amp;url=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>The Seasonal Autoregressive Integrated Moving Average, or SARIMA, model is an approach for modeling univariate time series data that may contain trend and seasonal components.</p>
<p>It is an effective approach for time series forecasting, although it requires careful analysis and domain expertise in order to configure the seven or more model hyperparameters.</p>
<p>An alternative approach to configuring the model that makes use of fast and parallel modern hardware is to grid search a suite of hyperparameter configurations in order to discover what works best. Often, this process can reveal non-intuitive model configurations that result in lower forecast error than those configurations specified through careful analysis.</p>
<p>In this tutorial, you will discover how to develop a framework for grid searching all of the SARIMA model hyperparameters for univariate time series forecasting.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a framework for grid searching SARIMA models from scratch using walk-forward validation.</li>
<li>How to grid search SARIMA model hyperparameters for daily time series data for births.</li>
<li>How to grid search SARIMA model hyperparameters for monthly time series data for shampoo sales, car sales, and temperature.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_6358" style="width: 650px"><img alt="How to Grid Search SARIMA Model Hyperparameters for Time Series Forecasting in Python" class="size-full wp-image-6358" height="360" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Grid-Search-SARIMA-Model-Hyperparameters-for-Time-Series-Forecasting-in-Python.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Grid-Search-SARIMA-Model-Hyperparameters-for-Time-Series-Forecasting-in-Python.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Grid-Search-SARIMA-Model-Hyperparameters-for-Time-Series-Forecasting-in-Python-300x169.jpg 300w" width="640"/><p class="wp-caption-text">How to Grid Search SARIMA Model Hyperparameters for Time Series Forecasting in Python<br/>Photo by <a href="https://www.flickr.com/photos/photommo/17832992898/">Thomas</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into six parts; they are:</p>
<ol>
<li>SARIMA for Time Series Forecasting</li>
<li>Develop a Grid Search Framework</li>
<li>Case Study 1: No Trend or Seasonality</li>
<li>Case Study 2: Trend</li>
<li>Case Study 3: Seasonality</li>
<li>Case Study 4: Trend and Seasonality</li>
</ol>
<h2>SARIMA for Time Series Forecasting</h2>
<p>Seasonal Autoregressive Integrated Moving Average, SARIMA or Seasonal ARIMA, is an extension of ARIMA that explicitly supports univariate time series data with a seasonal component.</p>
<p>It adds three new hyperparameters to specify the autoregression (AR), differencing (I), and moving average (MA) for the seasonal component of the series, as well as an additional parameter for the period of the seasonality.</p>
<blockquote><p>A seasonal ARIMA model is formed by including additional seasonal terms in the ARIMA […] The seasonal part of the model consists of terms that are very similar to the non-seasonal components of the model, but they involve backshifts of the seasonal period.</p></blockquote>
<p>— Page 242, <a href="https://amzn.to/2xlJsfV">Forecasting: principles and practice</a>, 2013.</p>
<p>Configuring a SARIMA requires selecting hyperparameters for both the trend and seasonal elements of the series.</p>
<p>There are three trend elements that require configuration.</p>
<p>They are the same as the ARIMA model; specifically:</p>
<ul>
<li><strong>p</strong>: Trend autoregression order.</li>
<li><strong>d</strong>: Trend difference order.</li>
<li><strong>q</strong>: Trend moving average order.</li>
</ul>
<p>There are four seasonal elements that are not part of ARIMA that must be configured; they are:</p>
<ul>
<li><strong>P</strong>: Seasonal autoregressive order.</li>
<li><strong>D</strong>: Seasonal difference order.</li>
<li><strong>Q</strong>: Seasonal moving average order.</li>
<li><strong>m</strong>: The number of time steps for a single seasonal period.</li>
</ul>
<p>Together, the notation for a SARIMA model is specified as:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f128b003636668" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
SARIMA(p,d,q)(P,D,Q)m</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f128b003636668-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f128b003636668-1">SARIMA(p,d,q)(P,D,Q)m</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The SARIMA model can subsume the ARIMA, ARMA, AR, and MA models via model configuration parameters.</p>
<p>The trend and seasonal hyperparameters of the model can be configured by analyzing autocorrelation and partial autocorrelation plots, and this can take some expertise.</p>
<p>An alternative approach is to grid search a suite of model configurations and discover which configurations work best for a specific univariate time series.</p>
<blockquote><p>Seasonal ARIMA models can potentially have a large number of parameters and combinations of terms. Therefore, it is appropriate to try out a wide range of models when fitting to data and choose a best fitting model using an appropriate criterion …</p></blockquote>
<p>— Pages 143-144, <a href="https://amzn.to/2smB9LR">Introductory Time Series with R</a>, 2009.</p>
<p>This approach can be faster on modern computers than an analysis process and can reveal surprising findings that might not be obvious and result in lower forecast error.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Download Your FREE Mini-Course</a><script data-config="%7B%7D" data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Develop a Grid Search Framework</h2>
<p>In this section, we will develop a framework for grid searching SARIMA model hyperparameters for a given univariate time series forecasting problem.</p>
<p>We will use the implementation of <a href="http://www.statsmodels.org/dev/generated/statsmodels.tsa.statespace.sarimax.SARIMAX.html">SARIMA</a> provided by the statsmodels library.</p>
<p>This model has hyperparameters that control the nature of the model performed for the series, trend and seasonality, specifically:</p>
<ul>
<li><strong>order</strong>: A tuple p, d, and q parameters for the modeling of the trend.</li>
<li><strong>sesonal_order</strong>: A tuple of P, D, Q, and m parameters for the modeling the seasonality</li>
<li><strong>trend</strong>: A parameter for controlling a model of the deterministic trend as one of ‘n’,’c’,’t’,’ct’ for no trend, constant, linear, and constant with linear trend, respectively.</li>
</ul>
<p>If you know enough about your problem to specify one or more of these parameters, then you should specify them. If not, you can try grid searching these parameters.</p>
<p>We can start-off by defining a function that will fit a model with a given configuration and make a one-step forecast.</p>
<p>The <em>sarima_forecast()</em> below implements this behavior.</p>
<p>The function takes an array or list of contiguous prior observations and a list of configuration parameters used to configure the model, specifically two tuples and a string for the trend order, seasonal order trend, and parameter.</p>
<p>We also try to make the model robust by relaxing constraints, such as that the data must be stationary and that the MA transform be invertible.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f1295785043864" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# one-step sarima forecast
def sarima_forecast(history, config):
	order, sorder, trend = config
	# define model
	model = SARIMAX(history, order=order, seasonal_order=sorder, trend=trend, enforce_stationarity=False, enforce_invertibility=False)
	# fit model
	model_fit = model.fit(disp=False)
	# make one step forecast
	yhat = model_fit.predict(len(history), len(history))
	return yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f1295785043864-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f1295785043864-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f1295785043864-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f1295785043864-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f1295785043864-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f1295785043864-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f1295785043864-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f1295785043864-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f1295785043864-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f1295785043864-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f1295785043864-1"><span class="crayon-p"># one-step sarima forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f1295785043864-2"><span class="crayon-e">def </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f1295785043864-3"><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f1295785043864-4"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca4c6f1295785043864-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SARIMAX</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seasonal_order</span><span class="crayon-o">=</span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-o">=</span><span class="crayon-v">trend</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_stationarity</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_invertibility</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f1295785043864-6"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca4c6f1295785043864-7"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f1295785043864-8"><span class="crayon-h"> </span><span class="crayon-p"># make one step forecast</span></div><div class="crayon-line" id="crayon-5c0ca4c6f1295785043864-9"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f1295785043864-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Next, we need to build up some functions for fitting and evaluating a model repeatedly via walk-forward validation, including splitting a dataset into train and test sets and evaluating one-step forecasts.</p>
<p>We can split a list or NumPy array of data using a slice given a specified size of the split, e.g. the number of time steps to use from the data in the test set.</p>
<p>The <em>train_test_split()</em> function below implements this for a provided dataset and a specified number of time steps to use in the test set.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f1297400381160" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f1297400381160-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f1297400381160-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f1297400381160-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f1297400381160-1"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f1297400381160-2"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f1297400381160-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>After forecasts have been made for each step in the test dataset, they need to be compared to the test set in order to calculate an error score.</p>
<p>There are many popular error scores for time series forecasting. In this case we will use root mean squared error (RMSE), but you can change this to your preferred measure, e.g. MAPE, MAE, etc.</p>
<p>The <em>measure_rmse()</em> function below will calculate the RMSE given a list of actual (the test set) and predicted values.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f1299913942324" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f1299913942324-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f1299913942324-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f1299913942324-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f1299913942324-1"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f1299913942324-2"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f1299913942324-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can now implement the walk-forward validation scheme. This is a standard approach to evaluating a time series forecasting model that respects the temporal ordering of observations.</p>
<p>First, a provided univariate time series dataset is split into train and test sets using the <em>train_test_split()</em> function. Then the number of observations in the test set are enumerated. For each we fit a model on all of the history and make a one step forecast. The true observation for the time step is then added to the history and the process is repeated. The <em>sarima_forecast()</em> function is called in order to fit a model and make a prediction. Finally, an error score is calculated by comparing all one-step forecasts to the actual test set by calling the <em>measure_rmse()</em> function.</p>
<p>The <em>walk_forward_validation()</em> function below implements this, taking a univariate time series, a number of time steps to use in the test set, and an array of model configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f129d617016956" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = sarima_forecast(history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	return error</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129d617016956-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129d617016956-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-1"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-2"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-3"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-4"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-5"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-6"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-7"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-8"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-10"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-11"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-12"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-13"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-14"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-15"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-16"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129d617016956-17"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129d617016956-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>If you are interested in making multi-step predictions, you can change the call to <em>predict()</em> in the <em>sarima_forecast()</em> function and also change the calculation of error in the <em>measure_rmse()</em> function.</p>
<p>We can call <em>walk_forward_validation()</em> repeatedly with different lists of model configurations.</p>
<p>One possible issue is that some combinations of model configurations may not be called for the model and will throw an exception, e.g. specifying some but not all aspects of the seasonal structure in the data.</p>
<p>Further, some models may also raise warnings on some data, e.g. from the linear algebra libraries called by the statsmodels library.</p>
<p>We can trap exceptions and ignore warnings during the grid search by wrapping all calls to <em>walk_forward_validation()</em> with a try-except and a block to ignore warnings. We can also add debugging support to disable these protections in the case we want to see what is really going on. Finally, if an error does occur, we can return a None result, otherwise we can print some information about the skill of each model evaluated. This is helpful when a large number of models are evaluated.</p>
<p>The <em>score_model()</em> function below implements this and returns a tuple of (key and result), where the key is a string version of the tested model configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f129f506453238" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# score a model, return None on failure
def score_model(data, n_test, cfg, debug=False):
	result = None
	# convert config to a key
	key = str(cfg)
	# show all warnings and fail on exception if debugging
	if debug:
		result = walk_forward_validation(data, n_test, cfg)
	else:
		# one failure during model validation suggests an unstable config
		try:
			# never show warnings when grid searching, too noisy
			with catch_warnings():
				filterwarnings("ignore")
				result = walk_forward_validation(data, n_test, cfg)
		except:
			error = None
	# check for an interesting result
	if result is not None:
		print(' &gt; Model[%s] %.3f' % (key, result))
	return (key, result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f129f506453238-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4c6f129f506453238-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-1"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-2"><span class="crayon-e">def </span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-3"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-4"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-5"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-6"><span class="crayon-h"> </span><span class="crayon-p"># show all warnings and fail on exception if debugging</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-8"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-9"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-10"><span class="crayon-h"> </span><span class="crayon-p"># one failure during model validation suggests an unstable config</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-11"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-12"><span class="crayon-h"> </span><span class="crayon-p"># never show warnings when grid searching, too noisy</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-13"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-14"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-15"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-16"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-17"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-18"><span class="crayon-h"> </span><span class="crayon-p"># check for an interesting result</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-19"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">result </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f129f506453238-20"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f129f506453238-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Next, we need a loop to test a list of different model configurations.</p>
<p>This is the main function that drives the grid search process and will call the <em>score_model()</em> function for each model configuration.</p>
<p>We can dramatically speed up the grid search process by evaluating model configurations in parallel. One way to do that is to use the <a href="https://pythonhosted.org/joblib/">Joblib library</a>.</p>
<p>We can define a Parallel object with the number of cores to use and set it to the number of scores detected in your hardware.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12a1694442905" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
executor = Parallel(n_jobs=cpu_count(), backend='multiprocessing')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12a1694442905-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12a1694442905-1"><span class="crayon-v">executor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Parallel</span><span class="crayon-sy">(</span><span class="crayon-v">n_jobs</span><span class="crayon-o">=</span><span class="crayon-e">cpu_count</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backend</span><span class="crayon-o">=</span><span class="crayon-s">'multiprocessing'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can then can then create a list of tasks to execute in parallel, which will be one call to the <em>score_model()</em> function for each model configuration we have.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12a3114208932" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
tasks = (delayed(score_model)(data, n_test, cfg) for cfg in cfg_list)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12a3114208932-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12a3114208932-1"><span class="crayon-v">tasks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">delayed</span><span class="crayon-sy">(</span><span class="crayon-v">score_model</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Finally, we can use the Parallel object to execute the list of tasks in parallel.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12a4335068727" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
scores = executor(tasks)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12a4335068727-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12a4335068727-1"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">executor</span><span class="crayon-sy">(</span><span class="crayon-v">tasks</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>That’s it.</p>
<p>We can also provide a non-parallel version of evaluating all model configurations in case we want to debug something.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12a6313552222" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
scores = [score_model(data, n_test, cfg) for cfg in cfg_list]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12a6313552222-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12a6313552222-1"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The result of evaluating a list of configurations will be a list of tuples, each with a name that summarizes a specific model configuration and the error of the model evaluated with that configuration as either the RMSE or None if there was an error.</p>
<p>We can filter out all scores with a None.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12a7885087466" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
scores = [r for r in scores if r[1] != None]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12a7885087466-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12a7885087466-1"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">scores </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can then sort all tuples in the list by the score in ascending order (best are first), then return this list of scores for review.</p>
<p>The <em>grid_search()</em> function below implements this behavior given a univariate time series dataset, a list of model configurations (list of lists), and the number of time steps to use in the test set. An optional <em>parallel</em> argument allows the evaluation of models across all cores to be tuned on or off, and is on by default.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12a9723419857" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search configs
def grid_search(data, cfg_list, n_test, parallel=True):
	scores = None
	if parallel:
		# execute configs in parallel
		executor = Parallel(n_jobs=cpu_count(), backend='multiprocessing')
		tasks = (delayed(score_model)(data, n_test, cfg) for cfg in cfg_list)
		scores = executor(tasks)
	else:
		scores = [score_model(data, n_test, cfg) for cfg in cfg_list]
	# remove empty results
	scores = [r for r in scores if r[1] != None]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12a9723419857-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12a9723419857-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12a9723419857-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12a9723419857-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12a9723419857-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12a9723419857-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12a9723419857-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12a9723419857-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-1"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12a9723419857-2"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-3"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12a9723419857-4"><span class="crayon-e"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-5"><span class="crayon-h"> </span><span class="crayon-p"># execute configs in parallel</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12a9723419857-6"><span class="crayon-h"> </span><span class="crayon-v">executor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Parallel</span><span class="crayon-sy">(</span><span class="crayon-v">n_jobs</span><span class="crayon-o">=</span><span class="crayon-e">cpu_count</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backend</span><span class="crayon-o">=</span><span class="crayon-s">'multiprocessing'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-7"><span class="crayon-h"> </span><span class="crayon-v">tasks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">delayed</span><span class="crayon-sy">(</span><span class="crayon-v">score_model</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12a9723419857-8"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">executor</span><span class="crayon-sy">(</span><span class="crayon-v">tasks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-9"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12a9723419857-10"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-11"><span class="crayon-h"> </span><span class="crayon-p"># remove empty results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12a9723419857-12"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">scores </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-13"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12a9723419857-14"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12a9723419857-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We’re nearly done.</p>
<p>The only thing left to do is to define a list of model configurations to try for a dataset.</p>
<p>We can define this generically. The only parameter we may want to specify is the periodicity of the seasonal component in the series, if one exists. By default, we will assume no seasonal component.</p>
<p>The <em>sarima_configs()</em> function below will create a list of model configurations to evaluate.</p>
<p>The configurations assume each of the AR, MA, and I components for trend and seasonality are low order, e.g. off (0) or in [1,2]. You may want to extend these ranges if you believe the order may be higher. An optional list of seasonal periods can be specified, and you could even change the function to specify other elements that you may know about your time series.</p>
<p>In theory, there are 1,296 possible model configurations to evaluate, but in practice, many will not be valid and will result in an error that we will trap and ignore.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12ab871645663" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a set of sarima configs to try
def sarima_configs(seasonal=[0]):
	models = list()
	# define config lists
	p_params = [0, 1, 2]
	d_params = [0, 1]
	q_params = [0, 1, 2]
	t_params = ['n','c','t','ct']
	P_params = [0, 1, 2]
	D_params = [0, 1]
	Q_params = [0, 1, 2]
	m_params = seasonal
	# create config instances
	for p in p_params:
		for d in d_params:
			for q in q_params:
				for t in t_params:
					for P in P_params:
						for D in D_params:
							for Q in Q_params:
								for m in m_params:
									cfg = [(p,d,q), (P,D,Q,m), t]
									models.append(cfg)
	return models</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ab871645663-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ab871645663-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-1"><span class="crayon-p"># create a set of sarima configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-2"><span class="crayon-e">def </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-3"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-4"><span class="crayon-h"> </span><span class="crayon-p"># define config lists</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-5"><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-6"><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-7"><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-8"><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'n'</span><span class="crayon-sy">,</span><span class="crayon-s">'c'</span><span class="crayon-sy">,</span><span class="crayon-s">'t'</span><span class="crayon-sy">,</span><span class="crayon-s">'ct'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-9"><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-10"><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-11"><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-12"><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seasonal</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-13"><span class="crayon-h"> </span><span class="crayon-p"># create config instances</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-16"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-17"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-18"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">P</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-19"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">D</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">Q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-21"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-22"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">q</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-v">D</span><span class="crayon-sy">,</span><span class="crayon-v">Q</span><span class="crayon-sy">,</span><span class="crayon-v">m</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ab871645663-23"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ab871645663-24"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>We now have a framework for grid searching SARIMA model hyperparameters via one-step walk-forward validation.</p>
<p>It is generic and will work for any in-memory univariate time series provided as a list or NumPy array.</p>
<p>We can make sure all the pieces work together by testing it on a contrived 10-step dataset.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12ad267553021" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search sarima hyperparameters
from math import sqrt
from multiprocessing import cpu_count
from joblib import Parallel
from joblib import delayed
from warnings import catch_warnings
from warnings import filterwarnings
from statsmodels.tsa.statespace.sarimax import SARIMAX
from sklearn.metrics import mean_squared_error

# one-step sarima forecast
def sarima_forecast(history, config):
	order, sorder, trend = config
	# define model
	model = SARIMAX(history, order=order, seasonal_order=sorder, trend=trend, enforce_stationarity=False, enforce_invertibility=False)
	# fit model
	model_fit = model.fit(disp=False)
	# make one step forecast
	yhat = model_fit.predict(len(history), len(history))
	return yhat[0]

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = sarima_forecast(history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	return error

# score a model, return None on failure
def score_model(data, n_test, cfg, debug=False):
	result = None
	# convert config to a key
	key = str(cfg)
	# show all warnings and fail on exception if debugging
	if debug:
		result = walk_forward_validation(data, n_test, cfg)
	else:
		# one failure during model validation suggests an unstable config
		try:
			# never show warnings when grid searching, too noisy
			with catch_warnings():
				filterwarnings("ignore")
				result = walk_forward_validation(data, n_test, cfg)
		except:
			error = None
	# check for an interesting result
	if result is not None:
		print(' &gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test, parallel=True):
	scores = None
	if parallel:
		# execute configs in parallel
		executor = Parallel(n_jobs=cpu_count(), backend='multiprocessing')
		tasks = (delayed(score_model)(data, n_test, cfg) for cfg in cfg_list)
		scores = executor(tasks)
	else:
		scores = [score_model(data, n_test, cfg) for cfg in cfg_list]
	# remove empty results
	scores = [r for r in scores if r[1] != None]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a set of sarima configs to try
def sarima_configs(seasonal=[0]):
	models = list()
	# define config lists
	p_params = [0, 1, 2]
	d_params = [0, 1]
	q_params = [0, 1, 2]
	t_params = ['n','c','t','ct']
	P_params = [0, 1, 2]
	D_params = [0, 1]
	Q_params = [0, 1, 2]
	m_params = seasonal
	# create config instances
	for p in p_params:
		for d in d_params:
			for q in q_params:
				for t in t_params:
					for P in P_params:
						for D in D_params:
							for Q in Q_params:
								for m in m_params:
									cfg = [(p,d,q), (P,D,Q,m), t]
									models.append(cfg)
	return models

if __name__ == '__main__':
	# define dataset
	data = [10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0]
	print(data)
	# data split
	n_test = 4
	# model configs
	cfg_list = sarima_configs()
	# grid search
	scores = grid_search(data, cfg_list, n_test)
	print('done')
	# list top 3 configs
	for cfg, error in scores[:3]:
		print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-68">68</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-70">70</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-72">72</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-74">74</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-76">76</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-78">78</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-80">80</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-82">82</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-84">84</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-86">86</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-88">88</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-90">90</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-92">92</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-94">94</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-96">96</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-98">98</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-100">100</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-102">102</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-104">104</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-106">106</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-108">108</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-110">110</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-112">112</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-114">114</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-116">116</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-118">118</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-120">120</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-122">122</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ad267553021-124">124</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ad267553021-125">125</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-1"><span class="crayon-p"># grid search sarima hyperparameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-3"><span class="crayon-e">from </span><span class="crayon-e">multiprocessing </span><span class="crayon-e">import </span><span class="crayon-e">cpu_count</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-4"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">Parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-5"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">delayed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-6"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">catch_warnings</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-7"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">filterwarnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-8"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">tsa</span><span class="crayon-sy">.</span><span class="crayon-v">statespace</span><span class="crayon-sy">.</span><span class="crayon-e">sarimax </span><span class="crayon-e">import </span><span class="crayon-e">SARIMAX</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-10"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-11"><span class="crayon-p"># one-step sarima forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-12"><span class="crayon-e">def </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-13"><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-14"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SARIMAX</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seasonal_order</span><span class="crayon-o">=</span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-o">=</span><span class="crayon-v">trend</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_stationarity</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_invertibility</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-16"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-17"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-18"><span class="crayon-h"> </span><span class="crayon-p"># make one step forecast</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-19"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-22"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-23"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-24"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-25"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-26"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-27"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-30"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-31"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-32"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-33"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-34"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-35"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-36"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-37"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-38"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-39"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-40"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-41"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-42"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-43"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-44"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-45"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-46"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-47"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-48"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-49"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-50"><span class="crayon-e">def </span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-51"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-52"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-53"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-54"><span class="crayon-h"> </span><span class="crayon-p"># show all warnings and fail on exception if debugging</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-55"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-56"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-57"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-58"><span class="crayon-h"> </span><span class="crayon-p"># one failure during model validation suggests an unstable config</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-59"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-60"><span class="crayon-h"> </span><span class="crayon-p"># never show warnings when grid searching, too noisy</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-61"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-62"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-63"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-64"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-65"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-66"><span class="crayon-h"> </span><span class="crayon-p"># check for an interesting result</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-67"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">result </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-68"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-69"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-70"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-71"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-72"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-73"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-74"><span class="crayon-e"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-75"><span class="crayon-h"> </span><span class="crayon-p"># execute configs in parallel</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-76"><span class="crayon-h"> </span><span class="crayon-v">executor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Parallel</span><span class="crayon-sy">(</span><span class="crayon-v">n_jobs</span><span class="crayon-o">=</span><span class="crayon-e">cpu_count</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backend</span><span class="crayon-o">=</span><span class="crayon-s">'multiprocessing'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-77"><span class="crayon-h"> </span><span class="crayon-v">tasks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">delayed</span><span class="crayon-sy">(</span><span class="crayon-v">score_model</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-78"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">executor</span><span class="crayon-sy">(</span><span class="crayon-v">tasks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-79"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-80"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-81"><span class="crayon-h"> </span><span class="crayon-p"># remove empty results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-82"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">scores </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-83"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-84"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-85"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-86"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-87"><span class="crayon-p"># create a set of sarima configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-88"><span class="crayon-e">def </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-89"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-90"><span class="crayon-h"> </span><span class="crayon-p"># define config lists</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-91"><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-92"><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-93"><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-94"><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'n'</span><span class="crayon-sy">,</span><span class="crayon-s">'c'</span><span class="crayon-sy">,</span><span class="crayon-s">'t'</span><span class="crayon-sy">,</span><span class="crayon-s">'ct'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-95"><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-96"><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-97"><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-98"><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seasonal</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-99"><span class="crayon-h"> </span><span class="crayon-p"># create config instances</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-100"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-101"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-102"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-103"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-104"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">P</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-105"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">D</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-106"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">Q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-107"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-108"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">q</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-v">D</span><span class="crayon-sy">,</span><span class="crayon-v">Q</span><span class="crayon-sy">,</span><span class="crayon-v">m</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-109"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-110"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">models</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-111"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-112"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-113"><span class="crayon-h"> </span><span class="crayon-p"># define dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-114"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">10.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">30.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">40.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">60.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">70.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">80.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">90.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-115"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-116"><span class="crayon-h"> </span><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-117"><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-118"><span class="crayon-h"> </span><span class="crayon-p"># model configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-119"><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-120"><span class="crayon-h"> </span><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-121"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-122"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-123"><span class="crayon-h"> </span><span class="crayon-p"># list top 3 configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ad267553021-124"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ad267553021-125"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0062 seconds] -->
<p>Running the example first prints the contrived time series dataset.</p>
<p>Next, the model configurations and their errors are reported as they are evaluated, truncated below for brevity.</p>
<p>Finally, the configurations and the error for the top three configurations are reported. We can see that many models achieve perfect performance on this simple linearly increasing contrived time series problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12b0760136471" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0]

...
 &gt; Model[[(2, 0, 0), (2, 0, 0, 0), 'ct']] 0.001
 &gt; Model[[(2, 0, 0), (2, 0, 1, 0), 'ct']] 0.000
 &gt; Model[[(2, 0, 1), (0, 0, 0, 0), 'n']] 0.000
 &gt; Model[[(2, 0, 1), (0, 0, 1, 0), 'n']] 0.000
done

[(2, 1, 0), (1, 0, 0, 0), 'n'] 0.0
[(2, 1, 0), (2, 0, 0, 0), 'n'] 0.0
[(2, 1, 1), (1, 0, 1, 0), 'n'] 0.0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12b0760136471-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b0760136471-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b0760136471-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b0760136471-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b0760136471-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b0760136471-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b0760136471-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b0760136471-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b0760136471-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b0760136471-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b0760136471-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b0760136471-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12b0760136471-1">[10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b0760136471-2"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12b0760136471-3">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b0760136471-4"> &gt; Model[[(2, 0, 0), (2, 0, 0, 0), 'ct']] 0.001</div><div class="crayon-line" id="crayon-5c0ca4c6f12b0760136471-5"> &gt; Model[[(2, 0, 0), (2, 0, 1, 0), 'ct']] 0.000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b0760136471-6"> &gt; Model[[(2, 0, 1), (0, 0, 0, 0), 'n']] 0.000</div><div class="crayon-line" id="crayon-5c0ca4c6f12b0760136471-7"> &gt; Model[[(2, 0, 1), (0, 0, 1, 0), 'n']] 0.000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b0760136471-8">done</div><div class="crayon-line" id="crayon-5c0ca4c6f12b0760136471-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b0760136471-10">[(2, 1, 0), (1, 0, 0, 0), 'n'] 0.0</div><div class="crayon-line" id="crayon-5c0ca4c6f12b0760136471-11">[(2, 1, 0), (2, 0, 0, 0), 'n'] 0.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b0760136471-12">[(2, 1, 1), (1, 0, 1, 0), 'n'] 0.0</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now that we have a robust framework for grid searching SARIMA model hyperparameters, let’s test it out on a suite of standard univariate time series datasets.</p>
<p>The datasets were chosen for demonstration purposes; I am not suggesting that a SARIMA model is the best approach for each dataset; perhaps an ETS or something else would be more appropriate in some cases.</p>
<h2>Case Study 1: No Trend or Seasonality</h2>
<p>The ‘daily female births’ dataset summarizes the daily total female births in California, USA in 1959.</p>
<p>The dataset has no obvious trend or seasonal component.</p>
<div class="wp-caption aligncenter" id="attachment_6350" style="width: 1450px"><img alt="Line Plot of the Daily Female Births Dataset" class="size-full wp-image-6350" height="780" sizes="(max-width: 1440px) 100vw, 1440px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Daily-Female-Births-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Daily-Female-Births-Dataset.png 1440w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Daily-Female-Births-Dataset-300x163.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Daily-Female-Births-Dataset-768x416.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Daily-Female-Births-Dataset-1024x555.png 1024w" width="1440"/><p class="wp-caption-text">Line Plot of the Daily Female Births Dataset</p></div>
<p>You can learn more about the dataset from <a href="https://datamarket.com/data/set/235k/daily-total-female-births-in-california-1959#!ds=235k&amp;display=line">DataMarket</a>.</p>
<p>Download the dataset directly from here:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/daily-total-female-births.csv">daily-total-female-births.csv</a></li>
</ul>
<p>Save the file with the filename ‘<em>daily-total-female-births.csv</em>‘ in your current working directory.</p>
<p>We can load this dataset as a Pandas series using the function <em>read_csv()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12b3677142170" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
series = read_csv('daily-total-female-births.csv', header=0, index_col=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12b3677142170-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12b3677142170-1"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'daily-total-female-births.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The dataset has one year, or 365 observations. We will use the first 200 for training and the remaining 165 as the test set.</p>
<p>The complete example grid searching the daily female univariate time series forecasting problem is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12b5257102991" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search sarima hyperparameters for daily female dataset
from math import sqrt
from multiprocessing import cpu_count
from joblib import Parallel
from joblib import delayed
from warnings import catch_warnings
from warnings import filterwarnings
from statsmodels.tsa.statespace.sarimax import SARIMAX
from sklearn.metrics import mean_squared_error
from pandas import read_csv

# one-step sarima forecast
def sarima_forecast(history, config):
	order, sorder, trend = config
	# define model
	model = SARIMAX(history, order=order, seasonal_order=sorder, trend=trend, enforce_stationarity=False, enforce_invertibility=False)
	# fit model
	model_fit = model.fit(disp=False)
	# make one step forecast
	yhat = model_fit.predict(len(history), len(history))
	return yhat[0]

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = sarima_forecast(history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	return error

# score a model, return None on failure
def score_model(data, n_test, cfg, debug=False):
	result = None
	# convert config to a key
	key = str(cfg)
	# show all warnings and fail on exception if debugging
	if debug:
		result = walk_forward_validation(data, n_test, cfg)
	else:
		# one failure during model validation suggests an unstable config
		try:
			# never show warnings when grid searching, too noisy
			with catch_warnings():
				filterwarnings("ignore")
				result = walk_forward_validation(data, n_test, cfg)
		except:
			error = None
	# check for an interesting result
	if result is not None:
		print(' &gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test, parallel=True):
	scores = None
	if parallel:
		# execute configs in parallel
		executor = Parallel(n_jobs=cpu_count(), backend='multiprocessing')
		tasks = (delayed(score_model)(data, n_test, cfg) for cfg in cfg_list)
		scores = executor(tasks)
	else:
		scores = [score_model(data, n_test, cfg) for cfg in cfg_list]
	# remove empty results
	scores = [r for r in scores if r[1] != None]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a set of sarima configs to try
def sarima_configs(seasonal=[0]):
	models = list()
	# define config lists
	p_params = [0, 1, 2]
	d_params = [0, 1]
	q_params = [0, 1, 2]
	t_params = ['n','c','t','ct']
	P_params = [0, 1, 2]
	D_params = [0, 1]
	Q_params = [0, 1, 2]
	m_params = seasonal
	# create config instances
	for p in p_params:
		for d in d_params:
			for q in q_params:
				for t in t_params:
					for P in P_params:
						for D in D_params:
							for Q in Q_params:
								for m in m_params:
									cfg = [(p,d,q), (P,D,Q,m), t]
									models.append(cfg)
	return models

if __name__ == '__main__':
	# load dataset
	series = read_csv('daily-total-female-births.csv', header=0, index_col=0)
	data = series.values
	print(data.shape)
	# data split
	n_test = 165
	# model configs
	cfg_list = sarima_configs()
	# grid search
	scores = grid_search(data, cfg_list, n_test)
	print('done')
	# list top 3 configs
	for cfg, error in scores[:3]:
		print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-68">68</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-70">70</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-72">72</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-74">74</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-76">76</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-78">78</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-80">80</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-82">82</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-84">84</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-86">86</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-88">88</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-90">90</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-92">92</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-94">94</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-96">96</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-98">98</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-100">100</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-102">102</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-104">104</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-106">106</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-108">108</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-110">110</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-112">112</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-114">114</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-116">116</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-118">118</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-120">120</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-122">122</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-124">124</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b5257102991-126">126</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b5257102991-127">127</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-1"><span class="crayon-p"># grid search sarima hyperparameters for daily female dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-3"><span class="crayon-e">from </span><span class="crayon-e">multiprocessing </span><span class="crayon-e">import </span><span class="crayon-e">cpu_count</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-4"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">Parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-5"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">delayed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-6"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">catch_warnings</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-7"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">filterwarnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-8"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">tsa</span><span class="crayon-sy">.</span><span class="crayon-v">statespace</span><span class="crayon-sy">.</span><span class="crayon-e">sarimax </span><span class="crayon-e">import </span><span class="crayon-e">SARIMAX</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-10"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-12"><span class="crayon-p"># one-step sarima forecast</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-13"><span class="crayon-e">def </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-14"><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-15"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SARIMAX</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seasonal_order</span><span class="crayon-o">=</span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-o">=</span><span class="crayon-v">trend</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_stationarity</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_invertibility</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-17"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-18"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-19"><span class="crayon-h"> </span><span class="crayon-p"># make one step forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-20"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-22"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-23"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-24"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-25"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-26"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-27"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-28"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-30"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-31"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-32"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-33"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-34"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-35"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-36"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-37"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-38"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-40"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-41"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-42"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-43"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-44"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-45"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-46"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-47"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-48"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-50"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-51"><span class="crayon-e">def </span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-52"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-53"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-54"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-55"><span class="crayon-h"> </span><span class="crayon-p"># show all warnings and fail on exception if debugging</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-56"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-57"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-58"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-59"><span class="crayon-h"> </span><span class="crayon-p"># one failure during model validation suggests an unstable config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-60"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-61"><span class="crayon-h"> </span><span class="crayon-p"># never show warnings when grid searching, too noisy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-62"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-63"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-64"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-65"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-66"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-67"><span class="crayon-h"> </span><span class="crayon-p"># check for an interesting result</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-68"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">result </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-69"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-70"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-71"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-72"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-73"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-74"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-75"><span class="crayon-e"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-76"><span class="crayon-h"> </span><span class="crayon-p"># execute configs in parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-77"><span class="crayon-h"> </span><span class="crayon-v">executor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Parallel</span><span class="crayon-sy">(</span><span class="crayon-v">n_jobs</span><span class="crayon-o">=</span><span class="crayon-e">cpu_count</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backend</span><span class="crayon-o">=</span><span class="crayon-s">'multiprocessing'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-78"><span class="crayon-h"> </span><span class="crayon-v">tasks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">delayed</span><span class="crayon-sy">(</span><span class="crayon-v">score_model</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-79"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">executor</span><span class="crayon-sy">(</span><span class="crayon-v">tasks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-80"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-81"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-82"><span class="crayon-h"> </span><span class="crayon-p"># remove empty results</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-83"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">scores </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-84"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-85"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-86"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-88"><span class="crayon-p"># create a set of sarima configs to try</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-89"><span class="crayon-e">def </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-90"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-91"><span class="crayon-h"> </span><span class="crayon-p"># define config lists</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-92"><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-93"><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-94"><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-95"><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'n'</span><span class="crayon-sy">,</span><span class="crayon-s">'c'</span><span class="crayon-sy">,</span><span class="crayon-s">'t'</span><span class="crayon-sy">,</span><span class="crayon-s">'ct'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-96"><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-97"><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-98"><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-99"><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seasonal</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-100"><span class="crayon-h"> </span><span class="crayon-p"># create config instances</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-101"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-102"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-103"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-104"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-105"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">P</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-106"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">D</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-107"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">Q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-108"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-109"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">q</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-v">D</span><span class="crayon-sy">,</span><span class="crayon-v">Q</span><span class="crayon-sy">,</span><span class="crayon-v">m</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-110"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-111"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-112"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-113"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-114"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-115"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'daily-total-female-births.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-116"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-117"><span class="crayon-e"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-118"><span class="crayon-h"> </span><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-119"><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">165</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-120"><span class="crayon-h"> </span><span class="crayon-p"># model configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-121"><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-122"><span class="crayon-h"> </span><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-123"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-124"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-125"><span class="crayon-h"> </span><span class="crayon-p"># list top 3 configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b5257102991-126"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12b5257102991-127"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0062 seconds] -->
<p>Running the example may take a few minutes on modern hardware.</p>
<p>Model configurations and the RMSE are printed as the models are evaluated The top three model configurations and their error are reported at the end of the run.</p>
<p>We can see that the best result was an RMSE of about 6.77 births with the following configuration:</p>
<ul>
<li><strong>Order</strong>: (1, 0, 2)</li>
<li><strong>Seasonal Order</strong>: (1, 0, 1, 0)</li>
<li><strong>Trend Parameter</strong>: ‘t’ for linear trend</li>
</ul>
<p>It is surprising that a configuration with some seasonal elements resulted in the lowest error. I would not have guessed at this configuration and would have likely stuck with an ARIMA model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12b7729127059" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
&gt; Model[[(2, 1, 2), (1, 0, 1, 0), 'ct']] 6.905
&gt; Model[[(2, 1, 2), (2, 0, 0, 0), 'ct']] 7.031
&gt; Model[[(2, 1, 2), (2, 0, 1, 0), 'ct']] 6.985
&gt; Model[[(2, 1, 2), (1, 0, 2, 0), 'ct']] 6.941
&gt; Model[[(2, 1, 2), (2, 0, 2, 0), 'ct']] 7.056
done

[(1, 0, 2), (1, 0, 1, 0), 't'] 6.770349800255089
[(0, 1, 2), (1, 0, 2, 0), 'ct'] 6.773217122759515
[(2, 1, 1), (2, 0, 2, 0), 'ct'] 6.886633191752254</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12b7729127059-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b7729127059-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b7729127059-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b7729127059-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b7729127059-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b7729127059-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b7729127059-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b7729127059-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b7729127059-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12b7729127059-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12b7729127059-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12b7729127059-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b7729127059-2">&gt; Model[[(2, 1, 2), (1, 0, 1, 0), 'ct']] 6.905</div><div class="crayon-line" id="crayon-5c0ca4c6f12b7729127059-3">&gt; Model[[(2, 1, 2), (2, 0, 0, 0), 'ct']] 7.031</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b7729127059-4">&gt; Model[[(2, 1, 2), (2, 0, 1, 0), 'ct']] 6.985</div><div class="crayon-line" id="crayon-5c0ca4c6f12b7729127059-5">&gt; Model[[(2, 1, 2), (1, 0, 2, 0), 'ct']] 6.941</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b7729127059-6">&gt; Model[[(2, 1, 2), (2, 0, 2, 0), 'ct']] 7.056</div><div class="crayon-line" id="crayon-5c0ca4c6f12b7729127059-7">done</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b7729127059-8"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12b7729127059-9">[(1, 0, 2), (1, 0, 1, 0), 't'] 6.770349800255089</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12b7729127059-10">[(0, 1, 2), (1, 0, 2, 0), 'ct'] 6.773217122759515</div><div class="crayon-line" id="crayon-5c0ca4c6f12b7729127059-11">[(2, 1, 1), (2, 0, 2, 0), 'ct'] 6.886633191752254</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Case Study 2: Trend</h2>
<p>The ‘shampoo’ dataset summarizes the monthly sales of shampoo over a three-year period.</p>
<p>The dataset contains an obvious trend but no obvious seasonal component.</p>
<div class="wp-caption aligncenter" id="attachment_6351" style="width: 1448px"><img alt="Line Plot of the Monthly Shampoo Sales Dataset" class="size-full wp-image-6351" height="776" sizes="(max-width: 1438px) 100vw, 1438px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Shampoo-Sales-Dataset.png 1438w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Shampoo-Sales-Dataset-300x162.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Shampoo-Sales-Dataset-768x414.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Shampoo-Sales-Dataset-1024x553.png 1024w" width="1438"/><p class="wp-caption-text">Line Plot of the Monthly Shampoo Sales Dataset</p></div>
<p>You can learn more about the dataset from <a href="https://datamarket.com/data/set/22r0/sales-of-shampoo-over-a-three-year-period#!ds=22r0&amp;display=line">DataMarket</a>.</p>
<p>Download the dataset directly from here:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/shampoo.csv">shampoo.csv</a></li>
</ul>
<p>Save the file with the filename ‘shampoo.csv’ in your current working directory.</p>
<p>We can load this dataset as a Pandas series using the function <em>read_csv()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12ba911085586" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# parse dates
def custom_parser(x):
	return datetime.strptime('195'+x, '%Y-%m')

# load dataset
series = read_csv('shampoo.csv', header=0, index_col=0, date_parser=custom_parser)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12ba911085586-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ba911085586-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ba911085586-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ba911085586-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ba911085586-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ba911085586-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12ba911085586-1"><span class="crayon-p"># parse dates</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ba911085586-2"><span class="crayon-e">def </span><span class="crayon-e">custom_parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12ba911085586-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'195'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ba911085586-4"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12ba911085586-5"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ba911085586-6"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">custom_parser</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The dataset has three years, or 36 observations. We will use the first 24 for training and the remaining 12 as the test set.</p>
<p>The complete example grid searching the shampoo sales univariate time series forecasting problem is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12bc291002869" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search sarima hyperparameters for monthly shampoo sales dataset
from math import sqrt
from multiprocessing import cpu_count
from joblib import Parallel
from joblib import delayed
from warnings import catch_warnings
from warnings import filterwarnings
from statsmodels.tsa.statespace.sarimax import SARIMAX
from sklearn.metrics import mean_squared_error
from pandas import read_csv
from pandas import datetime

# one-step sarima forecast
def sarima_forecast(history, config):
	order, sorder, trend = config
	# define model
	model = SARIMAX(history, order=order, seasonal_order=sorder, trend=trend, enforce_stationarity=False, enforce_invertibility=False)
	# fit model
	model_fit = model.fit(disp=False)
	# make one step forecast
	yhat = model_fit.predict(len(history), len(history))
	return yhat[0]

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = sarima_forecast(history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	return error

# score a model, return None on failure
def score_model(data, n_test, cfg, debug=False):
	result = None
	# convert config to a key
	key = str(cfg)
	# show all warnings and fail on exception if debugging
	if debug:
		result = walk_forward_validation(data, n_test, cfg)
	else:
		# one failure during model validation suggests an unstable config
		try:
			# never show warnings when grid searching, too noisy
			with catch_warnings():
				filterwarnings("ignore")
				result = walk_forward_validation(data, n_test, cfg)
		except:
			error = None
	# check for an interesting result
	if result is not None:
		print(' &gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test, parallel=True):
	scores = None
	if parallel:
		# execute configs in parallel
		executor = Parallel(n_jobs=cpu_count(), backend='multiprocessing')
		tasks = (delayed(score_model)(data, n_test, cfg) for cfg in cfg_list)
		scores = executor(tasks)
	else:
		scores = [score_model(data, n_test, cfg) for cfg in cfg_list]
	# remove empty results
	scores = [r for r in scores if r[1] != None]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a set of sarima configs to try
def sarima_configs(seasonal=[0]):
	models = list()
	# define config lists
	p_params = [0, 1, 2]
	d_params = [0, 1]
	q_params = [0, 1, 2]
	t_params = ['n','c','t','ct']
	P_params = [0, 1, 2]
	D_params = [0, 1]
	Q_params = [0, 1, 2]
	m_params = seasonal
	# create config instances
	for p in p_params:
		for d in d_params:
			for q in q_params:
				for t in t_params:
					for P in P_params:
						for D in D_params:
							for Q in Q_params:
								for m in m_params:
									cfg = [(p,d,q), (P,D,Q,m), t]
									models.append(cfg)
	return models


# parse dates
def custom_parser(x):
	return datetime.strptime('195'+x, '%Y-%m')

if __name__ == '__main__':
	# load dataset
	series = read_csv('shampoo.csv', header=0, index_col=0, date_parser=custom_parser)
	data = series.values
	print(data.shape)
	# data split
	n_test = 12
	# model configs
	cfg_list = sarima_configs()
	# grid search
	scores = grid_search(data, cfg_list, n_test)
	print('done')
	# list top 3 configs
	for cfg, error in scores[:3]:
		print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-68">68</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-70">70</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-72">72</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-74">74</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-76">76</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-78">78</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-80">80</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-82">82</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-84">84</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-86">86</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-88">88</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-90">90</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-92">92</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-94">94</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-96">96</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-98">98</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-100">100</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-102">102</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-104">104</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-106">106</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-108">108</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-110">110</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-112">112</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-114">114</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-116">116</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-118">118</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-120">120</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-122">122</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-124">124</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-126">126</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-128">128</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-130">130</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bc291002869-132">132</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bc291002869-133">133</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-1"><span class="crayon-p"># grid search sarima hyperparameters for monthly shampoo sales dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-3"><span class="crayon-e">from </span><span class="crayon-e">multiprocessing </span><span class="crayon-e">import </span><span class="crayon-e">cpu_count</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-4"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">Parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-5"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">delayed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-6"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">catch_warnings</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-7"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">filterwarnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-8"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">tsa</span><span class="crayon-sy">.</span><span class="crayon-v">statespace</span><span class="crayon-sy">.</span><span class="crayon-e">sarimax </span><span class="crayon-e">import </span><span class="crayon-e">SARIMAX</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-10"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-11"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-12"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-13"><span class="crayon-p"># one-step sarima forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-14"><span class="crayon-e">def </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-15"><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-16"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-17"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SARIMAX</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seasonal_order</span><span class="crayon-o">=</span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-o">=</span><span class="crayon-v">trend</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_stationarity</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_invertibility</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-18"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-19"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-20"><span class="crayon-h"> </span><span class="crayon-p"># make one step forecast</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-21"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-22"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-23"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-24"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-25"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-27"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-28"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-29"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-32"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-33"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-34"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-35"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-36"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-37"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-38"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-39"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-40"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-41"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-42"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-43"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-44"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-45"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-46"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-47"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-48"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-49"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-50"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-51"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-52"><span class="crayon-e">def </span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-53"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-54"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-55"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-56"><span class="crayon-h"> </span><span class="crayon-p"># show all warnings and fail on exception if debugging</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-57"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-58"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-59"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-60"><span class="crayon-h"> </span><span class="crayon-p"># one failure during model validation suggests an unstable config</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-61"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-62"><span class="crayon-h"> </span><span class="crayon-p"># never show warnings when grid searching, too noisy</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-63"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-64"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-65"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-66"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-67"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-68"><span class="crayon-h"> </span><span class="crayon-p"># check for an interesting result</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-69"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">result </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-70"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-71"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-72"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-73"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-74"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-75"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-76"><span class="crayon-e"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-77"><span class="crayon-h"> </span><span class="crayon-p"># execute configs in parallel</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-78"><span class="crayon-h"> </span><span class="crayon-v">executor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Parallel</span><span class="crayon-sy">(</span><span class="crayon-v">n_jobs</span><span class="crayon-o">=</span><span class="crayon-e">cpu_count</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backend</span><span class="crayon-o">=</span><span class="crayon-s">'multiprocessing'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-79"><span class="crayon-h"> </span><span class="crayon-v">tasks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">delayed</span><span class="crayon-sy">(</span><span class="crayon-v">score_model</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-80"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">executor</span><span class="crayon-sy">(</span><span class="crayon-v">tasks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-81"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-82"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-83"><span class="crayon-h"> </span><span class="crayon-p"># remove empty results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-84"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">scores </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-85"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-86"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-87"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-88"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-89"><span class="crayon-p"># create a set of sarima configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-90"><span class="crayon-e">def </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-91"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-92"><span class="crayon-h"> </span><span class="crayon-p"># define config lists</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-93"><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-94"><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-95"><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-96"><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'n'</span><span class="crayon-sy">,</span><span class="crayon-s">'c'</span><span class="crayon-sy">,</span><span class="crayon-s">'t'</span><span class="crayon-sy">,</span><span class="crayon-s">'ct'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-97"><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-98"><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-99"><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-100"><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seasonal</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-101"><span class="crayon-h"> </span><span class="crayon-p"># create config instances</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-102"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-103"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-104"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-105"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-106"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">P</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-107"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">D</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-108"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">Q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-109"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-110"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">q</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-v">D</span><span class="crayon-sy">,</span><span class="crayon-v">Q</span><span class="crayon-sy">,</span><span class="crayon-v">m</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-111"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-112"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-113"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-114"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-115"><span class="crayon-p"># parse dates</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-116"><span class="crayon-e">def </span><span class="crayon-e">custom_parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-117"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'195'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-118"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-119"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-120"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-121"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">custom_parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-122"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-123"><span class="crayon-e"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-124"><span class="crayon-h"> </span><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-125"><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-126"><span class="crayon-h"> </span><span class="crayon-p"># model configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-127"><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-128"><span class="crayon-h"> </span><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-129"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-130"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-131"><span class="crayon-h"> </span><span class="crayon-p"># list top 3 configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bc291002869-132"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12bc291002869-133"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0079 seconds] -->
<p>Running the example may take a few minutes on modern hardware.</p>
<p>Model configurations and the RMSE are printed as the models are evaluated The top three model configurations and their error are reported at the end of the run.</p>
<p>We can see that the best result was an RMSE of about 54.76 sales with the following configuration:</p>
<ul>
<li><strong>Trend Order</strong>: (0, 1, 2)</li>
<li><strong>Seasonal Order</strong>: (2, 0, 2, 0)</li>
<li><strong>Trend Parameter</strong>: ‘t’ (linear trend)</li>
</ul>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12bf987884912" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
&gt; Model[[(2, 1, 2), (1, 0, 1, 0), 'ct']] 68.891
&gt; Model[[(2, 1, 2), (2, 0, 0, 0), 'ct']] 75.406
&gt; Model[[(2, 1, 2), (1, 0, 2, 0), 'ct']] 80.908
&gt; Model[[(2, 1, 2), (2, 0, 1, 0), 'ct']] 78.734
&gt; Model[[(2, 1, 2), (2, 0, 2, 0), 'ct']] 82.958
done
[(0, 1, 2), (2, 0, 2, 0), 't'] 54.767582003072874
[(0, 1, 1), (2, 0, 2, 0), 'ct'] 58.69987083057107
[(1, 1, 2), (0, 0, 1, 0), 't'] 58.709089340600094</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12bf987884912-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bf987884912-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bf987884912-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bf987884912-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bf987884912-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bf987884912-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bf987884912-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bf987884912-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12bf987884912-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12bf987884912-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12bf987884912-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bf987884912-2">&gt; Model[[(2, 1, 2), (1, 0, 1, 0), 'ct']] 68.891</div><div class="crayon-line" id="crayon-5c0ca4c6f12bf987884912-3">&gt; Model[[(2, 1, 2), (2, 0, 0, 0), 'ct']] 75.406</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bf987884912-4">&gt; Model[[(2, 1, 2), (1, 0, 2, 0), 'ct']] 80.908</div><div class="crayon-line" id="crayon-5c0ca4c6f12bf987884912-5">&gt; Model[[(2, 1, 2), (2, 0, 1, 0), 'ct']] 78.734</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bf987884912-6">&gt; Model[[(2, 1, 2), (2, 0, 2, 0), 'ct']] 82.958</div><div class="crayon-line" id="crayon-5c0ca4c6f12bf987884912-7">done</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bf987884912-8">[(0, 1, 2), (2, 0, 2, 0), 't'] 54.767582003072874</div><div class="crayon-line" id="crayon-5c0ca4c6f12bf987884912-9">[(0, 1, 1), (2, 0, 2, 0), 'ct'] 58.69987083057107</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12bf987884912-10">[(1, 1, 2), (0, 0, 1, 0), 't'] 58.709089340600094</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Case Study 3: Seasonality</h2>
<p>The ‘monthly mean temperatures’ dataset summarizes the monthly average air temperatures in Nottingham Castle, England from 1920 to 1939 in degrees Fahrenheit.</p>
<p>The dataset has an obvious seasonal component and no obvious trend.</p>
<div class="wp-caption aligncenter" id="attachment_6352" style="width: 1464px"><img alt="Line Plot of the Monthly Mean Temperatures Dataset" class="size-full wp-image-6352" height="766" sizes="(max-width: 1454px) 100vw, 1454px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Mean-Temperatures-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Mean-Temperatures-Dataset.png 1454w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Mean-Temperatures-Dataset-300x158.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Mean-Temperatures-Dataset-768x405.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Mean-Temperatures-Dataset-1024x539.png 1024w" width="1454"/><p class="wp-caption-text">Line Plot of the Monthly Mean Temperatures Dataset</p></div>
<p>You can learn more about the dataset from <a href="https://datamarket.com/data/set/22li/mean-monthly-air-temperature-deg-f-nottingham-castle-1920-1939#!ds=22li&amp;display=line">DataMarket</a>.</p>
<p>Download the dataset directly from here:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/monthly-mean-temp.csv">monthly-mean-temp.csv</a></li>
</ul>
<p>Save the file with the filename ‘<em>monthly-mean-temp.csv</em>‘ in your current working directory.</p>
<p>We can load this dataset as a Pandas series using the function <em>read_csv()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12c2157660344" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
series = read_csv('monthly-mean-temp.csv', header=0, index_col=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12c2157660344-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12c2157660344-1"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-mean-temp.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The dataset has 20 years, or 240 observations. We will trim the dataset to the last five years of data (60 observations) in order to speed up the model evaluation process and use the last year, or 12 observations, for the test set.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12c4518110790" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# trim dataset to 5 years
data = data[-(5*12):]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12c4518110790-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c4518110790-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12c4518110790-1"><span class="crayon-p"># trim dataset to 5 years</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c4518110790-2"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">12</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The period of the seasonal component is about one year, or 12 observations. We will use this as the seasonal period in the call to the <em>sarima_configs()</em> function when preparing the model configurations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12c6364850956" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# model configs
cfg_list = sarima_configs(seasonal=[0, 12])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12c6364850956-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c6364850956-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12c6364850956-1"><span class="crayon-p"># model configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c6364850956-2"><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete example grid searching the monthly mean temperature time series forecasting problem is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12c8878256916" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search sarima hyperparameters for monthly mean temp dataset
from math import sqrt
from multiprocessing import cpu_count
from joblib import Parallel
from joblib import delayed
from warnings import catch_warnings
from warnings import filterwarnings
from statsmodels.tsa.statespace.sarimax import SARIMAX
from sklearn.metrics import mean_squared_error
from pandas import read_csv

# one-step sarima forecast
def sarima_forecast(history, config):
	order, sorder, trend = config
	# define model
	model = SARIMAX(history, order=order, seasonal_order=sorder, trend=trend, enforce_stationarity=False, enforce_invertibility=False)
	# fit model
	model_fit = model.fit(disp=False)
	# make one step forecast
	yhat = model_fit.predict(len(history), len(history))
	return yhat[0]

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = sarima_forecast(history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	return error

# score a model, return None on failure
def score_model(data, n_test, cfg, debug=False):
	result = None
	# convert config to a key
	key = str(cfg)
	# show all warnings and fail on exception if debugging
	if debug:
		result = walk_forward_validation(data, n_test, cfg)
	else:
		# one failure during model validation suggests an unstable config
		try:
			# never show warnings when grid searching, too noisy
			with catch_warnings():
				filterwarnings("ignore")
				result = walk_forward_validation(data, n_test, cfg)
		except:
			error = None
	# check for an interesting result
	if result is not None:
		print(' &gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test, parallel=True):
	scores = None
	if parallel:
		# execute configs in parallel
		executor = Parallel(n_jobs=cpu_count(), backend='multiprocessing')
		tasks = (delayed(score_model)(data, n_test, cfg) for cfg in cfg_list)
		scores = executor(tasks)
	else:
		scores = [score_model(data, n_test, cfg) for cfg in cfg_list]
	# remove empty results
	scores = [r for r in scores if r[1] != None]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a set of sarima configs to try
def sarima_configs(seasonal=[0]):
	models = list()
	# define config lists
	p_params = [0, 1, 2]
	d_params = [0, 1]
	q_params = [0, 1, 2]
	t_params = ['n','c','t','ct']
	P_params = [0, 1, 2]
	D_params = [0, 1]
	Q_params = [0, 1, 2]
	m_params = seasonal
	# create config instances
	for p in p_params:
		for d in d_params:
			for q in q_params:
				for t in t_params:
					for P in P_params:
						for D in D_params:
							for Q in Q_params:
								for m in m_params:
									cfg = [(p,d,q), (P,D,Q,m), t]
									models.append(cfg)
	return models

if __name__ == '__main__':
	# load dataset
	series = read_csv('monthly-mean-temp.csv', header=0, index_col=0)
	data = series.values
	# trim dataset to 5 years
	data = data[-(5*12):]
	# data split
	n_test = 12
	# model configs
	cfg_list = sarima_configs(seasonal=[0, 12])
	# grid search
	scores = grid_search(data, cfg_list, n_test)
	print('done')
	# list top 3 configs
	for cfg, error in scores[:3]:
		print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-68">68</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-70">70</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-72">72</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-74">74</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-76">76</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-78">78</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-80">80</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-82">82</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-84">84</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-86">86</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-88">88</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-90">90</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-92">92</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-94">94</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-96">96</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-98">98</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-100">100</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-102">102</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-104">104</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-106">106</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-108">108</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-110">110</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-112">112</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-114">114</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-116">116</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-118">118</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-120">120</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-122">122</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-124">124</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-126">126</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12c8878256916-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12c8878256916-128">128</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-1"><span class="crayon-p"># grid search sarima hyperparameters for monthly mean temp dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-3"><span class="crayon-e">from </span><span class="crayon-e">multiprocessing </span><span class="crayon-e">import </span><span class="crayon-e">cpu_count</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-4"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">Parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-5"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">delayed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-6"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">catch_warnings</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-7"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">filterwarnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-8"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">tsa</span><span class="crayon-sy">.</span><span class="crayon-v">statespace</span><span class="crayon-sy">.</span><span class="crayon-e">sarimax </span><span class="crayon-e">import </span><span class="crayon-e">SARIMAX</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-10"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-12"><span class="crayon-p"># one-step sarima forecast</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-13"><span class="crayon-e">def </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-14"><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-15"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SARIMAX</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seasonal_order</span><span class="crayon-o">=</span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-o">=</span><span class="crayon-v">trend</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_stationarity</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_invertibility</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-17"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-18"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-19"><span class="crayon-h"> </span><span class="crayon-p"># make one step forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-20"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-22"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-23"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-24"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-25"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-26"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-27"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-28"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-30"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-31"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-32"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-33"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-34"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-35"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-36"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-37"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-38"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-40"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-41"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-42"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-43"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-44"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-45"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-46"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-47"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-48"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-50"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-51"><span class="crayon-e">def </span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-52"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-53"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-54"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-55"><span class="crayon-h"> </span><span class="crayon-p"># show all warnings and fail on exception if debugging</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-56"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-57"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-58"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-59"><span class="crayon-h"> </span><span class="crayon-p"># one failure during model validation suggests an unstable config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-60"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-61"><span class="crayon-h"> </span><span class="crayon-p"># never show warnings when grid searching, too noisy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-62"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-63"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-64"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-65"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-66"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-67"><span class="crayon-h"> </span><span class="crayon-p"># check for an interesting result</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-68"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">result </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-69"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-70"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-71"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-72"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-73"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-74"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-75"><span class="crayon-e"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-76"><span class="crayon-h"> </span><span class="crayon-p"># execute configs in parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-77"><span class="crayon-h"> </span><span class="crayon-v">executor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Parallel</span><span class="crayon-sy">(</span><span class="crayon-v">n_jobs</span><span class="crayon-o">=</span><span class="crayon-e">cpu_count</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backend</span><span class="crayon-o">=</span><span class="crayon-s">'multiprocessing'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-78"><span class="crayon-h"> </span><span class="crayon-v">tasks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">delayed</span><span class="crayon-sy">(</span><span class="crayon-v">score_model</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-79"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">executor</span><span class="crayon-sy">(</span><span class="crayon-v">tasks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-80"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-81"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-82"><span class="crayon-h"> </span><span class="crayon-p"># remove empty results</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-83"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">scores </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-84"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-85"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-86"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-88"><span class="crayon-p"># create a set of sarima configs to try</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-89"><span class="crayon-e">def </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-90"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-91"><span class="crayon-h"> </span><span class="crayon-p"># define config lists</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-92"><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-93"><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-94"><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-95"><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'n'</span><span class="crayon-sy">,</span><span class="crayon-s">'c'</span><span class="crayon-sy">,</span><span class="crayon-s">'t'</span><span class="crayon-sy">,</span><span class="crayon-s">'ct'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-96"><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-97"><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-98"><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-99"><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seasonal</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-100"><span class="crayon-h"> </span><span class="crayon-p"># create config instances</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-101"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-102"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-103"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-104"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-105"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">P</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-106"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">D</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-107"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">Q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-108"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-109"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">q</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-v">D</span><span class="crayon-sy">,</span><span class="crayon-v">Q</span><span class="crayon-sy">,</span><span class="crayon-v">m</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-110"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-111"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-112"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-113"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-114"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-115"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-mean-temp.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-116"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-117"><span class="crayon-h"> </span><span class="crayon-p"># trim dataset to 5 years</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-118"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">12</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-119"><span class="crayon-h"> </span><span class="crayon-p"># data split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-120"><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-121"><span class="crayon-h"> </span><span class="crayon-p"># model configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-122"><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-123"><span class="crayon-h"> </span><span class="crayon-p"># grid search</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-124"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-125"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-126"><span class="crayon-h"> </span><span class="crayon-p"># list top 3 configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12c8878256916-127"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12c8878256916-128"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0065 seconds] -->
<p>Running the example may take a few minutes on modern hardware.</p>
<p>Model configurations and the RMSE are printed as the models are evaluated The top three model configurations and their error are reported at the end of the run.</p>
<p>We can see that the best result was an RMSE of about 1.5 degrees with the following configuration:</p>
<ul>
<li><strong>Trend Order</strong>: (0, 0, 0)</li>
<li><strong>Seasonal Order</strong>: (1, 0, 1, 12)</li>
<li><strong>Trend Parameter</strong>: ‘n’ (no trend)</li>
</ul>
<p>As we would expect, the model has no trend component and a 12-month seasonal ARMA component.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12ca179503629" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
&gt; Model[[(2, 1, 2), (2, 1, 0, 12), 't']] 4.599
&gt; Model[[(2, 1, 2), (1, 1, 0, 12), 'ct']] 2.477
&gt; Model[[(2, 1, 2), (2, 0, 0, 12), 'ct']] 2.548
&gt; Model[[(2, 1, 2), (2, 0, 1, 12), 'ct']] 2.893
&gt; Model[[(2, 1, 2), (2, 1, 0, 12), 'ct']] 5.404
done

[(0, 0, 0), (1, 0, 1, 12), 'n'] 1.5577613610905712
[(0, 0, 0), (1, 1, 0, 12), 'n'] 1.6469530713847962
[(0, 0, 0), (2, 0, 0, 12), 'n'] 1.7314448163607488</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12ca179503629-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ca179503629-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ca179503629-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ca179503629-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ca179503629-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ca179503629-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ca179503629-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ca179503629-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ca179503629-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ca179503629-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12ca179503629-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12ca179503629-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ca179503629-2">&gt; Model[[(2, 1, 2), (2, 1, 0, 12), 't']] 4.599</div><div class="crayon-line" id="crayon-5c0ca4c6f12ca179503629-3">&gt; Model[[(2, 1, 2), (1, 1, 0, 12), 'ct']] 2.477</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ca179503629-4">&gt; Model[[(2, 1, 2), (2, 0, 0, 12), 'ct']] 2.548</div><div class="crayon-line" id="crayon-5c0ca4c6f12ca179503629-5">&gt; Model[[(2, 1, 2), (2, 0, 1, 12), 'ct']] 2.893</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ca179503629-6">&gt; Model[[(2, 1, 2), (2, 1, 0, 12), 'ct']] 5.404</div><div class="crayon-line" id="crayon-5c0ca4c6f12ca179503629-7">done</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ca179503629-8"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12ca179503629-9">[(0, 0, 0), (1, 0, 1, 12), 'n'] 1.5577613610905712</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ca179503629-10">[(0, 0, 0), (1, 1, 0, 12), 'n'] 1.6469530713847962</div><div class="crayon-line" id="crayon-5c0ca4c6f12ca179503629-11">[(0, 0, 0), (2, 0, 0, 12), 'n'] 1.7314448163607488</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Case Study 4: Trend and Seasonality</h2>
<p>The ‘monthly car sales’ dataset summarizes the monthly car sales in Quebec, Canada between 1960 and 1968.</p>
<p>The dataset has an obvious trend and seasonal component.</p>
<div class="wp-caption aligncenter" id="attachment_6353" style="width: 1472px"><img alt="Line Plot of the Monthly Car Sales Dataset" class="size-full wp-image-6353" height="768" sizes="(max-width: 1462px) 100vw, 1462px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Car-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Car-Sales-Dataset.png 1462w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Car-Sales-Dataset-300x158.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Car-Sales-Dataset-768x403.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-the-Monthly-Car-Sales-Dataset-1024x538.png 1024w" width="1462"/><p class="wp-caption-text">Line Plot of the Monthly Car Sales Dataset</p></div>
<p>You can learn more about the dataset from <a href="https://datamarket.com/data/set/22n4/monthly-car-sales-in-quebec-1960-1968#!ds=22n4&amp;display=line">DataMarket</a>.</p>
<p>Download the dataset directly from here:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/monthly-car-sales.csv">monthly-car-sales.csv</a></li>
</ul>
<p>Save the file with the filename ‘<em>monthly-car-sales.csv</em>‘ in your current working directory.</p>
<p>We can load this dataset as a Pandas series using the function <em>read_csv()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12cd002521575" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
series = read_csv('monthly-car-sales.csv', header=0, index_col=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12cd002521575-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12cd002521575-1"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The dataset has 9 years, or 108 observations. We will use the last year, or 12 observations, as the test set.</p>
<p>The period of the seasonal component could be six months or 12 months. We will try both as the seasonal period in the call to the <em>sarima_configs()</em> function when preparing the model configurations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12ce981715958" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# model configs
cfg_list = sarima_configs(seasonal=[0,6,12])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12ce981715958-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12ce981715958-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12ce981715958-1"><span class="crayon-p"># model configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12ce981715958-2"><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete example grid searching the monthly car sales time series forecasting problem is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12d0474404292" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search sarima hyperparameters for monthly car sales dataset
from math import sqrt
from multiprocessing import cpu_count
from joblib import Parallel
from joblib import delayed
from warnings import catch_warnings
from warnings import filterwarnings
from statsmodels.tsa.statespace.sarimax import SARIMAX
from sklearn.metrics import mean_squared_error
from pandas import read_csv

# one-step sarima forecast
def sarima_forecast(history, config):
	order, sorder, trend = config
	# define model
	model = SARIMAX(history, order=order, seasonal_order=sorder, trend=trend, enforce_stationarity=False, enforce_invertibility=False)
	# fit model
	model_fit = model.fit(disp=False)
	# make one step forecast
	yhat = model_fit.predict(len(history), len(history))
	return yhat[0]

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = sarima_forecast(history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	return error

# score a model, return None on failure
def score_model(data, n_test, cfg, debug=False):
	result = None
	# convert config to a key
	key = str(cfg)
	# show all warnings and fail on exception if debugging
	if debug:
		result = walk_forward_validation(data, n_test, cfg)
	else:
		# one failure during model validation suggests an unstable config
		try:
			# never show warnings when grid searching, too noisy
			with catch_warnings():
				filterwarnings("ignore")
				result = walk_forward_validation(data, n_test, cfg)
		except:
			error = None
	# check for an interesting result
	if result is not None:
		print(' &gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test, parallel=True):
	scores = None
	if parallel:
		# execute configs in parallel
		executor = Parallel(n_jobs=cpu_count(), backend='multiprocessing')
		tasks = (delayed(score_model)(data, n_test, cfg) for cfg in cfg_list)
		scores = executor(tasks)
	else:
		scores = [score_model(data, n_test, cfg) for cfg in cfg_list]
	# remove empty results
	scores = [r for r in scores if r[1] != None]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a set of sarima configs to try
def sarima_configs(seasonal=[0]):
	models = list()
	# define config lists
	p_params = [0, 1, 2]
	d_params = [0, 1]
	q_params = [0, 1, 2]
	t_params = ['n','c','t','ct']
	P_params = [0, 1, 2]
	D_params = [0, 1]
	Q_params = [0, 1, 2]
	m_params = seasonal
	# create config instances
	for p in p_params:
		for d in d_params:
			for q in q_params:
				for t in t_params:
					for P in P_params:
						for D in D_params:
							for Q in Q_params:
								for m in m_params:
									cfg = [(p,d,q), (P,D,Q,m), t]
									models.append(cfg)
	return models

if __name__ == '__main__':
	# load dataset
	series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
	data = series.values
	print(data.shape)
	# data split
	n_test = 12
	# model configs
	cfg_list = sarima_configs(seasonal=[0,6,12])
	# grid search
	scores = grid_search(data, cfg_list, n_test)
	print('done')
	# list top 3 configs
	for cfg, error in scores[:3]:
		print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-68">68</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-70">70</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-72">72</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-74">74</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-76">76</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-78">78</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-80">80</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-82">82</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-84">84</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-86">86</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-88">88</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-90">90</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-92">92</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-94">94</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-96">96</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-98">98</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-100">100</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-102">102</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-104">104</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-106">106</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-108">108</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-110">110</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-112">112</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-114">114</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-116">116</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-118">118</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-120">120</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-122">122</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-124">124</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d0474404292-126">126</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d0474404292-127">127</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-1"><span class="crayon-p"># grid search sarima hyperparameters for monthly car sales dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-3"><span class="crayon-e">from </span><span class="crayon-e">multiprocessing </span><span class="crayon-e">import </span><span class="crayon-e">cpu_count</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-4"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">Parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-5"><span class="crayon-e">from </span><span class="crayon-e">joblib </span><span class="crayon-e">import </span><span class="crayon-e">delayed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-6"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">catch_warnings</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-7"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">filterwarnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-8"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">tsa</span><span class="crayon-sy">.</span><span class="crayon-v">statespace</span><span class="crayon-sy">.</span><span class="crayon-e">sarimax </span><span class="crayon-e">import </span><span class="crayon-e">SARIMAX</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-10"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-12"><span class="crayon-p"># one-step sarima forecast</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-13"><span class="crayon-e">def </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-14"><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-15"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SARIMAX</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seasonal_order</span><span class="crayon-o">=</span><span class="crayon-v">sorder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trend</span><span class="crayon-o">=</span><span class="crayon-v">trend</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_stationarity</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enforce_invertibility</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-17"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-18"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-19"><span class="crayon-h"> </span><span class="crayon-p"># make one step forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-20"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-22"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-23"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-24"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-25"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-26"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-27"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-28"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-30"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-31"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-32"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-33"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-34"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-35"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-36"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-37"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-38"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-40"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-41"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-42"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-43"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-44"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-45"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-46"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-47"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-48"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-50"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-51"><span class="crayon-e">def </span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-52"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-53"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-54"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-55"><span class="crayon-h"> </span><span class="crayon-p"># show all warnings and fail on exception if debugging</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-56"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-57"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-58"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-59"><span class="crayon-h"> </span><span class="crayon-p"># one failure during model validation suggests an unstable config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-60"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-61"><span class="crayon-h"> </span><span class="crayon-p"># never show warnings when grid searching, too noisy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-62"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-63"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-64"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-65"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-66"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-67"><span class="crayon-h"> </span><span class="crayon-p"># check for an interesting result</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-68"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">result </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-69"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-70"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-71"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-72"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-73"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-74"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-75"><span class="crayon-e"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">parallel</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-76"><span class="crayon-h"> </span><span class="crayon-p"># execute configs in parallel</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-77"><span class="crayon-h"> </span><span class="crayon-v">executor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Parallel</span><span class="crayon-sy">(</span><span class="crayon-v">n_jobs</span><span class="crayon-o">=</span><span class="crayon-e">cpu_count</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backend</span><span class="crayon-o">=</span><span class="crayon-s">'multiprocessing'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-78"><span class="crayon-h"> </span><span class="crayon-v">tasks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">delayed</span><span class="crayon-sy">(</span><span class="crayon-v">score_model</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-79"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">executor</span><span class="crayon-sy">(</span><span class="crayon-v">tasks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-80"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-81"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-82"><span class="crayon-h"> </span><span class="crayon-p"># remove empty results</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-83"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">scores </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-84"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-85"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-86"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-88"><span class="crayon-p"># create a set of sarima configs to try</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-89"><span class="crayon-e">def </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-90"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-91"><span class="crayon-h"> </span><span class="crayon-p"># define config lists</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-92"><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-93"><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-94"><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-95"><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'n'</span><span class="crayon-sy">,</span><span class="crayon-s">'c'</span><span class="crayon-sy">,</span><span class="crayon-s">'t'</span><span class="crayon-sy">,</span><span class="crayon-s">'ct'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-96"><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-97"><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-98"><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-99"><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">seasonal</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-100"><span class="crayon-h"> </span><span class="crayon-p"># create config instances</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-101"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">p_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-102"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">d_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-103"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">q_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-104"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">t_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-105"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">P</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">P_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-106"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">D</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">D_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-107"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">Q</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">Q_params</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-108"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">m_params</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-109"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">q</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-v">D</span><span class="crayon-sy">,</span><span class="crayon-v">Q</span><span class="crayon-sy">,</span><span class="crayon-v">m</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-110"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-111"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-112"> </div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-113"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-114"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-115"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-116"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-117"><span class="crayon-e"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-118"><span class="crayon-h"> </span><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-119"><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-120"><span class="crayon-h"> </span><span class="crayon-p"># model configs</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-121"><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sarima_configs</span><span class="crayon-sy">(</span><span class="crayon-v">seasonal</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-122"><span class="crayon-h"> </span><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-123"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-124"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-125"><span class="crayon-h"> </span><span class="crayon-p"># list top 3 configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d0474404292-126"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4c6f12d0474404292-127"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0079 seconds] -->
<p>Running the example may take a few minutes on modern hardware.</p>
<p>Model configurations and the RMSE are printed as the models are evaluated The top three model configurations and their error are reported at the end of the run.</p>
<p>We can see that the best result was an RMSE of about 1,551 sales with the following configuration:</p>
<ul>
<li><strong>Trend Order</strong>: (0, 0, 0)</li>
<li><strong>Seasonal Order</strong>: (1, 1, 0, 12)</li>
<li><strong>Trend Parameter</strong>: ‘t’ (linear trend)</li>
</ul>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4c6f12d2705643708" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
&gt; Model[[(2, 1, 2), (2, 1, 1, 6), 'ct']] 2246.248
&gt; Model[[(2, 1, 2), (2, 0, 2, 12), 'ct']] 10710.462
&gt; Model[[(2, 1, 2), (2, 1, 2, 6), 'ct']] 2183.568
&gt; Model[[(2, 1, 2), (2, 1, 0, 12), 'ct']] 2105.800
&gt; Model[[(2, 1, 2), (2, 1, 1, 12), 'ct']] 2330.361
&gt; Model[[(2, 1, 2), (2, 1, 2, 12), 'ct']] 31580326686.803
done
[(0, 0, 0), (1, 1, 0, 12), 't'] 1551.8423920342414
[(0, 0, 0), (2, 1, 1, 12), 'c'] 1557.334614575545
[(0, 0, 0), (1, 1, 0, 12), 'c'] 1559.3276311282675</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4c6f12d2705643708-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d2705643708-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d2705643708-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d2705643708-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d2705643708-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d2705643708-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d2705643708-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d2705643708-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4c6f12d2705643708-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4c6f12d2705643708-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4c6f12d2705643708-1">&gt; Model[[(2, 1, 2), (2, 1, 1, 6), 'ct']] 2246.248</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d2705643708-2">&gt; Model[[(2, 1, 2), (2, 0, 2, 12), 'ct']] 10710.462</div><div class="crayon-line" id="crayon-5c0ca4c6f12d2705643708-3">&gt; Model[[(2, 1, 2), (2, 1, 2, 6), 'ct']] 2183.568</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d2705643708-4">&gt; Model[[(2, 1, 2), (2, 1, 0, 12), 'ct']] 2105.800</div><div class="crayon-line" id="crayon-5c0ca4c6f12d2705643708-5">&gt; Model[[(2, 1, 2), (2, 1, 1, 12), 'ct']] 2330.361</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d2705643708-6">&gt; Model[[(2, 1, 2), (2, 1, 2, 12), 'ct']] 31580326686.803</div><div class="crayon-line" id="crayon-5c0ca4c6f12d2705643708-7">done</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d2705643708-8">[(0, 0, 0), (1, 1, 0, 12), 't'] 1551.8423920342414</div><div class="crayon-line" id="crayon-5c0ca4c6f12d2705643708-9">[(0, 0, 0), (2, 1, 1, 12), 'c'] 1557.334614575545</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4c6f12d2705643708-10">[(0, 0, 0), (1, 1, 0, 12), 'c'] 1559.3276311282675</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Data Transforms</strong>. Update the framework to support configurable data transforms such as normalization and standardization.</li>
<li><strong>Plot Forecast</strong>. Update the framework to re-fit a model with the best configuration and forecast the entire test dataset, then plot the forecast compared to the actual observations in the test set.</li>
<li><strong>Tune Amount of History</strong>. Update the framework to tune the amount of historical data used to fit the model (e.g. in the case of the 10 years of max temperature data).</li>
</ul>
<p>If you explore any of these extensions, I’d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>Posts</h3>
<ul>
<li><a href="https://machinelearningmastery.com/arima-for-time-series-forecasting-with-python/">How to Create an ARIMA Model for Time Series Forecasting with Python</a></li>
<li><a href="https://machinelearningmastery.com/grid-search-arima-hyperparameters-with-python/">How to Grid Search ARIMA Model Hyperparameters with Python</a></li>
<li><a href="https://machinelearningmastery.com/gentle-introduction-autocorrelation-partial-autocorrelation/">A Gentle Introduction to Autocorrelation and Partial Autocorrelation</a></li>
</ul>
<h3>Books</h3>
<ul>
<li>Chapter 8 ARIMA models, <a href="https://amzn.to/2xlJsfV">Forecasting: principles and practice</a>, 2013.</li>
<li>Chapter 7, Non-stationary Models, <a href="https://amzn.to/2smB9LR">Introductory Time Series with R</a>, 2009.</li>
</ul>
<h3>API</h3>
<ul>
<li><a href="http://www.statsmodels.org/dev/statespace.html">Statsmodels Time Series Analysis by State Space Methods</a></li>
<li><a href="http://www.statsmodels.org/dev/generated/statsmodels.tsa.statespace.sarimax.SARIMAX.html">statsmodels.tsa.statespace.sarimax.SARIMAX API</a></li>
<li><a href="http://www.statsmodels.org/dev/generated/statsmodels.tsa.statespace.sarimax.SARIMAXResults.html">statsmodels.tsa.statespace.sarimax.SARIMAXResults API</a></li>
<li><a href="http://www.statsmodels.org/dev/examples/notebooks/generated/statespace_sarimax_stata.html">Statsmodels SARIMAX Notebook</a></li>
<li><a href="https://pythonhosted.org/joblib/">Joblib: running Python functions as pipeline jobs</a></li>
</ul>
<h3>Articles</h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average">Autoregressive integrated moving average on Wikipedia</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop a framework for grid searching all of the SARIMA model hyperparameters for univariate time series forecasting.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a framework for grid searching SARIMA models from scratch using walk-forward validation.</li>
<li>How to grid search SARIMA model hyperparameters for daily time series data for births.</li>
<li>How to grid search SARIMA model hyperparameters for monthly time series data for shampoo sales, car sales and temperature.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img align="left" alt="Deep Learning for Time Series Forecasting" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br/>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6357 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Grid+Search+SARIMA+Model+Hyperparameters+for+Time+Series+Forecasting+in+Python&amp;url=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-grid-search-triple-exponential-smoothing-for-time-series-forecasting-in-python/" rel="prev"><i class="fa fa-angle-left"></i> How to Grid Search Triple Exponential Smoothing for Time Series Forecasting in Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-grid-search-naive-methods-for-univariate-time-series-forecasting/" rel="next">How to Grid Search Naive Methods for Univariate Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">10 Responses to <em>How to Grid Search SARIMA Model Hyperparameters for Time Series Forecasting in Python</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-452554">
<div class="comment-container" id="li-comment-452554">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4ad43c2d0ff136ee686c96c7a50dafa8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4ad43c2d0ff136ee686c96c7a50dafa8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://None" rel="external nofollow">zhangbo</a></span>
<span class="date">October 24, 2018 at 11:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-452554" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing.can you support a pay way of Zhi fubao or Wechat?Because i am in china,and payment of visa or paypal is kind of complex.</p>
<div class="reply">
<a aria-label="Reply to zhangbo" class="comment-reply-link" href="#comment-452554" onclick='return addComment.moveForm( "comment-452554", "452554", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-452580">
<div class="comment-container" id="li-comment-452580">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 24, 2018 at 2:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-452580" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion, I answer this question here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/can-i-pay-via-wechat-pay-or-alipay" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/can-i-pay-via-wechat-pay-or-alipay</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452580" onclick='return addComment.moveForm( "comment-452580", "452580", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-452701">
<div class="comment-container" id="li-comment-452701">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a0864a441dbf0b3063a66b839a4245e3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a0864a441dbf0b3063a66b839a4245e3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://github.com/PhySci" rel="external nofollow">Fedor</a></span>
<span class="date">October 25, 2018 at 6:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-452701" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Many thanks for the article. It’s really impressive, but eight nested for loops are not pythonic. Probably, there is a smarter way to do it. For instance, use ‘itertools.product’</p>
<div class="reply">
<a aria-label="Reply to Fedor" class="comment-reply-link" href="#comment-452701" onclick='return addComment.moveForm( "comment-452701", "452701", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-452754">
<div class="comment-container" id="li-comment-452754">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2018 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-452754" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I could not agree more!</p>
<p>Yes, cartesian product or similar.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452754" onclick='return addComment.moveForm( "comment-452754", "452754", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-452783">
<div class="comment-container" id="li-comment-452783">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d36fc1670dde552d3c0f745ba8221648?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d36fc1670dde552d3c0f745ba8221648?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://jonnoftw.github.com" rel="external nofollow">Jonathan Mackenzie</a></span>
<span class="date">October 26, 2018 at 12:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-452783" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this, I’ve been learning about ARIMA for my applications. I learnt a lot from Forecasting Principles and Practice which has an opentexts online version: <a href="https://otexts.org/fpp2/arima.html" rel="nofollow">https://otexts.org/fpp2/arima.html</a></p>
<p>One of the main issues I have with SARIMA (or maybe it’s just statsmodels) is that it doesn’t handle very large datasets very well. I have timeseries data with records every 5 minutes for ~6 years with 1 day or 1 week season length, ie. monday 9am is likely to correlate with monday 9am next week, which shows up in the differencing and ACF plots. Is there a better way or a better library to do this?</p>
<div class="reply">
<a aria-label="Reply to Jonathan Mackenzie" class="comment-reply-link" href="#comment-452783" onclick='return addComment.moveForm( "comment-452783", "452783", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-452788">
<div class="comment-container" id="li-comment-452788">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2018 at 2:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-452788" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could try exposing/engineering the features and fit a linear regression model directly to the data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452788" onclick='return addComment.moveForm( "comment-452788", "452788", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-454689">
<div class="comment-container" id="li-comment-454689">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/899b8163e3a02a546b47624805cda92a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/899b8163e3a02a546b47624805cda92a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stefan</span>
<span class="date">November 14, 2018 at 3:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-454689" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>You probably know already, but the following package aims to convert the R auto.arima to python. It has worked great for me. </p>
<p><a href="https://pypi.org/project/pyramid-arima/" rel="nofollow">https://pypi.org/project/pyramid-arima/</a></p>
<div class="reply">
<a aria-label="Reply to Stefan" class="comment-reply-link" href="#comment-454689" onclick='return addComment.moveForm( "comment-454689", "454689", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-454726">
<div class="comment-container" id="li-comment-454726">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 14, 2018 at 7:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-454726" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice find!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-454726" onclick='return addComment.moveForm( "comment-454726", "454726", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-454878">
<div class="comment-container" id="li-comment-454878">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/442b0656f0441242c67aa5e890fefe7c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/442b0656f0441242c67aa5e890fefe7c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://nearlearn.com" rel="external nofollow">mamina sahu</a></span>
<span class="date">November 15, 2018 at 8:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-454878" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks for sharing..</p>
<div class="reply">
<a aria-label="Reply to mamina sahu" class="comment-reply-link" href="#comment-454878" onclick='return addComment.moveForm( "comment-454878", "454878", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-454928">
<div class="comment-container" id="li-comment-454928">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2018 at 6:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#comment-454928" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad it helped.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-454928" onclick='return addComment.moveForm( "comment-454928", "454928", "respond", "6357" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/how-to-grid-search-sarima-model-hyperparameters-for-time-series-forecasting-in-python/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="6357"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="189c9395cf"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="174"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-51"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for Time Series</strong><br/>
Forecast the future with MLPs, CNNs, and LSTMs.
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>