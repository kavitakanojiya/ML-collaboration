<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop Deep Learning Models for Univariate Time Series Forecasting</title>
<link href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop Deep Learning Models for Univariate Time Series Forecasting" property="og:title"/>
<meta content="Deep learning neural networks are capable of automatically learning and extracting features from raw data. This feature of neural networks can be used for time series forecasting problems, where models can be developed directly on the raw observations without the direct need to scale the data using normalization and standardization or to make the data …" property="og:description"/>
<meta content="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Time Series" property="article:section"/>
<meta content="2018-10-28T18:00:20+00:00" property="article:published_time"/>
<meta content="2018-08-30T00:35:39+00:00" property="article:modified_time"/>
<meta content="2018-08-30T00:35:39+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-Car-Sales.png" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-Car-Sales.png" property="og:image:secure_url"/>
<meta content="1280" property="og:image:width"/>
<meta content="960" property="og:image:height"/>
<meta content="Line Plot of Monthly Car Sales" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop Deep Learning Models for Univariate Time Series Forecasting Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=6365" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-deep-learning-models-for-univariate-time-series-forecasting%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-deep-learning-models-for-univariate-time-series-forecasting%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-6365 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-53"> <div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-6365 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
<header>
<h1 class="title entry-title">How to Develop Deep Learning Models for Univariate Time Series Forecasting</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-29T05:00:20+1100">October 29, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6365 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+Deep+Learning+Models+for+Univariate+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Deep learning neural networks are capable of automatically learning and extracting features from raw data.</p>
<p>This feature of neural networks can be used for time series forecasting problems, where models can be developed directly on the raw observations without the direct need to scale the data using normalization and standardization or to make the data stationary by differencing.</p>
<p>Impressively, simple deep learning neural network models are capable of making skillful forecasts as compared to naive models and tuned SARIMA models on univariate time series forecasting problems that have both trend and seasonal components with no pre-processing.</p>
<p>In this tutorial, you will discover how to develop a suite of deep learning models for univariate time series forecasting.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a robust test harness using walk-forward validation for evaluating the performance of neural network models.</li>
<li>How to develop and evaluate simple multilayer Perceptron and convolutional neural networks for time series forecasting.</li>
<li>How to develop and evaluate LSTMs, CNN-LSTMs, and ConvLSTM neural network models for time series forecasting.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_6376" style="width: 650px"><img alt="How to Develop Deep Learning Models for Univariate Time Series Forecasting" class="size-full wp-image-6376" height="277" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Deep-Learning-Models-for-Univariate-Time-Series-Forecasting.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Deep-Learning-Models-for-Univariate-Time-Series-Forecasting.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Deep-Learning-Models-for-Univariate-Time-Series-Forecasting-300x130.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop Deep Learning Models for Univariate Time Series Forecasting<br/>Photo by <a href="https://www.flickr.com/photos/nmcqueenphotography/40518405705/">Nathaniel McQueen</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into five parts; they are:</p>
<ol>
<li>Problem Description</li>
<li>Model Evaluation Test Harness</li>
<li>Multilayer Perceptron Model</li>
<li>Convolutional Neural Network Model</li>
<li>Recurrent Neural Network Models</li>
</ol>
<h2>Problem Description</h2>
<p>The ‘<em>monthly car sales</em>‘ dataset summarizes the monthly car sales in Quebec, Canada between 1960 and 1968.</p>
<p>You can learn more about the dataset from <a href="https://datamarket.com/data/set/22n4/monthly-car-sales-in-quebec-1960-1968#!ds=22n4&amp;display=line">DataMarket</a>.</p>
<p>Download the dataset directly from here:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/monthly-car-sales.csv">monthly-car-sales.csv</a></li>
</ul>
<p>Save the file with the filename ‘<em>monthly-car-sales.csv</em>‘ in your current working directory.</p>
<p>We can load this dataset as a Pandas series using the function <em>read_csv()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac733484810354" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load
series = read_csv('monthly-car-sales.csv', header=0, index_col=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac733484810354-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac733484810354-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac733484810354-1"><span class="crayon-p"># load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac733484810354-2"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Once loaded, we can summarize the shape of the dataset in order to determine the number of observations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac73b866424732" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize shape
print(series.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac73b866424732-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac73b866424732-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac73b866424732-1"><span class="crayon-p"># summarize shape</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac73b866424732-2"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can then create a line plot of the series to get an idea of the structure of the series.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac73d550164253" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot
pyplot.plot(series)
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac73d550164253-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac73d550164253-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac73d550164253-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac73d550164253-1"><span class="crayon-p"># plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac73d550164253-2"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac73d550164253-3"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can tie all of this together; the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac73f070502950" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load and plot dataset
from pandas import read_csv
from matplotlib import pyplot
# load
series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
# summarize shape
print(series.shape)
# plot
pyplot.plot(series)
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac73f070502950-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac73f070502950-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac73f070502950-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac73f070502950-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac73f070502950-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac73f070502950-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac73f070502950-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac73f070502950-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac73f070502950-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac73f070502950-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac73f070502950-1"><span class="crayon-p"># load and plot dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac73f070502950-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9a8dac73f070502950-3"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac73f070502950-4"><span class="crayon-p"># load</span></div><div class="crayon-line" id="crayon-5c0c9a8dac73f070502950-5"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac73f070502950-6"><span class="crayon-p"># summarize shape</span></div><div class="crayon-line" id="crayon-5c0c9a8dac73f070502950-7"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac73f070502950-8"><span class="crayon-p"># plot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac73f070502950-9"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac73f070502950-10"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Running the example first prints the shape of the dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac741217467783" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(108, 1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac741217467783-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac741217467783-1">(108, 1)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The dataset is monthly and has nine years, or 108 observations. In our testing, will use the last year, or 12 observations, as the test set.</p>
<p>A line plot is created. The dataset has an obvious trend and seasonal component. The period of the seasonal component could be six months or 12 months.</p>
<div class="wp-caption aligncenter" id="attachment_6368" style="width: 1290px"><img alt="Line Plot of Monthly Car Sales" class="size-full wp-image-6368" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-Car-Sales.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-Car-Sales.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-Car-Sales-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-Car-Sales-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-Car-Sales-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plot of Monthly Car Sales</p></div>
<p>From prior experiments, we know that a naive model can achieve a root mean squared error, or RMSE, of 1841.155 by taking the median of the observations at the three prior years for the month being predicted; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac742573477727" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat = median(-12, -24, -36)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac742573477727-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac742573477727-1"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">median</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">36</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Where the negative indexes refer to observations in the series relative to the end of the historical data for the month being predicted.</p>
<p>From prior experiments, we know that a SARIMA model can achieve an RMSE of 1551.842 with the configuration of SARIMA(0, 0, 0),(1, 1, 0),12 where no elements are specified for the trend and a seasonal difference with a period of 12 is calculated and an AR model of one season is used.</p>
<p>The performance of the naive model provides a lower bound on a model that is considered skillful. Any model that achieves a predictive performance of lower than 1841.155 on the last 12 months has skill.</p>
<p>The performance of the SARIMA model provides a measure of a good model on the problem. Any model that achieves a predictive performance lower than 1551.842 on the last 12 months should be adopted over a SARIMA model.</p>
<p>Now that we have defined our problem and expectations of model skill, we can look at defining the test harness.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Download Your FREE Mini-Course</a><script data-config="%7B%7D" data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Model Evaluation Test Harness</h2>
<p>In this section, we will develop a test harness for developing and evaluating different types of neural network models for univariate time series forecasting.</p>
<p>This section is divided into the following parts:</p>
<ol>
<li>Train-Test Split</li>
<li>Series as Supervised Learning</li>
<li>Walk-Forward Validation</li>
<li>Repeat Evaluation</li>
<li>Summarize Performance</li>
<li>Worked Example</li>
</ol>
<h3>Train-Test Split</h3>
<p>The first step is to split the loaded series into train and test sets.</p>
<p>We will use the first eight years (96 observations) for training and the last 12 for the test set.</p>
<p>The <em>train_test_split()</em> function below will split the series taking the raw observations and the number of observations to use in the test set as arguments.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac744298692129" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac744298692129-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac744298692129-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac744298692129-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac744298692129-1"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac744298692129-2"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac744298692129-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<h3>Series as Supervised Learning</h3>
<p>Next, we need to be able to frame the univariate series of observations as a supervised learning problem so that we can train neural network models.</p>
<p>A supervised learning framing of a series means that the data needs to be split into multiple examples that the model learn from and generalize across.</p>
<p>Each sample must have both an input component and an output component.</p>
<p>The input component will be some number of prior observations, such as three years or 36 time steps.</p>
<p>The output component will be the total sales in the next month because we are interested in developing a model to make one-step forecasts.</p>
<p>We can implement this using the <a href="http://pandas-docs.github.io/pandas-docs-travis/generated/pandas.DataFrame.shift.html">shift() function</a> on the pandas DataFrame. It allows us to shift a column down (forward in time) or back (backward in time). We can take the series as a column of data, then create multiple copies of the column, shifted forward or backward in time in order to create the samples with the input and output elements we require.</p>
<p>When a series is shifted down, <em>NaN</em> values are introduced because we don’t have values beyond the start of the series.</p>
<p>For example, the series defined as a column:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac747286720934" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(t)
1
2
3
4</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac747286720934-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac747286720934-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac747286720934-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac747286720934-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac747286720934-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac747286720934-1">(t)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac747286720934-2">1</div><div class="crayon-line" id="crayon-5c0c9a8dac747286720934-3">2</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac747286720934-4">3</div><div class="crayon-line" id="crayon-5c0c9a8dac747286720934-5">4</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Can be shifted and inserted as a column beforehand:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac749237062930" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(t-1),		(t)
Nan,		1
1,			2
2,			3
3,			4
4			NaN</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac749237062930-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac749237062930-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac749237062930-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac749237062930-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac749237062930-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac749237062930-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac749237062930-1">(t-1),		(t)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac749237062930-2">Nan,		1</div><div class="crayon-line" id="crayon-5c0c9a8dac749237062930-3">1,			2</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac749237062930-4">2,			3</div><div class="crayon-line" id="crayon-5c0c9a8dac749237062930-5">3,			4</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac749237062930-6">4			NaN</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that on the second row, the value 1 is provided as input as an observation at the prior time step, and 2 is the next value in the series that can be predicted, or learned by the model to be predicted when 1 is presented as input.</p>
<p>Rows with <em>NaN</em> values can be removed.</p>
<p>The <em>series_to_supervised()</em> function below implements this behavior, allowing you to specify the number of lag observations to use in the input and the number to use in the output for each sample. It will also remove rows that have <em>NaN</em> values as they cannot be used to train or test a model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac74b172023844" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74b172023844-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74b172023844-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74b172023844-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74b172023844-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74b172023844-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74b172023844-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74b172023844-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74b172023844-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-1"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74b172023844-2"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-3"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74b172023844-4"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-5"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74b172023844-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-7"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74b172023844-8"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74b172023844-10"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-11"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74b172023844-12"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-13"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74b172023844-14"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74b172023844-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p></p>
<h3>Walk-Forward Validation</h3>
<p>Time series forecasting models can be evaluated on a test set using <a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/">walk-forward validation</a>.</p>
<p>Walk-forward validation is an approach where the model makes a forecast for each observation in the test dataset one at a time. After each forecast is made for a time step in the test dataset, the true observation for the forecast is added to the test dataset and made available to the model.</p>
<p>Simpler models can be refit with the observation prior to making the subsequent prediction. More complex models, such as neural networks, are not refit given the much greater computational cost.</p>
<p>Nevertheless, the true observation for the time step can then be used as part of the input for making the prediction on the next time step.</p>
<p>First, the dataset is split into train and test sets. We will call the <em>train_test_split()</em> function to perform this split and pass in the pre-specified number of observations to use as the test data.</p>
<p>A model will be fit once on the training dataset for a given configuration.</p>
<p>We will define a generic <em>model_fit()</em> function to perform this operation that can be filled in for the given type of neural network that we may be interested in later. The function takes the training dataset and the model configuration and returns the fit model ready for making predictions.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac74d487201755" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	return None</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac74d487201755-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74d487201755-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74d487201755-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac74d487201755-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74d487201755-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74d487201755-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Each time step of the test dataset is enumerated. A prediction is made using the fit model.</p>
<p>Again, we will define a generic function named <em>model_predict()</em> that takes the fit model, the history, and the model configuration and makes a single one-step prediction.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac74e962912638" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	return 0.0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac74e962912638-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac74e962912638-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac74e962912638-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac74e962912638-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac74e962912638-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac74e962912638-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The prediction is added to a list of predictions and the true observation from the test set is added to a list of observations that was seeded with all observations from the training dataset. This list is built up during each step in the walk-forward validation, allowing the model to make a one-step prediction using the most recent history.</p>
<p>All of the predictions can then be compared to the true values in the test set and an error measure calculated.</p>
<p>We will calculate the root mean squared error, or RMSE, between predictions and the true values.</p>
<p>RMSE is calculated as the square root of the average of the squared differences between the forecasts and the actual values. The <em>measure_rmse()</em> implements this below using the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">mean_squared_error() scikit-learn function</a> to first calculate the mean squared error, or MSE, before calculating the square root.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac750250494437" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac750250494437-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac750250494437-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac750250494437-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac750250494437-1"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac750250494437-2"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac750250494437-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete <em>walk_forward_validation()</em> function that ties all of this together is listed below.</p>
<p>It takes the dataset, the number of observations to use as the test set, and the configuration for the model, and returns the RMSE for the model performance on the test set.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac752091800788" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac752091800788-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac752091800788-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-1"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-2"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-3"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-4"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-5"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-6"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-8"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-9"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-10"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-12"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-14"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-15"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-16"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-17"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-18"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-19"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac752091800788-20"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac752091800788-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p></p>
<h3>Repeat Evaluation</h3>
<p>Neural network models are stochastic.</p>
<p>This means that, given the same model configuration and the same training dataset, a different internal set of weights will result each time the model is trained that will in turn have a different performance.</p>
<p>This is a benefit, allowing the model to be adaptive and find high performing configurations to complex problems.</p>
<p>It is also a problem when evaluating the performance of a model and in choosing a final model to use to make predictions.</p>
<p>To address model evaluation, we will evaluate a model configuration multiple times via walk-forward validation and report the error as the average error across each evaluation.</p>
<p>This is not always possible for large neural networks and may only make sense for small networks that can be fit in minutes or hours.</p>
<p>The <em>repeat_evaluate()</em> function below implements this and allows the number of repeats to be specified as an optional parameter that defaults to 30 and returns a list of model performance scores: in this case, RMSE values.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac753239205324" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# repeat evaluation of a config
def repeat_evaluate(data, config, n_test, n_repeats=30):
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	return scores</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac753239205324-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac753239205324-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac753239205324-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac753239205324-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac753239205324-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac753239205324-1"><span class="crayon-p"># repeat evaluation of a config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac753239205324-2"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac753239205324-3"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac753239205324-4"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac753239205324-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p></p>
<h3>Summarize Performance</h3>
<p>Finally, we need to summarize the performance of a model from the multiple repeats.</p>
<p>We will summarize the performance first using summary statistics, specifically the mean and the standard deviation.</p>
<p>We will also plot the distribution of model performance scores using a box and whisker plot to help get an idea of the spread of performance.</p>
<p>The <em>summarize_scores()</em> function below implements this, taking the name of the model that was evaluated and the list of scores from each repeated evaluation, printing the summary and showing a plot.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac755028004769" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize model performance
def summarize_scores(name, scores):
	# print a summary
	scores_m, score_std = mean(scores), std(scores)
	print('%s: %.3f RMSE (+/- %.3f)' % (name, scores_m, score_std))
	# box and whisker plot
	pyplot.boxplot(scores)
	pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac755028004769-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac755028004769-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac755028004769-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac755028004769-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac755028004769-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac755028004769-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac755028004769-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac755028004769-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac755028004769-1"><span class="crayon-p"># summarize model performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac755028004769-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac755028004769-3"><span class="crayon-h"> </span><span class="crayon-p"># print a summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac755028004769-4"><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac755028004769-5"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f RMSE (+/- %.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac755028004769-6"><span class="crayon-h"> </span><span class="crayon-p"># box and whisker plot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac755028004769-7"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac755028004769-8"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<h3>Worked Example</h3>
<p>Now that we have defined the elements of the test harness, we can tie them all together and define a simple persistence model.</p>
<p>Specifically, we will calculate the median of a subset of prior observations relative to the time to be forecasted.</p>
<p>We do not need to fit a model so the <em>model_fit()</em> function will be implemented to simply return <em>None</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac757616693907" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	return None</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac757616693907-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac757616693907-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac757616693907-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac757616693907-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac757616693907-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac757616693907-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We will use the config to define a list of index offsets in the prior observations relative to the time to be forecasted that will be used as the prediction. For example, 12 will use the observation 12 months ago (-12) relative to the time to be forecasted.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac759348911602" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define config
config = [12, 24, 36]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac759348911602-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac759348911602-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac759348911602-1"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac759348911602-2"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">36</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The model_predict() function can be implemented to use this configuration to collect the observations, then return the median of those observations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac77b144563131" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	values = list()
	for offset in config:
		values.append(history[-offset])
	return median(values)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac77b144563131-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77b144563131-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77b144563131-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77b144563131-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77b144563131-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77b144563131-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac77b144563131-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77b144563131-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77b144563131-3"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77b144563131-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">offset </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77b144563131-5"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">offset</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77b144563131-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">median</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>The complete example of using the framework with a simple persistence model is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac77f178561922" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# persistence
from math import sqrt
from numpy import mean
from numpy import std
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# difference dataset
def difference(data, interval):
	return [data[i] - data[i - interval] for i in range(interval, len(data))]

# fit a model
def model_fit(train, config):
	return None

# forecast with a pre-fit model
def model_predict(model, history, config):
	values = list()
	for offset in config:
		values.append(history[-offset])
	return median(values)

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# repeat evaluation of a config
def repeat_evaluate(data, config, n_test, n_repeats=30):
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	return scores

# summarize model performance
def summarize_scores(name, scores):
	# print a summary
	scores_m, score_std = mean(scores), std(scores)
	print('%s: %.3f RMSE (+/- %.3f)' % (name, scores_m, score_std))
	# box and whisker plot
	pyplot.boxplot(scores)
	pyplot.show()

series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# define config
config = [12, 24, 36]
# grid search
scores = repeat_evaluate(data, config, n_test)
# summarize scores
summarize_scores('persistence', scores)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a8dac77f178561922-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac77f178561922-96">96</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-1"><span class="crayon-p"># persistence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-9"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-10"> </div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-11"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-12"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-14"> </div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-15"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-16"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-17"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-18"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-19"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-21"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-22"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-23"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-24"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-25"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-26"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-27"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-28"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-30"> </div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-31"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-32"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-34"> </div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-35"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-36"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-38"> </div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-39"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-40"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-41"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-42"> </div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-43"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-44"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-45"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-46"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">offset </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-47"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">offset</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-48"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">median</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-50"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-51"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-52"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-53"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-54"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-55"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-56"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-57"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-58"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-59"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-60"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-61"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-62"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-63"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-64"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-65"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-66"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-67"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-68"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-69"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-70"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-71"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-72"><span class="crayon-p"># repeat evaluation of a config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-73"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-74"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-75"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-76"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-77"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-78"><span class="crayon-p"># summarize model performance</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-79"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-80"><span class="crayon-h"> </span><span class="crayon-p"># print a summary</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-81"><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-82"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f RMSE (+/- %.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-83"><span class="crayon-h"> </span><span class="crayon-p"># box and whisker plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-84"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-85"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-86"> </div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-87"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-88"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-89"><span class="crayon-p"># data split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-90"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-91"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-92"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">36</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-93"><span class="crayon-p"># grid search</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-94"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac77f178561922-95"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac77f178561922-96"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'persistence'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0048 seconds] -->
<p>Running the example prints the RMSE of the model evaluated using walk-forward validation on the final 12 months of data.</p>
<p>The model is evaluated 30 times, although, because the model has no stochastic element, the score is the same each time.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac784965159268" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
 &gt; 1841.156
persistence: 1841.156 RMSE (+/- 0.000)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac784965159268-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac784965159268-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-1"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-2"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-3"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-4"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-5"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-6"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-7"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-8"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-9"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-10"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-11"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-12"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-13"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-14"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-15"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-16"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-17"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-18"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-19"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-20"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-21"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-22"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-23"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-24"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-25"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-26"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-27"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-28"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-29"> &gt; 1841.156</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac784965159268-30"> &gt; 1841.156</div><div class="crayon-line" id="crayon-5c0c9a8dac784965159268-31">persistence: 1841.156 RMSE (+/- 0.000)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that the RMSE of the model is 1841, providing a lower-bound of performance by which we can evaluate whether a model is skillful or not on the problem.</p>
<div class="wp-caption aligncenter" id="attachment_6369" style="width: 1290px"><img alt="Box and Whisker Plot of Persistence RMSE Forecasting Car Sales" class="size-full wp-image-6369" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Persistence-RMSE-Forecasting-Car-Sales.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Persistence-RMSE-Forecasting-Car-Sales.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Persistence-RMSE-Forecasting-Car-Sales-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Persistence-RMSE-Forecasting-Car-Sales-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Persistence-RMSE-Forecasting-Car-Sales-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Box and Whisker Plot of Persistence RMSE Forecasting Car Sales</p></div>
<p>Now that we have a robust test harness, we can use it to evaluate a suite of neural network models.</p>
<h2>Multilayer Perceptron Model</h2>
<p>The first network that we will evaluate is a multilayer Perceptron, or MLP for short.</p>
<p>This is a simple feed-forward neural network model that should be evaluated before more elaborate models are considered.</p>
<p>MLPs can be used for time series forecasting by taking multiple observations at prior time steps, called lag observations, and using them as input features and predicting one or more time steps from those observations.</p>
<p>This is exactly the framing of the problem provided by the <em>series_to_supervised()</em> function in the previous section.</p>
<p>The training dataset is therefore a list of samples, where each sample has some number of observations from months prior to the time being forecasted, and the forecast is the next month in the sequence. For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac788801949783" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X, 							y
month1, month2, month3,		month4
month2, month3, month4,		month5
month3, month4, month5,		month6
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac788801949783-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac788801949783-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac788801949783-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac788801949783-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac788801949783-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac788801949783-1">X, 							y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac788801949783-2">month1, month2, month3,		month4</div><div class="crayon-line" id="crayon-5c0c9a8dac788801949783-3">month2, month3, month4,		month5</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac788801949783-4">month3, month4, month5,		month6</div><div class="crayon-line" id="crayon-5c0c9a8dac788801949783-5">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The model will attempt to generalize over these samples, such that when a new sample is provided beyond what is known by the model, it can predict something useful; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac78d629579106" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X, 							y
month4, month5, month6,		???</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac78d629579106-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac78d629579106-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac78d629579106-1">X, 							y</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac78d629579106-2">month4, month5, month6,		???</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We will implement a simple MLP using the Keras deep learning library.</p>
<p>The model will have an input layer with some number of prior observations. This can be specified using the <em>input_dim</em> argument when we define the first hidden layer. The model will have a single hidden layer with some number of nodes, then a single output layer.</p>
<p>We will use the rectified linear activation function on the hidden layer as it performs well. We will use a linear activation function (the default) on the output layer because we are predicting a continuous value.</p>
<p>The loss function for the network will be the mean squared error loss, or MSE, and we will use the efficient <a href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/">Adam flavor of stochastic gradient descent</a> to train the network.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac791581517439" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(Dense(n_nodes, activation='relu', input_dim=n_input))
model.add(Dense(1))
model.compile(loss='mse', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac791581517439-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac791581517439-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac791581517439-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac791581517439-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac791581517439-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac791581517439-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac791581517439-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac791581517439-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac791581517439-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac791581517439-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>The model will be fit for some number of training epochs (exposures to the training data) and batch size can be specified to define how often the weights are updated within each epoch.</p>
<p>The <em>model_fit()</em> function for fitting an MLP model on the training dataset is listed below.</p>
<p>The function expects the config to be a list with the following configuration hyperparameters:</p>
<ul>
<li><strong>n_input</strong>: The number of lag observations to use as input to the model.</li>
<li><strong>n_nodes</strong>: The number of nodes to use in the hidden layer.</li>
<li><strong>n_epochs</strong>: The number of times to expose the model to the whole training dataset.</li>
<li><strong>n_batch</strong>: The number of samples within an epoch after which the weights are updated.</li>
</ul>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac795510004564" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch = config
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	# define model
	model = Sequential()
	model.add(Dense(n_nodes, activation='relu', input_dim=n_input))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac795510004564-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac795510004564-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac795510004564-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac795510004564-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac795510004564-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac795510004564-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac795510004564-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac795510004564-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac795510004564-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac795510004564-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac795510004564-6"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-7"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac795510004564-8"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-9"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac795510004564-10"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-11"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac795510004564-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-13"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac795510004564-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac795510004564-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Making a prediction with a fit MLP model is as straightforward as calling the <em>predict()</em> function and passing in one sample worth of input values required to make the prediction.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac79a374882772" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat = model.predict(x_input, verbose=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac79a374882772-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac79a374882772-1"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>In order to make a prediction beyond the limit of known data, this requires that the last n known observations are taken as an array and used as input.</p>
<p>The <em>predict()</em> function expects one or more samples of inputs when making a prediction, so providing a single sample requires the array to have the shape [<em>1, n_input</em>], where <em>n_input</em> is the number of time steps that the model expects as input.</p>
<p>Similarly, the <em>predict()</em> function returns an array of predictions, one for each sample provided as input. In the case of one prediction, there will be an array with one value.</p>
<p>The <em>model_predict()</em> function below implements this behavior, taking the model, the prior observations, and model configuration as arguments, formulating an input sample and making a one-step prediction that is then returned.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac79e445766692" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _ = config
	# prepare data
	x_input = array(history[-n_input:]).reshape(1, n_input)
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac79e445766692-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac79e445766692-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac79e445766692-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac79e445766692-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac79e445766692-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac79e445766692-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac79e445766692-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac79e445766692-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac79e445766692-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac79e445766692-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac79e445766692-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac79e445766692-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac79e445766692-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac79e445766692-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac79e445766692-6"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac79e445766692-7"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac79e445766692-8"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac79e445766692-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We now have everything we need to evaluate an MLP model on the monthly car sales dataset.</p>
<p>A simple grid search of model hyperparameters was performed and the configuration below was chosen. This may not be an optimal configuration, but is the best that was found.</p>
<ul>
<li><strong>n_input</strong>: 24 (e.g. 24 months)</li>
<li><strong>n_nodes</strong>: 500</li>
<li><strong>n_epochs</strong>: 100</li>
<li><strong>n_batch</strong>: 100</li>
</ul>
<p>This configuration can be defined as a list:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7a2085453981" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define config
config = [24, 500, 100, 100]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7a2085453981-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a2085453981-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7a2085453981-1"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a2085453981-2"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Note that when the training data is framed as a supervised learning problem, there are only 72 samples that can be used to train the model.</p>
<p>Using a batch size of 72 or more means that the model is being trained using batch gradient descent instead of mini-batch gradient descent. This is often used for small datasets and means that weight updates and gradient calculations are performed at the end of each epoch, instead of multiple times within each epoch.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7a7885529894" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate mlp
from math import sqrt
from numpy import array
from numpy import mean
from numpy import std
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from matplotlib import pyplot

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch = config
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	# define model
	model = Sequential()
	model.add(Dense(n_nodes, activation='relu', input_dim=n_input))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _ = config
	# prepare data
	x_input = array(history[-n_input:]).reshape(1, n_input)
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# repeat evaluation of a config
def repeat_evaluate(data, config, n_test, n_repeats=30):
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	return scores

# summarize model performance
def summarize_scores(name, scores):
	# print a summary
	scores_m, score_std = mean(scores), std(scores)
	print('%s: %.3f RMSE (+/- %.3f)' % (name, scores_m, score_std))
	# box and whisker plot
	pyplot.boxplot(scores)
	pyplot.show()

series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# define config
config = [24, 500, 100, 100]
# grid search
scores = repeat_evaluate(data, config, n_test)
# summarize scores
summarize_scores('mlp', scores)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7a7885529894-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7a7885529894-110">110</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-1"><span class="crayon-p"># evaluate mlp</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-8"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-12"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-14"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-15"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-18"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-19"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-20"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-21"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-22"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-23"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-24"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-25"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-26"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-27"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-28"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-29"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-30"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-31"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-32"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-33"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-34"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-35"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-38"><span class="crayon-p"># fit a model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-39"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-40"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-41"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-42"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-43"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-44"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-45"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-46"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-47"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-48"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-49"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-50"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-51"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-52"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-53"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-54"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-55"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-56"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-57"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-58"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-59"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-60"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-61"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-62"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-63"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-64"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-65"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-66"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-67"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-68"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-69"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-70"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-71"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-72"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-73"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-74"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-75"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-76"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-77"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-78"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-79"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-80"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-81"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-82"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-83"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-84"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-85"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-86"><span class="crayon-p"># repeat evaluation of a config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-87"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-88"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-89"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-90"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-91"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-92"><span class="crayon-p"># summarize model performance</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-93"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-94"><span class="crayon-h"> </span><span class="crayon-p"># print a summary</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-95"><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-96"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f RMSE (+/- %.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-97"><span class="crayon-h"> </span><span class="crayon-p"># box and whisker plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-98"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-99"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-100"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-101"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-102"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-103"><span class="crayon-p"># data split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-104"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-105"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-106"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-107"><span class="crayon-p"># grid search</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-108"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7a7885529894-109"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7a7885529894-110"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'mlp'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0050 seconds] -->
<p>Running the example prints the RMSE for each of the 30 repeated evaluations of the model.</p>
<p>At the end of the run, the average and standard deviation RMSE are reported of about 1,526 sales.</p>
<p>We can see that, on average, the chosen configuration has better performance than both the naive model (1841.155) and the SARIMA model (1551.842).</p>
<p>This is impressive given that the model operated on the raw data directly without scaling or the data being made stationary.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7ab185144226" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
 &gt; 1629.203
 &gt; 1642.219
 &gt; 1472.483
 &gt; 1662.055
 &gt; 1452.480
 &gt; 1465.535
 &gt; 1116.253
 &gt; 1682.667
 &gt; 1642.626
 &gt; 1700.183
 &gt; 1444.481
 &gt; 1673.217
 &gt; 1602.342
 &gt; 1655.895
 &gt; 1319.387
 &gt; 1591.972
 &gt; 1592.574
 &gt; 1361.607
 &gt; 1450.348
 &gt; 1314.529
 &gt; 1549.505
 &gt; 1569.750
 &gt; 1427.897
 &gt; 1478.926
 &gt; 1474.990
 &gt; 1458.993
 &gt; 1643.383
 &gt; 1457.925
 &gt; 1558.934
 &gt; 1708.278
mlp: 1526.688 RMSE (+/- 134.789)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ab185144226-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ab185144226-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-1"> &gt; 1629.203</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-2"> &gt; 1642.219</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-3"> &gt; 1472.483</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-4"> &gt; 1662.055</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-5"> &gt; 1452.480</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-6"> &gt; 1465.535</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-7"> &gt; 1116.253</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-8"> &gt; 1682.667</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-9"> &gt; 1642.626</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-10"> &gt; 1700.183</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-11"> &gt; 1444.481</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-12"> &gt; 1673.217</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-13"> &gt; 1602.342</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-14"> &gt; 1655.895</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-15"> &gt; 1319.387</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-16"> &gt; 1591.972</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-17"> &gt; 1592.574</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-18"> &gt; 1361.607</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-19"> &gt; 1450.348</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-20"> &gt; 1314.529</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-21"> &gt; 1549.505</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-22"> &gt; 1569.750</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-23"> &gt; 1427.897</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-24"> &gt; 1478.926</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-25"> &gt; 1474.990</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-26"> &gt; 1458.993</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-27"> &gt; 1643.383</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-28"> &gt; 1457.925</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-29"> &gt; 1558.934</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ab185144226-30"> &gt; 1708.278</div><div class="crayon-line" id="crayon-5c0c9a8dac7ab185144226-31">mlp: 1526.688 RMSE (+/- 134.789)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A box and whisker plot of the RMSE scores is created to summarize the spread of the performance for the model.</p>
<p>This helps to understand the spread of the scores. We can see that although on average the performance of the model is impressive, the spread is large. The standard deviation is a little more than 134 sales, meaning a worse case model run that is 2 or 3 standard deviations in error from the mean error may be worse than the naive model.</p>
<p>A challenge in using the MLP model is in harnessing the higher skill and minimizing the variance of the model across multiple runs.</p>
<p>This problem applies generally for neural networks. There are many strategies that you could use, but perhaps the simplest is simply to train multiple final models on all of the available data and use them in an ensemble when making predictions, e.g. the prediction is the average of 10-to-30 models.</p>
<div class="wp-caption aligncenter" id="attachment_6370" style="width: 1290px"><img alt="Box and Whisker Plot of Multilayer Perceptron RMSE Forecasting Car Sales" class="size-full wp-image-6370" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Multilayer-Perceptron-RMSE-Forecasting-Car-Sales.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Multilayer-Perceptron-RMSE-Forecasting-Car-Sales.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Multilayer-Perceptron-RMSE-Forecasting-Car-Sales-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Multilayer-Perceptron-RMSE-Forecasting-Car-Sales-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Multilayer-Perceptron-RMSE-Forecasting-Car-Sales-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Box and Whisker Plot of Multilayer Perceptron RMSE Forecasting Car Sales</p></div>
<h2>Convolutional Neural Network Model</h2>
<p>Convolutional Neural Networks, or CNNs, are a type of neural network developed for two-dimensional image data, although they can be used for one-dimensional data such as sequences of text and time series.</p>
<p>When operating on one-dimensional data, the CNN reads across a sequence of lag observations and learns to extract features that are relevant for making a prediction.</p>
<p>We will define a CNN with two convolutional layers for extracting features from the input sequences. Each will have a configurable number of filters and kernel size and will use the rectified linear activation function. The number of filters determines the number of parallel fields on which the weighted inputs are read and projected. The kernel size defines the number of time steps read within each snapshot as the network reads along the input sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7b0409449109" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(n_input, 1)))
model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu'))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7b0409449109-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7b0409449109-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7b0409449109-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7b0409449109-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>A max pooling layer is used after convolutional layers to distill the weighted input features into those that are most salient, reducing the input size by 1/4. The pooled inputs are flattened to one long vector before being interpreted and used to make a one-step prediction.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7b5859284353" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7b5859284353-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7b5859284353-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7b5859284353-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7b5859284353-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7b5859284353-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7b5859284353-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The CNN model expects input data to be in the form of multiple samples, where each sample has multiple input time steps, the same as the MLP in the previous section.</p>
<p>One difference is that the CNN can support multiple features or types of observations at each time step, which are interpreted as channels of an image. We only have a single feature at each time step, therefore the required three-dimensional shape of the input data will be [<em>n_samples, n_input, 1</em>].</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7b9958306027" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7b9958306027-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7b9958306027-1"><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The <em>model_fit()</em> function for fitting the CNN model on the training dataset is listed below.</p>
<p>The model takes the following five configuration parameters as a list:</p>
<ul>
<li><strong>n_input</strong>: The number of lag observations to use as input to the model.</li>
<li><strong>n_filters</strong>: The number of parallel filters.</li>
<li><strong>n_kernel</strong>: The number of time steps considered in each read of the input sequence.</li>
<li><strong>n_epochs</strong>: The number of times to expose the model to the whole training dataset.</li>
<li><strong>n_batch</strong>: The number of samples within an epoch after which the weights are updated.</li>
</ul>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7bd889423251" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_filters, n_kernel, n_epochs, n_batch = config
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], 1))
	# define model
	model = Sequential()
	model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(n_input, 1)))
	model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7bd889423251-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7bd889423251-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-6"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-7"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-8"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-9"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-10"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-11"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-17"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7bd889423251-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7bd889423251-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Making a prediction with the fit CNN model is very much like making a prediction with the fit MLP model in the previous section.</p>
<p>The one difference is in the requirement that we specify the number of features observed at each time step, which in this case is 1. Therefore, when making a single one-step prediction, the shape of the input array must be:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7c2222319908" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[1, n_input, 1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7c2222319908-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7c2222319908-1">[1, n_input, 1]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The <em>model_predict()</em> function below implements this behavior.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7c6488603090" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, _ = config
	# prepare data
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7c6488603090-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7c6488603090-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7c6488603090-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7c6488603090-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7c6488603090-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7c6488603090-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7c6488603090-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7c6488603090-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7c6488603090-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7c6488603090-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7c6488603090-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7c6488603090-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7c6488603090-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7c6488603090-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7c6488603090-6"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7c6488603090-7"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7c6488603090-8"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7c6488603090-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>A simple grid search of model hyperparameters was performed and the configuration below was chosen. This is not an optimal configuration, but is the best that was found.</p>
<p>The chosen configuration is as follows:</p>
<ul>
<li><strong>n_input</strong>: 36 (e.g. 3 years or 3 * 12)</li>
<li><strong>n_filters</strong>: 256</li>
<li><strong>n_kernel</strong>: 3</li>
<li><strong>n_epochs</strong>: 100</li>
<li><strong>n_batch</strong>: 100 (e.g. batch gradient descent)</li>
</ul>
<p>This can be specified as a list as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7cb387373780" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define config
config = [36, 256, 3, 100, 100]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7cb387373780-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cb387373780-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7cb387373780-1"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cb387373780-2"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">36</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Tying all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7cf724982926" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate cnn
from math import sqrt
from numpy import array
from numpy import mean
from numpy import std
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D
from matplotlib import pyplot

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_filters, n_kernel, n_epochs, n_batch = config
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], 1))
	# define model
	model = Sequential()
	model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(n_input, 1)))
	model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, _ = config
	# prepare data
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# repeat evaluation of a config
def repeat_evaluate(data, config, n_test, n_repeats=30):
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	return scores

# summarize model performance
def summarize_scores(name, scores):
	# print a summary
	scores_m, score_std = mean(scores), std(scores)
	print('%s: %.3f RMSE (+/- %.3f)' % (name, scores_m, score_std))
	# box and whisker plot
	pyplot.boxplot(scores)
	pyplot.show()

series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# define config
config = [36, 256, 3, 100, 100]
# grid search
scores = repeat_evaluate(data, config, n_test)
# summarize scores
summarize_scores('cnn', scores)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-112">112</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-114">114</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7cf724982926-116">116</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7cf724982926-117">117</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-1"><span class="crayon-p"># evaluate cnn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-8"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-14"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">MaxPooling1D</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-15"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-16"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-17"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-18"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-20"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-21"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-22"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-23"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-24"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-25"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-26"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-27"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-28"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-29"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-30"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-31"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-32"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-33"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-34"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-36"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-37"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-38"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-39"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-40"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-41"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-42"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-43"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-44"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-45"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-46"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-47"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-48"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-49"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-50"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-51"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-52"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-53"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-55"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-56"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-57"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-58"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-59"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-60"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-61"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-62"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-63"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-64"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-65"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-66"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-67"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-68"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-69"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-70"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-71"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-72"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-73"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-74"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-75"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-76"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-77"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-78"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-79"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-80"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-81"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-82"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-83"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-84"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-85"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-86"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-87"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-88"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-89"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-90"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-91"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-92"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-93"><span class="crayon-p"># repeat evaluation of a config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-94"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-95"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-96"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-97"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-98"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-99"><span class="crayon-p"># summarize model performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-100"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-101"><span class="crayon-h"> </span><span class="crayon-p"># print a summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-102"><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-103"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f RMSE (+/- %.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-104"><span class="crayon-h"> </span><span class="crayon-p"># box and whisker plot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-105"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-106"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-107"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-108"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-109"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-110"><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-111"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-112"><span class="crayon-p"># define config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-113"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">36</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-114"><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-115"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7cf724982926-116"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7cf724982926-117"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'cnn'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0059 seconds] -->
<p>Running the example first prints the RMSE for each repeated evaluation of the model.</p>
<p>At the end of the run, we can see that indeed the model is skillful, achieving an average RMSE of 1,524.067, which is better than the naive model, the SARIMA model, and even the MLP model in the previous section.</p>
<p>This is impressive given that the model operated on the raw data directly without scaling or the data being made stationary.</p>
<p>The standard deviation of the score is large, at about 57 sales, but is 1/3 the size of the variance observed with the MLP model in the previous section. We have some confidence that in a bad-case scenario (3 standard deviations), the model RMSE will remain below (better than) the performance of the naive model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7d3001625727" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
&gt; 1551.031
&gt; 1495.743
&gt; 1449.408
&gt; 1526.017
&gt; 1466.118
&gt; 1566.535
&gt; 1649.204
&gt; 1455.782
&gt; 1574.214
&gt; 1541.790
&gt; 1489.140
&gt; 1506.035
&gt; 1513.197
&gt; 1530.714
&gt; 1511.328
&gt; 1471.518
&gt; 1555.596
&gt; 1552.026
&gt; 1531.727
&gt; 1472.978
&gt; 1620.242
&gt; 1424.153
&gt; 1456.393
&gt; 1581.114
&gt; 1539.286
&gt; 1489.795
&gt; 1652.620
&gt; 1537.349
&gt; 1443.777
&gt; 1567.179
cnn: 1524.067 RMSE (+/- 57.148)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d3001625727-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d3001625727-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-1">&gt; 1551.031</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-2">&gt; 1495.743</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-3">&gt; 1449.408</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-4">&gt; 1526.017</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-5">&gt; 1466.118</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-6">&gt; 1566.535</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-7">&gt; 1649.204</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-8">&gt; 1455.782</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-9">&gt; 1574.214</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-10">&gt; 1541.790</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-11">&gt; 1489.140</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-12">&gt; 1506.035</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-13">&gt; 1513.197</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-14">&gt; 1530.714</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-15">&gt; 1511.328</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-16">&gt; 1471.518</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-17">&gt; 1555.596</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-18">&gt; 1552.026</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-19">&gt; 1531.727</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-20">&gt; 1472.978</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-21">&gt; 1620.242</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-22">&gt; 1424.153</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-23">&gt; 1456.393</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-24">&gt; 1581.114</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-25">&gt; 1539.286</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-26">&gt; 1489.795</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-27">&gt; 1652.620</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-28">&gt; 1537.349</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-29">&gt; 1443.777</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d3001625727-30">&gt; 1567.179</div><div class="crayon-line" id="crayon-5c0c9a8dac7d3001625727-31">cnn: 1524.067 RMSE (+/- 57.148)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A box and whisker plot of the scores is created to help understand the spread of error across the runs.</p>
<p>We can see that the spread does seem to be biased towards larger error values, as we would expect, although the upper whisker of the plot (in this case, the largest error that are not outliers) is still limited at an RMSE of 1,650 sales.</p>
<div class="wp-caption aligncenter" id="attachment_6371" style="width: 1290px"><img alt="Box and Whisker Plot of Convolutional Neural Network RMSE Forecasting Car Sales" class="size-full wp-image-6371" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Convolutional-Neural-Network-RMSE-Forecasting-Car-Sales.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Convolutional-Neural-Network-RMSE-Forecasting-Car-Sales.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Convolutional-Neural-Network-RMSE-Forecasting-Car-Sales-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Convolutional-Neural-Network-RMSE-Forecasting-Car-Sales-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Convolutional-Neural-Network-RMSE-Forecasting-Car-Sales-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Box and Whisker Plot of Convolutional Neural Network RMSE Forecasting Car Sales</p></div>
<h2>Recurrent Neural Network Models</h2>
<p>Recurrent neural networks, or RNNs, are those types of neural networks that use an output of the network from a prior step as an input in attempt to automatically learn across sequence data.</p>
<p>The Long Short-Term Memory, or LSTM, network is a type of RNN whose implementation addresses the general difficulties in training RNNs on sequence data that results in a stable model. It achieves this by learning the weights for internal gates that control the recurrent connections within each node.</p>
<p>Although developed for sequence data, <a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/">LSTMs have not proven effective</a> on time series forecasting problems where the output is a function of recent observations, e.g. an autoregressive type forecasting problem, such as the car sales dataset.</p>
<p>Nevertheless, we can develop LSTM models for autoregressive problems and use them as a point of comparison with other neural network models.</p>
<p>In this section, we will explore three variations on the LSTM model for univariate time series forecasting; they are:</p>
<ul>
<li><strong>LSTM</strong>: The LSTM network as-is.</li>
<li><strong>CNN-LSTM</strong>: A CNN network that learns input features and an LSTM that interprets them.</li>
<li><strong>ConvLSTM</strong>: A combination of CNNs and LSTMs where the LSTM units read input data using the convolutional process of a CNN.</li>
</ul>
<h3>LSTM</h3>
<p>The LSTM neural network can be used for univariate time series forecasting.</p>
<p>As an RNN, it will read each time step of an input sequence one step at a time. The LSTM has an internal memory allowing it to accumulate internal state as it reads across the steps of a given input sequence.</p>
<p>At the end of the sequence, each node in a layer of hidden LSTM units will output a single value. This vector of values summarizes what the LSTM learned or extracted from the input sequence. This can be interpreted by a fully connected layer before a final prediction is made.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7d8924188805" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(LSTM(n_nodes, activation='relu', input_shape=(n_input, 1)))
model.add(Dense(n_nodes, activation='relu'))
model.add(Dense(1))
model.compile(loss='mse', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7d8924188805-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d8924188805-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d8924188805-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d8924188805-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7d8924188805-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7d8924188805-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7d8924188805-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d8924188805-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7d8924188805-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d8924188805-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7d8924188805-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7d8924188805-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Like the CNN, the LSTM can support multiple variables or features at each time step. As the car sales dataset only has one value at each time step, we can fix this at 1, both when defining the input to the network in the input_shape argument [<em>n_input, 1</em>], and in defining the shape of the input samples.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7dd112407957" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7dd112407957-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7dd112407957-1"><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Unlike the MLP and CNN that do not read the sequence data one-step at a time, the LSTM does perform better if the data is stationary. This means that difference operations are performed to remove the trend and seasonal structure.</p>
<p>In the case of the car sales dataset, we can make the data stationery by performing a seasonal adjustment, that is subtracting the value from one year ago from each observation.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7e1940678211" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
adjusted = value - value[-12]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7e1940678211-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7e1940678211-1"><span class="crayon-v">adjusted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>This can be performed systematically for the entire training dataset. It also means that the first year of observations must be discarded as we have no prior year of data to difference them with.</p>
<p>The <em>difference()</em> function below will difference a provided dataset with a provided offset, called the difference order, e.g. 12 for one year of months prior.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7e6381094874" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# difference dataset
def difference(data, interval):
	return [data[i] - data[i - interval] for i in range(interval, len(data))]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7e6381094874-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7e6381094874-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7e6381094874-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7e6381094874-1"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7e6381094874-2"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7e6381094874-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can make the difference order a hyperparameter to the model and only perform the operation if a value other than zero is provided.</p>
<p>The <em>model_fit()</em> function for fitting an LSTM model is provided below.</p>
<p>The model expects a list of five model hyperparameters; they are:</p>
<ul>
<li><strong>n_input</strong>: The number of lag observations to use as input to the model.</li>
<li><strong>n_nodes</strong>: The number of LSTM units to use in the hidden layer.</li>
<li><strong>n_epochs</strong>: The number of times to expose the model to the whole training dataset.</li>
<li><strong>n_batch</strong>: The number of samples within an epoch after which the weights are updated.</li>
<li><strong>n_diff</strong>: The difference order or 0 if not used.</li>
</ul>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7ea436111231" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], 1))
	# define model
	model = Sequential()
	model.add(LSTM(n_nodes, activation='relu', input_shape=(n_input, 1)))
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ea436111231-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ea436111231-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-7"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-8"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-9"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-10"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-11"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-17"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ea436111231-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ea436111231-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Making a prediction with the LSTM model is the same as making a prediction with a CNN model.</p>
<p>A single input must have the three-dimensional structure of samples, timesteps, and features, which in this case we only have 1 sample and 1 feature: [<em>1, n_input, 1</em>].</p>
<p>If the difference operation was performed, we must add back the value that was subtracted after the model has made a forecast. We must also difference the historical data prior to formulating the single input used to make a prediction.</p>
<p>The <em>model_predict()</em> function below implements this behavior.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7ef982588837" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, n_diff = config
	# prepare data
	correction = 0.0
	if n_diff &gt; 0:
		correction = history[-n_diff]
		history = difference(history, n_diff)
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return correction + yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7ef982588837-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ef982588837-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ef982588837-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ef982588837-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ef982588837-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ef982588837-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ef982588837-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ef982588837-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ef982588837-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ef982588837-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ef982588837-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7ef982588837-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7ef982588837-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7ef982588837-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ef982588837-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ef982588837-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ef982588837-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ef982588837-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ef982588837-6"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ef982588837-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ef982588837-8"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ef982588837-9"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ef982588837-10"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ef982588837-11"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7ef982588837-12"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7ef982588837-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>A simple grid search of model hyperparameters was performed and the configuration below was chosen. This is not an optimal configuration, but is the best that was found.</p>
<p>The chosen configuration is as follows:</p>
<ul>
<li><strong>n_input</strong>: 36 (i.e. 3 years or 3 * 12)</li>
<li><strong>n_nodes</strong>: 50</li>
<li><strong>n_epochs</strong>: 100</li>
<li><strong>n_batch</strong>: 100 (i.e. batch gradient descent)</li>
<li><strong>n_diff</strong>: 12 (i.e. seasonal difference)</li>
</ul>
<p>This can be specified as a list:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7f3856961785" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define config
config = [36, 50, 100, 100, 12]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7f3856961785-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f3856961785-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7f3856961785-1"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f3856961785-2"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">36</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Tying all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7f7569715821" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate lstm
from math import sqrt
from numpy import array
from numpy import mean
from numpy import std
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from matplotlib import pyplot

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# difference dataset
def difference(data, interval):
	return [data[i] - data[i - interval] for i in range(interval, len(data))]

# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], 1))
	# define model
	model = Sequential()
	model.add(LSTM(n_nodes, activation='relu', input_shape=(n_input, 1)))
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, n_diff = config
	# prepare data
	correction = 0.0
	if n_diff &gt; 0:
		correction = history[-n_diff]
		history = difference(history, n_diff)
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return correction + yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# repeat evaluation of a config
def repeat_evaluate(data, config, n_test, n_repeats=30):
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	return scores

# summarize model performance
def summarize_scores(name, scores):
	# print a summary
	scores_m, score_std = mean(scores), std(scores)
	print('%s: %.3f RMSE (+/- %.3f)' % (name, scores_m, score_std))
	# box and whisker plot
	pyplot.boxplot(scores)
	pyplot.show()

series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# define config
config = [36, 50, 100, 100, 12]
# grid search
scores = repeat_evaluate(data, config, n_test)
# summarize scores
summarize_scores('lstm', scores)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-112">112</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-114">114</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-116">116</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-118">118</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-120">120</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7f7569715821-122">122</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7f7569715821-123">123</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-1"><span class="crayon-p"># evaluate lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-8"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-13"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-14"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-15"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-16"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-18"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-19"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-20"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-21"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-22"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-23"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-25"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-26"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-27"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-28"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-29"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-30"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-31"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-32"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-34"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-35"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-36"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-38"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-39"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-40"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-41"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-42"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-43"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-44"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-45"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-46"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-47"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-48"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-49"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-50"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-51"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-52"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-53"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-55"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-56"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-57"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-58"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-59"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-60"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-61"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-62"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-63"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-64"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-65"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-66"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-67"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-68"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-69"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-70"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-71"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-72"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-73"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-74"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-75"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-76"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-77"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-78"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-79"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-80"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-81"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-82"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-83"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-84"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-85"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-86"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-87"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-88"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-89"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-90"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-91"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-92"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-93"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-94"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-95"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-96"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-97"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-98"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-99"><span class="crayon-p"># repeat evaluation of a config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-100"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-101"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-102"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-103"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-104"> </div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-105"><span class="crayon-p"># summarize model performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-106"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-107"><span class="crayon-h"> </span><span class="crayon-p"># print a summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-108"><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-109"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f RMSE (+/- %.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-110"><span class="crayon-h"> </span><span class="crayon-p"># box and whisker plot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-111"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-112"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-113"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-114"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-115"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-116"><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-117"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-118"><span class="crayon-p"># define config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-119"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">36</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-120"><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-121"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7f7569715821-122"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9a8dac7f7569715821-123"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0061 seconds] -->
<p>Running the example, we can see the RMSE for each repeated evaluation of the model.</p>
<p>At the end of the run, we can see that the average RMSE is about 2,109, which is worse than the naive model. This suggests that the chosen model is not skillful, and it was the best that could be found given the same resources used to find model configurations in the previous sections.</p>
<p>This provides further evidence (although weak evidence) that LSTMs, at least alone, are perhaps a bad fit for autoregressive-type sequence prediction problems.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac7fc350681820" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
&gt; 2129.480
&gt; 2169.109
&gt; 2078.290
&gt; 2257.222
&gt; 2014.911
&gt; 2197.283
&gt; 2028.176
&gt; 2110.718
&gt; 2100.388
&gt; 2157.271
&gt; 1940.103
&gt; 2086.588
&gt; 1986.696
&gt; 2168.784
&gt; 2188.813
&gt; 2086.759
&gt; 2128.095
&gt; 2126.467
&gt; 2077.463
&gt; 2057.679
&gt; 2209.818
&gt; 2067.082
&gt; 1983.346
&gt; 2157.749
&gt; 2145.071
&gt; 2266.130
&gt; 2105.043
&gt; 2128.549
&gt; 1952.002
&gt; 2188.287
lstm: 2109.779 RMSE (+/- 81.373)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac7fc350681820-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac7fc350681820-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-1">&gt; 2129.480</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-2">&gt; 2169.109</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-3">&gt; 2078.290</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-4">&gt; 2257.222</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-5">&gt; 2014.911</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-6">&gt; 2197.283</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-7">&gt; 2028.176</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-8">&gt; 2110.718</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-9">&gt; 2100.388</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-10">&gt; 2157.271</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-11">&gt; 1940.103</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-12">&gt; 2086.588</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-13">&gt; 1986.696</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-14">&gt; 2168.784</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-15">&gt; 2188.813</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-16">&gt; 2086.759</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-17">&gt; 2128.095</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-18">&gt; 2126.467</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-19">&gt; 2077.463</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-20">&gt; 2057.679</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-21">&gt; 2209.818</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-22">&gt; 2067.082</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-23">&gt; 1983.346</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-24">&gt; 2157.749</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-25">&gt; 2145.071</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-26">&gt; 2266.130</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-27">&gt; 2105.043</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-28">&gt; 2128.549</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-29">&gt; 1952.002</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac7fc350681820-30">&gt; 2188.287</div><div class="crayon-line" id="crayon-5c0c9a8dac7fc350681820-31">lstm: 2109.779 RMSE (+/- 81.373)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A box and whisker plot is also created summarizing the distribution of RMSE scores.</p>
<p>Even the base case for the model did not achieve the performance of a naive model.</p>
<div class="wp-caption aligncenter" id="attachment_6372" style="width: 1290px"><img alt="Box and Whisker Plot of Long Short-Term Memory Neural Network RMSE Forecasting Car Sales" class="size-full wp-image-6372" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Long-Short-Term-Memory-Neural-Network-RMSE-Forecasting-Car-Sales.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Long-Short-Term-Memory-Neural-Network-RMSE-Forecasting-Car-Sales.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Long-Short-Term-Memory-Neural-Network-RMSE-Forecasting-Car-Sales-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Long-Short-Term-Memory-Neural-Network-RMSE-Forecasting-Car-Sales-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-Long-Short-Term-Memory-Neural-Network-RMSE-Forecasting-Car-Sales-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Box and Whisker Plot of Long Short-Term Memory Neural Network RMSE Forecasting Car Sales</p></div>
<h3>CNN LSTM</h3>
<p>We have seen that the CNN model is capable of automatically learning and extracting features from the raw sequence data without scaling or differencing.</p>
<p>We can combine this capability with the LSTM where a CNN model is applied to sub-sequences of input data, the results of which together form a time series of extracted features that can be interpreted by an LSTM model.</p>
<p>This combination of a CNN model used to read multiple subsequences over time by an LSTM is called a CNN-LSTM model.</p>
<p>The model requires that each input sequence, e.g. 36 months, is divided into multiple subsequences, each read by the CNN model, e.g. 3 subsequence of 12 time steps. It may make sense to divide the sub-sequences by years, but this is just a hypothesis, and other splits could be used, such as six subsequences of six time steps. Therefore, this splitting is parameterized with the <em>n_seq</em> and <em>n_steps</em> for the number of subsequences and number of steps per subsequence parameters.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac801737765982" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
train_x = train_x.reshape((train_x.shape[0], n_seq, n_steps, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac801737765982-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac801737765982-1"><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The number of lag observations per sample is simply (<em>n_seq * n_steps</em>).</p>
<p>This is a 4-dimensional input array now with the dimensions:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac805502216002" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[samples, subsequences, timesteps, features]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac805502216002-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac805502216002-1">[samples, subsequences, timesteps, features]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The same CNN model must be applied to each input subsequence.</p>
<p>We can achieve this by wrapping the entire CNN model in a <em>TimeDistributed</em> layer wrapper.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac80a497436303" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = Sequential()
model.add(TimeDistributed(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(None,n_steps,1))))
model.add(TimeDistributed(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu')))
model.add(TimeDistributed(MaxPooling1D(pool_size=2)))
model.add(TimeDistributed(Flatten()))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac80a497436303-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac80a497436303-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac80a497436303-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac80a497436303-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac80a497436303-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac80a497436303-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac80a497436303-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac80a497436303-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac80a497436303-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac80a497436303-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The output of one application of the CNN submodel will be a vector. The output of the submodel to each input subsequence will be a time series of interpretations that can be interpreted by an LSTM model. This can be followed by a fully connected layer to interpret the outcomes of the LSTM and finally an output layer for making one-step predictions.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac80e862060692" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(LSTM(n_nodes, activation='relu'))
model.add(Dense(n_nodes, activation='relu'))
model.add(Dense(1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac80e862060692-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac80e862060692-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac80e862060692-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac80e862060692-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac80e862060692-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac80e862060692-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The complete <em>model_fit()</em> function is listed below.</p>
<p>The model expects a list of seven hyperparameters; they are:</p>
<ul>
<li><strong>n_seq</strong>: The number of subsequences within a sample.</li>
<li><strong>n_steps</strong>: The number of time steps within each subsequence.</li>
<li><strong>n_filters</strong>: The number of parallel filters.</li>
<li><strong>n_kernel</strong>: The number of time steps considered in each read of the input sequence.</li>
<li><strong>n_nodes</strong>: The number of LSTM units to use in the hidden layer.</li>
<li><strong>n_epochs</strong>: The number of times to expose the model to the whole training dataset.</li>
<li><strong>n_batch</strong>: The number of samples within an epoch after which the weights are updated.</li>
</ul>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac812558728462" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_seq, n_steps, n_filters, n_kernel, n_nodes, n_epochs, n_batch = config
	n_input = n_seq * n_steps
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], n_seq, n_steps, 1))
	# define model
	model = Sequential()
	model.add(TimeDistributed(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(None,n_steps,1))))
	model.add(TimeDistributed(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu')))
	model.add(TimeDistributed(MaxPooling1D(pool_size=2)))
	model.add(TimeDistributed(Flatten()))
	model.add(LSTM(n_nodes, activation='relu'))
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac812558728462-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac812558728462-22">22</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-4"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-5"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-6"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-7"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-8"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-9"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-10"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-11"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-17"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-19"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-20"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line" id="crayon-5c0c9a8dac812558728462-21"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac812558728462-22"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>Making a prediction with the fit model is much the same as the LSTM or CNN, although with the addition of splitting each sample into subsequences with a given number of time steps.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac816433554615" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare data
x_input = array(history[-n_input:]).reshape((1, n_seq, n_steps, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac816433554615-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac816433554615-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac816433554615-1"><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac816433554615-2"><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The updated <em>model_predict()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac81b710198802" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_seq, n_steps, _, _, _, _, _ = config
	n_input = n_seq * n_steps
	# prepare data
	x_input = array(history[-n_input:]).reshape((1, n_seq, n_steps, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac81b710198802-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac81b710198802-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac81b710198802-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac81b710198802-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac81b710198802-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac81b710198802-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac81b710198802-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac81b710198802-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac81b710198802-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac81b710198802-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac81b710198802-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac81b710198802-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac81b710198802-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac81b710198802-4"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac81b710198802-5"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac81b710198802-6"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac81b710198802-7"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac81b710198802-8"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0c9a8dac81b710198802-9"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac81b710198802-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>A simple grid search of model hyperparameters was performed and the configuration below was chosen. This may not be an optimal configuration, but it is the best that was found.</p>
<ul>
<li><strong>n_seq</strong>: 3 (i.e. 3 years)</li>
<li><strong>n_steps</strong>: 12 (i.e. 1 year of months)</li>
<li><strong>n_filters</strong>: 64</li>
<li><strong>n_kernel</strong>: 3</li>
<li><strong>n_nodes</strong>: 100</li>
<li><strong>n_epochs</strong>: 200</li>
<li><strong>n_batch</strong>: 100 (i.e. batch gradient descent)</li>
</ul>
<p>We can define the configuration as a list; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac81f990066636" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define config
config = [3, 12, 64, 3, 100, 200, 100]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac81f990066636-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac81f990066636-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac81f990066636-1"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac81f990066636-2"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete example of evaluating the CNN-LSTM model for forecasting the univariate monthly car sales is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac823822000888" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate cnn lstm
from math import sqrt
from numpy import array
from numpy import mean
from numpy import std
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.layers import TimeDistributed
from keras.layers import Flatten
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D
from matplotlib import pyplot

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# fit a model
def model_fit(train, config):
	# unpack config
	n_seq, n_steps, n_filters, n_kernel, n_nodes, n_epochs, n_batch = config
	n_input = n_seq * n_steps
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], n_seq, n_steps, 1))
	# define model
	model = Sequential()
	model.add(TimeDistributed(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(None,n_steps,1))))
	model.add(TimeDistributed(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu')))
	model.add(TimeDistributed(MaxPooling1D(pool_size=2)))
	model.add(TimeDistributed(Flatten()))
	model.add(LSTM(n_nodes, activation='relu'))
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_seq, n_steps, _, _, _, _, _ = config
	n_input = n_seq * n_steps
	# prepare data
	x_input = array(history[-n_input:]).reshape((1, n_seq, n_steps, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# repeat evaluation of a config
def repeat_evaluate(data, config, n_test, n_repeats=30):
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	return scores

# summarize model performance
def summarize_scores(name, scores):
	# print a summary
	scores_m, score_std = mean(scores), std(scores)
	print('%s: %.3f RMSE (+/- %.3f)' % (name, scores_m, score_std))
	# box and whisker plot
	pyplot.boxplot(scores)
	pyplot.show()

series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# define config
config = [3, 12, 64, 3, 100, 200, 100]
# grid search
scores = repeat_evaluate(data, config, n_test)
# summarize scores
summarize_scores('cnn-lstm', scores)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-112">112</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-114">114</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-116">116</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-118">118</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-120">120</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac823822000888-122">122</div><div class="crayon-num" data-line="crayon-5c0c9a8dac823822000888-123">123</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-1"><span class="crayon-p"># evaluate cnn lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-8"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-14"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-15"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-16"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">MaxPooling1D</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-17"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-18"> </div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-19"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-20"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-22"> </div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-23"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-24"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-25"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-26"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-27"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-28"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-29"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-30"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-31"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-32"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-33"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-34"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-35"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-36"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-38"> </div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-39"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-40"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-41"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-42"> </div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-43"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-44"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-45"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-46"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-47"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-48"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-49"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-50"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-51"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-52"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-53"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-55"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-56"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-57"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-58"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-59"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-60"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-61"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-62"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-63"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-64"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-65"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-66"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-67"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-68"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-69"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-70"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-71"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-72"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-73"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-74"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-75"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-76"> </div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-77"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-78"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-79"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-80"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-81"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-82"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-83"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-84"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-85"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-86"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-87"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-88"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-89"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-90"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-91"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-92"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-93"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-94"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-95"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-96"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-97"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-98"> </div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-99"><span class="crayon-p"># repeat evaluation of a config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-100"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-101"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-102"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-103"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-104"> </div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-105"><span class="crayon-p"># summarize model performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-106"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-107"><span class="crayon-h"> </span><span class="crayon-p"># print a summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-108"><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-109"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f RMSE (+/- %.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-110"><span class="crayon-h"> </span><span class="crayon-p"># box and whisker plot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-111"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-112"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-113"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-114"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-115"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-116"><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-117"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-118"><span class="crayon-p"># define config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-119"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-120"><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-121"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac823822000888-122"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9a8dac823822000888-123"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'cnn-lstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0067 seconds] -->
<p>Running the example prints the RMSE for each repeated evaluation of the model.</p>
<p>The final averaged RMSE is reported at the end of about 1,626, which is lower than the naive model, but still higher than a SARIMA model. The standard deviation of this score is also very large, suggesting that the chosen configuration may not be as stable as the standalone CNN model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac828065404808" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
 &gt; 1543.533
 &gt; 1421.895
 &gt; 1467.927
 &gt; 1441.125
 &gt; 1750.995
 &gt; 1321.498
 &gt; 1571.657
 &gt; 1845.298
 &gt; 1621.589
 &gt; 1425.065
 &gt; 1675.232
 &gt; 1807.288
 &gt; 2922.295
 &gt; 1391.861
 &gt; 1626.655
 &gt; 1633.177
 &gt; 1667.572
 &gt; 1577.285
 &gt; 1590.235
 &gt; 1557.385
 &gt; 1784.982
 &gt; 1664.839
 &gt; 1741.729
 &gt; 1437.992
 &gt; 1772.076
 &gt; 1289.794
 &gt; 1685.976
 &gt; 1498.123
 &gt; 1618.627
 &gt; 1448.361
cnn-lstm: 1626.735 RMSE (+/- 279.850)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac828065404808-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac828065404808-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-1"> &gt; 1543.533</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-2"> &gt; 1421.895</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-3"> &gt; 1467.927</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-4"> &gt; 1441.125</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-5"> &gt; 1750.995</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-6"> &gt; 1321.498</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-7"> &gt; 1571.657</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-8"> &gt; 1845.298</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-9"> &gt; 1621.589</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-10"> &gt; 1425.065</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-11"> &gt; 1675.232</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-12"> &gt; 1807.288</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-13"> &gt; 2922.295</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-14"> &gt; 1391.861</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-15"> &gt; 1626.655</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-16"> &gt; 1633.177</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-17"> &gt; 1667.572</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-18"> &gt; 1577.285</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-19"> &gt; 1590.235</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-20"> &gt; 1557.385</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-21"> &gt; 1784.982</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-22"> &gt; 1664.839</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-23"> &gt; 1741.729</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-24"> &gt; 1437.992</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-25"> &gt; 1772.076</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-26"> &gt; 1289.794</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-27"> &gt; 1685.976</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-28"> &gt; 1498.123</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-29"> &gt; 1618.627</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac828065404808-30"> &gt; 1448.361</div><div class="crayon-line" id="crayon-5c0c9a8dac828065404808-31">cnn-lstm: 1626.735 RMSE (+/- 279.850)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A box and whisker plot is also created summarizing the distribution of RMSE scores.</p>
<p>The plot shows one single outlier of very poor performance just below 3,000 sales.</p>
<div class="wp-caption aligncenter" id="attachment_6375" style="width: 1290px"><img alt="Box and Whisker Plot of CNN-LSTM RMSE Forecasting Car Sales" class="size-full wp-image-6375" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-CNN-LSTM-RMSE-Forecasting-Car-Sales.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-CNN-LSTM-RMSE-Forecasting-Car-Sales.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-CNN-LSTM-RMSE-Forecasting-Car-Sales-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-CNN-LSTM-RMSE-Forecasting-Car-Sales-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-CNN-LSTM-RMSE-Forecasting-Car-Sales-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Box and Whisker Plot of CNN-LSTM RMSE Forecasting Car Sales</p></div>
<h3>ConvLSTM</h3>
<p>It is possible to perform a convolutional operation as part of the read of the input sequence within each LSTM unit.</p>
<p>This means, rather than reading a sequence one step at a time, the LSTM would read a block or subsequence of observations at a time using a convolutional process, like a CNN.</p>
<p>This is different to first reading an extracting features with an LSTM and interpreting the result with an LSTM; this is performing the CNN operation at each time step as part of the LSTM.</p>
<p>This type of model is called a Convolutional LSTM, or ConvLSTM for short. It is provided in Keras as a layer called ConvLSTM2D for 2D data. We can configure it for use with 1D sequence data by assuming that we have one row with multiple columns.</p>
<p>As with the CNN-LSTM, the input data is split into subsequences where each subsequence has a fixed number of time steps, although we must also specify the number of rows in each subsequence, which in this case is fixed at 1.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac82d883503076" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
train_x = train_x.reshape((train_x.shape[0], n_seq, 1, n_steps, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac82d883503076-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac82d883503076-1"><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The shape is five-dimensional, with the dimensions:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac832471005211" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[samples, subsequences, rows, columns, features]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac832471005211-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac832471005211-1">[samples, subsequences, rows, columns, features]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Like the CNN, the ConvLSTM layer allows us to specify the number of filter maps and the size of the kernel used when reading the input sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac836831608422" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(ConvLSTM2D(filters=n_filters, kernel_size=(1,n_kernel), activation='relu', input_shape=(n_seq, 1, n_steps, 1)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac836831608422-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac836831608422-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The output of the layer is a sequence of filter maps that must first be flattened before it can be interpreted and followed by an output layer.</p>
<p>The model expects a list of seven hyperparameters, the same as the CNN-LSTM; they are:</p>
<ul>
<li><strong>n_seq</strong>: The number of subsequences within a sample.</li>
<li><strong>n_steps</strong>: The number of time steps within each subsequence.</li>
<li><strong>n_filters</strong>: The number of parallel filters.</li>
<li><strong>n_kernel</strong>: The number of time steps considered in each read of the input sequence.</li>
<li><strong>n_nodes</strong>: The number of LSTM units to use in the hidden layer.</li>
<li><strong>n_epochs</strong>: The number of times to expose the model to the whole training dataset.</li>
<li><strong>n_batch</strong>: The number of samples within an epoch after which the weights are updated.</li>
</ul>
<p>The <em>model_fit()</em> function that implements all of this is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac83a598782560" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_seq, n_steps, n_filters, n_kernel, n_nodes, n_epochs, n_batch = config
	n_input = n_seq * n_steps
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], n_seq, 1, n_steps, 1))
	# define model
	model = Sequential()
	model.add(ConvLSTM2D(filters=n_filters, kernel_size=(1,n_kernel), activation='relu', input_shape=(n_seq, 1, n_steps, 1)))
	model.add(Flatten())
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83a598782560-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac83a598782560-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-4"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-5"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-6"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-7"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-8"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-9"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-10"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-11"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-12"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-17"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83a598782560-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac83a598782560-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>A prediction is made with the fit model in the same way as the CNN-LSTM, although with the additional rows dimension that we fix to 1.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac83e473267838" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare data
x_input = array(history[-n_input:]).reshape((1, n_seq, 1, n_steps, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac83e473267838-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac83e473267838-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac83e473267838-1"><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac83e473267838-2"><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The <em>model_predict()</em> function for making a single one-step prediction is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac842286777757" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_seq, n_steps, _, _, _, _, _ = config
	n_input = n_seq * n_steps
	# prepare data
	x_input = array(history[-n_input:]).reshape((1, n_seq, 1, n_steps, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac842286777757-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac842286777757-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac842286777757-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac842286777757-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac842286777757-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac842286777757-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac842286777757-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac842286777757-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac842286777757-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac842286777757-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac842286777757-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac842286777757-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac842286777757-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac842286777757-4"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac842286777757-5"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac842286777757-6"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0c9a8dac842286777757-7"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac842286777757-8"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0c9a8dac842286777757-9"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac842286777757-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>A simple grid search of model hyperparameters was performed and the configuration below was chosen.</p>
<p>This may not be an optimal configuration, but is the best that was found.</p>
<ul>
<li><strong>n_seq</strong>: 3 (i.e. 3 years)</li>
<li><strong>n_steps</strong>: 12 (i.e. 1 year of months)</li>
<li><strong>n_filters</strong>: 256</li>
<li><strong>n_kernel</strong>: 3</li>
<li><strong>n_nodes</strong>: 200</li>
<li><strong>n_epochs</strong>: 200</li>
<li><strong>n_batch</strong>: 100 (i.e. batch gradient descent)</li>
</ul>
<p>We can define the configuration as a list; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac847661956687" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define config
config = [3, 12, 256, 3, 200, 200, 100]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac847661956687-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac847661956687-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac847661956687-1"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac847661956687-2"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can tie all of this together. The complete code listing for the ConvLSTM model evaluated for one-step forecasting of the monthly car sales dataset is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac84b240311037" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate convlstm
from math import sqrt
from numpy import array
from numpy import mean
from numpy import std
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import ConvLSTM2D
from matplotlib import pyplot

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# difference dataset
def difference(data, interval):
	return [data[i] - data[i - interval] for i in range(interval, len(data))]

# fit a model
def model_fit(train, config):
	# unpack config
	n_seq, n_steps, n_filters, n_kernel, n_nodes, n_epochs, n_batch = config
	n_input = n_seq * n_steps
	# prepare data
	data = series_to_supervised(train, n_in=n_input)
	train_x, train_y = data[:, :-1], data[:, -1]
	train_x = train_x.reshape((train_x.shape[0], n_seq, 1, n_steps, 1))
	# define model
	model = Sequential()
	model.add(ConvLSTM2D(filters=n_filters, kernel_size=(1,n_kernel), activation='relu', input_shape=(n_seq, 1, n_steps, 1)))
	model.add(Flatten())
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with a pre-fit model
def model_predict(model, history, config):
	# unpack config
	n_seq, n_steps, _, _, _, _, _ = config
	n_input = n_seq * n_steps
	# prepare data
	x_input = array(history[-n_input:]).reshape((1, n_seq, 1, n_steps, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# repeat evaluation of a config
def repeat_evaluate(data, config, n_test, n_repeats=30):
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	return scores

# summarize model performance
def summarize_scores(name, scores):
	# print a summary
	scores_m, score_std = mean(scores), std(scores)
	print('%s: %.3f RMSE (+/- %.3f)' % (name, scores_m, score_std))
	# box and whisker plot
	pyplot.boxplot(scores)
	pyplot.show()

series = read_csv('monthly-car-sales.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# define config
config = [3, 12, 256, 3, 200, 200, 100]
# grid search
scores = repeat_evaluate(data, config, n_test)
# summarize scores
summarize_scores('convlstm', scores)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-112">112</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-114">114</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-116">116</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-118">118</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84b240311037-120">120</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84b240311037-121">121</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-1"><span class="crayon-p"># evaluate convlstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">std</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-8"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">ConvLSTM2D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-14"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-16"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-17"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-19"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-20"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-21"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-22"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-23"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-24"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-25"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-26"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-27"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-28"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-29"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-30"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-31"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-32"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-33"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-34"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-36"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-37"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-38"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-39"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-40"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-41"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-42"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-43"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-44"><span class="crayon-p"># fit a model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-45"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-46"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-47"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-48"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-49"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-50"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-51"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-52"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-53"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-55"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-56"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-57"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-58"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-59"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-60"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-61"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-62"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-63"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-64"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-65"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-66"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-67"><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-68"><span class="crayon-e"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_seq *</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-69"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-70"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-71"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-72"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-73"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-74"> </div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-75"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-76"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-77"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-78"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-79"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-80"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-81"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-82"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-83"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-84"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-85"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-86"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-87"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-88"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-89"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-90"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-91"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-92"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-93"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-94"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-95"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-96"> </div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-97"><span class="crayon-p"># repeat evaluation of a config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-98"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-99"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-100"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-101"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-102"> </div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-103"><span class="crayon-p"># summarize model performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-104"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-105"><span class="crayon-h"> </span><span class="crayon-p"># print a summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-106"><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-107"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f RMSE (+/- %.3f)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores_m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score_std</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-108"><span class="crayon-h"> </span><span class="crayon-p"># box and whisker plot</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-109"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-110"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-111"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-112"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-car-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-113"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-114"><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-115"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-116"><span class="crayon-p"># define config</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-117"><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-118"><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-119"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84b240311037-120"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c0c9a8dac84b240311037-121"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'convlstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0067 seconds] -->
<p>Running the example prints the RMSE for each repeated evaluation of the model.</p>
<p>The final averaged RMSE is reported at the end of about 1,660, which is lower than the naive model, but still higher than a SARIMA model.</p>
<p>It is a result that is perhaps on par with the CNN-LSTM model. The standard deviation of this score is also very large, suggesting that the chosen configuration may not be as stable as the standalone CNN model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a8dac84f651321357" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
 &gt; 1825.246
 &gt; 1862.674
 &gt; 1684.313
 &gt; 1310.448
 &gt; 2109.668
 &gt; 1507.912
 &gt; 1431.118
 &gt; 1442.692
 &gt; 1400.548
 &gt; 1732.381
 &gt; 1523.824
 &gt; 1611.898
 &gt; 1805.970
 &gt; 1616.015
 &gt; 1649.466
 &gt; 1521.884
 &gt; 2025.655
 &gt; 1622.886
 &gt; 2536.448
 &gt; 1526.532
 &gt; 1866.631
 &gt; 1562.625
 &gt; 1491.386
 &gt; 1506.270
 &gt; 1843.981
 &gt; 1653.084
 &gt; 1650.430
 &gt; 1291.353
 &gt; 1558.616
 &gt; 1653.231
convlstm: 1660.840 RMSE (+/- 248.826)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a8dac84f651321357-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a8dac84f651321357-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-1"> &gt; 1825.246</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-2"> &gt; 1862.674</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-3"> &gt; 1684.313</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-4"> &gt; 1310.448</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-5"> &gt; 2109.668</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-6"> &gt; 1507.912</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-7"> &gt; 1431.118</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-8"> &gt; 1442.692</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-9"> &gt; 1400.548</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-10"> &gt; 1732.381</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-11"> &gt; 1523.824</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-12"> &gt; 1611.898</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-13"> &gt; 1805.970</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-14"> &gt; 1616.015</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-15"> &gt; 1649.466</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-16"> &gt; 1521.884</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-17"> &gt; 2025.655</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-18"> &gt; 1622.886</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-19"> &gt; 2536.448</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-20"> &gt; 1526.532</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-21"> &gt; 1866.631</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-22"> &gt; 1562.625</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-23"> &gt; 1491.386</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-24"> &gt; 1506.270</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-25"> &gt; 1843.981</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-26"> &gt; 1653.084</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-27"> &gt; 1650.430</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-28"> &gt; 1291.353</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-29"> &gt; 1558.616</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a8dac84f651321357-30"> &gt; 1653.231</div><div class="crayon-line" id="crayon-5c0c9a8dac84f651321357-31">convlstm: 1660.840 RMSE (+/- 248.826)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A box and whisker plot is also created, summarizing the distribution of RMSE scores.</p>
<div class="wp-caption aligncenter" id="attachment_6373" style="width: 1290px"><img alt="Box and Whisker Plot of ConvLSTM RMSE Forecasting Car Sales" class="size-full wp-image-6373" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-ConvLSTM-RMSE-Forecasting-Car-Sales.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-ConvLSTM-RMSE-Forecasting-Car-Sales.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-ConvLSTM-RMSE-Forecasting-Car-Sales-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-ConvLSTM-RMSE-Forecasting-Car-Sales-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Box-and-Whisker-Plot-of-ConvLSTM-RMSE-Forecasting-Car-Sales-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Box and Whisker Plot of ConvLSTM RMSE Forecasting Car Sales</p></div>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Data Preparation</strong>. Explore whether data preparation, such as normalization, standardization, and/or differencing can list the performance of any of the models.</li>
<li><strong>Grid Search Hyperparameters</strong>. Implement a grid search of the hyperparameters for one model to see if you can further lift performance.</li>
<li><strong>Learning Curve Diagnostics</strong>. Create a single fit of one model and review the learning curves on train and validation splits of the dataset, then use the diagnostics of the learning curves to further tune the model hyperparameters in order to improve model performance.</li>
<li><strong>History Size</strong>. Explore different amounts of historical data (lag inputs) for one model to see if you can further improve model performance</li>
<li><strong>Reduce Variance of Final Model</strong>. Explore one or more strategies to reduce the variance for one of the neural network models.</li>
<li><strong>Update During Walk-Forward</strong>. Explore whether re-fitting or updating a neural network model as part of walk-forward validation can further improve model performance.</li>
<li><strong>More Parameterization</strong>. Explore adding further model parameterization for one model, such as the use of additional layers.</li>
</ul>
<p>If you explore any of these extensions, I’d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="http://pandas-docs.github.io/pandas-docs-travis/generated/pandas.DataFrame.shift.html">pandas.DataFrame.shift API</a></li>
<li><a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">sklearn.metrics.mean_squared_error API</a></li>
<li><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.boxplot.html">matplotlib.pyplot.boxplot API</a></li>
<li><a href="https://keras.io/models/sequential/">Keras Sequence Model API</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop a suite of deep learning models for univariate time series forecasting.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a robust test harness using walk-forward validation for evaluating the performance of neural network models.</li>
<li>How to develop and evaluate simple multilayer Perceptron and convolutional neural networks for time series forecasting.</li>
<li>How to develop and evaluate LSTMs, CNN-LSTMs, and ConvLSTM neural network models for time series forecasting.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img align="left" alt="Deep Learning for Time Series Forecasting" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br/>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6365 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+Deep+Learning+Models+for+Univariate+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-grid-search-naive-methods-for-univariate-time-series-forecasting/" rel="prev"><i class="fa fa-angle-left"></i> How to Grid Search Naive Methods for Univariate Time Series Forecasting</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/findings-comparing-classical-and-machine-learning-methods-for-time-series-forecasting/" rel="next">Results From Comparing Classical and Machine Learning Methods for Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">16 Responses to <em>How to Develop Deep Learning Models for Univariate Time Series Forecasting</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-453067">
<div class="comment-container" id="li-comment-453067">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b4c1df05416887cb7a0cd9b71dc6ede6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b4c1df05416887cb7a0cd9b71dc6ede6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andy</span>
<span class="date">October 30, 2018 at 12:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453067" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello . Andy. Ukraine. Kiev.</p>
<p>In your example  CNN LSTM (whole code model) I have error.</p>
<p>  File “C:\Users\User\Dropbox\DeepLearning3\realmodproj\project\educationNew\sub2\step_005.py”, line 89, in model_fit<br/>
    model.add(TimeDistributed(Conv1D(filters=n_filters, kernel_size=n_kernel, activation=’relu’, input_shape=(None,n_steps,1))))<br/>
  File “C:\Users\User\AppData\Local\Programs\Python\Python36\lib\site-packages\keras\models.py”, line 454, in add<br/>
    raise ValueError(‘The first layer in a ‘<br/>
ValueError: The first layer in a Sequential model must get an <code>input_shape</code> or <code>batch_input_shape</code> argument.</p>
<p> Coud you explame me what the reason ?</p>
<p>Thank you.</p>
<div class="reply">
<a aria-label="Reply to Andy" class="comment-reply-link" href="#comment-453067" onclick='return addComment.moveForm( "comment-453067", "453067", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453098">
<div class="comment-container" id="li-comment-453098">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2018 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453098" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe you need to update your version of Keras to 2.2.4 or higher.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453098" onclick='return addComment.moveForm( "comment-453098", "453098", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-453069">
<div class="comment-container" id="li-comment-453069">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b4c1df05416887cb7a0cd9b71dc6ede6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b4c1df05416887cb7a0cd9b71dc6ede6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andy</span>
<span class="date">October 30, 2018 at 12:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453069" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Using TensorFlow backend.<br/>
1.8.0</p>
<div class="reply">
<a aria-label="Reply to Andy" class="comment-reply-link" href="#comment-453069" onclick='return addComment.moveForm( "comment-453069", "453069", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453100">
<div class="comment-container" id="li-comment-453100">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2018 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453100" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I recommend using tensorflow 1.11.0 or higher.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453100" onclick='return addComment.moveForm( "comment-453100", "453100", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-453076">
<div class="comment-container" id="li-comment-453076">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b4c1df05416887cb7a0cd9b71dc6ede6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b4c1df05416887cb7a0cd9b71dc6ede6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andy</span>
<span class="date">October 30, 2018 at 1:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453076" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Andy , Kiev</p>
<p>May be i should use ?<br/>
model.add(TimeDistributed(   Conv1D(filters=n_filters, kernel_size=n_kernel, activation=’relu’,  input_shape=(None,n_steps,1) ) , input_shape=(None,n_steps,1) )  )</p>
<div class="reply">
<a aria-label="Reply to Andy" class="comment-reply-link" href="#comment-453076" onclick='return addComment.moveForm( "comment-453076", "453076", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453104">
<div class="comment-container" id="li-comment-453104">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2018 at 6:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453104" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure, that was required for older versions of Keras.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453104" onclick='return addComment.moveForm( "comment-453104", "453104", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-453129">
<div class="comment-container" id="li-comment-453129">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4dcf31ebb93974d2da1edfa385cb1903?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4dcf31ebb93974d2da1edfa385cb1903?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Orion</span>
<span class="date">October 30, 2018 at 2:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453129" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So, in a nutshell, RNN doesn’t work very well when dealing with time series forecasting?</p>
<div class="reply">
<a aria-label="Reply to Orion" class="comment-reply-link" href="#comment-453129" onclick='return addComment.moveForm( "comment-453129", "453129", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453189">
<div class="comment-container" id="li-comment-453189">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2018 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453189" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct, they will be outperformed by linear methods on univariate data in most cases.</p>
<p>Also see this:<br/>
<a href="https://machinelearningmastery.com/findings-comparing-classical-and-machine-learning-methods-for-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/findings-comparing-classical-and-machine-learning-methods-for-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453189" onclick='return addComment.moveForm( "comment-453189", "453189", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-453181">
<div class="comment-container" id="li-comment-453181">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dc8f1d156484a23d077cb928fad631c2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dc8f1d156484a23d077cb928fad631c2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amir</span>
<span class="date">October 31, 2018 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453181" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the article<br/>
I have a univariate time series classification problem. Data comes from the accelerometer sensor (vibration analysis). only X-axis. and the sampling rate is 2.5 KHz and I need a real-time classification.<br/>
what’s your suggestion for classifying this time series? I want to differentiate between multiple labeled classes (failures).<br/>
which of your articles can help me? I read all of them but many of them are not univariate and this article which is univariate is about forecasting and not classification.<br/>
thanks indeed.</p>
<div class="reply">
<a aria-label="Reply to Amir" class="comment-reply-link" href="#comment-453181" onclick='return addComment.moveForm( "comment-453181", "453181", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453210">
<div class="comment-container" id="li-comment-453210">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2018 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453210" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like time series classification.</p>
<p>You could look at the HAR articles, for example:<br/>
<a href="https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/" rel="nofollow">https://machinelearningmastery.com/how-to-develop-rnn-models-for-human-activity-recognition-time-series-classification/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453210" onclick='return addComment.moveForm( "comment-453210", "453210", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-453274">
<div class="comment-container" id="li-comment-453274">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f084a6f6c752f1cfb36503dcd65c00f5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f084a6f6c752f1cfb36503dcd65c00f5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lars</span>
<span class="date">October 31, 2018 at 9:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453274" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason and thanks for all of your amazing turorials on ML!<br/>
I am new to time-series forecasting, but I have been learning a lot from your articles. </p>
<p>I have a issue were am trying to forecast the amount of tickets sold per day, but I would like to the forecast 60 days before the actual date. I have 3 years of historical data on the tickets sold per day. </p>
<p>Testing the above models on my data, the persistence model scored the best (I think) with a 4.041 RMSE, the next best was the MLP with 7.501 (+/- 0.589)  RMSE. </p>
<p>Do you have any recommendation on how to proceed doing the forecast for my data? </p>
<p>Thanks again for your great work!</p>
<div class="reply">
<a aria-label="Reply to Lars" class="comment-reply-link" href="#comment-453274" onclick='return addComment.moveForm( "comment-453274", "453274", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453306">
<div class="comment-container" id="li-comment-453306">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2018 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453306" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work.</p>
<p>Yes, what is the problem that you are having exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453306" onclick='return addComment.moveForm( "comment-453306", "453306", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-453352">
<div class="comment-container" id="li-comment-453352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f084a6f6c752f1cfb36503dcd65c00f5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f084a6f6c752f1cfb36503dcd65c00f5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lars</span>
<span class="date">November 1, 2018 at 7:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey,</p>
<p>Say I have show, and 60 days before the show I want to forecast how many tickets sold during those 60days.(t+60)</p>
<p>If I look at the the 60days as one time period, the forecast would not consider seasonal effects, which have a big effect on the tickets sold. Therfore, I think I need to use each day during those 60 days as a period for a more accurate forecast. </p>
<p>So, I want to forecast the tickest sold each day during a 60 day period, but I want to know the forecast before that 60 day period starts.  And the output of the model is a list of 60 elements representing the expected ticket sale for each day  [0,1,7,5,3…,3]</p>
<p>My problem is choosing the correct approach for such forecast. Do you have any tips?</p>
<div class="reply">
<a aria-label="Reply to Lars" class="comment-reply-link" href="#comment-453352" onclick='return addComment.moveForm( "comment-453352", "453352", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-453393">
<div class="comment-container" id="li-comment-453393">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2018 at 5:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-453393" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That sounds like a very challenging problem.</p>
<p>We cannot know the best approach. You must discover the best approach through experimentation with a suite of different methods.</p>
<p>This might help:<br/>
<a href="https://machinelearningmastery.com/how-to-develop-a-skilful-time-series-forecasting-model/" rel="nofollow">https://machinelearningmastery.com/how-to-develop-a-skilful-time-series-forecasting-model/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453393" onclick='return addComment.moveForm( "comment-453393", "453393", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-455630">
<div class="comment-container" id="li-comment-455630">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c8bf5305ba2946479898d5d8d36358af?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c8bf5305ba2946479898d5d8d36358af?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">tgb123</span>
<span class="date">November 20, 2018 at 6:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-455630" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>your blog pretty good</p>
<div class="reply">
<a aria-label="Reply to tgb123" class="comment-reply-link" href="#comment-455630" onclick='return addComment.moveForm( "comment-455630", "455630", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455689">
<div class="comment-container" id="li-comment-455689">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 21, 2018 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#comment-455689" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455689" onclick='return addComment.moveForm( "comment-455689", "455689", "respond", "6365" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/how-to-develop-deep-learning-models-for-univariate-time-series-forecasting/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="6365"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="818894f7bd"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="157"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-51"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for Time Series</strong><br/>
Forecast the future with MLPs, CNNs, and LSTMs.
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>