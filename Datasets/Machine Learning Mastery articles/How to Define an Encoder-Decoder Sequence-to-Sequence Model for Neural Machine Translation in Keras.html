<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</title>
<link href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" property="og:title"/>
<meta content="The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems, such as machine translation. Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample …" property="og:description"/>
<meta content="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Natural Language Processing" property="article:section"/>
<meta content="2017-10-25T18:00:36+00:00" property="article:published_time"/>
<meta content="2018-04-05T05:10:42+00:00" property="article:modified_time"/>
<meta content="2018-04-05T05:10:42+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="427" property="og:image:height"/>
<meta content="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4563" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdefine-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdefine-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4563 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Want help with deep learning for text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4563 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-10-26T05:00:36+1100">October 26, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Deep Learning for Natural Language Processing">Deep Learning for Natural Language Processing</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4563 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Define+an+Encoder-Decoder+Sequence-to-Sequence+Model+for+Neural+Machine+Translation+in+Keras&amp;url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems, such as machine translation.</p>
<p>Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample code distributed with the Keras project.</p>
<p>In this post, you will discover how to define an encoder-decoder sequence-to-sequence prediction model for machine translation, as described by the author of the Keras deep learning library.</p>
<p>After reading this post, you will know:</p>
<ul>
<li>The neural machine translation example provided with Keras and described on the Keras blog.</li>
<li>How to correctly define an encoder-decoder LSTM for training a neural machine translation model.</li>
<li>How to correctly define an inference model for using a trained encoder-decoder model to translate new sequences.</li>
</ul>
<p>Let’s get started.</p>
<ul>
<li><strong>Update Apr/2018</strong>: For an example applying this complex model, see the post: <a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</a></li>
</ul>
<div></div>
<div class="wp-caption aligncenter" id="attachment_4567" style="width: 650px"><img alt="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" class="size-full wp-image-4567" height="427" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras-300x200.jpg 300w" width="640"/><p class="wp-caption-text">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras<br/>Photo by <a href="https://www.flickr.com/photos/68942208@N02/16012752622/">Tom Lee</a>, some rights reserved.</p></div>
<h2>Sequence-to-Sequence Prediction in Keras</h2>
<p><a href="https://twitter.com/fchollet">Francois Chollet</a>, the author of the Keras deep learning library, recently released a blog post that steps through a code example for developing an encoder-decoder LSTM for sequence-to-sequence prediction titled “<a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a>“.</p>
<p>The code developed in the blog post has also been added to Keras as an example in the file <a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">lstm_seq2seq.py</a>.</p>
<p>The post develops a sophisticated implementation of the encoder-decoder LSTM as described in the canonical papers on the topic:</p>
<ul>
<li><a href="https://arxiv.org/abs/1409.3215">Sequence to Sequence Learning with Neural Networks</a>, 2014.</li>
<li><a href="https://arxiv.org/abs/1406.1078">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</a>, 2014.</li>
</ul>
<p>The model is applied to the problem of machine translation, the same as the source papers in which the approach was first described. Technically, the model is a neural machine translation model.</p>
<p>Francois’ implementation provides a template for how sequence-to-sequence prediction can be implemented (correctly) in the Keras deep learning library at the time of writing.</p>
<p>In this post, will take a closer look at exactly how the training and inference models were designed and how they work.</p>
<p>You will be able to use this understanding to develop similar models for your own sequence-to-sequence prediction problems.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Machine Translation Data</h2>
<p>The dataset used in the example involves short French and English sentence pairs used in the flash card software <a href="https://apps.ankiweb.net/">Anki</a>.</p>
<p>The dataset is called “<a href="http://www.manythings.org/anki/">Tab-delimited Bilingual Sentence Pairs</a>” and is part of the <a href="http://tatoeba.org/home">Tatoeba Project</a> and listed on the <a href="http://www.manythings.org/">ManyThings.org</a> site for helping English as a Second Language students.</p>
<p>The dataset used in the tutorial can be downloaded from here:</p>
<ul>
<li><a href="http://www.manythings.org/anki/fra-eng.zip">French – English fra-eng.zip</a></li>
</ul>
<p>Below is a sample of the first 10 rows from the <em>fra.txt</em> data file you will see after you unzip the downloaded archive.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac16623433606" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Go.		Va !
Run!	Cours !
Run!	Courez !
Wow!	Ça alors !
Fire!	Au feu !
Help!	À l'aide !
Jump.	Saute.
Stop!	Ça suffit !
Stop!	Stop !
Stop!	Arrête-toi !</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac16623433606-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac16623433606-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac16623433606-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac16623433606-4">4</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac16623433606-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac16623433606-6">6</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac16623433606-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac16623433606-8">8</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac16623433606-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac16623433606-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac16623433606-1">Go.		Va !</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac16623433606-2">Run!	Cours !</div><div class="crayon-line" id="crayon-5c0ca27c3ac16623433606-3">Run!	Courez !</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac16623433606-4">Wow!	Ça alors !</div><div class="crayon-line" id="crayon-5c0ca27c3ac16623433606-5">Fire!	Au feu !</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac16623433606-6">Help!	À l'aide !</div><div class="crayon-line" id="crayon-5c0ca27c3ac16623433606-7">Jump.	Saute.</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac16623433606-8">Stop!	Ça suffit !</div><div class="crayon-line" id="crayon-5c0ca27c3ac16623433606-9">Stop!	Stop !</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac16623433606-10">Stop!	Arrête-toi !</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The problem is framed as a sequence prediction problem where input sequences of characters are in English and output sequences of characters are in French.</p>
<p>A total of 10,000 of the nearly 150,000 examples in the data file are used in the dataset. Some technical details of the prepared data are as follows:</p>
<ul>
<li><strong>Input Sequences</strong>: Padded to a maximum length of 16 characters with a vocabulary of 71 different characters (10000, 16, 71).</li>
<li><strong>Output Sequences</strong>: Padded to a maximum length of 59 characters with a vocabulary of 93 different characters (10000, 59, 93).</li>
</ul>
<p>The training data is framed such that the input for the model is comprised of one whole input sequence of English characters and the whole output sequence of French characters. The output of the model is the whole sequence of French characters, but offset forward by one time step.</p>
<p>For example (with minimal padding and without one-hot encoding):</p>
<ul>
<li>Input1: [‘G’, ‘o’, ‘.’, ”]</li>
<li>Input2: [ ”, ‘V’, ‘a’, ‘ ‘]</li>
<li>Output: [‘V’, ‘a’, ‘ ‘, ‘!’]</li>
</ul>
<h2>Machine Translation Model</h2>
<p>The neural translation model is an encoder-decoder recurrent neural network.</p>
<p>It is comprised of an encoder that reads a variable length input sequence and a decoder that predicts a variable length output sequence.</p>
<p>In this section, we will step through each element of the model’s definition, with code taken directly from the post and the code example in the Keras project (at the time of writing).</p>
<p>The model is divided into two sub-models: the encoder responsible for outputting a fixed-length encoding of the input English sequence, and the decoder responsible for predicting the output sequence, one character per output time step.</p>
<p>The first step is to define the encoder.</p>
<p>The input to the encoder is a sequence of characters, each encoded as one-hot vectors with length of <em>num_encoder_tokens</em>.</p>
<p>The LSTM layer in the encoder is defined with the <em>return_state</em> argument set to <em>True</em>. This returns the hidden state output returned by LSTM layers generally, as well as the hidden and cell state for all cells in the layer. These are used when defining the decoder.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac1e467498525" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Define an input sequence and process it.
encoder_inputs = Input(shape=(None, num_encoder_tokens))
encoder = LSTM(latent_dim, return_state=True)
encoder_outputs, state_h, state_c = encoder(encoder_inputs)
# We discard `encoder_outputs` and only keep the states.
encoder_states = [state_h, state_c]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac1e467498525-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac1e467498525-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac1e467498525-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac1e467498525-4">4</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac1e467498525-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac1e467498525-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac1e467498525-1"><span class="crayon-p"># Define an input sequence and process it.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac1e467498525-2"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_encoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac1e467498525-3"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac1e467498525-4"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac1e467498525-5"><span class="crayon-p"># We discard `encoder_outputs` and only keep the states.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac1e467498525-6"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we define the decoder.</p>
<p>The decoder input is defined as a sequence of French character one-hot encoded to binary vectors with a length of <em>num_decoder_tokens</em>.</p>
<p>The LSTM layer is defined to both return sequences and state. The final hidden and cell states are ignored and only the output sequence of hidden states is referenced.</p>
<p>Importantly, the final hidden and cell state from the encoder is used to initialize the state of the decoder. This means every time that the encoder model encodes an input sequence, the final internal states of the encoder model are used as the starting point for outputting the first character in the output sequence. This also means that the encoder and decoder LSTM layers must have the same number of cells, in this case, 256.</p>
<p>A <em>Dense</em> output layer is used to predict each character. This <em>Dense</em> is used to produce each character in the output sequence in a one-shot manner, rather than recursively, at least during training. This is because the entire target sequence required for input to the model is known during training.</p>
<p>The Dense does not need to be wrapped in a <em>TimeDistributed</em> layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac21550166169" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Set up the decoder, using `encoder_states` as initial state.
decoder_inputs = Input(shape=(None, num_decoder_tokens))
# We set up our decoder to return full output sequences,
# and to return internal states as well. We don't use the
# return states in the training model, but we will use them in inference.
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)
decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
decoder_dense = Dense(num_decoder_tokens, activation='softmax')
decoder_outputs = decoder_dense(decoder_outputs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac21550166169-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac21550166169-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac21550166169-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac21550166169-4">4</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac21550166169-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac21550166169-6">6</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac21550166169-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac21550166169-8">8</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac21550166169-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac21550166169-1"><span class="crayon-p"># Set up the decoder, using `encoder_states` as initial state.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac21550166169-2"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac21550166169-3"><span class="crayon-p"># We set up our decoder to return full output sequences,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac21550166169-4"><span class="crayon-p"># and to return internal states as well. We don't use the</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac21550166169-5"><span class="crayon-p"># return states in the training model, but we will use them in inference.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac21550166169-6"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac21550166169-7"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac21550166169-8"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac21550166169-9"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Finally, the model is defined with inputs for the encoder and the decoder and the output target sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac23829405070" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Define the model that will turn
# `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac23829405070-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac23829405070-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac23829405070-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac23829405070-1"><span class="crayon-p"># Define the model that will turn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac23829405070-2"><span class="crayon-p"># `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac23829405070-3"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can tie all of this together in a standalone example and fix the configuration and print a graph of the model. The complete code example for defining the model is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac27111352991" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from keras.models import Model
from keras.layers import Input
from keras.layers import LSTM
from keras.layers import Dense
from keras.utils.vis_utils import plot_model
# configure
num_encoder_tokens = 71
num_decoder_tokens = 93
latent_dim = 256
# Define an input sequence and process it.
encoder_inputs = Input(shape=(None, num_encoder_tokens))
encoder = LSTM(latent_dim, return_state=True)
encoder_outputs, state_h, state_c = encoder(encoder_inputs)
# We discard `encoder_outputs` and only keep the states.
encoder_states = [state_h, state_c]
# Set up the decoder, using `encoder_states` as initial state.
decoder_inputs = Input(shape=(None, num_decoder_tokens))
# We set up our decoder to return full output sequences,
# and to return internal states as well. We don't use the
# return states in the training model, but we will use them in inference.
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)
decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
decoder_dense = Dense(num_decoder_tokens, activation='softmax')
decoder_outputs = decoder_dense(decoder_outputs)
# Define the model that will turn
# `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
# plot the model
plot_model(model, to_file='model.png', show_shapes=True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-4">4</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-6">6</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-8">8</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-10">10</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-12">12</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-14">14</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-16">16</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-18">18</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-20">20</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-22">22</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-24">24</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-26">26</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac27111352991-28">28</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac27111352991-29">29</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-1"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-v">plot_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-6"><span class="crayon-p"># configure</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-7"><span class="crayon-v">num_encoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">71</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-8"><span class="crayon-v">num_decoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">93</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-9"><span class="crayon-v">latent_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">256</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-10"><span class="crayon-p"># Define an input sequence and process it.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-11"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_encoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-12"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-13"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-14"><span class="crayon-p"># We discard `encoder_outputs` and only keep the states.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-15"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-16"><span class="crayon-p"># Set up the decoder, using `encoder_states` as initial state.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-17"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-18"><span class="crayon-p"># We set up our decoder to return full output sequences,</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-19"><span class="crayon-p"># and to return internal states as well. We don't use the</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-20"><span class="crayon-p"># return states in the training model, but we will use them in inference.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-21"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-22"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-23"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-24"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-25"><span class="crayon-p"># Define the model that will turn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-26"><span class="crayon-p"># `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-27"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac27111352991-28"><span class="crayon-p"># plot the model</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac27111352991-29"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>Running the example creates a plot of the defined model that may help you better understand how everything hangs together.</p>
<p>Note that the encoder LSTM does not directly pass its outputs as inputs to the decoder LSTM; as noted above, the decoder uses the final hidden and cell states as the initial state for the decoder.</p>
<p>Also note that the decoder LSTM only passes the sequence of hidden states to the Dense for output, not the final hidden and cell states as suggested by the output shape information.</p>
<div class="wp-caption aligncenter" id="attachment_4564" style="width: 975px"><img alt="Graph of Encoder-Decoder Model For Training" class="size-full wp-image-4564" height="405" sizes="(max-width: 965px) 100vw, 965px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training.png 965w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training-300x126.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training-768x322.png 768w" width="965"/><p class="wp-caption-text">Graph of Encoder-Decoder Model For Training</p></div>
<h2>Neural Machine Translation Inference</h2>
<p>Once the defined model is fit, it can be used to make predictions. Specifically, output a French translation for an English source text.</p>
<p>The model defined for training has learned weights for this operation, but the structure of the model is not designed to be called recursively to generate one character at a time.</p>
<p>Instead, new models are required for the prediction step, specifically a model for encoding English input sequences of characters and a model that takes the sequence of French characters generated so far and the encoding as input and predicts the next character in the sequence.</p>
<p>Defining the inference models requires reference to elements of the model used for training in the example. Alternately, one could define a new model with the same shapes and load the weights from file.</p>
<p>The encoder model is defined as taking the input layer from the encoder in the trained model (<em>encoder_inputs</em>) and outputting the hidden and cell state tensors (<em>encoder_states</em>).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac29761049424" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define encoder inference model
encoder_model = Model(encoder_inputs, encoder_states)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac29761049424-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac29761049424-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac29761049424-1"><span class="crayon-p"># define encoder inference model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac29761049424-2"><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The decoder is more elaborate.</p>
<p>The decoder requires the hidden and cell states from the encoder as the initial state of the newly defined encoder model. Because the decoder is a separate standalone model, these states will be provided as input to the model, and therefore must first be defined as inputs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac2b773155572" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
decoder_state_input_h = Input(shape=(latent_dim,))
decoder_state_input_c = Input(shape=(latent_dim,))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac2b773155572-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac2b773155572-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac2b773155572-1"><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac2b773155572-2"><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>They can then be specified for use as the initial state of the decoder LSTM layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac2d304214438" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac2d304214438-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac2d304214438-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac2d304214438-1"><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac2d304214438-2"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Both the encoder and decoder will be called recursively for each character that is to be generated in the translated sequence.</p>
<p>On the first call, the hidden and cell states from the encoder will be used to initialize the decoder LSTM layer, provided as input to the model directly.</p>
<p>On subsequent recursive calls to the decoder, the last hidden and cell state must be provided to the model. These state values are already within the decoder; nevertheless, we must re-initialize the state on each call given the way that the model was defined in order to take the final states from the encoder on the first call.</p>
<p>Therefore, the decoder must output the hidden and cell states along with the predicted character on each call, so that these states can be assigned to a variable and used on each subsequent recursive call for a given input sequence of English text to be translated.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac2e728199168" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
decoder_states = [state_h, state_c]
decoder_outputs = decoder_dense(decoder_outputs)
decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac2e728199168-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac2e728199168-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac2e728199168-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac2e728199168-1"><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac2e728199168-2"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac2e728199168-3"><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can tie all of this together into a standalone code example combined with the definition of the training model of the previous section, given the reuse of some elements. The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3ac30852900898" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from keras.models import Model
from keras.layers import Input
from keras.layers import LSTM
from keras.layers import Dense
from keras.utils.vis_utils import plot_model
# configure
num_encoder_tokens = 71
num_decoder_tokens = 93
latent_dim = 256
# Define an input sequence and process it.
encoder_inputs = Input(shape=(None, num_encoder_tokens))
encoder = LSTM(latent_dim, return_state=True)
encoder_outputs, state_h, state_c = encoder(encoder_inputs)
# We discard `encoder_outputs` and only keep the states.
encoder_states = [state_h, state_c]
# Set up the decoder, using `encoder_states` as initial state.
decoder_inputs = Input(shape=(None, num_decoder_tokens))
# We set up our decoder to return full output sequences,
# and to return internal states as well. We don't use the
# return states in the training model, but we will use them in inference.
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)
decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
decoder_dense = Dense(num_decoder_tokens, activation='softmax')
decoder_outputs = decoder_dense(decoder_outputs)
# Define the model that will turn
# `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
# plot the model
plot_model(model, to_file='model.png', show_shapes=True)
# define encoder inference model
encoder_model = Model(encoder_inputs, encoder_states)
# define decoder inference model
decoder_state_input_h = Input(shape=(latent_dim,))
decoder_state_input_c = Input(shape=(latent_dim,))
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)
decoder_states = [state_h, state_c]
decoder_outputs = decoder_dense(decoder_outputs)
decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)
# summarize model
plot_model(encoder_model, to_file='encoder_model.png', show_shapes=True)
plot_model(decoder_model, to_file='decoder_model.png', show_shapes=True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-4">4</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-6">6</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-8">8</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-10">10</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-12">12</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-14">14</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-16">16</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-18">18</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-20">20</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-22">22</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-24">24</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-26">26</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-28">28</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-30">30</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-32">32</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-34">34</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-36">36</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-38">38</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-40">40</div><div class="crayon-num" data-line="crayon-5c0ca27c3ac30852900898-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3ac30852900898-42">42</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-1"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-v">plot_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-6"><span class="crayon-p"># configure</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-7"><span class="crayon-v">num_encoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">71</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-8"><span class="crayon-v">num_decoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">93</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-9"><span class="crayon-v">latent_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">256</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-10"><span class="crayon-p"># Define an input sequence and process it.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-11"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_encoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-12"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-13"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-14"><span class="crayon-p"># We discard `encoder_outputs` and only keep the states.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-15"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-16"><span class="crayon-p"># Set up the decoder, using `encoder_states` as initial state.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-17"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-18"><span class="crayon-p"># We set up our decoder to return full output sequences,</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-19"><span class="crayon-p"># and to return internal states as well. We don't use the</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-20"><span class="crayon-p"># return states in the training model, but we will use them in inference.</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-21"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-22"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-23"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-24"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-25"><span class="crayon-p"># Define the model that will turn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-26"><span class="crayon-p"># `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-27"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-28"><span class="crayon-p"># plot the model</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-29"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-30"><span class="crayon-p"># define encoder inference model</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-31"><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-32"><span class="crayon-p"># define decoder inference model</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-33"><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-34"><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-35"><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-36"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-37"><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-38"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-39"><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-40"><span class="crayon-p"># summarize model</span></div><div class="crayon-line" id="crayon-5c0ca27c3ac30852900898-41"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'encoder_model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3ac30852900898-42"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'decoder_model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0032 seconds] -->
<p>Running the example defines the training model, inference encoder, and inference decoder.</p>
<p>Plots of all three models are then created.</p>
<div class="wp-caption aligncenter" id="attachment_4565" style="width: 551px"><img alt="Graph of Encoder Model For Inference" class="size-full wp-image-4565" height="184" sizes="(max-width: 541px) 100vw, 541px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Model-For-Inference.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Model-For-Inference.png 541w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Model-For-Inference-300x102.png 300w" width="541"/><p class="wp-caption-text">Graph of Encoder Model For Inference</p></div>
<p>The plot of the encoder is straightforward.</p>
<p>The decoder shows the three inputs required to decode a single character in the translated sequence, the encoded translation output so far, and the hidden and cell states provided first from the encoder and then from the output of the decoder as the model is called recursively for a given translation.</p>
<div class="wp-caption aligncenter" id="attachment_4566" style="width: 1185px"><img alt="Graph of Decoder Model For Inference" class="size-full wp-image-4566" height="295" sizes="(max-width: 1175px) 100vw, 1175px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference.png 1175w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference-300x75.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference-768x193.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference-1024x257.png 1024w" width="1175"/><p class="wp-caption-text">Graph of Decoder Model For Inference</p></div>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://twitter.com/fchollet">Francois Chollet on Twitter</a></li>
<li><a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a></li>
<li><a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">Keras seq2seq Code Example (lstm_seq2seq)</a></li>
<li><a href="https://keras.io/getting-started/functional-api-guide/">Keras Functional API</a></li>
<li><a href="https://keras.io/layers/recurrent/#lstm">LSTM API in Keras</a></li>
<li><a href="http://www.bioinf.jku.at/publications/older/2604.pdf">Long Short-Term Memory</a>, 1997.</li>
<li><a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/">Understanding LSTM Networks</a>, 2015.</li>
<li><a href="https://arxiv.org/abs/1409.3215">Sequence to Sequence Learning with Neural Networks</a>, 2014.</li>
<li><a href="https://arxiv.org/abs/1406.1078">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</a>, 2014.</li>
</ul>
<p><strong>Update</strong></p>
<p>For an example of how to use this model on a standalone problem, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</a></li>
</ul>
<h2>Summary</h2>
<p>In this post, you discovered how to define an encoder-decoder sequence-to-sequence prediction model for machine translation, as described by the author of the Keras deep learning library.</p>
<p>Specifically, you learned:</p>
<ul>
<li>The neural machine translation example provided with Keras and described on the Keras blog.</li>
<li>How to correctly define an encoder-decoder LSTM for training a neural machine translation model.</li>
<li>How to correctly define an inference model for using a trained encoder-decoder model to translate new sequences.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4563 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Define+an+Encoder-Decoder+Sequence-to-Sequence+Model+for+Neural+Machine+Translation+in+Keras&amp;url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/" rel="prev"><i class="fa fa-angle-left"></i> How to Index, Slice and Reshape NumPy Arrays for Machine Learning in Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="next">How to Use the Keras Functional API for Deep Learning <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">146 Responses to <em>How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-418093">
<div class="comment-container" id="li-comment-418093">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d6e53cd310d401852858089d556ce04a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d6e53cd310d401852858089d556ce04a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tom</span>
<span class="date">October 27, 2017 at 11:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418093" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason – Which book has this article?  I did not see this in LSTM, if I am not mistaken.</p>
<div class="reply">
<a aria-label="Reply to Tom" class="comment-reply-link" href="#comment-418093" onclick='return addComment.moveForm( "comment-418093", "418093", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418606">
<div class="comment-container" id="li-comment-418606">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">October 31, 2017 at 10:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418606" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i have referenced lstm_seq2seq.py code for requirement,i had executed correctly i got the correct results.<br/>
my requirement is that i  have to inputs from user and it has to encode to state vectors ,give to decoder ,generate results for given inputs. I have written a  logic for it.but i am not able to generate the correct results.</p>
<p>userInput=”<br/>
count=0<br/>
while(userInput!=’quit’):<br/>
     userInput = input(‘enter the english sentences or want to stop (enter quote with quotes)’);<br/>
     userInput=str(userInput)<br/>
     f = open(‘testone.txt’, ‘a’ )<br/>
     if userInput==’quit’:<br/>
          f.close()<br/>
     else:<br/>
        f.write( userInput + ‘\n’ )<br/>
        count=count+1<br/>
print(“count”,count)</p>
<p># taking inputs from user </p>
<p>#saving in testone.txt file</p>
<p>test_path=’testone.txt’<br/>
test_texts = []<br/>
#target_texts = []<br/>
test_characters = set()<br/>
#target_characters = set()<br/>
lines = open(test_path).read().split(‘\n’)<br/>
for line in lines[: min(30, len(lines) – 1)]:<br/>
    test_text = line</p>
<p>    test_texts.append(test_text)<br/>
    #target_texts.append(target_text)<br/>
    for char in test_text:<br/>
        if char not in test_characters:<br/>
            test_characters.add(char)</p>
<p>test_characters = sorted(list(test_characters))<br/>
num_testencoder_tokens = len(test_characters)<br/>
max_testencoder_seq_length = max([len(txt) for txt in test_texts])</p>
<p>print(‘Number of samples:’, len(test_texts))<br/>
#print(‘Number of unique input tokens:’, num_encoder_tokens)<br/>
print(“max test encoder seq length”,max_testencoder_seq_length)<br/>
print(“num_testencoder_tokens”,num_testencoder_tokens)<br/>
test_token_index = dict(<br/>
    [(char, i) for i, char in enumerate(test_characters)])<br/>
print(“test_token_index”,test_token_index)<br/>
encoder_test_data = np.zeros(<br/>
    (len(test_texts), max_testencoder_seq_length,num_testencoder_tokens),<br/>
    dtype=’float32′)<br/>
print(“encoder_test_data”,encoder_test_data.shape)</p>
<p>for i,test_text in enumerate(test_texts):<br/>
    for t, char in enumerate(test_text):<br/>
        encoder_test_data[i, t,test_token_index[char]] = 1.<br/>
print(“encoder_test_data”,encoder_test_data.shape)</p>
<p>encoder_test_inputs = Input(shape=(None,num_testencoder_tokens))<br/>
print(“encoder_inputs”,encoder_test_inputs.shape)</p>
<p>encoder_test_inputs = Input(shape=(None, num_testencoder_tokens))<br/>
print(“—————-“,encoder_test_inputs.shape)</p>
<p>encoder = LSTM(latent_dim, return_state=True)<br/>
encoder_outputs, state_h, state_c = encoder(encoder_test_inputs)<br/>
print(“encoder_outputs”,encoder_outputs)</p>
<p># We discard <code>encoder_outputs</code> and only keep the states.<br/>
encoder_test_states = [state_h, state_c]</p>
<p>print(“encoder_test_states”,encoder_test_states)<br/>
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)<br/>
decoder_outputs, _, _ = decoder_lstm(decoder_inputs,<br/>
                                     initial_state=encoder_test_states)<br/>
print(‘encoder_test_inputs.shape’,encoder_test_inputs.shape)<br/>
print(‘encoder_test_states’,encoder_test_states)</p>
<p>encoder_test_model = Model(encoder_test_inputs, encoder_test_states)</p>
<p>print(encoder_test_model.summary)</p>
<p>decoder_state_input_h = Input(shape=(latent_dim,))<br/>
decoder_state_input_c = Input(shape=(latent_dim,))<br/>
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]<br/>
decoder_outputs, state_h, state_c = decoder_lstm(<br/>
    decoder_inputs, initial_state=decoder_states_inputs)<br/>
decoder_states = [state_h, state_c]<br/>
decoder_outputs = decoder_dense(decoder_outputs)</p>
<p>decoder_model = Model(<br/>
    [decoder_inputs] + decoder_states_inputs,<br/>
    [decoder_outputs] + decoder_states)</p>
<p># Reverse-lookup token index to decode sequences back to<br/>
# something readable.<br/>
reverse_input_char_index = dict(<br/>
    (i, char) for char, i in test_token_index.items())<br/>
reverse_testtarget_char_index=dict(<br/>
    (i, char) for char, i in target_token_index.items())</p>
<p>def decode_sequence(input_seq):<br/>
    # Encode the input as state vectors.<br/>
    #print(input_seq)<br/>
    states_value = encoder_test_model.predict(input_seq)</p>
<p>    # Generate empty target sequence of length 1.<br/>
    target_seq = np.zeros((1, 1, num_decoder_tokens))<br/>
   # print(“target_seq”,target_seq)<br/>
    # Populate the first character of target sequence with the start character.<br/>
    target_seq[0, 0, target_token_index[‘\t’]] = 1.</p>
<p>    # Sampling loop for a batch of sequences<br/>
    # (to simplify, here we assume a batch of size 1).<br/>
    stop_condition = False<br/>
    decoded_sentence = ”<br/>
    while not stop_condition:<br/>
        output_tokens, h, c = decoder_model.predict(<br/>
            [target_seq] + states_value)<br/>
        #print(“output_tokens”,output_tokens)<br/>
        # Sample a token<br/>
        sampled_token_index = np.argmax(output_tokens[0, -1, :])<br/>
        print(‘sampled_token_index’, sampled_token_index)<br/>
        #sampled_char = reverse_target_char_index[sampled_token_index]<br/>
        sampled_char = reverse_testtarget_char_index[sampled_token_index]<br/>
        print(“sampled_char”,sampled_char)<br/>
        decoded_sentence += sampled_char</p>
<p>        # Exit condition: either hit max length<br/>
        # or find stop character.<br/>
        if (sampled_char == ‘\n’ or<br/>
           len(decoded_sentence) &gt; max_decoder_seq_length):<br/>
            stop_condition = True</p>
<p>        # Update the target sequence (of length 1).<br/>
        target_seq = np.zeros((1, 1, num_decoder_tokens))<br/>
        #print(“target_seq legnth”,len(target_seq))<br/>
        target_seq[0, 0, sampled_token_index] = 1.</p>
<p>        # Update states<br/>
        states_value = [h, c]</p>
<p>    return decoded_sentence</p>
<p>for seq_index in range(count):<br/>
    #print(encoder_test_data[0:1])<br/>
    input_seq = encoder_test_data[seq_index: seq_index + 1]<br/>
    print(“input_seq”,input_seq.shape)<br/>
    decoded_sentence = decode_sequence(input_seq)<br/>
    print(‘-‘)<br/>
    print(‘Input sentence:’, test_texts[seq_index])<br/>
    print(‘Decoded sentence:’, decoded_sentence)</p>
<p>Above is my code ,please suggest where i am going wrong.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-418606" onclick='return addComment.moveForm( "comment-418606", "418606", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418629">
<div class="comment-container" id="li-comment-418629">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 5:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418629" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot debug your code for you. </p>
<p>What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418629" onclick='return addComment.moveForm( "comment-418629", "418629", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418670">
<div class="comment-container" id="li-comment-418670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 1, 2017 at 3:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Actually in original code ,they are testing on  already trained code,in my code what i am doing is ,i  am giving inputs from console and stored in a file,this inputs i am giving to encoder_model, for console inputs i am not getting proper outputs like we got i n trained data.</p>
<p>Suppose i have given same words from console to encoder model also i am getting wrong results.</p>
<p>Please tell me where i am going wrong.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-418670" onclick='return addComment.moveForm( "comment-418670", "418670", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418678">
<div class="comment-container" id="li-comment-418678">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 4:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418678" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you can debug your example with static data?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418678" onclick='return addComment.moveForm( "comment-418678", "418678", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418685">
<div class="comment-container" id="li-comment-418685">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 1, 2017 at 5:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418685" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>for static data it is working, but when i am taking inputs from users i am not getting proper results.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-418685" onclick='return addComment.moveForm( "comment-418685", "418685", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418728">
<div class="comment-container" id="li-comment-418728">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2017 at 5:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418728" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It might be related to how you are reading the input and preparing it for the model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418728" onclick='return addComment.moveForm( "comment-418728", "418728", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418804">
<div class="comment-container" id="li-comment-418804">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ambika</span>
<span class="date">November 2, 2017 at 6:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418804" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How to do predictions for sequence to sequence model using keras,why we are not using train model directly,why we are creating inference model in this scenario ,Please can you explain.</p>
<p>i would like to know,how to predict the model outputs for model unknown inputs in sequence to sequence model using keras.</p>
<div class="reply">
<a aria-label="Reply to Ambika" class="comment-reply-link" href="#comment-418804" onclick='return addComment.moveForm( "comment-418804", "418804", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418833">
<div class="comment-container" id="li-comment-418833">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418833" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a sophisticated seq2seq model. For a much simpler architecture see here:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418833" onclick='return addComment.moveForm( "comment-418833", "418833", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418810">
<div class="comment-container" id="li-comment-418810">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandu</span>
<span class="date">November 2, 2017 at 11:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418810" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have unknown inputs in eng, i want to translate these inputs to french.So i converted these textst inputs into vectors,like in seq2sq model they have encoded as  constant length vector.<br/>
I have given these inputs to inference encoder_model,along with these inputs states(hidden,cell states) like encoder_model = Model(encoder_test_inputs, encoder_test_states)<br/>
from these i am extracting state value from encoder_model(),this state value i am passing to decoder model,like that decoder_model.predict(<br/>
[target_seq] + states_value),but i am getting scarmbled outputs if i will give unknown inputs to encoder_model.</p>
<p>is there any difference procedure available to predict target sequnce for given unknwon inputs sequnce,Please suggest me for this problem.<br/>
I am able to decode the already trained data,if is not trained  data i am not able to decode.</p>
<div class="reply">
<a aria-label="Reply to Nandu" class="comment-reply-link" href="#comment-418810" onclick='return addComment.moveForm( "comment-418810", "418810", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418837">
<div class="comment-container" id="li-comment-418837">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418837" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Once the model is trained, you must encode new data using the same procedure as you used for the training data then call model.predict()</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418837" onclick='return addComment.moveForm( "comment-418837", "418837", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418892">
<div class="comment-container" id="li-comment-418892">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandu</span>
<span class="date">November 3, 2017 at 4:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418892" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>in that they are not doing model.predict,they are doing encoder_model.predict and decoder_model.predict() seperately.</p>
<div class="reply">
<a aria-label="Reply to nandu" class="comment-reply-link" href="#comment-418892" onclick='return addComment.moveForm( "comment-418892", "418892", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418946">
<div class="comment-container" id="li-comment-418946">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 4, 2017 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418946" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418946" onclick='return addComment.moveForm( "comment-418946", "418946", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-419138">
<div class="comment-container" id="li-comment-419138">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 6, 2017 at 5:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-419138" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How to predict unknown target sequence for unknown inputs using keras? for unknown inputs again i need to create input layer and encoder states  and encoder model or else or i need to use same encoder_model its taking parameters as  encoder_inputs and encoders_states.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-419138" onclick='return addComment.moveForm( "comment-419138", "419138", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-419193">
<div class="comment-container" id="li-comment-419193">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 7, 2017 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-419193" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The inference models could be saved, loaded and used to make predictions as in the above examples.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-419193" onclick='return addComment.moveForm( "comment-419193", "419193", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-419996">
<div class="comment-container" id="li-comment-419996">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandu</span>
<span class="date">November 14, 2017 at 11:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-419996" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Please can you explain how this inference decoder_model will work in this examples,i  am ok with training of the encoder and decoder model ,inference encoder_model,I didn’t understnd the inference decoder_model in this example.</p>
<p># define decoder inference model<br/>
decoder_state_input_h = Input(shape=(latent_dim,))<br/>
decoder_state_input_c = Input(shape=(latent_dim,))<br/>
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]<br/>
in training model we are passing decoder_inputs and intial state as encoder states,but in inference something it is differnent things we are passing ,why what is the reason.</p>
<p>decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)</p>
<p>decoder_states = [state_h, state_c]</p>
<p>decoder_outputs = decoder_dense(decoder_outputs)<br/>
decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs]</p>
<div class="reply">
<a aria-label="Reply to Nandu" class="comment-reply-link" href="#comment-419996" onclick='return addComment.moveForm( "comment-419996", "419996", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420043">
<div class="comment-container" id="li-comment-420043">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420043" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The key difference is that we recursively pass in the last state as input, starting with the encoder state for the first pass.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420043" onclick='return addComment.moveForm( "comment-420043", "420043", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420022">
<div class="comment-container" id="li-comment-420022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/765ff36ce7382543fbf0cf1e3d3b44ed?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/765ff36ce7382543fbf0cf1e3d3b44ed?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jonas</span>
<span class="date">November 15, 2017 at 6:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could you please elaborate more on why TimeDistributed is not need here? The Dense layer in Decoder must output one character for each character in the input sequence, so how is it different here from the case where TimeDistributed must be aplied?</p>
<div class="reply">
<a aria-label="Reply to Jonas" class="comment-reply-link" href="#comment-420022" onclick='return addComment.moveForm( "comment-420022", "420022", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420050">
<div class="comment-container" id="li-comment-420050">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420050" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question. Dense can now support time steps! </p>
<p>You can add a TimeDistribted wrapper and it will have the same effect.</p>
<p>I know… Keras is getting a little confusing.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420050" onclick='return addComment.moveForm( "comment-420050", "420050", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420073">
<div class="comment-container" id="li-comment-420073">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 15, 2017 at 6:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420073" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason,</p>
<p>currently i am working on seq2seq model using keras.</p>
<p>my requirement: they will test case in english like (adding two numbers).<br/>
output: source has to generate for that particular test case in python .</p>
<p>this requirement is quietly different from language translation tool.</p>
<p>Please do any suggestions for it,how to proceed further.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-420073" onclick='return addComment.moveForm( "comment-420073", "420073", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420173">
<div class="comment-container" id="li-comment-420173">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2017 at 10:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420173" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post for almost exactly this problem:<br/>
<a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" rel="nofollow">https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420173" onclick='return addComment.moveForm( "comment-420173", "420173", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420098">
<div class="comment-container" id="li-comment-420098">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 15, 2017 at 9:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420098" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>while predicting target character .</p>
<p>output_tokens, h, c = decoder_test_model.predict(<br/>
            [target_seq] + states_value)</p>
<p>        # Sample a token<br/>
        sampled_token_index = np.argmax(output_tokens[0, -1, :])<br/>
they are using np.argmax(output_tokesn) ,Could you explain how does it works inorder to predict the target character.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-420098" onclick='return addComment.moveForm( "comment-420098", "420098", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420177">
<div class="comment-container" id="li-comment-420177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2017 at 10:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly?</p>
<p>argmax? See here:<br/>
<a href="https://en.wikipedia.org/wiki/Arg_max" rel="nofollow">https://en.wikipedia.org/wiki/Arg_max</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420177" onclick='return addComment.moveForm( "comment-420177", "420177", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420733">
<div class="comment-container" id="li-comment-420733">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f66d349d54d2934cca64266c4a40a5dc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f66d349d54d2934cca64266c4a40a5dc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Krtk</span>
<span class="date">November 21, 2017 at 1:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420733" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for making a detailed blog.</p>
<p>Did you try saving and restoring the model for inference later?<br/>
I’m following the lstm_seq2seq example where the model.save stored the HDF5 file but when I try restoring the model just for inference, the output is all garbage despite the model providing good test responses when train is followed by inference.</p>
<div class="reply">
<a aria-label="Reply to Krtk" class="comment-reply-link" href="#comment-420733" onclick='return addComment.moveForm( "comment-420733", "420733", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420810">
<div class="comment-container" id="li-comment-420810">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2017 at 10:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420810" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have not tried that, sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420810" onclick='return addComment.moveForm( "comment-420810", "420810", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420859">
<div class="comment-container" id="li-comment-420859">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 22, 2017 at 6:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420859" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Can we identify the grammer  using keras,like what is noun and pronoun ,</p>
<p>Please suggest any procedure is there to identify thr grammer using keras.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-420859" onclick='return addComment.moveForm( "comment-420859", "420859", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420943">
<div class="comment-container" id="li-comment-420943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure. It could be framed as word classification.</p>
<p>You must prepare a dataset of examples then fit your model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420943" onclick='return addComment.moveForm( "comment-420943", "420943", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420867">
<div class="comment-container" id="li-comment-420867">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 22, 2017 at 9:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420867" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason,</p>
<p>do you have any example of word level encoding for language translation ,above examples is for character level encoding rigjt.<br/>
if you have example please share the link.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="#comment-420867" onclick='return addComment.moveForm( "comment-420867", "420867", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420945">
<div class="comment-container" id="li-comment-420945">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420945" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I have an example in my book:<br/>
<a href="https://machinelearningmastery.com/deep-learning-for-nlp/" rel="nofollow">https://machinelearningmastery.com/deep-learning-for-nlp/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420945" onclick='return addComment.moveForm( "comment-420945", "420945", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421000">
<div class="comment-container" id="li-comment-421000">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandu</span>
<span class="date">November 24, 2017 at 12:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421000" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here provided example ,they are doing character level encoding for encoder and decoder,Same model i would like to work on word level encoding for encoder and decoder?<br/>
is word level encoding will better than character level encoding?</p>
<p>in order to word level encoding ,which method i need to follow,please suggest me before going to start.</p>
<div class="reply">
<a aria-label="Reply to nandu" class="comment-reply-link" href="#comment-421000" onclick='return addComment.moveForm( "comment-421000", "421000", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421044">
<div class="comment-container" id="li-comment-421044">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421044" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends on the problem whether word or char level will be better. Char may be more flexible but be slower to train, Word may require larger vocab/memory but train sooner.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421044" onclick='return addComment.moveForm( "comment-421044", "421044", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt thread-even depth-1" id="comment-421039">
<div class="comment-container" id="li-comment-421039">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421039" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow, can you please restate the question?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421039" onclick='return addComment.moveForm( "comment-421039", "421039", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421185">
<div class="comment-container" id="li-comment-421185">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Baptiste Amato</span>
<span class="date">November 26, 2017 at 2:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421185" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well explained article! I wonder if these sequence-to-sequence can be applied to images, for example to handle different size images, and apply encoder-decoder for segmentation?</p>
<div class="reply">
<a aria-label="Reply to Baptiste Amato" class="comment-reply-link" href="#comment-421185" onclick='return addComment.moveForm( "comment-421185", "421185", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421202">
<div class="comment-container" id="li-comment-421202">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 26, 2017 at 7:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421202" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps, I’m not sure I follow sorry. Do you have an example?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421202" onclick='return addComment.moveForm( "comment-421202", "421202", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-421213">
<div class="comment-container" id="li-comment-421213">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Baptiste Amato</span>
<span class="date">November 26, 2017 at 8:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421213" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Let’s say I want to develop a Neural Network that returns, given an image, a sort of contour map (like the cars in blue, the people in green), but my data set has various images from different size, making them impossible to stack in an array and put them directly in a CNN. Would it be possible to apply the sequence-to-sequence idea to these images, as we want an image as result and we don’t have a uniform size for the input data?</p>
<div class="reply">
<a aria-label="Reply to Baptiste Amato" class="comment-reply-link" href="#comment-421213" onclick='return addComment.moveForm( "comment-421213", "421213", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-421278">
<div class="comment-container" id="li-comment-421278">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421278" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting challenge.</p>
<p>I don’t think seq2seq is the right framing, but I could be wrong.</p>
<p>There are many ways to frame this type of problem and I’d encourage you to explore a few. Perhaps a network that outputs a red and a green image that you combine downstream, or perhaps the network outputs one image with all pixels colored.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421278" onclick='return addComment.moveForm( "comment-421278", "421278", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-421310">
<div class="comment-container" id="li-comment-421310">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Baptiste Amato</span>
<span class="date">November 27, 2017 at 10:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421310" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>“a network that outputs a red and a green image that you combine downstream”: it’s pretty simple but I did not think about it… Thank you for your comment 🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-421421">
<div class="comment-container" id="li-comment-421421">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2017 at 8:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421421" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No problem, let me know how you go.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-421472">
<div class="comment-container" id="li-comment-421472">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 28, 2017 at 5:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421472" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>can we store model states and use it further for testing,<br/>
Please suggest me the way to store the states in file ,use it further.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="#comment-421472" onclick='return addComment.moveForm( "comment-421472", "421472", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421541">
<div class="comment-container" id="li-comment-421541">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2017 at 8:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421541" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can, e.g. pickle the state LSTM variable.</p>
<p>Why do you want to save the state?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421541" onclick='return addComment.moveForm( "comment-421541", "421541", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-421596">
<div class="comment-container" id="li-comment-421596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 29, 2017 at 5:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am writting the training model and testing model seperately thats why i want to  feed encoder_inputs and encoder states to inference model,thats why i would like to store the states.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="#comment-421596" onclick='return addComment.moveForm( "comment-421596", "421596", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-421659">
<div class="comment-container" id="li-comment-421659">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 8:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421659" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’d recommend using one model to keep things simple.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421659" onclick='return addComment.moveForm( "comment-421659", "421659", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421597">
<div class="comment-container" id="li-comment-421597">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 29, 2017 at 5:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421597" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>model = Model([encoder_inputs, decoder_inputs], decoder_outputs)</p>
<p>model.save(“seq2seq.h5”)<br/>
here i am loading the model from h5 file<br/>
model=model.load(seq2seq.h5)<br/>
after that i have stored encoder_inputs,encoders_states of trained model using pickling .<br/>
next i am trying to create the inference model using encoder_inputs and encoder_states<br/>
but i am not able to create the inference model correctly, i am getting the issue like graph disconnected with input layer 1 .<br/>
encoder_model = Model(encoder_inputs, encoder_states</p>
<p>Please suggest why i am getting like this issue.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="#comment-421597" onclick='return addComment.moveForm( "comment-421597", "421597", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-423283">
<div class="comment-container" id="li-comment-423283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Etienne</span>
<span class="date">December 16, 2017 at 1:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey , I had the same issue ( I have implemented a seq 2 seq model with R but I had the same problem) and I solved this with a trick.<br/>
So after training your model you can save it using keras function save model. Then I defined a function to build the encoder model and another one to build the decoder model from the model I have trained. Here is my code :</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3dbab939716749" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
get_encoder_model &lt;- function(model) {
  encoder_inputs = get_output_at(get_layer(model,'encoder_inputs'),0)
  encoder_lstm = get_output_at(get_layer(model,'encoder_lstm'),0)
  state_h &lt;- encoder_lstm[[2]]
  state_c &lt;- encoder_lstm[[3]]
  encoder_states = list(state_h,state_c)
  encoder_model = keras_model(encoder_inputs, encoder_states)
  return(encoder_model)
}

get_decoder_model &lt;- function(model) {
  latent_dim = get_output_shape_at(get_layer(model,'decoder_lstm'),0)[[1]][[3]]
  decoder_inputs = get_output_at(get_layer(model,'decoder_inputs'),0)
  decoder_state_input_h = layer_input(c(latent_dim))
  decoder_state_input_c = layer_input(c(latent_dim))
  decoder_states_inputs = list(decoder_state_input_h, decoder_state_input_c)
  decoder = layer_lstm(units = latent_dim,return_sequences = T,return_state=T,name = 'decoder_lstm')
  decoder_inf_lstm = decoder(get_output_at(get_layer(model,'decoder_inputs'),0), initial_state = decoder_states_inputs)
  
  set_weights(decoder,keras::get_weights(get_layer(model,'decoder_lstm')))
  decoder_outputs &lt;- decoder_inf_lstm[[1]]
  state_h &lt;- decoder_inf_lstm[[2]]
  state_c &lt;- decoder_inf_lstm[[3]]
  decoder_states = list(state_h,state_c)
  decoder_dense = layer_dense(units = n_features,activation='linear',name = 'decoder_dense')
  decoder_outputs &lt;- decoder_dense(decoder_outputs)
  set_weights(decoder_dense,keras::get_weights(get_layer(model,'decoder_dense')))
  decoder_model = keras_model(inputs = c(decoder_inputs,decoder_states_inputs), outputs = c(decoder_outputs,decoder_states))
  return(decoder_model)
}</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-4">4</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-6">6</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-8">8</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-10">10</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-12">12</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-14">14</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-16">16</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-18">18</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-20">20</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-22">22</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-24">24</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-26">26</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-28">28</div><div class="crayon-num" data-line="crayon-5c0ca27c3dbab939716749-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3dbab939716749-30">30</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-1"><span class="crayon-v">get_encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-2"><span class="crayon-h">  </span><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'encoder_inputs'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-3"><span class="crayon-h">  </span><span class="crayon-v">encoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'encoder_lstm'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-4"><span class="crayon-h">  </span><span class="crayon-v">state_h</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">encoder_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-5"><span class="crayon-h">  </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">encoder_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-6"><span class="crayon-h">  </span><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-v">state_c</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-7"><span class="crayon-h">  </span><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">keras_model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-8"><span class="crayon-h">  </span><span class="crayon-st">return</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-9"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-10"> </div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-11"><span class="crayon-v">get_decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-12"><span class="crayon-h">  </span><span class="crayon-v">latent_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_shape_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_lstm'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-13"><span class="crayon-h">  </span><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_inputs'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-14"><span class="crayon-h">  </span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_input</span><span class="crayon-sy">(</span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-15"><span class="crayon-h">  </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_input</span><span class="crayon-sy">(</span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-16"><span class="crayon-h">  </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-17"><span class="crayon-h">  </span><span class="crayon-v">decoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">units</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-v">return_sequences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'decoder_lstm'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-18"><span class="crayon-h">  </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder</span><span class="crayon-sy">(</span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_inputs'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-19"><span class="crayon-h">  </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-20"><span class="crayon-h">  </span><span class="crayon-e">set_weights</span><span class="crayon-sy">(</span><span class="crayon-v">decoder</span><span class="crayon-sy">,</span><span class="crayon-v">keras</span><span class="crayon-o">::</span><span class="crayon-e">get_weights</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_lstm'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-21"><span class="crayon-h">  </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-22"><span class="crayon-h">  </span><span class="crayon-v">state_h</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-23"><span class="crayon-h">  </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-24"><span class="crayon-h">  </span><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-v">state_c</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-25"><span class="crayon-h">  </span><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_dense</span><span class="crayon-sy">(</span><span class="crayon-v">units</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'linear'</span><span class="crayon-sy">,</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'decoder_dense'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-26"><span class="crayon-h">  </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-27"><span class="crayon-h">  </span><span class="crayon-e">set_weights</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_dense</span><span class="crayon-sy">,</span><span class="crayon-v">keras</span><span class="crayon-o">::</span><span class="crayon-e">get_weights</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_dense'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-28"><span class="crayon-h">  </span><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">keras_model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3dbab939716749-29"><span class="crayon-h">  </span><span class="crayon-st">return</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3dbab939716749-30"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0026 seconds] -->
<p>It is R code but you can adapt it to python. The trick was mainly to create new layers and set weight with those trained by your model.</p>
<div class="reply">
<a aria-label="Reply to Etienne" class="comment-reply-link" href="#comment-423283" onclick='return addComment.moveForm( "comment-423283", "423283", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-423340">
<div class="comment-container" id="li-comment-423340">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423340" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing, I added some formatting.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-423340" onclick='return addComment.moveForm( "comment-423340", "423340", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-423948">
<div class="comment-container" id="li-comment-423948">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">December 19, 2017 at 6:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423948" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks for your suggestion 🙂</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="#comment-423948" onclick='return addComment.moveForm( "comment-423948", "423948", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-424976">
<div class="comment-container" id="li-comment-424976">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/92b33c92fca7076989a72401afb63ec0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/92b33c92fca7076989a72401afb63ec0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.digitalnk.com/blog" rel="external nofollow">Benoit</a></span>
<span class="date">December 27, 2017 at 6:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424976" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This should do the trick for Python:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca27c3d981295469981" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = load_model('s2s.h5')

encoder = model.layers[2]
encoder_inputs = model.layers[0].input
encoder_outputs, state_h, state_c = model.layers[2].output
encoder_states = [state_h, state_c]
encoder_model = Model(encoder_inputs, encoder_states)

decoder_inputs = model.layers[1].input
decoder_lstm = model.layers[3]
decoder_dense = model.layers[-1]
decoder_state_input_h = Input(shape=(latent_dim,))
decoder_state_input_c = Input(shape=(latent_dim,))
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
decoder_outputs, state_h, state_c = decoder_lstm(
    decoder_inputs, initial_state=decoder_states_inputs)
decoder_states = [state_h, state_c]
decoder_outputs = decoder_dense(decoder_outputs)
decoder_model = Model(
    [decoder_inputs] + decoder_states_inputs,
    [decoder_outputs] + decoder_states)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-2">2</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-4">4</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-6">6</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-8">8</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-10">10</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-12">12</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-14">14</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-16">16</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-18">18</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca27c3d981295469981-20">20</div><div class="crayon-num" data-line="crayon-5c0ca27c3d981295469981-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'s2s.h5'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-2"> </div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-3"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-4"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">input</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-5"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">output</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-6"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-7"><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-8"> </div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-9"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-10"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-11"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-12"><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-13"><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-14"><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-15"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-16"><span class="crayon-h">    </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-17"><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-18"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-19"><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca27c3d981295469981-20"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca27c3d981295469981-21"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Benoit" class="comment-reply-link" href="#comment-424976" onclick='return addComment.moveForm( "comment-424976", "424976", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-425005">
<div class="comment-container" id="li-comment-425005">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 28, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-425005" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425005" onclick='return addComment.moveForm( "comment-425005", "425005", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-444686">
<div class="comment-container" id="li-comment-444686">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihana</span>
<span class="date">July 29, 2018 at 1:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444686" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is ‘s2s.h5’ model they only thing you saved from your encode-decoder for lated prediction?<br/>
I mean in the main code, could we eliminate building the encoder-interface and decoder-interface and just saving the model. Later for prediction, we retrieve and build the interface based on only ‘s2s.h5’?</p>
<p>If I do so I get this error:<br/>
TypeError: Tensor objects are not iterable when eager execution is not enabled. To iterate over this tensor use tf.map_fn.</p>
<p>My main confusion is whether we have to build the encoder/decoder_interface at the time of building the model (training) or not?</p>
<p>Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Reihana" class="comment-reply-link" href="#comment-444686" onclick='return addComment.moveForm( "comment-444686", "444686", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423249">
<div class="comment-container" id="li-comment-423249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3f168e506cefb78f3fc2b0a56ab9e7c9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3f168e506cefb78f3fc2b0a56ab9e7c9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.data-blogger.com/" rel="external nofollow">Kevin</a></span>
<span class="date">December 15, 2017 at 8:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for this great article! I created a Tensorflow implementation. This gives another perspective on the implementation side of the seq2seq model. The blog post about the Tensorflow implementation is found on Data Blogger: <a href="https://www.data-blogger.com/2017/12/14/create-a-character-based-seq2seq-using-python-and-tensorflow/" rel="nofollow">https://www.data-blogger.com/2017/12/14/create-a-character-based-seq2seq-using-python-and-tensorflow/</a>.</p>
<div class="reply">
<a aria-label="Reply to Kevin" class="comment-reply-link" href="#comment-423249" onclick='return addComment.moveForm( "comment-423249", "423249", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423330">
<div class="comment-container" id="li-comment-423330">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423330" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing Kevin.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-423330" onclick='return addComment.moveForm( "comment-423330", "423330", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423951">
<div class="comment-container" id="li-comment-423951">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">December 19, 2017 at 6:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423951" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can we add more lstm layres in encoder and decoder inorder to predict the results correctly,<br/>
is it a good approach to add more layers in encoder and decoder using keras.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="#comment-423951" onclick='return addComment.moveForm( "comment-423951", "423951", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424043">
<div class="comment-container" id="li-comment-424043">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424043" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It can help. Try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-424043" onclick='return addComment.moveForm( "comment-424043", "424043", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423952">
<div class="comment-container" id="li-comment-423952">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">December 19, 2017 at 6:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423952" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>encoder and decoder model is good approach to implement a model ,for algorithm as input to model,output is source code generation for specified language .</p>
<p>i am trying to this problem statement using encoder and decoder model using keras,is this good  idea to implement,or is there any apporach  is there for this problem statement.</p>
<p>Please do suggest  for it.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="#comment-423952" onclick='return addComment.moveForm( "comment-423952", "423952", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424044">
<div class="comment-container" id="li-comment-424044">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424044" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think it is a good place to start.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-424044" onclick='return addComment.moveForm( "comment-424044", "424044", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-424212">
<div class="comment-container" id="li-comment-424212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Etienne</span>
<span class="date">December 20, 2017 at 9:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, First thank you for your article. I’ve managed to set up a model with only 1 layer for the enoder and 1 layer for the decoder ( both LSTM) . I would like to train my model with more than 1 LSTM layer. </p>
<p>I have added 1 more LSTM to my decoder and set states for both of them with the encoder states. However when I want to predict a new sequence the ouput is very bad. Have you tried to add more than 1 LSTM with keras ?</p>
<div class="reply">
<a aria-label="Reply to Etienne" class="comment-reply-link" href="#comment-424212" onclick='return addComment.moveForm( "comment-424212", "424212", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-424215">
<div class="comment-container" id="li-comment-424215">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">December 20, 2017 at 9:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424215" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>why are you not adding more lstm layers to encoder,can i know reason.<br/>
Actually i am also trying for the issue,let me why are you not adding more lstm layers to encoder rather than decoder?</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="#comment-424215" onclick='return addComment.moveForm( "comment-424215", "424215", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-424228">
<div class="comment-container" id="li-comment-424228">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Etienne</span>
<span class="date">December 21, 2017 at 1:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424228" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I try to create sophisticated model I start with basic model and then i try to improve it.<br/>
Sure you can add 8 layers for the encoder and 8 for the decoder. But I prefer build it step by ste. I w’ll try to add layers for the encoder for sure but i don’t think that it will solve my problem… The training part is Ok with 2 lstm for the decoder but thr problem comes when i try to predict something with my inference model</p>
<div class="reply">
<a aria-label="Reply to Etienne" class="comment-reply-link" href="#comment-424228" onclick='return addComment.moveForm( "comment-424228", "424228", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-424290">
<div class="comment-container" id="li-comment-424290">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">December 21, 2017 at 3:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424290" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how can share code of 2 lstm layers ,how you have implemented,same i have tried with 3 lstm layers encoder, and 3 lstm layers with decoder.but while creating inference decoder model , i am getting shaping issue.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="#comment-424290" onclick='return addComment.moveForm( "comment-424290", "424290", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-424308">
<div class="comment-container" id="li-comment-424308">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">December 21, 2017 at 5:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424308" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how can share code of 2 lstm layers decoder,how you have implemented,same i have tried with 3 lstm layers encoder, and 3 lstm layers with decoder.but while creating inference decoder model , i am getting shaping issue.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-424249">
<div class="comment-container" id="li-comment-424249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I use a single layer for the encoder and decoder to keep things simple in the example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-424249" onclick='return addComment.moveForm( "comment-424249", "424249", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424248">
<div class="comment-container" id="li-comment-424248">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 5:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424248" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You will need to tune the model, perhaps longer training, a new batch size and other config changes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-424248" onclick='return addComment.moveForm( "comment-424248", "424248", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-434968">
<div class="comment-container" id="li-comment-434968">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dc355da5c96d6b02d03a191b2c59d63f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dc355da5c96d6b02d03a191b2c59d63f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Greg</span>
<span class="date">April 14, 2018 at 6:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434968" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How can I add more LSTM layers to the encoder and decoder? I’m having some trouble with the syntax.</p>
<div class="reply">
<a aria-label="Reply to Greg" class="comment-reply-link" href="#comment-434968" onclick='return addComment.moveForm( "comment-434968", "434968", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-434975">
<div class="comment-container" id="li-comment-434975">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 14, 2018 at 6:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434975" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post for a tutorial on how:<br/>
<a href="https://machinelearningmastery.com/stacked-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/stacked-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434975" onclick='return addComment.moveForm( "comment-434975", "434975", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-425515">
<div class="comment-container" id="li-comment-425515">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandin</span>
<span class="date">January 3, 2018 at 4:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-425515" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>given test case i need to generate a script file for it,i am able to generate results some how ok.<br/>
but i would to recognize in my test case what are the variables they has to be same in script file also,Please give any suggestion for it.</p>
<p>how to recognize variable as per the input.<br/>
ex: Define a integer variable a  : int a</p>
<p>Define a integer variable add : int add.</p>
<p>how model can recognize a and add variable in test case.<br/>
please do any suggestions for it.</p>
<div class="reply">
<a aria-label="Reply to nandin" class="comment-reply-link" href="#comment-425515" onclick='return addComment.moveForm( "comment-425515", "425515", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425568">
<div class="comment-container" id="li-comment-425568">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 8:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-425568" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow.</p>
<p>If you are having trouble defining your machine learning problem, maybe this post will help:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425568" onclick='return addComment.moveForm( "comment-425568", "425568", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426004">
<div class="comment-container" id="li-comment-426004">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">January 9, 2018 at 11:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426004" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>is it good approach to increase accuracy of encoder and decoder model to adding more lstm layers ?</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="#comment-426004" onclick='return addComment.moveForm( "comment-426004", "426004", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426064">
<div class="comment-container" id="li-comment-426064">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426064" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It can be, depends on the dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426064" onclick='return addComment.moveForm( "comment-426064", "426064", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426323">
<div class="comment-container" id="li-comment-426323">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/365e77129a1e4670f8cf335c30e7a544?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/365e77129a1e4670f8cf335c30e7a544?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hardik Khandelwal</span>
<span class="date">January 12, 2018 at 8:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426323" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the post. It’s really helpful.<br/>
Why are we using only 10,000 samples out of 150,000. Is it because of huge memory requirements or is there some other reason.</p>
<div class="reply">
<a aria-label="Reply to Hardik Khandelwal" class="comment-reply-link" href="#comment-426323" onclick='return addComment.moveForm( "comment-426323", "426323", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426366">
<div class="comment-container" id="li-comment-426366">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426366" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, because of the large space and time complexity.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426366" onclick='return addComment.moveForm( "comment-426366", "426366", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427987">
<div class="comment-container" id="li-comment-427987">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8075a9e94c8aede2405b213c1c02d8fe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8075a9e94c8aede2405b213c1c02d8fe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Soumil Mandal</span>
<span class="date">January 31, 2018 at 5:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-427987" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the tutorial, it was quite helpful. In <a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html" rel="nofollow">https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html</a> he does mention in FAQ sec how to change the code to convert it into a GRU seq2seq model, but he does not mention how to change the inference model accordingly, any help would be really appreciated, I’m stuck here for quite some time. Thanks again though.</p>
<div class="reply">
<a aria-label="Reply to Soumil Mandal" class="comment-reply-link" href="#comment-427987" onclick='return addComment.moveForm( "comment-427987", "427987", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-428073">
<div class="comment-container" id="li-comment-428073">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/969c836471cfffdce595c51104a5768b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/969c836471cfffdce595c51104a5768b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">huaiyanggongzi</span>
<span class="date">February 1, 2018 at 4:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-428073" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thanks for the tutorial. Can we extend this model to generic sequence instead of just language model. For instance, both input and output sequences are numerical sequences. Thanks for your insights.</p>
<div class="reply">
<a aria-label="Reply to huaiyanggongzi" class="comment-reply-link" href="#comment-428073" onclick='return addComment.moveForm( "comment-428073", "428073", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-428102">
<div class="comment-container" id="li-comment-428102">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 1, 2018 at 7:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-428102" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428102" onclick='return addComment.moveForm( "comment-428102", "428102", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-428558">
<div class="comment-container" id="li-comment-428558">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b419748f1ea39eeeacd8bfacbe2a3713?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b419748f1ea39eeeacd8bfacbe2a3713?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ajay Prasadh Viswanathan</span>
<span class="date">February 6, 2018 at 9:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-428558" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason, Thanks for an awesome article.<br/>
I was wondering why you were padding the input with a max number of characters as 16. I could not see where this particular number was explicitly referenced in the model again. So I suppose I could feed non padded input to this model and the sequence to sequence model would still work ? </p>
<p>Also if we are going to pad input and output to a finite length. Could have not used just a simple sequence classification architecture something like </p>
<p><code></code><code><br/>
inputs = Input(shape = (in_max_characters, in_char_vocab_size))</code></p>
<p>h1 = LSTM(128)(inputs)</p>
<p>outputs = TimeDistributed(Dense(output_char_vocab_size), input_shape = (out_max_characters, 128))<br/>
<code></code></p>
<p>My question is regarding the conceptual and practical necessity of padding in context of sequence to sequence models.</p>
<div class="reply">
<a aria-label="Reply to Ajay Prasadh Viswanathan" class="comment-reply-link" href="#comment-428558" onclick='return addComment.moveForm( "comment-428558", "428558", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-428563">
<div class="comment-container" id="li-comment-428563">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b419748f1ea39eeeacd8bfacbe2a3713?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b419748f1ea39eeeacd8bfacbe2a3713?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ajay Prasadh Viswanathan</span>
<span class="date">February 6, 2018 at 9:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-428563" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I forgot to add the repeat vector in my code earlier. Here is an updated version.<br/>
<code></code><code><br/>
inputs = Input(shape = (in_max_characters, in_char_vocab_size))<br/>
h1 = LSTM(128)(inputs)<br/>
h2 = RepeatVector(out_max_characters)(h1)<br/>
outputs = TimeDistributed(Dense(output_char_vocab_size), input_shape = (out_max_characters, 128))(h2)</code></p>
<p><code></code></p>
<div class="reply">
<a aria-label="Reply to Ajay Prasadh Viswanathan" class="comment-reply-link" href="#comment-428563" onclick='return addComment.moveForm( "comment-428563", "428563", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-428570">
<div class="comment-container" id="li-comment-428570">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 6, 2018 at 9:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-428570" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For this model, I believe padding is not required as it processes one time step at a time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428570" onclick='return addComment.moveForm( "comment-428570", "428570", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-430265">
<div class="comment-container" id="li-comment-430265">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7a0e5f5cb7a64b232f40947fcf55274e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7a0e5f5cb7a64b232f40947fcf55274e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">February 23, 2018 at 3:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-430265" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, Thank you so much for your explanation.</p>
<p>I would like to ask you about the model’s fit.  Do you give a matrix as dimension of (10000,16,71) and as output a matrix as dimension of (10000,59,93)?</p>
<p>In the case of sequence2sequence word based (as explained in the: <a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html" rel="nofollow">https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html</a>) they introduced an embedding layer.  With the embedding layer, how do I set the model to make it able to understand that a single word is a single time step? Do i have to set the embedding’s input_dim parameter to 1 that give an output of (?,1,vocab_size) ? Or can I set the embedding’s input_dim parameter to maxlen of the corpus sentences that give an output of (?,maxlen,vocab_size) ?</p>
<p>Thank you for your reply</p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="#comment-430265" onclick='return addComment.moveForm( "comment-430265", "430265", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430312">
<div class="comment-container" id="li-comment-430312">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 23, 2018 at 12:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-430312" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>With the embedding, your input will be a sequence of integers. The embedding will map integers to the high-dimensional vector.</p>
<p>Therefore, this post will help you with reshaping your sequences of integer inputs:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430312" onclick='return addComment.moveForm( "comment-430312", "430312", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-430446">
<div class="comment-container" id="li-comment-430446">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7a0e5f5cb7a64b232f40947fcf55274e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7a0e5f5cb7a64b232f40947fcf55274e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">February 25, 2018 at 6:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-430446" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, thank you.<br/>
But if i have the following code: </p>
<p>i1=Input(shape=(2,))<br/>
emb=Embedding(input_dim=1, output_dim= 10 , input_length=1(i1)  # tensor (num_sample, 2, 10)<br/>
lst=LSTM (16)(emb) # &lt;- is it necessary declare input_shape?</p>
<p>In this case is it necessary declare input_shape of LSTM? emb is a tensor 3D with number of example, time step and dimension of output.</p>
<p>Thank you so much for your time.</p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="#comment-430446" onclick='return addComment.moveForm( "comment-430446", "430446", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-430461">
<div class="comment-container" id="li-comment-430461">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 25, 2018 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-430461" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, the embedding will provide 3d input to the LSTM layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430461" onclick='return addComment.moveForm( "comment-430461", "430461", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-430432">
<div class="comment-container" id="li-comment-430432">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f17f18eba1512d01a8a14a1b56269ed7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f17f18eba1512d01a8a14a1b56269ed7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Saket Karve</span>
<span class="date">February 24, 2018 at 7:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-430432" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am using a sequence to sequence model to predict keyphrases from a given text article. I am using the exact same model as mentioned in this blog for this purpose. However, I am confused whether the weights which are trained for the model will be used while inference?</p>
<p>As per the example code on github, during inference, each character has to be predicted recursively. For this, the encoder_model.predict() is called to encode the input and decoder_model.predict() is called to predict the output. However, after saving the trained model, how do we make sure the trained weights are used in the encoder_model and the decoder_model while inference?</p>
<p>Actually, I am getting the same output irrespective of the input.</p>
<div class="reply">
<a aria-label="Reply to Saket Karve" class="comment-reply-link" href="#comment-430432" onclick='return addComment.moveForm( "comment-430432", "430432", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430457">
<div class="comment-container" id="li-comment-430457">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 25, 2018 at 7:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-430457" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps there is something going on with the saved model.</p>
<p>Perhaps try to get it working in memory with a small example, then try saving/loading and reproducing the result to ensure there are no faults.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430457" onclick='return addComment.moveForm( "comment-430457", "430457", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-431858">
<div class="comment-container" id="li-comment-431858">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5cb2004de9b835362386910ed8a3ee74?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5cb2004de9b835362386910ed8a3ee74?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shannon</span>
<span class="date">March 11, 2018 at 4:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-431858" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial. I want to create a sequence to sequence model for images. </p>
<p>Here is an example of my training set :</p>
<p>x1 x2 x3 y1 y2 y3, where x1 x2 and x3 are the input sequence of images and y1, y2, and y3 are the following sequence of images which I want to forecast.</p>
<p>My question is how do I represent x1 x2 and x3 as input to a neural network or to say Encoder-Decoder Sequence-to-Sequence Model?</p>
<div class="reply">
<a aria-label="Reply to Shannon" class="comment-reply-link" href="#comment-431858" onclick='return addComment.moveForm( "comment-431858", "431858", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-431887">
<div class="comment-container" id="li-comment-431887">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 12, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-431887" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That sounds like a challenging problem. Perhaps you can find examples of existing models that output an image that you can use for the output part of the model. The input could be a modified VGG or similar network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431887" onclick='return addComment.moveForm( "comment-431887", "431887", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-433054">
<div class="comment-container" id="li-comment-433054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c3bb5642f2ebf08362b7ea959bec88d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c3bb5642f2ebf08362b7ea959bec88d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zoe</span>
<span class="date">March 24, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-433054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you very much for sharing this great article, Jason.<br/>
I don’t understand the inference model. why do we need the inference model after we defined our encoder and decoder. Don’t we just need to define the inputs/outputs and structure of the encoder/decoder, train this model, and then use it to predict? Very confused now. Thank you for your help in advance.</p>
<div class="reply">
<a aria-label="Reply to Zoe" class="comment-reply-link" href="#comment-433054" onclick='return addComment.moveForm( "comment-433054", "433054", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-433072">
<div class="comment-container" id="li-comment-433072">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 24, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-433072" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here, we are using two very different models, one for learning and one for making predictions.</p>
<p>The separation is required given the need to correctly perform the encoding and decoding in Keras.</p>
<p>I’d recommend writing wrapper functions to train/save/load/predict with models in this form to hide the complexity.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433072" onclick='return addComment.moveForm( "comment-433072", "433072", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-434192">
<div class="comment-container" id="li-comment-434192">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/52ddf140a6bbc28b559d5084022883f9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/52ddf140a6bbc28b559d5084022883f9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Parul</span>
<span class="date">April 5, 2018 at 8:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434192" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How do I fit the model? In your vanilla lstm you had used </p>
<p>model.fit(trainX, trainY, epochs=30, batch_size=64, validation_data=(testX, testY), callbacks=[checkpoint], verbose=2)</p>
<p>What would be the equivalent for that in this model?</p>
<div class="reply">
<a aria-label="Reply to Parul" class="comment-reply-link" href="#comment-434192" onclick='return addComment.moveForm( "comment-434192", "434192", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434211">
<div class="comment-container" id="li-comment-434211">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 5, 2018 at 3:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434211" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is more complex, here’s an example:<br/>
<a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" rel="nofollow">https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434211" onclick='return addComment.moveForm( "comment-434211", "434211", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-434562">
<div class="comment-container" id="li-comment-434562">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3aead8598d5e05281427fafc4119a42a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3aead8598d5e05281427fafc4119a42a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.georgemihaila.com" rel="external nofollow">George M.</a></span>
<span class="date">April 10, 2018 at 1:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434562" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why is the decoder output ahead by one timestep?</p>
<div class="reply">
<a aria-label="Reply to George M." class="comment-reply-link" href="#comment-434562" onclick='return addComment.moveForm( "comment-434562", "434562", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434604">
<div class="comment-container" id="li-comment-434604">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 10, 2018 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434604" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you mean exactly George?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434604" onclick='return addComment.moveForm( "comment-434604", "434604", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-434619">
<div class="comment-container" id="li-comment-434619">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3aead8598d5e05281427fafc4119a42a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3aead8598d5e05281427fafc4119a42a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.georgemihaila.com" rel="external nofollow">George M.</a></span>
<span class="date">April 10, 2018 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434619" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr. Brownlee,</p>
<p>First of all, very great tutorial! I have all you articles bookmarked.</p>
<p>I went through the <a href="https://github.com/keras-team/keras/blob/master/examples/lstm_seq2seq.py" rel="nofollow">https://github.com/keras-team/keras/blob/master/examples/lstm_seq2seq.py</a><br/>
which has the same code you have here. At line 117 where they create the target values for the output of decoder it says it’s ahead of the decoder input by 1 timestep.<br/>
Why do you think that is?</p>
<p>Sorry, I wasn’t specific enough before.</p>
<div class="reply">
<a aria-label="Reply to George M." class="comment-reply-link" href="#comment-434619" onclick='return addComment.moveForm( "comment-434619", "434619", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434683">
<div class="comment-container" id="li-comment-434683">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 11, 2018 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434683" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t know, sorry George.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434683" onclick='return addComment.moveForm( "comment-434683", "434683", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-434717">
<div class="comment-container" id="li-comment-434717">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c1802f9f36d787aee8b30637dda17e9a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c1802f9f36d787aee8b30637dda17e9a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">midabomb</span>
<span class="date">April 11, 2018 at 2:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434717" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>In inference mode, we define an encoder_model:</p>
<p># Define sampling models<br/>
encoder_model = Model(encoder_inputs, encoder_states)</p>
<p>Then we use this model here:<br/>
states_value = encoder_model.predict(input_seq)</p>
<p>I am used to defining model, then compile and fit, before using it to predict. Here, we just define the model then predict. </p>
<p>Obviously, I am missing something. Could you elaborate a bit on what is going on here behind the scene?<br/>
Thanks,<br/>
-MDB</p>
<div class="reply">
<a aria-label="Reply to midabomb" class="comment-reply-link" href="#comment-434717" onclick='return addComment.moveForm( "comment-434717", "434717", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434731">
<div class="comment-container" id="li-comment-434731">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 11, 2018 at 4:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434731" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe compilation is only required for fitting the Keras model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434731" onclick='return addComment.moveForm( "comment-434731", "434731", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-434776">
<div class="comment-container" id="li-comment-434776">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c1802f9f36d787aee8b30637dda17e9a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c1802f9f36d787aee8b30637dda17e9a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">midabomb</span>
<span class="date">April 12, 2018 at 1:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434776" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Okay Thanks Jason.</p>
<p>In my example, there is no fitting. Where the weights for the predict is coming from Jason?<br/>
-MDB</p>
<div class="reply">
<a aria-label="Reply to midabomb" class="comment-reply-link" href="#comment-434776" onclick='return addComment.moveForm( "comment-434776", "434776", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-434810">
<div class="comment-container" id="li-comment-434810">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 12, 2018 at 8:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434810" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>From the fit model still in memory.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434810" onclick='return addComment.moveForm( "comment-434810", "434810", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-434830">
<div class="comment-container" id="li-comment-434830">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ebfcf0828649eb3b9173b2c6b9e00e1c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ebfcf0828649eb3b9173b2c6b9e00e1c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sukruthi</span>
<span class="date">April 12, 2018 at 5:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434830" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason. How can i save the model then use it another time from the model saved</p>
<div class="reply">
<a aria-label="Reply to Sukruthi" class="comment-reply-link" href="#comment-434830" onclick='return addComment.moveForm( "comment-434830", "434830", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-434979">
<div class="comment-container" id="li-comment-434979">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ba65bd3489c17b86aac27c91c49bce5a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ba65bd3489c17b86aac27c91c49bce5a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">changito</span>
<span class="date">April 14, 2018 at 7:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-434979" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here, the difference between a good post(Github) and an excellent post(this). Thank you amigo!</p>
<div class="reply">
<a aria-label="Reply to changito" class="comment-reply-link" href="#comment-434979" onclick='return addComment.moveForm( "comment-434979", "434979", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435032">
<div class="comment-container" id="li-comment-435032">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 15, 2018 at 6:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-435032" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435032" onclick='return addComment.moveForm( "comment-435032", "435032", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-435826">
<div class="comment-container" id="li-comment-435826">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c91ba5820c4d8f187656985a0e4f87d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c91ba5820c4d8f187656985a0e4f87d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mayur Jain</span>
<span class="date">April 24, 2018 at 11:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-435826" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the wonderful post.<br/>
I have this question that the, LSTM model used for Machine Translation, can be applied for dialogue generation ? </p>
<p>Please let me know if it can be done. If yes, what are major tweaks that needs to be done.</p>
<div class="reply">
<a aria-label="Reply to Mayur Jain" class="comment-reply-link" href="#comment-435826" onclick='return addComment.moveForm( "comment-435826", "435826", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435851">
<div class="comment-container" id="li-comment-435851">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 25, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-435851" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs can be used as generative models for language, see here for examples:<br/>
<a href="https://machinelearningmastery.com/?s=language+model&amp;post_type=post&amp;submit=Search" rel="nofollow">https://machinelearningmastery.com/?s=language+model&amp;post_type=post&amp;submit=Search</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435851" onclick='return addComment.moveForm( "comment-435851", "435851", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-435829">
<div class="comment-container" id="li-comment-435829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/38d9a180b0144d8f9c6fc467c6605fa1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/38d9a180b0144d8f9c6fc467c6605fa1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">bratt</span>
<span class="date">April 24, 2018 at 11:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-435829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, your blogs are really great and taught me much, thank you for your opensource work! </p>
<p>I made this code for a prediction, regression task but I want to understand the math behind it as well. Why I go first with return sequence false in this case and what are my activation functions ? they are not named and where do I know which is the default one ? Thank you in advance.</p>
<p>inputs = Input(shape=(timesteps, input_dim))<br/>
    encoded = LSTM(n_dimensions, return_sequences=False, name=”encoder”)(inputs)<br/>
    decoded = RepeatVector(timesteps)(encoded)<br/>
    decoded = LSTM(input_dim, return_sequences=True, name=’decoder’)(decoded)</p>
<p>    autoencoder = Model(inputs, decoded)<br/>
    encoder = Model(inputs, encoded)</p>
<div class="reply">
<a aria-label="Reply to bratt" class="comment-reply-link" href="#comment-435829" onclick='return addComment.moveForm( "comment-435829", "435829", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435854">
<div class="comment-container" id="li-comment-435854">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 25, 2018 at 6:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-435854" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs and the encoder-decoder are not suited for regression, unless you have a sequence of inputs and outputs.</p>
<p>You can learn more here:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435854" onclick='return addComment.moveForm( "comment-435854", "435854", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-435888">
<div class="comment-container" id="li-comment-435888">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/38d9a180b0144d8f9c6fc467c6605fa1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/38d9a180b0144d8f9c6fc467c6605fa1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">bratt</span>
<span class="date">April 25, 2018 at 5:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-435888" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>My inputs are sequences, 100 measurements with each containing 10.000 data points. The point that I do not understand is, which I type of activation function is build in in the model, also in your other link it is not mentioned what the function is ?</p>
<div class="reply">
<a aria-label="Reply to bratt" class="comment-reply-link" href="#comment-435888" onclick='return addComment.moveForm( "comment-435888", "435888", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-435956">
<div class="comment-container" id="li-comment-435956">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 26, 2018 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-435956" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps use the defaults first in order to evaluate model skill?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435956" onclick='return addComment.moveForm( "comment-435956", "435956", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-436035">
<div class="comment-container" id="li-comment-436035">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/38d9a180b0144d8f9c6fc467c6605fa1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/38d9a180b0144d8f9c6fc467c6605fa1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">bratt</span>
<span class="date">April 27, 2018 at 1:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-436035" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,  sorry for the missunderstanding, but you brought it on point. What are the default activation functions of the  encoding decoding layers ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-436062">
<div class="comment-container" id="li-comment-436062">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 27, 2018 at 6:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-436062" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can see here:<br/>
<a href="https://keras.io/layers/recurrent/#lstm" rel="nofollow">https://keras.io/layers/recurrent/#lstm</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-437227">
<div class="comment-container" id="li-comment-437227">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3833d21e11edf90b8ad96bf5d04f74b5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3833d21e11edf90b8ad96bf5d04f74b5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://polytechplc.com" rel="external nofollow">wende</a></span>
<span class="date">May 11, 2018 at 5:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-437227" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, how can i adopt it for bidirectional architecture? I keep getting an error on the decoder part<br/>
 ‘valueError: Dimensions must be equal, but are 256 and 512 for ‘lstm_2_1/MatMul_4’ (op: ‘MatMul’) with input shapes: [?,256], [512,512].</p>
<p>‘</p>
<div class="reply">
<a aria-label="Reply to wende" class="comment-reply-link" href="#comment-437227" onclick='return addComment.moveForm( "comment-437227", "437227", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-437284">
<div class="comment-container" id="li-comment-437284">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 12, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-437284" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is an example of creating bidirectional LSTMs:<br/>
<a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" rel="nofollow">https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437284" onclick='return addComment.moveForm( "comment-437284", "437284", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-437342">
<div class="comment-container" id="li-comment-437342">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3833d21e11edf90b8ad96bf5d04f74b5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3833d21e11edf90b8ad96bf5d04f74b5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://polytechplc.com" rel="external nofollow">wende</a></span>
<span class="date">May 12, 2018 at 7:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-437342" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, Jason.</p>
<div class="reply">
<a aria-label="Reply to wende" class="comment-reply-link" href="#comment-437342" onclick='return addComment.moveForm( "comment-437342", "437342", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-437375">
<div class="comment-container" id="li-comment-437375">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 13, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-437375" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No probs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437375" onclick='return addComment.moveForm( "comment-437375", "437375", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-438058">
<div class="comment-container" id="li-comment-438058">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/feec54e0cda1fe2be9ec69d91b6612cb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/feec54e0cda1fe2be9ec69d91b6612cb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">zishan</span>
<span class="date">May 20, 2018 at 10:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-438058" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, when I try to use this model I got an error with expecting 2 input arrays. I know it has something to do with this line model = Model([encoder_inputs, decoder_inputs], decoder_outputs) and decoder part. I have a target array which my model should encode and decode in the end. but how do I define the decoder_inputs in  model.fit(train, train….) ?</p>
<div class="reply">
<a aria-label="Reply to zishan" class="comment-reply-link" href="#comment-438058" onclick='return addComment.moveForm( "comment-438058", "438058", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-438097">
<div class="comment-container" id="li-comment-438097">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 21, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-438097" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Are you able to confirm that you copied all of the code exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438097" onclick='return addComment.moveForm( "comment-438097", "438097", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-439344">
<div class="comment-container" id="li-comment-439344">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5be296371d6a7f0097bcf88e88949b91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5be296371d6a7f0097bcf88e88949b91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">paul</span>
<span class="date">June 1, 2018 at 9:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-439344" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, i am really new to python and machine learning and have not an IT background, so I might ask not clear enough and would provide details later as necessary.  I know that you commented that it is not good for time series but I still want to see my results. How do I do use this encoder decoder model with a sliding window approach ? Could you give me like the steps or blocks how to proceed with that ? Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to paul" class="comment-reply-link" href="#comment-439344" onclick='return addComment.moveForm( "comment-439344", "439344", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-439379">
<div class="comment-container" id="li-comment-439379">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 1, 2018 at 2:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-439379" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>My best advice is here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/how-do-i-use-lstms-for-time-series-forecasting" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-do-i-use-lstms-for-time-series-forecasting</a></p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439379" onclick='return addComment.moveForm( "comment-439379", "439379", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-439775">
<div class="comment-container" id="li-comment-439775">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/09c65461dc99b8a71a3c647db51366a4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/09c65461dc99b8a71a3c647db51366a4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">didu</span>
<span class="date">June 4, 2018 at 9:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-439775" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am a bit confused since I am new to ML, is there a big difference in the two models you described here and on your post here <a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" rel="nofollow">https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/</a></p>
<div class="reply">
<a aria-label="Reply to didu" class="comment-reply-link" href="#comment-439775" onclick='return addComment.moveForm( "comment-439775", "439775", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-439832">
<div class="comment-container" id="li-comment-439832">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 5, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-439832" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the linked approach matches the definition of the method as described in the research papers.</p>
<p>The above approach is a simplification of the approach that is easier to implement and understand and gives similar performance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439832" onclick='return addComment.moveForm( "comment-439832", "439832", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-440299">
<div class="comment-container" id="li-comment-440299">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c3cb45b5c32c9970dc7f9796027249bb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c3cb45b5c32c9970dc7f9796027249bb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">duwa</span>
<span class="date">June 9, 2018 at 12:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-440299" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi sir,<br/>
i have followed your tutorial and everything working fine until i train model to the fullest. I have 8gb ram and another 8gb on swap. I can see the ram going to the fullest through hardware monitors. Is there any way to avoid memory issues, or train the model again and again for different dataset ? P.S- I’m newbie to this stuffs 🙂<br/>
===========================<br/>
Using TensorFlow backend.<br/>
English Vocabulary Size: 8773<br/>
English Max Length: 9<br/>
German Vocabulary Size: 15723<br/>
German Max Length: 17<br/>
Traceback (most recent call last):<br/>
  File “train_model.py”, line 85, in<br/>
    trainY = encode_output(trainY, eng_vocab_size)<br/>
  File “train_model.py”, line 48, in encode_output<br/>
    y = array(ylist)<br/>
MemoryError</p>
<div class="reply">
<a aria-label="Reply to duwa" class="comment-reply-link" href="#comment-440299" onclick='return addComment.moveForm( "comment-440299", "440299", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-440343">
<div class="comment-container" id="li-comment-440343">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 10, 2018 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-440343" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry to hear that.</p>
<p>Perhaps try running the example on EC2 with more RAM?<br/>
Perhaps try using progressive loading instead of loading all data into memory?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440343" onclick='return addComment.moveForm( "comment-440343", "440343", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-444263">
<div class="comment-container" id="li-comment-444263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7f1fe6e6a0e5b70163f658f6b5dd1e3e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7f1fe6e6a0e5b70163f658f6b5dd1e3e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihana</span>
<span class="date">July 24, 2018 at 8:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Json,</p>
<p>How we can see the score of model? I mean the precision, recall, … on train set?</p>
<div class="reply">
<a aria-label="Reply to Reihana" class="comment-reply-link" href="#comment-444263" onclick='return addComment.moveForm( "comment-444263", "444263", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444271">
<div class="comment-container" id="li-comment-444271">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 24, 2018 at 2:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444271" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, we use measures like BLEU or ROGUE to evaluate the performance of a NMT system.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444271" onclick='return addComment.moveForm( "comment-444271", "444271", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-444400">
<div class="comment-container" id="li-comment-444400">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/608662bde096398371c60daeccc6d443?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/608662bde096398371c60daeccc6d443?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">tom</span>
<span class="date">July 26, 2018 at 5:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444400" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I read your blogs and its really easy to follow. But one thing confused me I saw somewehre a model for seq2seq with a repeatvector. Could you please tell the difference ? are there any papers describing the model with the inference and the model with the repeatvector? thanks in advance.</p>
<div class="reply">
<a aria-label="Reply to tom" class="comment-reply-link" href="#comment-444400" onclick='return addComment.moveForm( "comment-444400", "444400", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444418">
<div class="comment-container" id="li-comment-444418">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 26, 2018 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444418" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is a simpler design where the output of each time step is conditional on the context vector only. The internal state of the encoder is not shared with the decoder. </p>
<p>Works just as well if not better and is a lot simpler to implement in Keras.</p>
<p>More here:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444418" onclick='return addComment.moveForm( "comment-444418", "444418", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-444824">
<div class="comment-container" id="li-comment-444824">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihana</span>
<span class="date">July 31, 2018 at 3:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444824" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks a lot for this beautiful tutorial.</p>
<p>I have a very huge problem with the logic behind the interface model.<br/>
Interface model is going to predict the label for the data that we don’t have label for it. am I correct?</p>
<p>So then, the the decode_sequence(input_seq):<br/>
we have this:<br/>
    # Generate empty target sequence of length 1.<br/>
    target_seq = np.zeros((1, 1, num_decoder_tokens))<br/>
    # Populate the first character of target sequence with the start character.<br/>
    target_seq[0, 0, target_token_index[‘\t’]] = 1.</p>
<p>the second input (the input of our decoder) is set to be [1, 0, 0, …, 0] here. Meaning a sequence of zeros. On the other hand, this input is impactful in predicting the target sequence.<br/>
How we could do that? I mean why we are setting the input decoder like this when we know that it is going to be used in predicting the output data.</p>
<p>For sure I was expecting that since this is a vector of zero, no matter what are the encoder_states, the model will underfit everything to zero which is doing that for me now!</p>
<div class="reply">
<a aria-label="Reply to Reihana" class="comment-reply-link" href="#comment-444824" onclick='return addComment.moveForm( "comment-444824", "444824", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444847">
<div class="comment-container" id="li-comment-444847">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 31, 2018 at 6:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444847" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try this much simpler approach:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444847" onclick='return addComment.moveForm( "comment-444847", "444847", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-444857">
<div class="comment-container" id="li-comment-444857">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11387f8dbbbf7cd60dfcb314b6aa39b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reihana</span>
<span class="date">July 31, 2018 at 8:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444857" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just noticed that the nature of Decoder is designed to decode one token at a time. Meaning that it is not taking a sequence of tokens and predict a sequence of tokens.<br/>
That being said, the decoder input is being used to keep track of each token being discovered at a timestep, and because of that it just have the starting point to predict the next token.</p>
<p>Got it!<br/>
Thanks Jason! your blog is my first recommendation to everyone!</p>
<div class="reply">
<a aria-label="Reply to Reihana" class="comment-reply-link" href="#comment-444857" onclick='return addComment.moveForm( "comment-444857", "444857", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-444886">
<div class="comment-container" id="li-comment-444886">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 31, 2018 at 2:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-444886" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444886" onclick='return addComment.moveForm( "comment-444886", "444886", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-445083">
<div class="comment-container" id="li-comment-445083">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a100022e07c513e52ed4b6873982c6f1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a100022e07c513e52ed4b6873982c6f1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Monika Jain</span>
<span class="date">August 2, 2018 at 11:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-445083" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I need a single encoder and three decoders branching out parallely out of it. Can somebody suggest how to code for that?</p>
<div class="reply">
<a aria-label="Reply to Monika Jain" class="comment-reply-link" href="#comment-445083" onclick='return addComment.moveForm( "comment-445083", "445083", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-445114">
<div class="comment-container" id="li-comment-445114">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2018 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-445114" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try a multi-output model:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445114" onclick='return addComment.moveForm( "comment-445114", "445114", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-445656">
<div class="comment-container" id="li-comment-445656">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/75961a223c0229e2ccc30f4ad83b6248?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/75961a223c0229e2ccc30f4ad83b6248?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">betsi</span>
<span class="date">August 9, 2018 at 12:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-445656" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>what is the meaning of the latent dim? How can I find this value to fit to my problem?</p>
<div class="reply">
<a aria-label="Reply to betsi" class="comment-reply-link" href="#comment-445656" onclick='return addComment.moveForm( "comment-445656", "445656", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-445660">
<div class="comment-container" id="li-comment-445660">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 9, 2018 at 2:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-445660" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try this simpler tutorial instead:<br/>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" rel="nofollow">https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445660" onclick='return addComment.moveForm( "comment-445660", "445660", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-445915">
<div class="comment-container" id="li-comment-445915">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/efb9d4767a0cadf8a3b785b479823bf7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/efb9d4767a0cadf8a3b785b479823bf7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Angel</span>
<span class="date">August 12, 2018 at 6:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-445915" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason 🙂<br/>
Really thanks a lot for the tutorial it’s very helpful</p>
<p>I’m still rather new to deep learning,…I have tried to train the model on the dataset, but I wonder how can I reload my saved model to test it on a new set of data?</p>
<div class="reply">
<a aria-label="Reply to Angel" class="comment-reply-link" href="#comment-445915" onclick='return addComment.moveForm( "comment-445915", "445915", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-445958">
<div class="comment-container" id="li-comment-445958">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 13, 2018 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-445958" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I give examples of saving and loading Keras models here:<br/>
<a href="https://machinelearningmastery.com/save-load-keras-deep-learning-models/" rel="nofollow">https://machinelearningmastery.com/save-load-keras-deep-learning-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445958" onclick='return addComment.moveForm( "comment-445958", "445958", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-446512">
<div class="comment-container" id="li-comment-446512">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dba26a8b72a9fe73e2c066a9950dbad6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dba26a8b72a9fe73e2c066a9950dbad6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Richa Ranjan</span>
<span class="date">August 20, 2018 at 8:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-446512" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One of the best tutorials I’ve seen for sequence2sequence!</p>
<p>Just one doubt, how are the inference models connected to the actual model that we trained? While making predictions, if I try to load a previously trained model, I get different results than at the time of training. Basically, I’m not clear on how the model, encoder_model and the decoder_model are linked?</p>
<p>This may be a repeated query, but I haven’t had any luck with the answers. Any help would be appreciated. Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Richa Ranjan" class="comment-reply-link" href="#comment-446512" onclick='return addComment.moveForm( "comment-446512", "446512", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-446520">
<div class="comment-container" id="li-comment-446520">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 20, 2018 at 2:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-446520" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>They are linked by using the same weights, but different interfaces to the data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446520" onclick='return addComment.moveForm( "comment-446520", "446520", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-447136">
<div class="comment-container" id="li-comment-447136">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ccac25358ff5f928f5a7c8c29ce771fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ccac25358ff5f928f5a7c8c29ce771fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vishwas</span>
<span class="date">August 28, 2018 at 8:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-447136" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Is there Back propogation taking place in Encoder?,If yes,then how loss function  is calculated as we dont have any target variables</p>
<div class="reply">
<a aria-label="Reply to Vishwas" class="comment-reply-link" href="#comment-447136" onclick='return addComment.moveForm( "comment-447136", "447136", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-447181">
<div class="comment-container" id="li-comment-447181">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2018 at 8:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-447181" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, we are backpropagating from the output to the decoder to the encoder.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447181" onclick='return addComment.moveForm( "comment-447181", "447181", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-447226">
<div class="comment-container" id="li-comment-447226">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ccac25358ff5f928f5a7c8c29ce771fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ccac25358ff5f928f5a7c8c29ce771fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vishwas</span>
<span class="date">August 29, 2018 at 3:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-447226" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,<br/>
Thanks for your quick response, But I had one more question.</p>
<p>In the encoder step will be creating a thought vector  for the given input sentence(incase of Machine Translation) and giving it to the Decoder. So during  backpropogation , In the encoder  we are not performing any prediction,So why do we need to update the weights?</p>
<p>*Hope  you could give a brief description on this ,As I was not able to find any material which explains Backprop in Seq2Seq model.*</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Vishwas" class="comment-reply-link" href="#comment-447226" onclick='return addComment.moveForm( "comment-447226", "447226", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-447267">
<div class="comment-container" id="li-comment-447267">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2018 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-447267" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Think of it as one large model, errors are propagated back as per any other neural net.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447267" onclick='return addComment.moveForm( "comment-447267", "447267", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-449594">
<div class="comment-container" id="li-comment-449594">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e57cae50be56e378d04f6f55787bc6f2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e57cae50be56e378d04f6f55787bc6f2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amel Musić</span>
<span class="date">September 23, 2018 at 5:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-449594" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
thank you for this great tutorial. Can you please share code for stacked layers for us. From what I can see, lot of us are struggling to stack decoder and encoder.</p>
<p>I’ve stacked encoder like this:<br/>
encoder_inputs = Input(shape=(None, num_encoder_tokens))<br/>
encoder_hidden = LSTM(latent_dim, return_state=True, return_sequences=True)(encoder_inputs)<br/>
encoder = LSTM(latent_dim, return_state=True)<br/>
encoder_outputs, state_h, state_c = encoder(encoder_hidden)</p>
<p>And decoder like this:<br/>
decoder_inputs = Input(shape=(None, num_decoder_tokens))<br/>
# We set up our decoder to return full output sequences,<br/>
# and to return internal states as well. We don’t use the<br/>
# return states in the training model, but we will use them in inference.</p>
<p>decoder_hidden = LSTM(latent_dim, return_sequences=True, return_state=True)(decoder_inputs,<br/>
                                     initial_state=encoder_states)</p>
<p>decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)<br/>
decoder_outputs, _, _ = decoder_lstm(decoder_hidden)</p>
<p>Problem is inference, model seems to be training but I’m getting weird results at inference time.</p>
<p>Can you please post how would you stack additional layer  during training and inference.<br/>
Thnx</p>
<div class="reply">
<a aria-label="Reply to Amel Musić" class="comment-reply-link" href="#comment-449594" onclick='return addComment.moveForm( "comment-449594", "449594", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-453955">
<div class="comment-container" id="li-comment-453955">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f9f255b0983b152899d27a67aaaa82d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f9f255b0983b152899d27a67aaaa82d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://amilaco2.blogspot.com/" rel="external nofollow">Amila Gunawardana</a></span>
<span class="date">November 7, 2018 at 1:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-453955" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m working on Seq2Sql (natural language to SQL) project and I want to detect specific words in a question</p>
<p>eg: what is the last name of Rick?</p>
<p>for this example, Rick should be detected as the required word.</p>
<p>SELECT last_name FROM student WHERE first_name=’Rick’ ; and also the Column name</p>
<p>eg: how old is leo?</p>
<p>for this example,leo should be detected as the required word.</p>
<p>How can I write a machine learning program to detect it in any question? Please help.<br/>
I have written from select column detection model and I’m stuck with where clause.</p>
<div class="reply">
<a aria-label="Reply to Amila Gunawardana" class="comment-reply-link" href="#comment-453955" onclick='return addComment.moveForm( "comment-453955", "453955", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-453972">
<div class="comment-container" id="li-comment-453972">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 7, 2018 at 2:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-453972" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You will need thousands or millions of examples of inputs and outputs to learn from.</p>
<p>Perhaps model the input and output at the word level?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453972" onclick='return addComment.moveForm( "comment-453972", "453972", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-457423">
<div class="comment-container" id="li-comment-457423">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">December 5, 2018 at 11:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-457423" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would like to store  and load these encoder and decoder model  another machine without training the input samples ,Directly i would like to give input samples for predictions ,it has to predict instantly ,</p>
<p>Kindly suggest on it .</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="#comment-457423" onclick='return addComment.moveForm( "comment-457423", "457423", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457489">
<div class="comment-container" id="li-comment-457489">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 6, 2018 at 5:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-457489" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post shows you how to save:<br/>
<a href="https://machinelearningmastery.com/save-load-keras-deep-learning-models/" rel="nofollow">https://machinelearningmastery.com/save-load-keras-deep-learning-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457489" onclick='return addComment.moveForm( "comment-457489", "457489", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-457584">
<div class="comment-container" id="li-comment-457584">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">December 6, 2018 at 6:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-457584" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>After loading model form  model.load(“model.h5”),still we have to compile the model or directly we can use it.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="#comment-457584" onclick='return addComment.moveForm( "comment-457584", "457584", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457698">
<div class="comment-container" id="li-comment-457698">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2018 at 5:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-457698" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe you no longer need to compile models after loading.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457698" onclick='return addComment.moveForm( "comment-457698", "457698", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4563"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="9c161145d8"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="220"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for NLP</strong><br/>
Develop deep learning models for text data.
<p><a href="/deep-learning-for-nlp/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>