<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras</title>
<link href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras" property="og:title"/>
<meta content="The encoder-decoder architecture for recurrent neural networks is proving to be powerful on a host of sequence-to-sequence prediction problems in the field of natural language processing such as machine translation and caption generation. Attention is a mechanism that addresses a limitation of the encoder-decoder architecture on long sequences, and that in general speeds up the …" property="og:description"/>
<meta content="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-10-16T18:00:48+00:00" property="article:published_time"/>
<meta content="2017-10-12T21:40:30+00:00" property="article:modified_time"/>
<meta content="2017-10-12T21:40:30+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-an-Encoder-Decoder-Model-with-Attention-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-an-Encoder-Decoder-Model-with-Attention-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="427" property="og:image:height"/>
<meta content="How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4549" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fencoder-decoder-attention-sequence-to-sequence-prediction-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fencoder-decoder-attention-sequence-to-sequence-prediction-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4549 single-format-standard safari alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Want help with LSTMs? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4549 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-10-17T05:00:48+1100">October 17, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4549 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+an+Encoder-Decoder+Model+with+Attention+for+Sequence-to-Sequence+Prediction+in+Keras&amp;url=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>The encoder-decoder architecture for recurrent neural networks is proving to be powerful on a host of sequence-to-sequence prediction problems in the field of natural language processing such as machine translation and caption generation.</p>
<p>Attention is a mechanism that addresses a limitation of the encoder-decoder architecture on long sequences, and that in general speeds up the learning and lifts the skill of the model no sequence to sequence prediction problems.</p>
<p>In this tutorial, you will discover how to develop an encoder-decoder recurrent neural network with attention in Python with Keras.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to design a small and configurable problem to evaluate encoder-decoder recurrent neural networks with and without attention.</li>
<li>How to design and evaluate an encoder-decoder network with and without attention for the sequence prediction problem.</li>
<li>How to robustly compare the performance of encoder-decoder networks with and without attention.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4550" style="width: 650px"><img alt="How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras" class="size-full wp-image-4550" height="427" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-an-Encoder-Decoder-Model-with-Attention-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-an-Encoder-Decoder-Model-with-Attention-for-Sequence-to-Sequence-Prediction-in-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-an-Encoder-Decoder-Model-with-Attention-for-Sequence-to-Sequence-Prediction-in-Keras-300x200.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras<br/>Photo by <a href="https://www.flickr.com/photos/150568953@N07/34585914155/">Angela and Andrew</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 6 parts; they are:</p>
<ol>
<li>Encoder-Decoder with Attention</li>
<li>Test Problem for Attention</li>
<li>Encoder-Decoder without Attention</li>
<li>Custom Keras Attention Layer</li>
<li>Encoder-Decoder with Attention</li>
<li>Comparison of Models</li>
</ol>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python 3 SciPy environment installed.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<h2>Encoder-Decoder with Attention</h2>
<p>The encoder-decoder model for recurrent neural networks is an architecture for sequence-to-sequence prediction problems.</p>
<p>It is comprised of two sub-models, as its name suggests:</p>
<ul>
<li><strong>Encoder</strong>: The encoder is responsible for stepping through the input time steps and encoding the entire sequence into a fixed length vector called a context vector.</li>
<li><strong>Decoder</strong>: The decoder is responsible for stepping through the output time steps while reading from the context vector.</li>
</ul>
<p>A problem with the architecture is that performance is poor on long input or output sequences. The reason is believed to be because of the fixed-sized internal representation used by the encoder.</p>
<p>Attention is an extension to the architecture that addresses this limitation. It works by first providing a richer context from the encoder to the decoder and a learning mechanism where the decoder can learn where to pay attention in the richer encoding when predicting each time step in the output sequence.</p>
<p>For more on attention in the encoder-decoder architecture, see the posts:</p>
<ul>
<li><a href="https://machinelearningmastery.com/attention-long-short-term-memory-recurrent-neural-networks/">Attention in Long Short-Term Memory Recurrent Neural Networks</a></li>
<li><a href="https://machinelearningmastery.com/how-does-attention-work-in-encoder-decoder-recurrent-neural-networks/">How Does Attention Work in Encoder-Decoder Recurrent Neural Networks</a></li>
</ul>
<h2>Test Problem for Attention</h2>
<p>Before we develop models with attention, we will first define a contrived scalable test problem that we can use to determine whether attention is providing any benefit.</p>
<p>In this problem, we will generate sequences of random integers as input and matching output sequences comprised of a subset of the integers in the input sequence.</p>
<p>For example, an input sequence might be [1, 6, 2, 7, 3] and the expected output sequence might be the first two random integers in the sequence [1, 6].</p>
<p>We will define the problem such that the input and output sequences are the same length and pad the output sequences with “0” values as needed.</p>
<p>First, we need a function to generate sequences of random integers. We will use the Python <a href="https://docs.python.org/3/library/random.html">randint()</a> function to generate random integers between 0 and a maximum value and use this range as the cardinality for the problem (e.g. the number of features or an axis of difficulty).</p>
<p>The function <em>generate_sequence()</em> below will generate a random sequence of integers to a fixed length and with the specified cardinality.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b0b623941270" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(0, n_unique-1) for _ in range(length)]

# generate random sequence
sequence = generate_sequence(5, 50)
print(sequence)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b0b623941270-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b0b623941270-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b0b623941270-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b0b623941270-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b0b623941270-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b0b623941270-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b0b623941270-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b0b623941270-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b0b623941270-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b0b623941270-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-v">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b0b623941270-2"> </div><div class="crayon-line" id="crayon-5c0ca7b263b0b623941270-3"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b0b623941270-4"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b0b623941270-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b0b623941270-6"> </div><div class="crayon-line" id="crayon-5c0ca7b263b0b623941270-7"><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b0b623941270-8"><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b0b623941270-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Running this example generates a sequence of 5 time steps where each value in the sequence is a random integer between 0 and 49.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b14012815634" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[43, 3, 28, 34, 33]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b14012815634-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b14012815634-1">[43, 3, 28, 34, 33]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Next, we need a function to <a href="https://machinelearningmastery.com/how-to-one-hot-encode-sequence-data-in-python/">one hot encode</a> the discrete integer values into binary vectors.</p>
<p>If a cardinality of 50 is used, then each integer will be represented by a 50-element vector of 0 values and 1 in the index of the specified integer value.</p>
<p>The <em>one_hot_encode()</em> function below will one hot encode a given sequence of integers.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b17413528709" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# one hot encode sequence
def one_hot_encode(sequence, n_unique):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b17413528709-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b17413528709-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b17413528709-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b17413528709-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b17413528709-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b17413528709-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b17413528709-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b17413528709-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b17413528709-1"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b17413528709-2"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b17413528709-3"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b17413528709-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b17413528709-5"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b17413528709-6"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7b263b17413528709-7"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b17413528709-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We also need to be able to decode an encoded sequence. This will be needed to turn a prediction from the model or an encoded expected sequence back into a sequence of integers we can read and evaluate.</p>
<p>The <em>one_hot_decode()</em> function below will decode a one hot encoded sequence back into a sequence of integers.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b18562098964" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b18562098964-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b18562098964-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b18562098964-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b18562098964-1"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b18562098964-2"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b18562098964-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can test out these operations in the example below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b1a140484940" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(0, n_unique-1) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# generate random sequence
sequence = generate_sequence(5, 50)
print(sequence)
# one hot encode
encoded = one_hot_encode(sequence, 50)
print(encoded)
# decode
decoded = one_hot_decode(encoded)
print(decoded)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1a140484940-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1a140484940-30">30</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-v">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-4"> </div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-5"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-6"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-8"> </div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-9"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-10"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-11"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-13"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-14"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-15"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-18"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-19"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-22"><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-23"><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-24"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-25"><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-26"><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-27"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-28"><span class="crayon-p"># decode</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1a140484940-29"><span class="crayon-v">decoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1a140484940-30"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">decoded</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Running the example first prints a randomly generated sequence, then the one hot encoded version, then finally the decoded sequence again.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b1c244810157" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[3, 18, 32, 11, 36]
[[0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0]]
[3, 18, 32, 11, 36]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b1c244810157-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1c244810157-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1c244810157-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1c244810157-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1c244810157-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1c244810157-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1c244810157-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b1c244810157-1">[3, 18, 32, 11, 36]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1c244810157-2">[[0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b1c244810157-3"> [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1c244810157-4"> [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b1c244810157-5"> [0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1c244810157-6"> [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0]]</div><div class="crayon-line" id="crayon-5c0ca7b263b1c244810157-7">[3, 18, 32, 11, 36]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Finally, we need a function that can create input and output pairs of sequences to train and evaluate a model.</p>
<p>The function below named <em>get_pair()</em> will return one input and output sequence pair given a specified input length, output length, and cardinality. Both input and output sequences are the same length, the length of the input sequence, but the output sequence will be taken as the first <em>n</em> characters of the input sequence and padded with zero values to the required length.</p>
<p>The sequences of integers are then encoded then reshaped into a 3D format required for the recurrent neural network, with the dimensions: <em>samples</em>, <em>time steps</em>, and <em>features</em>. In this case, samples is always 1 as we are only generating one input-output pair, the time steps is the input sequence length and features is the cardinality of each time step.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b1d051381418" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare data for the LSTM
def get_pair(n_in, n_out, n_unique):
	# generate random sequence
	sequence_in = generate_sequence(n_in, n_unique)
	sequence_out = sequence_in[:n_out] + [0 for _ in range(n_in-n_out)]
	# one hot encode
	X = one_hot_encode(sequence_in, n_unique)
	y = one_hot_encode(sequence_out, n_unique)
	# reshape as 3D
	X = X.reshape((1, X.shape[0], X.shape[1]))
	y = y.reshape((1, y.shape[0], y.shape[1]))
	return X,y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b1d051381418-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1d051381418-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1d051381418-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1d051381418-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1d051381418-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1d051381418-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1d051381418-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1d051381418-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1d051381418-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1d051381418-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1d051381418-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1d051381418-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b1d051381418-1"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1d051381418-2"><span class="crayon-e">def </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1d051381418-3"><span class="crayon-h"> </span><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1d051381418-4"><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1d051381418-5"><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-o">-</span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1d051381418-6"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1d051381418-7"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1d051381418-8"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1d051381418-9"><span class="crayon-h"> </span><span class="crayon-p"># reshape as 3D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1d051381418-10"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1d051381418-11"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1d051381418-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We can put this all together and demonstrate the data preparation code.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b1f821552831" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(0, n_unique-1) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# prepare data for the LSTM
def get_pair(n_in, n_out, n_unique):
	# generate random sequence
	sequence_in = generate_sequence(n_in, n_unique)
	sequence_out = sequence_in[:n_out] + [0 for _ in range(n_in-n_out)]
	# one hot encode
	X = one_hot_encode(sequence_in, n_unique)
	y = one_hot_encode(sequence_out, n_unique)
	# reshape as 3D
	X = X.reshape((1, X.shape[0], X.shape[1]))
	y = y.reshape((1, y.shape[0], y.shape[1]))
	return X,y

# generate random sequence
X, y = get_pair(5, 2, 50)
print(X.shape, y.shape)
print('X=%s, y=%s' % (one_hot_decode(X[0]), one_hot_decode(y[0])))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7b263b1f821552831-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b1f821552831-38">38</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-v">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-4"> </div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-5"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-6"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-8"> </div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-9"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-10"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-11"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-13"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-14"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-15"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-18"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-19"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-22"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-23"><span class="crayon-e">def </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-24"><span class="crayon-h"> </span><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-25"><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-26"><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-o">-</span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-27"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-28"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-29"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-30"><span class="crayon-h"> </span><span class="crayon-p"># reshape as 3D</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-31"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-32"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-34"> </div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-35"><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-36"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b1f821552831-37"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b1f821552831-38"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'X=%s, y=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>Running the example generates a single input-output pair and prints the shape of both arrays.</p>
<p>The generated pair is then printed in a decoded form where we can see that the first two integers of the sequence are reproduced in the output sequence followed by a padding of zero values.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b21394593905" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(1, 5, 50) (1, 5, 50)
X=[12, 20, 36, 40, 12], y=[12, 20, 0, 0, 0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b21394593905-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b21394593905-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b21394593905-1">(1, 5, 50) (1, 5, 50)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b21394593905-2">X=[12, 20, 36, 40, 12], y=[12, 20, 0, 0, 0]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Encoder-Decoder Without Attention</h2>
<p>In this section, we will develop a baseline in performance on the problem with an encoder-decoder model without attention.</p>
<p>We will fix the problem definition at input and output sequences of 5 time steps, the first 2 elements of the input sequence in the output sequence and a cardinality of 50.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b23476194503" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# configure problem
n_features = 50
n_timesteps_in = 5
n_timesteps_out = 2</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b23476194503-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b23476194503-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b23476194503-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b23476194503-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b23476194503-1"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b23476194503-2"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span></div><div class="crayon-line" id="crayon-5c0ca7b263b23476194503-3"><span class="crayon-v">n_timesteps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b23476194503-4"><span class="crayon-v">n_timesteps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can develop a simple encoder-decoder model in Keras by taking the output from an encoder LSTM model, repeating it n times for the number of timesteps in the output sequence, then using a decoder to predict the output sequence.</p>
<p>For more detail on how to define an encoder-decoder architecture in Keras, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/">Encoder-Decoder Long Short-Term Memory Networks</a></li>
</ul>
<p>We will configure the encoder and decoder with the same number of units, in this case 150. We will use the efficient Adam implementation of gradient descent and optimize the categorical cross entropy loss function, given that the problem is technically a multi-class classification problem.</p>
<p>The configuration for the model was found after a little trial and error and is by no means optimized.</p>
<p>The code for an encoder-decoder architecture in Keras is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b25056511897" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(LSTM(150, input_shape=(n_timesteps_in, n_features)))
model.add(RepeatVector(n_timesteps_in))
model.add(LSTM(150, return_sequences=True))
model.add(TimeDistributed(Dense(n_features, activation='softmax')))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b25056511897-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b25056511897-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b25056511897-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b25056511897-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b25056511897-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b25056511897-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b25056511897-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b25056511897-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b25056511897-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b25056511897-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b25056511897-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b25056511897-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b25056511897-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b25056511897-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We will train the model on 5,000 random input-output pairs of integer sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b27679798867" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train LSTM
for epoch in range(5000):
	# generate new random sequence
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	# fit model for one epoch on this sequence
	model.fit(X, y, epochs=1, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b27679798867-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b27679798867-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b27679798867-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b27679798867-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b27679798867-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b27679798867-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b27679798867-1"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b27679798867-2"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b27679798867-3"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b27679798867-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b27679798867-5"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b27679798867-6"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Once trained, we will evaluate the model on 100 new randomly generated integer sequences and only mark a prediction correct when the entire output sequence matches the expected value.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b28300216460" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate LSTM
total, correct = 100, 0
for _ in range(total):
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	yhat = model.predict(X, verbose=0)
	if array_equal(one_hot_decode(y[0]), one_hot_decode(yhat[0])):
		correct += 1
print('Accuracy: %.2f%%' % (float(correct)/float(total)*100.0))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b28300216460-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b28300216460-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b28300216460-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b28300216460-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b28300216460-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b28300216460-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b28300216460-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b28300216460-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b28300216460-1"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b28300216460-2"><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0ca7b263b28300216460-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b28300216460-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b28300216460-5"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b28300216460-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b28300216460-7"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b28300216460-8"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Finally, we will print 10 examples of expected output sequences and sequences predicted by the model.</p>
<p>Putting all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b2a776394775" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from numpy import array_equal
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import TimeDistributed
from keras.layers import RepeatVector

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(0, n_unique-1) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# prepare data for the LSTM
def get_pair(n_in, n_out, cardinality):
	# generate random sequence
	sequence_in = generate_sequence(n_in, cardinality)
	sequence_out = sequence_in[:n_out] + [0 for _ in range(n_in-n_out)]
	# one hot encode
	X = one_hot_encode(sequence_in, cardinality)
	y = one_hot_encode(sequence_out, cardinality)
	# reshape as 3D
	X = X.reshape((1, X.shape[0], X.shape[1]))
	y = y.reshape((1, y.shape[0], y.shape[1]))
	return X,y

# configure problem
n_features = 50
n_timesteps_in = 5
n_timesteps_out = 2
# define model
model = Sequential()
model.add(LSTM(150, input_shape=(n_timesteps_in, n_features)))
model.add(RepeatVector(n_timesteps_in))
model.add(LSTM(150, return_sequences=True))
model.add(TimeDistributed(Dense(n_features, activation='softmax')))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
# train LSTM
for epoch in range(5000):
	# generate new random sequence
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	# fit model for one epoch on this sequence
	model.fit(X, y, epochs=1, verbose=2)
# evaluate LSTM
total, correct = 100, 0
for _ in range(total):
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	yhat = model.predict(X, verbose=0)
	if array_equal(one_hot_decode(y[0]), one_hot_decode(yhat[0])):
		correct += 1
print('Accuracy: %.2f%%' % (float(correct)/float(total)*100.0))
# spot check some examples
for _ in range(10):
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	yhat = model.predict(X, verbose=0)
	print('Expected:', one_hot_decode(y[0]), 'Predicted', one_hot_decode(yhat[0]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-42">42</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-44">44</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-46">46</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-48">48</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-50">50</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-52">52</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-54">54</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-56">56</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-58">58</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-60">60</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-62">62</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-64">64</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-66">66</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-68">68</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2a776394775-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2a776394775-70">70</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">array_equal</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">RepeatVector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-10"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-11"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-12"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-14"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-15"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-16"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-17"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-18"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-19"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-20"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-21"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-22"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-23"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-24"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-25"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-27"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-28"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-29"><span class="crayon-e">def </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-30"><span class="crayon-h"> </span><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-31"><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-32"><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-o">-</span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-33"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-34"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-35"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-36"><span class="crayon-h"> </span><span class="crayon-p"># reshape as 3D</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-37"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-38"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-39"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-40"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-41"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-42"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-43"><span class="crayon-v">n_timesteps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-44"><span class="crayon-v">n_timesteps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-45"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-46"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-47"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-48"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-49"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-50"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-51"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-52"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-53"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-54"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-55"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-56"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-57"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-58"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-59"><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-60"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-61"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-62"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-63"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-64"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-65"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-66"><span class="crayon-p"># spot check some examples</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-67"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-68"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2a776394775-69"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2a776394775-70"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Predicted'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>Running this example will not take long, perhaps a few minutes on the CPU, no GPU is required.</p>
<p>The accuracy of the model was reported at just under 20%. Your results will vary given the <a href="https://machinelearningmastery.com/randomness-in-machine-learning/">stochastic nature of neural networks</a>; consider running the example a few times and taking the average.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b2c650781346" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Accuracy: 19.00%</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b2c650781346-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b2c650781346-1">Accuracy: 19.00%</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see from the sample outputs that the model does get one number in the output sequence correct for most or all cases, and only struggles with the second number. All zero padding values are predicted correctly.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b2d975222317" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Expected: [47, 0, 0, 0, 0] Predicted [47, 47, 0, 0, 0]
Expected: [43, 31, 0, 0, 0] Predicted [43, 31, 0, 0, 0]
Expected: [14, 22, 0, 0, 0] Predicted [14, 14, 0, 0, 0]
Expected: [39, 31, 0, 0, 0] Predicted [39, 39, 0, 0, 0]
Expected: [6, 4, 0, 0, 0] Predicted [6, 4, 0, 0, 0]
Expected: [47, 0, 0, 0, 0] Predicted [47, 47, 0, 0, 0]
Expected: [39, 33, 0, 0, 0] Predicted [39, 39, 0, 0, 0]
Expected: [23, 2, 0, 0, 0] Predicted [23, 23, 0, 0, 0]
Expected: [19, 28, 0, 0, 0] Predicted [19, 3, 0, 0, 0]
Expected: [32, 33, 0, 0, 0] Predicted [32, 32, 0, 0, 0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b2d975222317-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2d975222317-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2d975222317-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2d975222317-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2d975222317-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2d975222317-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2d975222317-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2d975222317-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2d975222317-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2d975222317-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b2d975222317-1">Expected: [47, 0, 0, 0, 0] Predicted [47, 47, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2d975222317-2">Expected: [43, 31, 0, 0, 0] Predicted [43, 31, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b2d975222317-3">Expected: [14, 22, 0, 0, 0] Predicted [14, 14, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2d975222317-4">Expected: [39, 31, 0, 0, 0] Predicted [39, 39, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b2d975222317-5">Expected: [6, 4, 0, 0, 0] Predicted [6, 4, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2d975222317-6">Expected: [47, 0, 0, 0, 0] Predicted [47, 47, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b2d975222317-7">Expected: [39, 33, 0, 0, 0] Predicted [39, 39, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2d975222317-8">Expected: [23, 2, 0, 0, 0] Predicted [23, 23, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b2d975222317-9">Expected: [19, 28, 0, 0, 0] Predicted [19, 3, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2d975222317-10">Expected: [32, 33, 0, 0, 0] Predicted [32, 32, 0, 0, 0]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Custom Keras Attention Layer</h2>
<p>Now we need to add attention to the encoder-decoder model.</p>
<p>At the time of writing, Keras does not have the capability of attention built into the library, but it is <a href="https://github.com/fchollet/keras/issues/7633">coming</a> <a href="https://github.com/fchollet/keras/pull/7980">soon</a>.</p>
<p>Until attention is officially available in Keras, we can either develop our own implementation or use an existing third-party implementation.</p>
<p>To speed things up, let’s use an existing third-party implementation.</p>
<p><a href="http://www.zafarali.me/">Zafarali Ahmed</a> an intern at <a href="https://www.datalogue.io/">Datalogue</a> developed a <a href="https://keras.io/layers/writing-your-own-keras-layers/">custom layer</a> for Keras that provides support for attention, presented in a post titled “<a href="https://medium.com/datalogue/attention-in-keras-1892773a4f22">How to Visualize Your Recurrent Neural Network with Attention in Keras</a>” in 2017 and GitHub project called “<a href="https://github.com/datalogue/keras-attention">keras-attention</a>“.</p>
<p>The custom attention layer is called <em>AttentionDecoder</em> and is available in the <a href="https://github.com/datalogue/keras-attention/blob/master/models/custom_recurrents.py">custom_recurrents.py</a> file in the GitHub project. We can reuse this code under the <a href="https://github.com/datalogue/keras-attention/blob/master/LICENSE">GNU Affero General Public License v3.0 license </a>of the project.</p>
<p>A copy of the custom layer is listed below for completeness. Copy it and paste it into a new and separate file in your current working directory called ‘<em>attention_decoder.py</em>‘.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b2f716755023" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import tensorflow as tf
from keras import backend as K
from keras import regularizers, constraints, initializers, activations
from keras.layers.recurrent import Recurrent, _time_distributed_dense
from keras.engine import InputSpec

tfPrint = lambda d, T: tf.Print(input_=T, data=[T, tf.shape(T)], message=d)

class AttentionDecoder(Recurrent):

    def __init__(self, units, output_dim,
                 activation='tanh',
                 return_probabilities=False,
                 name='AttentionDecoder',
                 kernel_initializer='glorot_uniform',
                 recurrent_initializer='orthogonal',
                 bias_initializer='zeros',
                 kernel_regularizer=None,
                 bias_regularizer=None,
                 activity_regularizer=None,
                 kernel_constraint=None,
                 bias_constraint=None,
                 **kwargs):
        """
        Implements an AttentionDecoder that takes in a sequence encoded by an
        encoder and outputs the decoded states
        :param units: dimension of the hidden state and the attention matrices
        :param output_dim: the number of labels in the output space

        references:
            Bahdanau, Dzmitry, Kyunghyun Cho, and Yoshua Bengio.
            "Neural machine translation by jointly learning to align and translate."
            arXiv preprint arXiv:1409.0473 (2014).
        """
        self.units = units
        self.output_dim = output_dim
        self.return_probabilities = return_probabilities
        self.activation = activations.get(activation)
        self.kernel_initializer = initializers.get(kernel_initializer)
        self.recurrent_initializer = initializers.get(recurrent_initializer)
        self.bias_initializer = initializers.get(bias_initializer)

        self.kernel_regularizer = regularizers.get(kernel_regularizer)
        self.recurrent_regularizer = regularizers.get(kernel_regularizer)
        self.bias_regularizer = regularizers.get(bias_regularizer)
        self.activity_regularizer = regularizers.get(activity_regularizer)

        self.kernel_constraint = constraints.get(kernel_constraint)
        self.recurrent_constraint = constraints.get(kernel_constraint)
        self.bias_constraint = constraints.get(bias_constraint)

        super(AttentionDecoder, self).__init__(**kwargs)
        self.name = name
        self.return_sequences = True  # must return sequences

    def build(self, input_shape):
        """
          See Appendix 2 of Bahdanau 2014, arXiv:1409.0473
          for model details that correspond to the matrices here.
        """

        self.batch_size, self.timesteps, self.input_dim = input_shape

        if self.stateful:
            super(AttentionDecoder, self).reset_states()

        self.states = [None, None]  # y, s

        """
            Matrices for creating the context vector
        """

        self.V_a = self.add_weight(shape=(self.units,),
                                   name='V_a',
                                   initializer=self.kernel_initializer,
                                   regularizer=self.kernel_regularizer,
                                   constraint=self.kernel_constraint)
        self.W_a = self.add_weight(shape=(self.units, self.units),
                                   name='W_a',
                                   initializer=self.kernel_initializer,
                                   regularizer=self.kernel_regularizer,
                                   constraint=self.kernel_constraint)
        self.U_a = self.add_weight(shape=(self.input_dim, self.units),
                                   name='U_a',
                                   initializer=self.kernel_initializer,
                                   regularizer=self.kernel_regularizer,
                                   constraint=self.kernel_constraint)
        self.b_a = self.add_weight(shape=(self.units,),
                                   name='b_a',
                                   initializer=self.bias_initializer,
                                   regularizer=self.bias_regularizer,
                                   constraint=self.bias_constraint)
        """
            Matrices for the r (reset) gate
        """
        self.C_r = self.add_weight(shape=(self.input_dim, self.units),
                                   name='C_r',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.U_r = self.add_weight(shape=(self.units, self.units),
                                   name='U_r',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.W_r = self.add_weight(shape=(self.output_dim, self.units),
                                   name='W_r',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.b_r = self.add_weight(shape=(self.units, ),
                                   name='b_r',
                                   initializer=self.bias_initializer,
                                   regularizer=self.bias_regularizer,
                                   constraint=self.bias_constraint)

        """
            Matrices for the z (update) gate
        """
        self.C_z = self.add_weight(shape=(self.input_dim, self.units),
                                   name='C_z',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.U_z = self.add_weight(shape=(self.units, self.units),
                                   name='U_z',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.W_z = self.add_weight(shape=(self.output_dim, self.units),
                                   name='W_z',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.b_z = self.add_weight(shape=(self.units, ),
                                   name='b_z',
                                   initializer=self.bias_initializer,
                                   regularizer=self.bias_regularizer,
                                   constraint=self.bias_constraint)
        """
            Matrices for the proposal
        """
        self.C_p = self.add_weight(shape=(self.input_dim, self.units),
                                   name='C_p',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.U_p = self.add_weight(shape=(self.units, self.units),
                                   name='U_p',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.W_p = self.add_weight(shape=(self.output_dim, self.units),
                                   name='W_p',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.b_p = self.add_weight(shape=(self.units, ),
                                   name='b_p',
                                   initializer=self.bias_initializer,
                                   regularizer=self.bias_regularizer,
                                   constraint=self.bias_constraint)
        """
            Matrices for making the final prediction vector
        """
        self.C_o = self.add_weight(shape=(self.input_dim, self.output_dim),
                                   name='C_o',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.U_o = self.add_weight(shape=(self.units, self.output_dim),
                                   name='U_o',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.W_o = self.add_weight(shape=(self.output_dim, self.output_dim),
                                   name='W_o',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)
        self.b_o = self.add_weight(shape=(self.output_dim, ),
                                   name='b_o',
                                   initializer=self.bias_initializer,
                                   regularizer=self.bias_regularizer,
                                   constraint=self.bias_constraint)

        # For creating the initial state:
        self.W_s = self.add_weight(shape=(self.input_dim, self.units),
                                   name='W_s',
                                   initializer=self.recurrent_initializer,
                                   regularizer=self.recurrent_regularizer,
                                   constraint=self.recurrent_constraint)

        self.input_spec = [
            InputSpec(shape=(self.batch_size, self.timesteps, self.input_dim))]
        self.built = True

    def call(self, x):
        # store the whole sequence so we can "attend" to it at each timestep
        self.x_seq = x

        # apply the a dense layer over the time dimension of the sequence
        # do it here because it doesn't depend on any previous steps
        # thefore we can save computation time:
        self._uxpb = _time_distributed_dense(self.x_seq, self.U_a, b=self.b_a,
                                             input_dim=self.input_dim,
                                             timesteps=self.timesteps,
                                             output_dim=self.units)

        return super(AttentionDecoder, self).call(x)

    def get_initial_state(self, inputs):
        # apply the matrix on the first time step to get the initial s0.
        s0 = activations.tanh(K.dot(inputs[:, 0], self.W_s))

        # from keras.layers.recurrent to initialize a vector of (batchsize,
        # output_dim)
        y0 = K.zeros_like(inputs)  # (samples, timesteps, input_dims)
        y0 = K.sum(y0, axis=(1, 2))  # (samples, )
        y0 = K.expand_dims(y0)  # (samples, 1)
        y0 = K.tile(y0, [1, self.output_dim])

        return [y0, s0]

    def step(self, x, states):

        ytm, stm = states

        # repeat the hidden state to the length of the sequence
        _stm = K.repeat(stm, self.timesteps)

        # now multiplty the weight matrix with the repeated hidden state
        _Wxstm = K.dot(_stm, self.W_a)

        # calculate the attention probabilities
        # this relates how much other timesteps contributed to this one.
        et = K.dot(activations.tanh(_Wxstm + self._uxpb),
                   K.expand_dims(self.V_a))
        at = K.exp(et)
        at_sum = K.sum(at, axis=1)
        at_sum_repeated = K.repeat(at_sum, self.timesteps)
        at /= at_sum_repeated  # vector of size (batchsize, timesteps, 1)

        # calculate the context vector
        context = K.squeeze(K.batch_dot(at, self.x_seq, axes=1), axis=1)
        # ~~~&gt; calculate new hidden state
        # first calculate the "r" gate:

        rt = activations.sigmoid(
            K.dot(ytm, self.W_r)
            + K.dot(stm, self.U_r)
            + K.dot(context, self.C_r)
            + self.b_r)

        # now calculate the "z" gate
        zt = activations.sigmoid(
            K.dot(ytm, self.W_z)
            + K.dot(stm, self.U_z)
            + K.dot(context, self.C_z)
            + self.b_z)

        # calculate the proposal hidden state:
        s_tp = activations.tanh(
            K.dot(ytm, self.W_p)
            + K.dot((rt * stm), self.U_p)
            + K.dot(context, self.C_p)
            + self.b_p)

        # new hidden state:
        st = (1-zt)*stm + zt * s_tp

        yt = activations.softmax(
            K.dot(ytm, self.W_o)
            + K.dot(stm, self.U_o)
            + K.dot(context, self.C_o)
            + self.b_o)

        if self.return_probabilities:
            return at, [yt, st]
        else:
            return yt, [yt, st]

    def compute_output_shape(self, input_shape):
        """
            For Keras internal compatability checking
        """
        if self.return_probabilities:
            return (None, self.timesteps, self.timesteps)
        else:
            return (None, self.timesteps, self.output_dim)

    def get_config(self):
        """
            For rebuilding models on load time.
        """
        config = {
            'output_dim': self.output_dim,
            'units': self.units,
            'return_probabilities': self.return_probabilities
        }
        base_config = super(AttentionDecoder, self).get_config()
        return dict(list(base_config.items()) + list(config.items()))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-42">42</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-44">44</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-46">46</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-48">48</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-50">50</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-52">52</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-54">54</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-56">56</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-58">58</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-60">60</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-62">62</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-64">64</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-66">66</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-68">68</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-70">70</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-72">72</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-74">74</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-76">76</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-78">78</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-80">80</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-82">82</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-84">84</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-86">86</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-88">88</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-90">90</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-92">92</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-94">94</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-96">96</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-98">98</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-100">100</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-102">102</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-104">104</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-106">106</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-108">108</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-110">110</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-112">112</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-114">114</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-116">116</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-118">118</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-120">120</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-122">122</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-124">124</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-126">126</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-128">128</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-130">130</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-132">132</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-134">134</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-136">136</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-138">138</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-140">140</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-142">142</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-144">144</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-146">146</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-148">148</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-150">150</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-152">152</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-154">154</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-156">156</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-158">158</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-160">160</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-162">162</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-164">164</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-166">166</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-168">168</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-170">170</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-172">172</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-174">174</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-176">176</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-178">178</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-180">180</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-182">182</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-183">183</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-184">184</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-185">185</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-186">186</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-187">187</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-188">188</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-189">189</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-190">190</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-191">191</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-192">192</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-193">193</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-194">194</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-195">195</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-196">196</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-197">197</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-198">198</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-199">199</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-200">200</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-201">201</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-202">202</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-203">203</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-204">204</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-205">205</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-206">206</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-207">207</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-208">208</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-209">209</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-210">210</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-211">211</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-212">212</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-213">213</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-214">214</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-215">215</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-216">216</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-217">217</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-218">218</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-219">219</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-220">220</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-221">221</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-222">222</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-223">223</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-224">224</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-225">225</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-226">226</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-227">227</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-228">228</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-229">229</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-230">230</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-231">231</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-232">232</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-233">233</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-234">234</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-235">235</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-236">236</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-237">237</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-238">238</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-239">239</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-240">240</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-241">241</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-242">242</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-243">243</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-244">244</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-245">245</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-246">246</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-247">247</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-248">248</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-249">249</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-250">250</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-251">251</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-252">252</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-253">253</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-254">254</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-255">255</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-256">256</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-257">257</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-258">258</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-259">259</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-260">260</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-261">261</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-262">262</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-263">263</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-264">264</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-265">265</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-266">266</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-267">267</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-268">268</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-269">269</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-270">270</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-271">271</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-272">272</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-273">273</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-274">274</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-275">275</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-276">276</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-277">277</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-278">278</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-279">279</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-280">280</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-281">281</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-282">282</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-283">283</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-284">284</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-285">285</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-286">286</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-287">287</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-288">288</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-289">289</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-290">290</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-291">291</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-292">292</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-293">293</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-294">294</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-295">295</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-296">296</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-297">297</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-298">298</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-299">299</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-300">300</div><div class="crayon-num" data-line="crayon-5c0ca7b263b2f716755023-301">301</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b2f716755023-302">302</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-1"><span class="crayon-e">import </span><span class="crayon-e">tensorflow </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">tf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-2"><span class="crayon-e">from </span><span class="crayon-e">keras </span><span class="crayon-e">import </span><span class="crayon-e">backend </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-i">K</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-3"><span class="crayon-e">from </span><span class="crayon-e">keras </span><span class="crayon-e">import </span><span class="crayon-v">regularizers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">constraints</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initializers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">activations</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">recurrent </span><span class="crayon-e">import </span><span class="crayon-v">Recurrent</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">_time_distributed_dense</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">engine </span><span class="crayon-e">import </span><span class="crayon-e">InputSpec</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-6"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-7"><span class="crayon-v">tfPrint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">lambda</span><span class="crayon-h"> </span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">T</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-e">Print</span><span class="crayon-sy">(</span><span class="crayon-v">input_</span><span class="crayon-o">=</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-e">shape</span><span class="crayon-sy">(</span><span class="crayon-v">T</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">message</span><span class="crayon-o">=</span><span class="crayon-v">d</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-8"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-9"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">AttentionDecoder</span><span class="crayon-sy">(</span><span class="crayon-v">Recurrent</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-10"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-11"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">output_dim</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-12"><span class="crayon-h">                 </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'tanh'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-13"><span class="crayon-h">                 </span><span class="crayon-v">return_probabilities</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-14"><span class="crayon-h">                 </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'AttentionDecoder'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-15"><span class="crayon-h">                 </span><span class="crayon-v">kernel_initializer</span><span class="crayon-o">=</span><span class="crayon-s">'glorot_uniform'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-16"><span class="crayon-h">                 </span><span class="crayon-v">recurrent_initializer</span><span class="crayon-o">=</span><span class="crayon-s">'orthogonal'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-17"><span class="crayon-h">                 </span><span class="crayon-v">bias_initializer</span><span class="crayon-o">=</span><span class="crayon-s">'zeros'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-18"><span class="crayon-h">                 </span><span class="crayon-v">kernel_regularizer</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-19"><span class="crayon-h">                 </span><span class="crayon-v">bias_regularizer</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-20"><span class="crayon-h">                 </span><span class="crayon-v">activity_regularizer</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-21"><span class="crayon-h">                 </span><span class="crayon-v">kernel_constraint</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-22"><span class="crayon-h">                 </span><span class="crayon-v">bias_constraint</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-23"><span class="crayon-h">                 </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-v">kwargs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-24"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-25"><span class="crayon-s">        Implements an AttentionDecoder that takes in a sequence encoded by an</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-26"><span class="crayon-s">        encoder and outputs the decoded states</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-27"><span class="crayon-s">        :param units: dimension of the hidden state and the attention matrices</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-28"><span class="crayon-s">        :param output_dim: the number of labels in the output space</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-30"><span class="crayon-s">        references:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-31"><span class="crayon-s">            Bahdanau, Dzmitry, Kyunghyun Cho, and Yoshua Bengio.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-32"><span class="crayon-s">            "</span><span class="crayon-e">Neural </span><span class="crayon-e">machine </span><span class="crayon-e">translation </span><span class="crayon-e">by </span><span class="crayon-e">jointly </span><span class="crayon-e">learning </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-e">align </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">translate</span><span class="crayon-sy">.</span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-33"><span class="crayon-s">            arXiv preprint arXiv:1409.0473 (2014).</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-34"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-35"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">units</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-36"><span class="crayon-e">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">output_dim</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-37"><span class="crayon-e">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">return_probabilities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">return_probabilities</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-38"><span class="crayon-e">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">activations</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">activation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-39"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_initializer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">initializers</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">kernel_initializer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-40"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">initializers</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-41"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_initializer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">initializers</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">bias_initializer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-42"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-43"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-44"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-45"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_regularizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">bias_regularizer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-46"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">activity_regularizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">activity_regularizer</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-47"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-48"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_constraint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">constraints</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">kernel_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-49"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">constraints</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">kernel_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-50"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_constraint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">constraints</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">bias_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-51"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-52"><span class="crayon-h">        </span><span class="crayon-r">super</span><span class="crayon-sy">(</span><span class="crayon-v">AttentionDecoder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-v">kwargs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-53"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">name</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-54"><span class="crayon-e">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">return_sequences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-h">  </span><span class="crayon-p"># must return sequences</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-55"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-56"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-57"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-58"><span class="crayon-s">          See Appendix 2 of Bahdanau 2014, arXiv:1409.0473</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-59"><span class="crayon-s">          for model details that correspond to the matrices here.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-60"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-61"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-62"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">input_shape</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-63"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-64"><span class="crayon-e">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">stateful</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-65"><span class="crayon-h">            </span><span class="crayon-r">super</span><span class="crayon-sy">(</span><span class="crayon-v">AttentionDecoder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-66"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-67"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">]</span><span class="crayon-h">  </span><span class="crayon-p"># y, s</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-68"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-69"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-70"><span class="crayon-s">            Matrices for creating the context vector</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-71"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-72"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-73"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">V_a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-74"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'V_a'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-75"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-76"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-77"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-78"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-79"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'W_a'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-80"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-81"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-82"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-83"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-84"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'U_a'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-85"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-86"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-87"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">kernel_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-88"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-89"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'b_a'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-90"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-91"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-92"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-93"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-94"><span class="crayon-s">            Matrices for the r (reset) gate</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-95"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-96"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-97"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'C_r'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-98"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-99"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-100"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-101"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-102"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'U_r'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-103"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-104"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-105"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-106"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-107"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'W_r'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-108"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-109"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-110"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-111"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-112"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'b_r'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-113"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-114"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-115"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-116"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-117"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-118"><span class="crayon-s">            Matrices for the z (update) gate</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-119"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-120"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-121"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'C_z'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-122"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-123"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-124"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-125"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-126"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'U_z'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-127"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-128"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-129"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-130"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-131"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'W_z'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-132"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-133"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-134"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-135"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-136"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'b_z'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-137"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-138"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-139"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-140"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-141"><span class="crayon-s">            Matrices for the proposal</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-142"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-143"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_p</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-144"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'C_p'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-145"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-146"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-147"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-148"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_p</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-149"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'U_p'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-150"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-151"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-152"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-153"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_p</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-154"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'W_p'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-155"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-156"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-157"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-158"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_p</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-159"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'b_p'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-160"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-161"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-162"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-163"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-164"><span class="crayon-s">            Matrices for making the final prediction vector</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-165"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-166"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_o</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-167"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'C_o'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-168"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-169"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-170"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-171"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_o</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-172"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'U_o'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-173"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-174"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-175"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-176"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_o</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-177"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'W_o'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-178"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-179"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-180"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-181"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_o</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-182"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'b_o'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-183"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-184"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-185"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bias_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-186"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-187"><span class="crayon-h">        </span><span class="crayon-p"># For creating the initial state:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-188"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_weight</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-189"><span class="crayon-h">                                   </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'W_s'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-190"><span class="crayon-h">                                   </span><span class="crayon-v">initializer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_initializer</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-191"><span class="crayon-h">                                   </span><span class="crayon-v">regularizer</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_regularizer</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-192"><span class="crayon-h">                                   </span><span class="crayon-v">constraint</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recurrent_constraint</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-193"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-194"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_spec</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-195"><span class="crayon-h">            </span><span class="crayon-e">InputSpec</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-196"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">built</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-197"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-198"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">call</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-199"><span class="crayon-h">        </span><span class="crayon-p"># store the whole sequence so we can "attend" to it at each timestep</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-200"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">x_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-201"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-202"><span class="crayon-h">        </span><span class="crayon-p"># apply the a dense layer over the time dimension of the sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-203"><span class="crayon-h">        </span><span class="crayon-p"># do it here because it doesn't depend on any previous steps</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-204"><span class="crayon-h">        </span><span class="crayon-p"># thefore we can save computation time:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-205"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">_uxpb</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_time_distributed_dense</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">x_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_a</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-206"><span class="crayon-h">                                             </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">input_dim</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-207"><span class="crayon-h">                                             </span><span class="crayon-v">timesteps</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-208"><span class="crayon-h">                                             </span><span class="crayon-v">output_dim</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-209"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-210"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">super</span><span class="crayon-sy">(</span><span class="crayon-v">AttentionDecoder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">call</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-211"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-212"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">get_initial_state</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-213"><span class="crayon-h">        </span><span class="crayon-p"># apply the matrix on the first time step to get the initial s0.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-214"><span class="crayon-h">        </span><span class="crayon-v">s0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">activations</span><span class="crayon-sy">.</span><span class="crayon-e">tanh</span><span class="crayon-sy">(</span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-215"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-216"><span class="crayon-h">        </span><span class="crayon-p"># from keras.layers.recurrent to initialize a vector of (batchsize,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-217"><span class="crayon-h">        </span><span class="crayon-p"># output_dim)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-218"><span class="crayon-h">        </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">zeros_like</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span><span class="crayon-h">  </span><span class="crayon-p"># (samples, timesteps, input_dims)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-219"><span class="crayon-h">        </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">y0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h">  </span><span class="crayon-p"># (samples, )</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-220"><span class="crayon-h">        </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">expand_dims</span><span class="crayon-sy">(</span><span class="crayon-v">y0</span><span class="crayon-sy">)</span><span class="crayon-h">  </span><span class="crayon-p"># (samples, 1)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-221"><span class="crayon-h">        </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">tile</span><span class="crayon-sy">(</span><span class="crayon-v">y0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-222"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-223"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">y0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-224"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-225"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">step</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">states</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-226"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-227"><span class="crayon-h">        </span><span class="crayon-v">ytm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">states</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-228"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-229"><span class="crayon-h">        </span><span class="crayon-p"># repeat the hidden state to the length of the sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-230"><span class="crayon-h">        </span><span class="crayon-v">_stm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">repeat</span><span class="crayon-sy">(</span><span class="crayon-v">stm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-231"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-232"><span class="crayon-h">        </span><span class="crayon-p"># now multiplty the weight matrix with the repeated hidden state</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-233"><span class="crayon-h">        </span><span class="crayon-v">_Wxstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">_stm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-234"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-235"><span class="crayon-h">        </span><span class="crayon-p"># calculate the attention probabilities</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-236"><span class="crayon-h">        </span><span class="crayon-p"># this relates how much other timesteps contributed to this one.</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-237"><span class="crayon-h">        </span><span class="crayon-v">et</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">activations</span><span class="crayon-sy">.</span><span class="crayon-e">tanh</span><span class="crayon-sy">(</span><span class="crayon-v">_Wxstm</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">_uxpb</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-238"><span class="crayon-h">                   </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">expand_dims</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">V_a</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-239"><span class="crayon-h">        </span><span class="crayon-v">at</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">exp</span><span class="crayon-sy">(</span><span class="crayon-v">et</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-240"><span class="crayon-h">        </span><span class="crayon-v">at_sum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">at</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-241"><span class="crayon-h">        </span><span class="crayon-v">at_sum_repeated</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">repeat</span><span class="crayon-sy">(</span><span class="crayon-v">at_sum</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-242"><span class="crayon-h">        </span><span class="crayon-v">at</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-v">at_sum_repeated</span><span class="crayon-h">  </span><span class="crayon-p"># vector of size (batchsize, timesteps, 1)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-243"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-244"><span class="crayon-h">        </span><span class="crayon-p"># calculate the context vector</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-245"><span class="crayon-h">        </span><span class="crayon-v">context</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">squeeze</span><span class="crayon-sy">(</span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">batch_dot</span><span class="crayon-sy">(</span><span class="crayon-v">at</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">x_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axes</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-246"><span class="crayon-h">        </span><span class="crayon-p"># ~~~&gt; calculate new hidden state</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-247"><span class="crayon-h">        </span><span class="crayon-p"># first calculate the "r" gate:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-248"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-249"><span class="crayon-h">        </span><span class="crayon-v">rt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">activations</span><span class="crayon-sy">.</span><span class="crayon-e">sigmoid</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-250"><span class="crayon-h">            </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">ytm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_r</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-251"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">stm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_r</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-252"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">context</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_r</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-253"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_r</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-254"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-255"><span class="crayon-h">        </span><span class="crayon-p"># now calculate the "z" gate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-256"><span class="crayon-h">        </span><span class="crayon-v">zt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">activations</span><span class="crayon-sy">.</span><span class="crayon-e">sigmoid</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-257"><span class="crayon-h">            </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">ytm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_z</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-258"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">stm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_z</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-259"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">context</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_z</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-260"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_z</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-261"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-262"><span class="crayon-h">        </span><span class="crayon-p"># calculate the proposal hidden state:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-263"><span class="crayon-h">        </span><span class="crayon-v">s_tp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">activations</span><span class="crayon-sy">.</span><span class="crayon-e">tanh</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-264"><span class="crayon-h">            </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">ytm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_p</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-265"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e ">rt *</span><span class="crayon-h"> </span><span class="crayon-v">stm</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_p</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-266"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">context</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_p</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-267"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_p</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-268"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-269"><span class="crayon-h">        </span><span class="crayon-p"># new hidden state:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-270"><span class="crayon-h">        </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">zt</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-v">stm</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">zt *</span><span class="crayon-h"> </span><span class="crayon-e">s_tp</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-271"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-272"><span class="crayon-e">        </span><span class="crayon-v">yt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">activations</span><span class="crayon-sy">.</span><span class="crayon-e">softmax</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-273"><span class="crayon-h">            </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">ytm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">W_o</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-274"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">stm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">U_o</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-275"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">context</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">C_o</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-276"><span class="crayon-h">            </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">b_o</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-277"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-278"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">return_probabilities</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-279"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">at</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">yt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">st</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-280"><span class="crayon-h">        </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-281"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">yt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">st</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-282"> </div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-283"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">compute_output_shape</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-284"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-285"><span class="crayon-s">            For Keras internal compatability checking</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-286"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-287"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">return_probabilities</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-288"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-289"><span class="crayon-h">        </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-290"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-291"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-292"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">get_config</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-293"><span class="crayon-h">        </span><span class="crayon-s">""</span><span class="crayon-s">"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-294"><span class="crayon-s">            For rebuilding models on load time.</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-295"><span class="crayon-s">        "</span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-296"><span class="crayon-h">        </span><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-297"><span class="crayon-h">            </span><span class="crayon-s">'output_dim'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">output_dim</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-298"><span class="crayon-h">            </span><span class="crayon-s">'units'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">units</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-299"><span class="crayon-h">            </span><span class="crayon-s">'return_probabilities'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">return</span><span class="crayon-sy">_</span>probabilities</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-300"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c0ca7b263b2f716755023-301"><span class="crayon-h">        </span><span class="crayon-v">base_config</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">super</span><span class="crayon-sy">(</span><span class="crayon-v">AttentionDecoder</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">get_config</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b2f716755023-302"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">base_config</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0151 seconds] -->
<p>We can make use of this custom layer in our projects by importing it as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b32479743897" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from attention_decoder import AttentionDecoder</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b32479743897-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b32479743897-1"><span class="crayon-e">from </span><span class="crayon-e">attention_decoder </span><span class="crayon-e">import </span><span class="crayon-v">AttentionDecoder</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The layer implements attention as described by Bahdanau, et al. in their paper “<a href="https://arxiv.org/abs/1409.0473">Neural Machine Translation by Jointly Learning to Align and Translate</a>.”</p>
<p>The code is explained well in the original post and linked to both the LSTM and attention equations.</p>
<p>A limitation of this implementation is that it must output sequences that are the same length as the input sequences, the specific limitation that the encoder-decoder architecture was designed to overcome.</p>
<p>Importantly, the new layer manages both the repeating of the decoding as performed by the second LSTM, as well as the softmax output for the model as was performed by the Dense output layer in the encoder-decoder model without attention. This greatly simplifies the code for the model.</p>
<p>It is important to note that the custom layer is built upon the <a href="https://github.com/fchollet/keras/blob/master/keras/legacy/layers.py#L762">Recurrent</a> layer in Keras, which, at the time of writing, is marked as legacy code, and presumably will be removed from the project at some point.</p>
<h2>Encoder-Decoder With Attention</h2>
<p>Now that we have an implementation of attention that we can use, we can develop an encoder-decoder model with attention for our contrived sequence prediction problem.</p>
<p>The model with the attention layer is defined below. We can see that the layer handles some of the machinery of the encoder-decoder model itself, making defining the model simpler.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b3b361193838" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(LSTM(150, input_shape=(n_timesteps_in, n_features), return_sequences=True))
model.add(AttentionDecoder(150, n_features))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b3b361193838-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3b361193838-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3b361193838-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3b361193838-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3b361193838-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b3b361193838-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3b361193838-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3b361193838-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3b361193838-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">AttentionDecoder</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3b361193838-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>That’s it. The rest of the example is the same.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b3d926511579" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from numpy import array_equal
from keras.models import Sequential
from keras.layers import LSTM
from attention_decoder import AttentionDecoder

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(0, n_unique-1) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# prepare data for the LSTM
def get_pair(n_in, n_out, cardinality):
	# generate random sequence
	sequence_in = generate_sequence(n_in, cardinality)
	sequence_out = sequence_in[:n_out] + [0 for _ in range(n_in-n_out)]
	# one hot encode
	X = one_hot_encode(sequence_in, cardinality)
	y = one_hot_encode(sequence_out, cardinality)
	# reshape as 3D
	X = X.reshape((1, X.shape[0], X.shape[1]))
	y = y.reshape((1, y.shape[0], y.shape[1]))
	return X,y

# configure problem
n_features = 50
n_timesteps_in = 5
n_timesteps_out = 2

# define model
model = Sequential()
model.add(LSTM(150, input_shape=(n_timesteps_in, n_features), return_sequences=True))
model.add(AttentionDecoder(150, n_features))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
# train LSTM
for epoch in range(5000):
	# generate new random sequence
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	# fit model for one epoch on this sequence
	model.fit(X, y, epochs=1, verbose=2)
# evaluate LSTM
total, correct = 100, 0
for _ in range(total):
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	yhat = model.predict(X, verbose=0)
	if array_equal(one_hot_decode(y[0]), one_hot_decode(yhat[0])):
		correct += 1
print('Accuracy: %.2f%%' % (float(correct)/float(total)*100.0))
# spot check some examples
for _ in range(10):
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
	yhat = model.predict(X, verbose=0)
	print('Expected:', one_hot_decode(y[0]), 'Predicted', one_hot_decode(yhat[0]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-42">42</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-44">44</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-46">46</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-48">48</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-50">50</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-52">52</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-54">54</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-56">56</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-58">58</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-60">60</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-62">62</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-64">64</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b3d926511579-66">66</div><div class="crayon-num" data-line="crayon-5c0ca7b263b3d926511579-67">67</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">array_equal</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-7"><span class="crayon-e">from </span><span class="crayon-e">attention_decoder </span><span class="crayon-e">import </span><span class="crayon-v">AttentionDecoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-8"> </div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-9"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-10"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-12"> </div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-13"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-14"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-15"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-16"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-17"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-18"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-19"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-22"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-23"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-24"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-25"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-26"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-27"><span class="crayon-e">def </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-28"><span class="crayon-h"> </span><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-29"><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-30"><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-o">-</span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-31"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-33"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-34"><span class="crayon-h"> </span><span class="crayon-p"># reshape as 3D</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-35"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-36"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-38"> </div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-39"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-40"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-41"><span class="crayon-v">n_timesteps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-42"><span class="crayon-v">n_timesteps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-43"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-44"><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-45"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-46"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-47"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">AttentionDecoder</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-48"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-49"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-50"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-51"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-52"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-53"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-55"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-56"><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-57"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-58"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-59"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-60"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-61"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-62"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-63"><span class="crayon-p"># spot check some examples</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-64"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-65"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b3d926511579-66"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b3d926511579-67"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Predicted'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>Running the example prints the skill of the model on 100 randomly generated input-output pairs. With the same resources and same amount of training, the model with attention performs much better.</p>
<p>Your results may vary given the stochastic nature of neural networks. Try running the example a few times.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b3f381758925" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Accuracy: 95.00%</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b3f381758925-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b3f381758925-1">Accuracy: 95.00%</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Spot-checking some sample outputs and predicted sequences, we can see very few errors, even in cases when there is a zero value in the first two elements.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b41482603896" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Expected: [48, 47, 0, 0, 0] Predicted [48, 47, 0, 0, 0]
Expected: [7, 46, 0, 0, 0] Predicted [7, 46, 0, 0, 0]
Expected: [32, 30, 0, 0, 0] Predicted [32, 2, 0, 0, 0]
Expected: [3, 25, 0, 0, 0] Predicted [3, 25, 0, 0, 0]
Expected: [45, 4, 0, 0, 0] Predicted [45, 4, 0, 0, 0]
Expected: [49, 9, 0, 0, 0] Predicted [49, 9, 0, 0, 0]
Expected: [22, 23, 0, 0, 0] Predicted [22, 23, 0, 0, 0]
Expected: [29, 36, 0, 0, 0] Predicted [29, 36, 0, 0, 0]
Expected: [0, 29, 0, 0, 0] Predicted [0, 29, 0, 0, 0]
Expected: [11, 26, 0, 0, 0] Predicted [11, 26, 0, 0, 0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b41482603896-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b41482603896-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b41482603896-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b41482603896-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b41482603896-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b41482603896-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b41482603896-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b41482603896-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b41482603896-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b41482603896-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b41482603896-1">Expected: [48, 47, 0, 0, 0] Predicted [48, 47, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b41482603896-2">Expected: [7, 46, 0, 0, 0] Predicted [7, 46, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b41482603896-3">Expected: [32, 30, 0, 0, 0] Predicted [32, 2, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b41482603896-4">Expected: [3, 25, 0, 0, 0] Predicted [3, 25, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b41482603896-5">Expected: [45, 4, 0, 0, 0] Predicted [45, 4, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b41482603896-6">Expected: [49, 9, 0, 0, 0] Predicted [49, 9, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b41482603896-7">Expected: [22, 23, 0, 0, 0] Predicted [22, 23, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b41482603896-8">Expected: [29, 36, 0, 0, 0] Predicted [29, 36, 0, 0, 0]</div><div class="crayon-line" id="crayon-5c0ca7b263b41482603896-9">Expected: [0, 29, 0, 0, 0] Predicted [0, 29, 0, 0, 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b41482603896-10">Expected: [11, 26, 0, 0, 0] Predicted [11, 26, 0, 0, 0]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Comparison of Models</h2>
<p>Although we are getting better results from the model with attention, the results were reported from a single run of each model.</p>
<p>In this case, we seek a more robust finding by repeating the evaluation of each model multiple times and reporting the average performance over those runs. For more information on this robust approach to evaluating neural network models, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/evaluate-skill-deep-learning-models/">How to Evaluate the Skill of Deep Learning Models</a></li>
</ul>
<p>We can define a function to create each type of model, as follows.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b43148432848" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define the encoder-decoder model
def baseline_model(n_timesteps_in, n_features):
	model = Sequential()
	model.add(LSTM(150, input_shape=(n_timesteps_in, n_features)))
	model.add(RepeatVector(n_timesteps_in))
	model.add(LSTM(150, return_sequences=True))
	model.add(TimeDistributed(Dense(n_features, activation='softmax')))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
	return model

# define the encoder-decoder with attention model
def attention_model(n_timesteps_in, n_features):
	model = Sequential()
	model.add(LSTM(150, input_shape=(n_timesteps_in, n_features), return_sequences=True))
	model.add(AttentionDecoder(150, n_features))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b43148432848-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b43148432848-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-1"><span class="crayon-p"># define the encoder-decoder model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-2"><span class="crayon-e">def </span><span class="crayon-e">baseline_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-6"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-8"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-10"> </div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-11"><span class="crayon-p"># define the encoder-decoder with attention model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-12"><span class="crayon-e">def </span><span class="crayon-e">attention_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">AttentionDecoder</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b43148432848-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b43148432848-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>We can then define a function to fit and evaluate the accuracy of a fit model and return the accuracy score.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b45642509700" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train and evaluate a model, return accuracy
def train_evaluate_model(model, n_timesteps_in, n_timesteps_out, n_features):
	# train LSTM
	for epoch in range(5000):
		# generate new random sequence
		X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
		# fit model for one epoch on this sequence
		model.fit(X, y, epochs=1, verbose=0)
	# evaluate LSTM
	total, correct = 100, 0
	for _ in range(total):
		X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
		yhat = model.predict(X, verbose=0)
		if array_equal(one_hot_decode(y[0]), one_hot_decode(yhat[0])):
			correct += 1
	return float(correct)/float(total)*100.0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b45642509700-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b45642509700-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-1"><span class="crayon-p"># train and evaluate a model, return accuracy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-2"><span class="crayon-e">def </span><span class="crayon-e">train_evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-3"><span class="crayon-h"> </span><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-5"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-6"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-7"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-8"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-9"><span class="crayon-h"> </span><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-10"><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-14"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b45642509700-15"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b45642509700-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Putting this together, we can repeat the process of creating, training, and evaluating each type of model multiple times and reporting the mean accuracy over the repeats. To keep running times down, we will repeat each model evaluation 10 times, although if you have the resources, you could increase this to 30 or 100 times.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b47764534206" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from numpy import array_equal
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import TimeDistributed
from keras.layers import RepeatVector
from attention_decoder import AttentionDecoder

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(0, n_unique-1) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# prepare data for the LSTM
def get_pair(n_in, n_out, cardinality):
	# generate random sequence
	sequence_in = generate_sequence(n_in, cardinality)
	sequence_out = sequence_in[:n_out] + [0 for _ in range(n_in-n_out)]
	# one hot encode
	X = one_hot_encode(sequence_in, cardinality)
	y = one_hot_encode(sequence_out, cardinality)
	# reshape as 3D
	X = X.reshape((1, X.shape[0], X.shape[1]))
	y = y.reshape((1, y.shape[0], y.shape[1]))
	return X,y

# define the encoder-decoder model
def baseline_model(n_timesteps_in, n_features):
	model = Sequential()
	model.add(LSTM(150, input_shape=(n_timesteps_in, n_features)))
	model.add(RepeatVector(n_timesteps_in))
	model.add(LSTM(150, return_sequences=True))
	model.add(TimeDistributed(Dense(n_features, activation='softmax')))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
	return model

# define the encoder-decoder with attention model
def attention_model(n_timesteps_in, n_features):
	model = Sequential()
	model.add(LSTM(150, input_shape=(n_timesteps_in, n_features), return_sequences=True))
	model.add(AttentionDecoder(150, n_features))
	model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
	return model

# train and evaluate a model, return accuracy
def train_evaluate_model(model, n_timesteps_in, n_timesteps_out, n_features):
	# train LSTM
	for epoch in range(5000):
		# generate new random sequence
		X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
		# fit model for one epoch on this sequence
		model.fit(X, y, epochs=1, verbose=0)
	# evaluate LSTM
	total, correct = 100, 0
	for _ in range(total):
		X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)
		yhat = model.predict(X, verbose=0)
		if array_equal(one_hot_decode(y[0]), one_hot_decode(yhat[0])):
			correct += 1
	return float(correct)/float(total)*100.0

# configure problem
n_features = 50
n_timesteps_in = 5
n_timesteps_out = 2
n_repeats = 10
# evaluate encoder-decoder model
print('Encoder-Decoder Model')
results = list()
for _ in range(n_repeats):
	model = baseline_model(n_timesteps_in, n_features)
	accuracy = train_evaluate_model(model, n_timesteps_in, n_timesteps_out, n_features)
	results.append(accuracy)
	print(accuracy)
print('Mean Accuracy: %.2f%%' % (sum(results)/float(n_repeats)))
# evaluate encoder-decoder with attention model
print('Encoder-Decoder With Attention Model')
results = list()
for _ in range(n_repeats):
	model = attention_model(n_timesteps_in, n_features)
	accuracy = train_evaluate_model(model, n_timesteps_in, n_timesteps_out, n_features)
	results.append(accuracy)
	print(accuracy)
print('Mean Accuracy: %.2f%%' % (sum(results)/float(n_repeats)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-42">42</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-44">44</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-46">46</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-48">48</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-50">50</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-52">52</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-54">54</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-56">56</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-58">58</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-60">60</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-62">62</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-64">64</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-66">66</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-68">68</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-70">70</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-72">72</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-74">74</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-76">76</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-78">78</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-80">80</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-82">82</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-84">84</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-86">86</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-88">88</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-90">90</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-92">92</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-94">94</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-96">96</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b47764534206-98">98</div><div class="crayon-num" data-line="crayon-5c0ca7b263b47764534206-99">99</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">array_equal</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">RepeatVector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-10"><span class="crayon-e">from </span><span class="crayon-e">attention_decoder </span><span class="crayon-e">import </span><span class="crayon-v">AttentionDecoder</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-12"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-13"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-16"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-17"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-18"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-19"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-20"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-21"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-22"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-24"> </div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-25"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-26"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-28"> </div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-29"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-30"><span class="crayon-e">def </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-31"><span class="crayon-h"> </span><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-32"><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-33"><span class="crayon-h"> </span><span class="crayon-v">sequence_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sequence_in</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-o">-</span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-34"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-35"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-36"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-37"><span class="crayon-h"> </span><span class="crayon-p"># reshape as 3D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-38"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-39"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-40"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-41"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-42"><span class="crayon-p"># define the encoder-decoder model</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-43"><span class="crayon-e">def </span><span class="crayon-e">baseline_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-44"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-45"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-46"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-47"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-48"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-49"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-50"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-51"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-52"><span class="crayon-p"># define the encoder-decoder with attention model</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-53"><span class="crayon-e">def </span><span class="crayon-e">attention_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-55"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-56"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">AttentionDecoder</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-57"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-58"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-59"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-60"><span class="crayon-p"># train and evaluate a model, return accuracy</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-61"><span class="crayon-e">def </span><span class="crayon-e">train_evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-62"><span class="crayon-h"> </span><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-63"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-64"><span class="crayon-h"> </span><span class="crayon-p"># generate new random sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-65"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-66"><span class="crayon-h"> </span><span class="crayon-p"># fit model for one epoch on this sequence</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-67"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-68"><span class="crayon-h"> </span><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-69"><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-70"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-71"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_pair</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-72"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-73"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-74"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-75"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-76"> </div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-77"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-78"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-79"><span class="crayon-v">n_timesteps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-80"><span class="crayon-v">n_timesteps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-81"><span class="crayon-v">n_repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-82"><span class="crayon-p"># evaluate encoder-decoder model</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-83"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Encoder-Decoder Model'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-84"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-85"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-86"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">baseline_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-87"><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-88"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">accuracy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-89"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">accuracy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-90"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Mean Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-91"><span class="crayon-p"># evaluate encoder-decoder with attention model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-92"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Encoder-Decoder With Attention Model'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-93"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-94"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-95"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">attention_model</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-96"><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_timesteps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-97"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">accuracy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b47764534206-98"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">accuracy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b263b47764534206-99"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Mean Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0054 seconds] -->
<p>Running this example prints the accuracy for each model repeat to give you an idea of the progress of the run.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b263b49147799650" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Encoder-Decoder Model
20.0
23.0
23.0
18.0
28.000000000000004
28.999999999999996
23.0
26.0
21.0
20.0
Mean Accuracy: 23.10%

Encoder-Decoder With Attention Model
98.0
91.0
94.0
93.0
96.0
99.0
97.0
94.0
99.0
96.0
Mean Accuracy: 95.70%</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b263b49147799650-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b263b49147799650-25">25</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-1">Encoder-Decoder Model</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-2">20.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-3">23.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-4">23.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-5">18.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-6">28.000000000000004</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-7">28.999999999999996</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-8">23.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-9">26.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-10">21.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-11">20.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-12">Mean Accuracy: 23.10%</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-14">Encoder-Decoder With Attention Model</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-15">98.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-16">91.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-17">94.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-18">93.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-19">96.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-20">99.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-21">97.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-22">94.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-23">99.0</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b263b49147799650-24">96.0</div><div class="crayon-line" id="crayon-5c0ca7b263b49147799650-25">Mean Accuracy: 95.70%</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that even averaged over 10 runs, the attention model still shows better performance than the encoder-decoder model without attention, 23.10% vs 95.70%.</p>
<p>A good extension to this evaluation would be to capture the model loss each epoch for each model, take the average, and compare how the loss changes over time for the architecture with and without attention. I expect that this trace would show attention achieving better skill much faster and sooner than the non-attentional model, further highlighting the benefit of the approach.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://machinelearningmastery.com/attention-long-short-term-memory-recurrent-neural-networks/">Attention in Long Short-Term Memory Recurrent Neural Networks</a></li>
<li><a href="https://machinelearningmastery.com/how-does-attention-work-in-encoder-decoder-recurrent-neural-networks/">How Does Attention Work in Encoder-Decoder Recurrent Neural Networks</a></li>
<li><a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/">Encoder-Decoder Long Short-Term Memory Networks</a></li>
<li><a href="https://machinelearningmastery.com/evaluate-skill-deep-learning-models/">How to Evaluate the Skill of Deep Learning Models</a></li>
<li><a href="https://medium.com/datalogue/attention-in-keras-1892773a4f22">How to Visualize Your Recurrent Neural Network with Attention in Keras</a>, 2017.</li>
<li><a href="https://github.com/datalogue/keras-attention">keras-attention GitHub Project</a></li>
<li><a href="https://github.com/datalogue/keras-attention">Neural Machine Translation by Jointly Learning to Align and Translate</a>, 2015.</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop an encoder-decoder recurrent neural network with attention in Python with Keras.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to design a small and configurable problem to evaluate encoder-decoder recurrent neural networks with and without attention.</li>
<li>How to design and evaluate an encoder-decoder network with and without attention for the sequence prediction problem.</li>
<li>How to robustly compare the performance of encoder-decoder networks with and without attention.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4549 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+an+Encoder-Decoder+Model+with+Attention+for+Sequence-to-Sequence+Prediction+in+Keras&amp;url=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/prepare-movie-review-data-sentiment-analysis/" rel="prev"><i class="fa fa-angle-left"></i> How to Prepare Movie Review Data for Sentiment Analysis</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/clean-text-machine-learning-python/" rel="next">How to Clean Text for Machine Learning with Python <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">139 Responses to <em>How to Develop an Encoder-Decoder Model with Attention for Sequence-to-Sequence Prediction in Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-416988">
<div class="comment-container" id="li-comment-416988">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5f1923a192f166cd4dba85f49d136a15?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5f1923a192f166cd4dba85f49d136a15?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chetan</span>
<span class="date">October 17, 2017 at 6:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-416988" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The timing of this post couldn’t have been more accurate. I’ve spent hours and days on google looking for a reliable Keras implementation of attention. Can’t wait to test this on my specific problem definition. Thanks a ton Jason!</p>
<div class="reply">
<a aria-label="Reply to Chetan" class="comment-reply-link" href="#comment-416988" onclick='return addComment.moveForm( "comment-416988", "416988", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417014">
<div class="comment-container" id="li-comment-417014">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 17, 2017 at 4:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417014" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that Chetan!</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417014" onclick='return addComment.moveForm( "comment-417014", "417014", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417039">
<div class="comment-container" id="li-comment-417039">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a5165801397d5e04c68e8361e15b0699?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a5165801397d5e04c68e8361e15b0699?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ChrisJew</span>
<span class="date">October 17, 2017 at 10:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417039" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>test soft</p>
<div class="reply">
<a aria-label="Reply to ChrisJew" class="comment-reply-link" href="#comment-417039" onclick='return addComment.moveForm( "comment-417039", "417039", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417060">
<div class="comment-container" id="li-comment-417060">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 18, 2017 at 5:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417060" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your test worked.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417060" onclick='return addComment.moveForm( "comment-417060", "417060", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417120">
<div class="comment-container" id="li-comment-417120">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ba198a1f6dc86d11c5fe930dd5bda71?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ba198a1f6dc86d11c5fe930dd5bda71?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mateo</span>
<span class="date">October 18, 2017 at 11:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417120" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for this post! </p>
<p>Unfortunately the kernel crashes on my laptop! I don’t know why (no RAM issues)<br/>
I use Keras==2.0.8 and TF==1.3.0</p>
<div class="reply">
<a aria-label="Reply to Mateo" class="comment-reply-link" href="#comment-417120" onclick='return addComment.moveForm( "comment-417120", "417120", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417141">
<div class="comment-container" id="li-comment-417141">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 19, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417141" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ouch. Perhaps there is something up with your environment.</p>
<p>This post might help if you need to set things up from scratch:<br/>
<a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" rel="nofollow">http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417141" onclick='return addComment.moveForm( "comment-417141", "417141", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417270">
<div class="comment-container" id="li-comment-417270">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ravi Annaswamy</span>
<span class="date">October 20, 2017 at 7:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417270" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, very nice tutorial on probably the most important and most powerful neural application architecture (seq2seq with attention – since it is equivalent to a self programming turing machine – it sees an input stream of symbols, then can move back and forth using attention and write out a stream of symbols).</p>
<p>In fact theoretically it is super-turing, because it works with continuous (real) representation instead of Turing symbolic notation. google ‘recurrent networks super turing’ for proofs.</p>
<p>I am looking forward to attention being integrated into Keras and your revised code later, but no one can match your ability to setup the problem, generate data, explain step by step.. Keep up the great work.</p>
<p>Ravi Annaswamy</p>
<div class="reply">
<a aria-label="Reply to Ravi Annaswamy" class="comment-reply-link" href="#comment-417270" onclick='return addComment.moveForm( "comment-417270", "417270", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417326">
<div class="comment-container" id="li-comment-417326">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417326" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Ravi, I really appreciate your support! You made my day 🙂</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417326" onclick='return addComment.moveForm( "comment-417326", "417326", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417274">
<div class="comment-container" id="li-comment-417274">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ravi Annaswamy</span>
<span class="date">October 20, 2017 at 8:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417274" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, I think in order to show the power of sequence mapping, we need to try two things:<br/>
1. The input sequence should be of variable length (not always 5). For example you can make it a length of 10 max, but it should generate sequences of any length between say 4 to 10 (remaining zeros).<br/>
2. The output should not be just zeroing of values, but more complex output for example, the first and last non zero value of the sequence…</p>
<div class="reply">
<a aria-label="Reply to Ravi Annaswamy" class="comment-reply-link" href="#comment-417274" onclick='return addComment.moveForm( "comment-417274", "417274", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-417275">
<div class="comment-container" id="li-comment-417275">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ravi Annaswamy</span>
<span class="date">October 20, 2017 at 8:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417275" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>something like the example built here:<br/>
<a href="https://talbaumel.github.io/attention/" rel="nofollow">https://talbaumel.github.io/attention/</a></p>
<div class="reply">
<a aria-label="Reply to Ravi Annaswamy" class="comment-reply-link" href="#comment-417275" onclick='return addComment.moveForm( "comment-417275", "417275", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-417279">
<div class="comment-container" id="li-comment-417279">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ravi Annaswamy</span>
<span class="date">October 20, 2017 at 9:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417279" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am working on a modification of your excellent code, to illustrate this extended task, will post shortly.</p>
<div class="reply">
<a aria-label="Reply to Ravi Annaswamy" class="comment-reply-link" href="#comment-417279" onclick='return addComment.moveForm( "comment-417279", "417279", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417331">
<div class="comment-container" id="li-comment-417331">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417331" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you could easily modify the above example to achieve these requirements.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417331" onclick='return addComment.moveForm( "comment-417331", "417331", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417282">
<div class="comment-container" id="li-comment-417282">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ravi Annaswamy</span>
<span class="date">October 20, 2017 at 10:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417282" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr.Jason,</p>
<p>You have done an excellent application and framework code.</p>
<p>I wanted to expose the great value of this architecture and modularity of<br/>
this code by attempting a harder problem. Harder in two ways:</p>
<p>First we want to make the input sequence variable length from example to example.</p>
<p>Second, we want the output to be one that requires attention and long term memory,<br/>
 across the length!</p>
<p>So we come up with this task:</p>
<p>Given a input sequence which is variable length with zero padding…<br/>
[6, 8, 7, 2, 2, 6, 6, 4, 0, 0]<br/>
I wanted the network to pick out and output the first and last non-zero of the series<br/>
[6, 4, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<p>To make it even more interesting task for memory, we want it to output<br/>
the two numbers in reverse order:</p>
<p>input:<br/>
[6, 8, 7, 2, 2, 6, 6, 4, 0, 0]<br/>
output<br/>
[4, 6, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<p>This would require that the algorithm figure out that we are selecting the first and last of the sequence,<br/>
and then writing out them in reverse order! It really needs some kind of a turing machine that can<br/>
go back and forth on the sequence and decide when to write what! Can the seq2seq with attention LSTM do this?<br/>
Let us try out.</p>
<p>Here are few more training cases created:<br/>
[5, 5, 3, 3, 2, 0, 0, 0, 0, 0] [2, 5, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[4, 7, 7, 4, 3, 9, 0, 0, 0, 0] [9, 4, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[2, 6, 7, 6, 5, 0, 0, 0, 0, 0] [5, 2, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[9, 8, 2, 8, 8, 7, 9, 1, 5, 0] [5, 9, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<p>I made the following changes to your excellent code to make this possible:</p>
<p>1. In order to use 0 as the padding character, we make the unique letters from 1 to n_unique.</p>
<p># generate a sequence of random integers<br/>
def generate_sequence(length, n_unique):<br/>
	return [randint(0, n_unique-2)+1 for _ in range(length)]</p>
<p>I think in your original code also you should adopt the above mechanism so that 0 is reserved as padding<br/>
symbol and generated sequence only contains 1 to n_unique. I think this will increase accuracy to 100% in your tests too.</p>
<p>2. In order to simplify the domain, for faster training, I restricted the range of values:</p>
<p>n_features = 8<br/>
n_timesteps_in = 10<br/>
n_timesteps_out = 2</p>
<p>That is the input has a max of 10 positions but anywhere between 4 to 9 of these could be nonzero sequence, as shown below.<br/>
The input only uses an alphabet of 8 numbers instead of the 50 you used.</p>
<p>3. Correspondingly the get_pair was modified to generate the series above:</p>
<p># prepare data for the LSTM<br/>
def get_pair(n_in, n_out, cardinality, verbose=False): # edited this to add verbose flag<br/>
	# generate random sequence<br/>
	sequence_in = generate_sequence(n_in, cardinality)<br/>
	real_length = randint(4,n_in-1) # i added this<br/>
	sequence_in = sequence_in[:real_length] + [0 for _ in range(n_in-real_length)] # i added this<br/>
	sequence_out = [sequence_in[real_length-1]]+[sequence_in[0]] + [0 for _ in range(n_in-2)] # i edited this<br/>
	if verbose:  # added this for testing<br/>
		print(sequence_in,sequence_out) # added this<br/>
	# one hot encode<br/>
	X = one_hot_encode(sequence_in, cardinality)<br/>
	y = one_hot_encode(sequence_out, cardinality)<br/>
	# reshape as 3D<br/>
	X = X.reshape((1, X.shape[0], X.shape[1]))<br/>
	y = y.reshape((1, y.shape[0], y.shape[1]))<br/>
	return X,y</p>
<p>4. With these changes:<br/>
for _ in range(5):<br/>
    a=get_pair(10,2,10,verbose=True)</p>
<p>generates:</p>
<p>[6, 8, 7, 2, 2, 6, 6, 4, 0, 0] [4, 6, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[5, 5, 3, 3, 2, 0, 0, 0, 0, 0] [2, 5, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[4, 7, 7, 4, 3, 9, 0, 0, 0, 0] [9, 4, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[2, 6, 7, 6, 5, 0, 0, 0, 0, 0] [5, 2, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[9, 8, 2, 8, 8, 7, 9, 1, 5, 0] [5, 9, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<p>5. Result of training on this dataset:<br/>
Encoder-Decoder Model<br/>
20.0<br/>
12.0<br/>
18.0<br/>
19.0<br/>
9.0<br/>
10.0<br/>
16.0<br/>
12.0<br/>
12.0<br/>
11.0</p>
<p>Encoder-Decoder With Attention Model<br/>
100.0<br/>
100.0<br/>
100.0<br/>
100.0<br/>
100.0<br/>
100.0<br/>
100.0<br/>
100.0<br/>
100.0<br/>
100.0</p>
<p>Yes!</p>
<p>This shows the capacity of recurrent neural models to learn arbitrary programs from example input and output pairs!<br/>
Of course, one can increase length of the sequence and also the n_unique to make the task harder, but I do not expect<br/>
dramatic failure as we gradually increase to reasonable values.</p>
<p>I am really very happy that you put together this excellent example. Please feel free to add this extension application to your excellent article/books if it will add value. Also please review the changes to make sure I have not made any errors.</p>
<p>The only complaint I have is that the keras implementation of attention is very slow. (I think the pytorch implementation will be<br/>
far faster because of avoiding a few layers of abstraction..but I may be wrong, will try it..)</p>
<p>Ravi</p>
<p>Attached the complete code for reproducibility:</p>
<p>from random import randint<br/>
from numpy import array<br/>
from numpy import argmax<br/>
from numpy import array_equal<br/>
from keras.models import Sequential<br/>
from keras.layers import LSTM<br/>
from keras.layers import Dense<br/>
from keras.layers import TimeDistributed<br/>
from keras.layers import RepeatVector<br/>
from attention_decoder import AttentionDecoder</p>
<p># generate a sequence of random integers<br/>
def generate_sequence(length, n_unique):<br/>
	return [randint(0, n_unique-2)+1 for _ in range(length)]</p>
<p># one hot encode sequence<br/>
def one_hot_encode(sequence, n_unique):<br/>
	encoding = list()<br/>
	for value in sequence:<br/>
		vector = [0 for _ in range(n_unique)]<br/>
		vector[value] = 1<br/>
		encoding.append(vector)<br/>
	return array(encoding)</p>
<p># decode a one hot encoded string<br/>
def one_hot_decode(encoded_seq):<br/>
	return [argmax(vector) for vector in encoded_seq]</p>
<p># prepare data for the LSTM<br/>
def get_pair(n_in, n_out, cardinality, verbose=False):<br/>
	# generate random sequence<br/>
	sequence_in = generate_sequence(n_in, cardinality)<br/>
	real_length = randint(4,n_in-1)<br/>
	sequence_in = sequence_in[:real_length] + [0 for _ in range(n_in-real_length)]<br/>
	sequence_out = [sequence_in[real_length-1]]+[sequence_in[0]] + [0 for _ in range(n_in-2)]<br/>
	if verbose:<br/>
		print(sequence_in,sequence_out)<br/>
	# one hot encode<br/>
	X = one_hot_encode(sequence_in, cardinality)<br/>
	y = one_hot_encode(sequence_out, cardinality)<br/>
	# reshape as 3D<br/>
	X = X.reshape((1, X.shape[0], X.shape[1]))<br/>
	y = y.reshape((1, y.shape[0], y.shape[1]))<br/>
	return X,y</p>
<p># define the encoder-decoder model<br/>
def baseline_model(n_timesteps_in, n_features):<br/>
	model = Sequential()<br/>
	model.add(LSTM(150, input_shape=(n_timesteps_in, n_features)))<br/>
	model.add(RepeatVector(n_timesteps_in))<br/>
	model.add(LSTM(150, return_sequences=True))<br/>
	model.add(TimeDistributed(Dense(n_features, activation=’softmax’)))<br/>
	model.compile(loss=’categorical_crossentropy’, optimizer=’adam’, metrics=[‘acc’])<br/>
	return model</p>
<p># define the encoder-decoder with attention model<br/>
def attention_model(n_timesteps_in, n_features):<br/>
	model = Sequential()<br/>
	model.add(LSTM(150, input_shape=(n_timesteps_in, n_features), return_sequences=True))<br/>
	model.add(AttentionDecoder(150, n_features))<br/>
	model.compile(loss=’categorical_crossentropy’, optimizer=’adam’, metrics=[‘acc’])<br/>
	return model</p>
<p># train and evaluate a model, return accuracy<br/>
def train_evaluate_model(model, n_timesteps_in, n_timesteps_out, n_features):<br/>
	# train LSTM<br/>
	for epoch in range(5000):<br/>
		# generate new random sequence<br/>
		X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)<br/>
		# fit model for one epoch on this sequence<br/>
		model.fit(X, y, epochs=1, verbose=0)<br/>
	# evaluate LSTM<br/>
	total, correct = 100, 0<br/>
	for _ in range(total):<br/>
		X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)<br/>
		yhat = model.predict(X, verbose=0)<br/>
		if array_equal(one_hot_decode(y[0]), one_hot_decode(yhat[0])):<br/>
			correct += 1<br/>
	return float(correct)/float(total)*100.0</p>
<p># configure problem<br/>
n_features = 8<br/>
n_timesteps_in = 10<br/>
n_timesteps_out = 2<br/>
n_repeats = 10</p>
<p># evaluate encoder-decoder model<br/>
print(‘Encoder-Decoder Model’)<br/>
results = list()<br/>
for _ in range(n_repeats):<br/>
	model = baseline_model(n_timesteps_in, n_features)<br/>
	accuracy = train_evaluate_model(model, n_timesteps_in, n_timesteps_out, n_features)<br/>
	results.append(accuracy)<br/>
	print(accuracy)<br/>
print(‘Mean Accuracy: %.2f%%’ % (sum(results)/float(n_repeats)))<br/>
# evaluate encoder-decoder with attention model<br/>
print(‘Encoder-Decoder With Attention Model’)<br/>
results = list()<br/>
for _ in range(n_repeats):<br/>
	model = attention_model(n_timesteps_in, n_features)<br/>
	accuracy = train_evaluate_model(model, n_timesteps_in, n_timesteps_out, n_features)<br/>
	results.append(accuracy)<br/>
	print(accuracy)<br/>
print(‘Mean Accuracy: %.2f%%’ % (sum(results)/float(n_repeats)))</p>
<div class="reply">
<a aria-label="Reply to Ravi Annaswamy" class="comment-reply-link" href="#comment-417282" onclick='return addComment.moveForm( "comment-417282", "417282", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417335">
<div class="comment-container" id="li-comment-417335">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417335" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417335" onclick='return addComment.moveForm( "comment-417335", "417335", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417283">
<div class="comment-container" id="li-comment-417283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/983d413a4b7399b2c6fb79054226f50a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ravi annaswamy</span>
<span class="date">October 20, 2017 at 10:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>here is verbose evaluation</p>
<p>for _ in range(5):<br/>
    X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features,verbose=True)<br/>
    yhat = model.predict(X, verbose=0)<br/>
    print(one_hot_decode(yhat[0]))</p>
<p>[5, 5, 1, 6, 1, 4, 5, 0, 0, 0] [5, 5, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[5, 5, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[5, 5, 4, 7, 2, 1, 3, 0, 0, 0] [3, 5, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[3, 5, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[3, 4, 7, 6, 3, 1, 3, 1, 1, 0] [1, 3, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[1, 3, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[1, 4, 1, 4, 7, 2, 2, 3, 4, 0] [4, 1, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[4, 1, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[1, 5, 1, 4, 7, 6, 3, 7, 7, 0] [7, 1, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[7, 1, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<div class="reply">
<a aria-label="Reply to ravi annaswamy" class="comment-reply-link" href="#comment-417283" onclick='return addComment.moveForm( "comment-417283", "417283", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-417762">
<div class="comment-container" id="li-comment-417762">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be992c5c2c4cb5cedb66b0e234d2db42?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be992c5c2c4cb5cedb66b0e234d2db42?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Meeklai</span>
<span class="date">October 24, 2017 at 8:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417762" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome work Ravi!</p>
<p>Would you please upload these codes into <a href="https://gist.github.com" rel="nofollow">https://gist.github.com</a>?</p>
<div class="reply">
<a aria-label="Reply to Meeklai" class="comment-reply-link" href="#comment-417762" onclick='return addComment.moveForm( "comment-417762", "417762", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417295">
<div class="comment-container" id="li-comment-417295">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be992c5c2c4cb5cedb66b0e234d2db42?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be992c5c2c4cb5cedb66b0e234d2db42?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Meeklai</span>
<span class="date">October 21, 2017 at 2:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417295" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all, thank you so much for this worth reading article. It clarified me a lot about how to implement autoencoder model in Keras.</p>
<p>I just have a little confused point that I wish you would explain. Why do you need to transform an original vector of integers into a 2D matrix containing a one hot vector of each integer? Can’t you just send that original vector of integers into the encoder as an input?</p>
<p>Thank you again for this worthful article, Dr. Brownlee</p>
<div class="reply">
<a aria-label="Reply to Meeklai" class="comment-reply-link" href="#comment-417295" onclick='return addComment.moveForm( "comment-417295", "417295", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417343">
<div class="comment-container" id="li-comment-417343">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417343" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can, but the one hot encoding is richer and often results in better model skill.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417343" onclick='return addComment.moveForm( "comment-417343", "417343", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-417546">
<div class="comment-container" id="li-comment-417546">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be992c5c2c4cb5cedb66b0e234d2db42?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be992c5c2c4cb5cedb66b0e234d2db42?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Meeklai</span>
<span class="date">October 23, 2017 at 2:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417546" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Dr. Brownlee, would one hot encoding is better for a situation that the number of cardinality is much greater than this example? Like fitting an encoder with lots of text documents, which will result in huge number of encoder’s keys</p>
<div class="reply">
<a aria-label="Reply to Meeklai" class="comment-reply-link" href="#comment-417546" onclick='return addComment.moveForm( "comment-417546", "417546", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-417573">
<div class="comment-container" id="li-comment-417573">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 23, 2017 at 5:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417573" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In that case, it might be better to use a distributed representation like a word embedding:<br/>
<a href="https://machinelearningmastery.com/develop-word-embeddings-python-gensim/" rel="nofollow">https://machinelearningmastery.com/develop-word-embeddings-python-gensim/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417573" onclick='return addComment.moveForm( "comment-417573", "417573", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417760">
<div class="comment-container" id="li-comment-417760">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4aac06ac6fc821ea5c6dd300a33a5367?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4aac06ac6fc821ea5c6dd300a33a5367?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hendrik</span>
<span class="date">October 24, 2017 at 7:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417760" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In case of multiple LSTM layers, is the AttentionDecoder layer supposed to stay after all LSTMs only once or it must be inserted after each LSTM layert?</p>
<div class="reply">
<a aria-label="Reply to Hendrik" class="comment-reply-link" href="#comment-417760" onclick='return addComment.moveForm( "comment-417760", "417760", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417825">
<div class="comment-container" id="li-comment-417825">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2017 at 6:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417825" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The attention is only used directly after the encoder.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417825" onclick='return addComment.moveForm( "comment-417825", "417825", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-437881">
<div class="comment-container" id="li-comment-437881">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9cc731ddcff4ed8b0cf6a6393ff173cf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9cc731ddcff4ed8b0cf6a6393ff173cf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">AP</span>
<span class="date">May 18, 2018 at 7:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-437881" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, following up on Hendirk’s question, then how can I stack multple LSTM layers with attention. Do i initialise the first decoder layer as AttentionDecoder and follow it up with Keras’s LSTM layers? Thanks for the super informative post!</p>
<div class="reply">
<a aria-label="Reply to AP" class="comment-reply-link" href="#comment-437881" onclick='return addComment.moveForm( "comment-437881", "437881", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-437919">
<div class="comment-container" id="li-comment-437919">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2018 at 7:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-437919" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Attention would only be required on the first level of the decoder. LSTM layers may then be added after that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437919" onclick='return addComment.moveForm( "comment-437919", "437919", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417848">
<div class="comment-container" id="li-comment-417848">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/236a49e0b91ead97e45054264dd38e80?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/236a49e0b91ead97e45054264dd38e80?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Trialcritic</span>
<span class="date">October 25, 2017 at 8:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417848" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Usually, when people have 5 input and 2 output steps, we use</p>
<p>model.add(LSTM(size, input_shape=(n_timesteps_in, n_features)))<br/>
model.add(RepeatVector(n_timesteps_out)) # this is different from input steps<br/>
model.add(LSTM(size, return_sequences=True))</p>
<p>This makes sense, as suggested </p>
<p>“we need to repeat the single vector outputted from the encoder network to obtain a sequence which has the same length with the output sequences”.</p>
<p>Wonder if this must be changed.</p>
<div class="reply">
<a aria-label="Reply to Trialcritic" class="comment-reply-link" href="#comment-417848" onclick='return addComment.moveForm( "comment-417848", "417848", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417879">
<div class="comment-container" id="li-comment-417879">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2017 at 3:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-417879" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the RepeatVector approach is not a pure encoder-decoder as defined in the first papers, but often performs as well or better in my experience.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-417879" onclick='return addComment.moveForm( "comment-417879", "417879", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418907">
<div class="comment-container" id="li-comment-418907">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f39ae554bc7b2f18107ef1ef0c98fb57?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f39ae554bc7b2f18107ef1ef0c98fb57?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Aayushee</span>
<span class="date">November 3, 2017 at 8:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-418907" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for such a well explained post on this topic. You mention the limitation that output sequences are the same length as the input sequences in case of the attention encoder decoder model used.<br/>
Could you please give an idea what should be done in an attention based model when output and input lengths are not same? I was wondering if we can use a RepeatVector(output_timesteps) in the current attention model on the encoder output and then feed it to the AttentionDecoder?</p>
<div class="reply">
<a aria-label="Reply to Aayushee" class="comment-reply-link" href="#comment-418907" onclick='return addComment.moveForm( "comment-418907", "418907", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418950">
<div class="comment-container" id="li-comment-418950">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 4, 2017 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-418950" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This implementation of attention cannot handle input and output sequences with different lengths, sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418950" onclick='return addComment.moveForm( "comment-418950", "418950", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-419006">
<div class="comment-container" id="li-comment-419006">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">caichao</span>
<span class="date">November 4, 2017 at 11:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419006" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>By running your example (the “with attention part”, I’ve gotten the following error:<br/>
ValueError: Dimensions must be equal, but are 150 and 50 for ‘AttentionDecoder/MatMul_4’ (op: ‘MatMul’) with input shapes: [?,150], [50,150].</p>
<div class="reply">
<a aria-label="Reply to caichao" class="comment-reply-link" href="#comment-419006" onclick='return addComment.moveForm( "comment-419006", "419006", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419036">
<div class="comment-container" id="li-comment-419036">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 5, 2017 at 5:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419036" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ensure you have the latest version of Keras.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-419036" onclick='return addComment.moveForm( "comment-419036", "419036", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-419058">
<div class="comment-container" id="li-comment-419058">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">caichao</span>
<span class="date">November 5, 2017 at 11:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419058" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>My keras version is 2.0.2</p>
<div class="reply">
<a aria-label="Reply to caichao" class="comment-reply-link" href="#comment-419058" onclick='return addComment.moveForm( "comment-419058", "419058", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-419106">
<div class="comment-container" id="li-comment-419106">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 6, 2017 at 4:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419106" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try 2.0.8 or higher?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-419106" onclick='return addComment.moveForm( "comment-419106", "419106", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-419160">
<div class="comment-container" id="li-comment-419160">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">caichao</span>
<span class="date">November 6, 2017 at 11:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419160" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>also when I upgrade keras to 2.0.9<br/>
I got the following problem</p>
<p>from keras.layers.recurrent import Recurrent, _time_distributed_dense<br/>
“unresolved reference _time_distributed_dense”</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-419200">
<div class="comment-container" id="li-comment-419200">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 7, 2017 at 9:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419200" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting, perhaps the example requires Keras 2.0.8. This was the version I used when developing the example.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-419059">
<div class="comment-container" id="li-comment-419059">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6cc0059e7264ec1a65e56a360de273ea?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">caichao</span>
<span class="date">November 5, 2017 at 12:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419059" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>also when I upgrade keras to 2.0.9<br/>
I got the following problem</p>
<p>from keras.layers.recurrent import Recurrent, _time_distributed_dense<br/>
“unresolved reference _time_distributed_dense”</p>
<div class="reply">
<a aria-label="Reply to caichao" class="comment-reply-link" href="#comment-419059" onclick='return addComment.moveForm( "comment-419059", "419059", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-419087">
<div class="comment-container" id="li-comment-419087">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f0e23e514a28215a10f3a8b3ebd162aa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f0e23e514a28215a10f3a8b3ebd162aa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kamal</span>
<span class="date">November 6, 2017 at 12:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419087" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason. thank you for your great tutorials. I have 2 questions:</p>
<p>1) is there any Dense layer after Decoder in Attention code?<br/>
2)should features input be equal to features output or not ( their length should be equal  as you mentioned)?</p>
<p>thank you, again</p>
<div class="reply">
<a aria-label="Reply to kamal" class="comment-reply-link" href="#comment-419087" onclick='return addComment.moveForm( "comment-419087", "419087", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-419110">
<div class="comment-container" id="li-comment-419110">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 6, 2017 at 4:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-419110" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, there is normally a dense output after the decoder (or a part of the decoder).</p>
<p>Features can vary. Normally/often you would have more input features than output features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-419110" onclick='return addComment.moveForm( "comment-419110", "419110", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421598">
<div class="comment-container" id="li-comment-421598">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">November 29, 2017 at 5:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-421598" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>from keras.models import Model,</p>
<p>How this Model() layer will works in keras?</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="#comment-421598" onclick='return addComment.moveForm( "comment-421598", "421598", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421660">
<div class="comment-container" id="li-comment-421660">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 8:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-421660" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question, you can learn more in this post:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421660" onclick='return addComment.moveForm( "comment-421660", "421660", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421745">
<div class="comment-container" id="li-comment-421745">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f4270716c896093a88ecce0e6e9607f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f4270716c896093a88ecce0e6e9607f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Basma</span>
<span class="date">November 30, 2017 at 9:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-421745" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>thank you so much for this great tutorial, I’m actually trying to build an encoder with attention, so the attention should be in the encoder part, can you explain please how this can be adapted ?</p>
<p>Many thanks 🙂</p>
<div class="reply">
<a aria-label="Reply to Basma" class="comment-reply-link" href="#comment-421745" onclick='return addComment.moveForm( "comment-421745", "421745", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421802">
<div class="comment-container" id="li-comment-421802">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 1, 2017 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-421802" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, attention is in the decoder, not the encoder. Sorry, I don’t have an example of an encoder with attention.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421802" onclick='return addComment.moveForm( "comment-421802", "421802", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-422287">
<div class="comment-container" id="li-comment-422287">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f4270716c896093a88ecce0e6e9607f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f4270716c896093a88ecce0e6e9607f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Basma</span>
<span class="date">December 6, 2017 at 7:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-422287" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>i’m trying to use this great implementation for seq2seq to encode text. I have a dialogue turn from user A that I’ll decode to get dialogue turn from user B. I am using the following code</p>
<p>    seq2seq = Sequential()<br/>
    seq2seq.add(Embedding(output_dim=args.emb_dim,<br/>
                            input_dim=MAX_NB_WORDS,<br/>
                            input_length=MAX_SEQUENCE_LENGTH,<br/>
                            weights=[embedding_matrix],<br/>
                            mask_zero=True,<br/>
                            trainable=True))</p>
<p>    seq2seq.add(LSTM(units=args.hidden_size, return_sequences=True))<br/>
    seq2seq.add(AttentionDecoder(args.hidden_size, args.emb_dim))<br/>
    seq2seq.compile(loss=’categorical_crossentropy’, optimizer=’adam’, metrics=[‘acc’])</p>
<p>But actually I don’t know how I can compare the decoded vector to the turn vector that I already have. </p>
<p>My dialogue vectors are already encoded using keras preprocessing text_to_sequence and padded.</p>
<p>Many thanks !</p>
<div class="reply">
<a aria-label="Reply to Basma" class="comment-reply-link" href="#comment-422287" onclick='return addComment.moveForm( "comment-422287", "422287", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-422348">
<div class="comment-container" id="li-comment-422348">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2017 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-422348" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I assume you are outputting a sequence of integers. These integers must be mapped back to words using whatever scheme you used to encode your training data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-422348" onclick='return addComment.moveForm( "comment-422348", "422348", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-425448">
<div class="comment-container" id="li-comment-425448">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/100f574e3c1c287e687cbbb91e8a7f1b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/100f574e3c1c287e687cbbb91e8a7f1b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leo</span>
<span class="date">January 2, 2018 at 8:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425448" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason</p>
<p>Thanks for this tutorial. I’m trying a word embedding seq2seq model. But I’m stuck with how to build the model.<br/>
I use tokenizer and pad_sequences to encode Xtrain and ytrain, and then processing ytrain through to_categorical.<br/>
The format of input fed into the model is just like the ones in this tutorial: 1 input of Xtrain and ytrain for each epoch.<br/>
And it seems there’s something wrong with the embedding layer. But I can’t figure out why.</p>
<p>model = Sequential()<br/>
model.add(Embedding(vocab_size, 150, input_length=max_length))<br/>
model.add(Bidirectional(LSTM(150, return_sequences=True)))<br/>
model.add(AttentionDecoder(150, n_features))<br/>
model.compile(loss=’categorical_crossentropy’, optimizer=’adam’, metrics=[‘acc’])</p>
<p>ValueError: Error when checking input: expected embedding_8_input to have shape (None, 148) but got array with shape (148, 1)</p>
<div class="reply">
<a aria-label="Reply to Leo" class="comment-reply-link" href="#comment-425448" onclick='return addComment.moveForm( "comment-425448", "425448", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-425451">
<div class="comment-container" id="li-comment-425451">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/100f574e3c1c287e687cbbb91e8a7f1b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/100f574e3c1c287e687cbbb91e8a7f1b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leo</span>
<span class="date">January 2, 2018 at 9:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425451" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I have another question. Can I just fit the model directly instead of using for loop to train the model for each epoch?<br/>
If I just fit the model directly, I got another error message:<br/>
Error when checking target: expected AttentionDecoder to have 3 dimensions, but got array with shape (200, 1321)</p>
<p>Thank you very much.</p>
<div class="reply">
<a aria-label="Reply to Leo" class="comment-reply-link" href="#comment-425451" onclick='return addComment.moveForm( "comment-425451", "425451", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-425480">
<div class="comment-container" id="li-comment-425480">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 3, 2018 at 5:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425480" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can, but you must change the shape of the data you are feeding to the network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425480" onclick='return addComment.moveForm( "comment-425480", "425480", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425478">
<div class="comment-container" id="li-comment-425478">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 3, 2018 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425478" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post might help to get you started with embedding layers:<br/>
<a href="https://machinelearningmastery.com/use-word-embedding-layers-deep-learning-keras/" rel="nofollow">https://machinelearningmastery.com/use-word-embedding-layers-deep-learning-keras/</a></p>
<p>Remember to one hot encode your input data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425478" onclick='return addComment.moveForm( "comment-425478", "425478", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-425604">
<div class="comment-container" id="li-comment-425604">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/100f574e3c1c287e687cbbb91e8a7f1b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/100f574e3c1c287e687cbbb91e8a7f1b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leo</span>
<span class="date">January 4, 2018 at 3:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425604" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason</p>
<p>Thanks for your suggestion. and it works. However, I change the problem in this tutorial a little bit, and get stuck again.</p>
<p>In this tutorial, the definition of the problem is given Xtrain, for example, [3, 5, 12, 10, 18, 20], and then, we echo the first two element, so the ytrain looks like [3, 5, 0, 0, 0, 0].</p>
<p>Now, I want to find the specific continuous two numbers in a sequence but those two continuous numbers are located at different location within each sequence. </p>
<p>For example, what I want is [16, Z] where Z is any number, and [16, Z] is within an sequence, Xtrain.</p>
<p>So, Xtrain and ytrain look like:<br/>
Xtrain                                                     ytrain<br/>
[3, 1, 10, 14, 8, 20, 16, 7, 9, 19]            [16, 7, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[6, 1, 23, 16, 9, 12, 22, 8, 0, 17]            [16, 9, 0, 0, 0, 0, 0, 0, 0, 0]<br/>
[9, 13, 15, 12, 16, 2, 5, 1, 10, 8]            [16, 2, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<p>I think the key point is to transform the format of Xtrain and ytrain. One-hot encoding Xtrain remains the same just like this tutorial. But right now I have no idea how to fit ytrain into the model. I tried several ways to transform the format of ytrain, such as,<br/>
1. One-hot encoding ytrain, but it doesn’t work.<br/>
2. One-hot encoding the location of [16, Z], but it seems nonsense.<br/>
3. Changing the format of ytrain to, for example, [0, 0, 0, 0, 0, 0 16, 7, 0, 0], and then one-hot encoding this sequence, but it<br/>
    still doesn’t work.</p>
<p>Do you have any suggestion or idea on such problem? Thank you very much.</p>
<div class="reply">
<a aria-label="Reply to Leo" class="comment-reply-link" href="#comment-425604" onclick='return addComment.moveForm( "comment-425604", "425604", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-425655">
<div class="comment-container" id="li-comment-425655">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 5, 2018 at 5:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425655" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could model it as a summarization task with the full sequence in and 2 elements out.</p>
<p>For that you can use an encoder-decoder without attention.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425655" onclick='return addComment.moveForm( "comment-425655", "425655", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425795">
<div class="comment-container" id="li-comment-425795">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d7480b55f9558dfcf7c3ddca632964f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d7480b55f9558dfcf7c3ddca632964f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">January 7, 2018 at 2:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425795" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is there an updated version of this example that uses TimeDistributed in Keras instead of _time_distributed_dense ?</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="#comment-425795" onclick='return addComment.moveForm( "comment-425795", "425795", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425810">
<div class="comment-container" id="li-comment-425810">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 7, 2018 at 5:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-425810" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not at this stage, I am waiting for attention to be officially supported by Keras.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-425810" onclick='return addComment.moveForm( "comment-425810", "425810", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-426236">
<div class="comment-container" id="li-comment-426236">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f3686186b9a82fa2cdd9a5bf2072d97?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f3686186b9a82fa2cdd9a5bf2072d97?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.linkedin.com/in/denisandreiaraujo/" rel="external nofollow">Denis</a></span>
<span class="date">January 12, 2018 at 3:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-426236" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>About _time_distributed_dense problem: I copied the code of the _time_distributed_dense function from keras/python/keras/layers/recurrent.py file into the attention_decoder.py file (before the AttentionDecoder class) and the Jason’s code worked for me.</p>
<div class="reply">
<a aria-label="Reply to Denis" class="comment-reply-link" href="#comment-426236" onclick='return addComment.moveForm( "comment-426236", "426236", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-426261">
<div class="comment-container" id="li-comment-426261">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-426261" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426261" onclick='return addComment.moveForm( "comment-426261", "426261", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-4" id="comment-430117">
<div class="comment-container" id="li-comment-430117">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be7b2fc00dc92e00b45e66bc208e8e9d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be7b2fc00dc92e00b45e66bc208e8e9d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jacob</span>
<span class="date">February 21, 2018 at 9:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-430117" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can you send me the code to copy into the AttentionDecoder class? <a href="mailto:ninjajake@gmail.com">ninjajake@gmail.com</a></p>
<div class="reply">
<a aria-label="Reply to Jacob" class="comment-reply-link" href="#comment-430117" onclick='return addComment.moveForm( "comment-430117", "430117", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-4" id="comment-445666">
<div class="comment-container" id="li-comment-445666">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/acf5d9a4f5ae9ef1e20961670397e2b6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/acf5d9a4f5ae9ef1e20961670397e2b6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alimur Razi Rana</span>
<span class="date">August 9, 2018 at 3:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-445666" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This trick saves my day. Who wants the code – <a href="https://github.com/keras-team/keras/blob/b587aeee1c1be3633a56b945af3e7c2c303369ca/keras/layers/recurrent.py" rel="nofollow">https://github.com/keras-team/keras/blob/b587aeee1c1be3633a56b945af3e7c2c303369ca/keras/layers/recurrent.py</a></p>
<div class="reply">
<a aria-label="Reply to Alimur Razi Rana" class="comment-reply-link" href="#comment-445666" onclick='return addComment.moveForm( "comment-445666", "445666", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426399">
<div class="comment-container" id="li-comment-426399">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7dc7a3642d9d0071fbb1c2f35b405abe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7dc7a3642d9d0071fbb1c2f35b405abe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://nipunbatra.github.io" rel="external nofollow">Nipun Batra</a></span>
<span class="date">January 13, 2018 at 8:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-426399" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Many thanks for the excellent post (as always!)</p>
<p>I was wondering: could we have learnt a model for the continuous data? That is, instead of one hot encoding the input and the output, if we feed in the raw sequence? I wondered as I have not yet seen a Seq2Seq with attention for continuous data. I was thinking of writing a simple model based on your post, to denoise a sine signal. It should be a case of Seq2seq on same length sequences.</p>
<div class="reply">
<a aria-label="Reply to Nipun Batra" class="comment-reply-link" href="#comment-426399" onclick='return addComment.moveForm( "comment-426399", "426399", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426471">
<div class="comment-container" id="li-comment-426471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-426471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure, but it may be a harder problem for the model to learn.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426471" onclick='return addComment.moveForm( "comment-426471", "426471", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-426555">
<div class="comment-container" id="li-comment-426555">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7dc7a3642d9d0071fbb1c2f35b405abe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7dc7a3642d9d0071fbb1c2f35b405abe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://nipunbatra.github.io" rel="external nofollow">Nipun Batra</a></span>
<span class="date">January 14, 2018 at 11:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-426555" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks! When I just used the code in this blog post as it is (with attention), I didn’t see any reduction in loss function when using continuous data. That’s when I wondered if the attention implementation shared here is only for discrete data?</p>
<div class="reply">
<a aria-label="Reply to Nipun Batra" class="comment-reply-link" href="#comment-426555" onclick='return addComment.moveForm( "comment-426555", "426555", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-426585">
<div class="comment-container" id="li-comment-426585">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-426585" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice.</p>
<p>No, it is independent of the data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426585" onclick='return addComment.moveForm( "comment-426585", "426585", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-427953">
<div class="comment-container" id="li-comment-427953">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/54aaceba50469540986648caaf985fce?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/54aaceba50469540986648caaf985fce?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">moses</span>
<span class="date">January 30, 2018 at 5:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-427953" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How should the decode differ between 0 and empty row<br/>
(zero is a one_hot_code vector that has 1 on the first entry, and empty is line of zeros)?</p>
<div class="reply">
<a aria-label="Reply to moses" class="comment-reply-link" href="#comment-427953" onclick='return addComment.moveForm( "comment-427953", "427953", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-428009">
<div class="comment-container" id="li-comment-428009">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 31, 2018 at 9:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-428009" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, not sure I follow. Are you able to give more context?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428009" onclick='return addComment.moveForm( "comment-428009", "428009", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-427974">
<div class="comment-container" id="li-comment-427974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/54aaceba50469540986648caaf985fce?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/54aaceba50469540986648caaf985fce?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">moses</span>
<span class="date">January 31, 2018 at 12:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-427974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One more </p>
<p>If the number of features of the input differs from the features of the output. we have to change this line:<br/>
model.add(TimeDistributed(Dense(n_features, activation=’softmax’)))</p>
<p>Should we do more?</p>
<div class="reply">
<a aria-label="Reply to moses" class="comment-reply-link" href="#comment-427974" onclick='return addComment.moveForm( "comment-427974", "427974", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-428020">
<div class="comment-container" id="li-comment-428020">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 31, 2018 at 9:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-428020" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Features or time steps in the output?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428020" onclick='return addComment.moveForm( "comment-428020", "428020", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-428139">
<div class="comment-container" id="li-comment-428139">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/54aaceba50469540986648caaf985fce?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/54aaceba50469540986648caaf985fce?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">moses</span>
<span class="date">February 1, 2018 at 10:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-428139" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>My question was on the case of n_feauteres (make it in and out)  but I belive that the legnth of the seuqnece matters too. The first one I resloved as I wrote not sure it is enough/</p>
<div class="reply">
<a aria-label="Reply to moses" class="comment-reply-link" href="#comment-428139" onclick='return addComment.moveForm( "comment-428139", "428139", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-428160">
<div class="comment-container" id="li-comment-428160">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cc63d6185199d1aaab7e8ca973f0a59f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cc63d6185199d1aaab7e8ca973f0a59f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nathan D.</span>
<span class="date">February 2, 2018 at 5:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-428160" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>It’s a great demonstration and thank you very much for that. </p>
<p>I am wondering if you are aware of any way to get back the attention vector *at*? Since it is not model’s parameters, accessing via keras.backend.get_value() seems doesn’t work. Thank you.</p>
<div class="reply">
<a aria-label="Reply to Nathan D." class="comment-reply-link" href="#comment-428160" onclick='return addComment.moveForm( "comment-428160", "428160", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-429598">
<div class="comment-container" id="li-comment-429598">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b8f474b3489bffa0621c8f36c6e9bec8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b8f474b3489bffa0621c8f36c6e9bec8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amy</span>
<span class="date">February 15, 2018 at 4:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-429598" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great tutorial! This really helped my understanding a lot. May I ask how to modify this attention seq2seq to a batched version? Thanks!</p>
<div class="reply">
<a aria-label="Reply to Amy" class="comment-reply-link" href="#comment-429598" onclick='return addComment.moveForm( "comment-429598", "429598", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-429645">
<div class="comment-container" id="li-comment-429645">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 16, 2018 at 8:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-429645" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How would the batch approach to updates impact attention?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-429645" onclick='return addComment.moveForm( "comment-429645", "429645", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-431973">
<div class="comment-container" id="li-comment-431973">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f89039d61c94890326f358bac37920a3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f89039d61c94890326f358bac37920a3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">haya</span>
<span class="date">March 13, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-431973" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
in the step function in AttentionDecoder can we use keras lstm layer iinstead of building it from scratch?</p>
<div class="reply">
<a aria-label="Reply to haya" class="comment-reply-link" href="#comment-431973" onclick='return addComment.moveForm( "comment-431973", "431973", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-431986">
<div class="comment-container" id="li-comment-431986">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 13, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-431986" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not sure I follow. Perhaps try it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431986" onclick='return addComment.moveForm( "comment-431986", "431986", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-432627">
<div class="comment-container" id="li-comment-432627">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/480b2160e1de5052eafc6b2feb2b4114?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/480b2160e1de5052eafc6b2feb2b4114?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">March 20, 2018 at 2:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-432627" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It seems that the poor score without attention is mostly due to an optimization problem. I am able to achieve &gt;95% without accuracy by just using a reasonable batch size (32)</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="#comment-432627" onclick='return addComment.moveForm( "comment-432627", "432627", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-432669">
<div class="comment-container" id="li-comment-432669">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 20, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-432669" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice, thanks for the note Paul. What config did you use?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-432669" onclick='return addComment.moveForm( "comment-432669", "432669", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-433230">
<div class="comment-container" id="li-comment-433230">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d7a3215635f4574400610ebde4cccdab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d7a3215635f4574400610ebde4cccdab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dan</span>
<span class="date">March 26, 2018 at 8:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-433230" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I just wanted to let you know your hard work on this site is appreciated. It’s been incredibly helpful for me learning something so complex 😀</p>
<p>Thank you so much!</p>
<div class="reply">
<a aria-label="Reply to Dan" class="comment-reply-link" href="#comment-433230" onclick='return addComment.moveForm( "comment-433230", "433230", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-433252">
<div class="comment-container" id="li-comment-433252">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 26, 2018 at 10:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-433252" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I’m glad to hear that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433252" onclick='return addComment.moveForm( "comment-433252", "433252", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-435708">
<div class="comment-container" id="li-comment-435708">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/404ec13ecfc605be78d47e6a25d3b3e9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/404ec13ecfc605be78d47e6a25d3b3e9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eduardo</span>
<span class="date">April 23, 2018 at 5:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-435708" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thanks for the website. Is really saving me on my Bachelor Thesis.</p>
<p>Can we train an SVM using the context vector?</p>
<div class="reply">
<a aria-label="Reply to Eduardo" class="comment-reply-link" href="#comment-435708" onclick='return addComment.moveForm( "comment-435708", "435708", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435756">
<div class="comment-container" id="li-comment-435756">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 24, 2018 at 6:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-435756" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<p>Sure. To what end?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435756" onclick='return addComment.moveForm( "comment-435756", "435756", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-435718">
<div class="comment-container" id="li-comment-435718">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3caaacdc17b92e2252ea02c0fd2f4fcc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3caaacdc17b92e2252ea02c0fd2f4fcc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jimbung</span>
<span class="date">April 23, 2018 at 8:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-435718" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason,<br/>
i met an issue when running the code.</p>
<p>Traceback (most recent call last):<br/>
  File “gutils.py”, line 50, in<br/>
    model.add(AttentionDecoder(150, n_features))<br/>
……<br/>
# calculate the attention probabilities<br/>
# this relates how much other timesteps contributed to this one.<br/>
et = K.dot(activations.tanh(_Wxstm + self._uxpb),<br/>
                K.expand_dims(self.V_a))<br/>
……<br/>
File “/home/wanjb/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/tensor_util.py”, line 421, in make_tensor_proto<br/>
    raise ValueError(“None values not supported.”)<br/>
ValueError: None values not supported.</p>
<p>my environment:<br/>
Anaconda: conda 4.4.10<br/>
Python 3.6.4 :: Anaconda, Inc.</p>
<p>could u have a look on this? thanks!</p>
<div class="reply">
<a aria-label="Reply to jimbung" class="comment-reply-link" href="#comment-435718" onclick='return addComment.moveForm( "comment-435718", "435718", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435763">
<div class="comment-container" id="li-comment-435763">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 24, 2018 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-435763" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry to hear that:</p>
<p>– Are you able to confirm that TensorFlow and Keras are up to date?<br/>
– Are you able to confirm that you copied all of the code?<br/>
– Are you able to confirm that you are running the code from the command line?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435763" onclick='return addComment.moveForm( "comment-435763", "435763", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-435785">
<div class="comment-container" id="li-comment-435785">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3caaacdc17b92e2252ea02c0fd2f4fcc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3caaacdc17b92e2252ea02c0fd2f4fcc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jimbung</span>
<span class="date">April 24, 2018 at 1:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-435785" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason,</p>
<p>the problem have been solved as ‘Denis January 12, 2018 at 3:50 am’ described.<br/>
thank you Denis!</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7b26662d887805882" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def _time_distributed_dense(x, w, b=None, dropout=None,
                           input_dim=None, output_dim=None, timesteps=None):
    '''Apply y.w + b for every temporal slice y of x.
    '''
    if not input_dim:
        # won't work with TensorFlow
        input_dim = K.shape(x)[2]
    if not timesteps:
        # won't work with TensorFlow
        timesteps = K.shape(x)[1]
    if not output_dim:
        # won't work with TensorFlow
        output_dim = K.shape(w)[1]

    if dropout:
        # apply the same dropout pattern at every timestep
        ones = K.ones_like(K.reshape(x[:, 0, :], (-1, input_dim)))
        dropout_matrix = K.dropout(ones, dropout)
        expanded_dropout_matrix = K.repeat(dropout_matrix, timesteps)
        x *= expanded_dropout_matrix

    # collapse time dimension and batch dimension together
    x = K.reshape(x, (-1, input_dim))

    x = K.dot(x, w)
    if b:
        x = x + b
    # reshape to 3D tensor
    x = K.reshape(x, (-1, timesteps, output_dim))
    return x</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7b26662d887805882-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7b26662d887805882-30">30</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-1"><span class="crayon-e">def </span><span class="crayon-e">_time_distributed_dense</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">w</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropout</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-2"><span class="crayon-h">                           </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">output_dim</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">timesteps</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-3"><span class="crayon-h">    </span><span class="crayon-s">''</span><span class="crayon-s">'Apply y.w + b for every temporal slice y of x.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-4"><span class="crayon-s">    '</span><span class="crayon-s">''</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-5"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-6"><span class="crayon-h">        </span><span class="crayon-p"># won't work with TensorFlow</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-7"><span class="crayon-h">        </span><span class="crayon-v">input_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">shape</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-8"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">timesteps</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-9"><span class="crayon-h">        </span><span class="crayon-p"># won't work with TensorFlow</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-10"><span class="crayon-h">        </span><span class="crayon-v">timesteps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">shape</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-11"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">output_dim</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-12"><span class="crayon-h">        </span><span class="crayon-p"># won't work with TensorFlow</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-13"><span class="crayon-h">        </span><span class="crayon-v">output_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">shape</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-14"> </div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-15"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropout</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-16"><span class="crayon-h">        </span><span class="crayon-p"># apply the same dropout pattern at every timestep</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-17"><span class="crayon-h">        </span><span class="crayon-v">ones</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">ones_like</span><span class="crayon-sy">(</span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-18"><span class="crayon-h">        </span><span class="crayon-v">dropout_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dropout</span><span class="crayon-sy">(</span><span class="crayon-v">ones</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropout</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-19"><span class="crayon-h">        </span><span class="crayon-v">expanded_dropout_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">repeat</span><span class="crayon-sy">(</span><span class="crayon-v">dropout_matrix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">timesteps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-20"><span class="crayon-h">        </span><span class="crayon-e ">x *</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">expanded_dropout_matrix</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-22"><span class="crayon-h">    </span><span class="crayon-p"># collapse time dimension and batch dimension together</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-23"><span class="crayon-h">    </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-24"> </div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-25"><span class="crayon-h">    </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">w</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-26"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-27"><span class="crayon-h">        </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">b</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-28"><span class="crayon-h">    </span><span class="crayon-p"># reshape to 3D tensor</span></div><div class="crayon-line" id="crayon-5c0ca7b26662d887805882-29"><span class="crayon-h">    </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">K</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">output_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7b26662d887805882-30"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">x</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to jimbung" class="comment-reply-link" href="#comment-435785" onclick='return addComment.moveForm( "comment-435785", "435785", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435794">
<div class="comment-container" id="li-comment-435794">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 24, 2018 at 2:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-435794" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435794" onclick='return addComment.moveForm( "comment-435794", "435794", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-436401">
<div class="comment-container" id="li-comment-436401">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/962ca53391b89d1353c1865709cb72d4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/962ca53391b89d1353c1865709cb72d4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jorn</span>
<span class="date">May 2, 2018 at 2:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436401" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you very much for yet another great post! Would this architecture be suitable for time series forecasting where you have sequences of multiple features to forecast a sequence of a single target? The sequence lengths of the features are longer then the length of the target sequence to be forecast.<br/>
All the examples I have seen so far are showing one feature sequence as input to one output target sequence.</p>
<div class="reply">
<a aria-label="Reply to Jorn" class="comment-reply-link" href="#comment-436401" onclick='return addComment.moveForm( "comment-436401", "436401", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436426">
<div class="comment-container" id="li-comment-436426">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 2, 2018 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436426" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Maybe, try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436426" onclick='return addComment.moveForm( "comment-436426", "436426", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436657">
<div class="comment-container" id="li-comment-436657">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ab055146a2e3aee5805b24d9a2adbfc8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ab055146a2e3aee5805b24d9a2adbfc8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ahmad Aldali</span>
<span class="date">May 5, 2018 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436657" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason ..<br/>
Thank you for the this information ..<br/>
I have one question ..<br/>
Can I use this implementation in my Translation Model ..<br/>
I use encoder – decoder as following:</p>
<p>“””””<br/>
embedded_output = embedding_layer(embedding_input)</p>
<p># ================================ Encoder ================================<br/>
encoder = LSTM(lstm_units, return_sequences=True, return_state=True, name=’encoder’)<br/>
encoder_outputs, state_h, state_c = encoder(embedded_output)<br/>
encoder_states = [state_h, state_c]</p>
<p>#….<br/>
embedding_Ar_input = Input(shape=(MAX_Ar_SEQUENCE_LENGTH,))<br/>
embedded_Ar_output = embedding_Ar_layer(embedding_Ar_input)</p>
<p># ================================ Decoder ================================<br/>
# We set up our decoder to return full output sequences,<br/>
decoder_lstm = LSTM(lstm_units, return_sequences=True, return_state=True, name=’decoder’)</p>
<p>decoder_outputs, _, _ = decoder_lstm(embedded_Ar_output, initial_state=encoder_states)</p>
<p># SoftMax<br/>
decoder_dense = Dense(output_vector_length, activation=’softmax’, name=’softmax’)<br/>
outputs_model = decoder_dense(attention)</p>
<p>“””””<br/>
and what is n_features? what it is representing??</p>
<div class="reply">
<a aria-label="Reply to Ahmad Aldali" class="comment-reply-link" href="#comment-436657" onclick='return addComment.moveForm( "comment-436657", "436657", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-436658">
<div class="comment-container" id="li-comment-436658">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ab055146a2e3aee5805b24d9a2adbfc8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ab055146a2e3aee5805b24d9a2adbfc8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ahmad Aldali</span>
<span class="date">May 5, 2018 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436658" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>n_features mean max decoder sequence ?</p>
<div class="reply">
<a aria-label="Reply to Ahmad Aldali" class="comment-reply-link" href="#comment-436658" onclick='return addComment.moveForm( "comment-436658", "436658", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-436825">
<div class="comment-container" id="li-comment-436825">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">fatime</span>
<span class="date">May 7, 2018 at 8:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436825" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi, Jason can you tell me what actually verbose do ?</p>
<div class="reply">
<a aria-label="Reply to fatime" class="comment-reply-link" href="#comment-436825" onclick='return addComment.moveForm( "comment-436825", "436825", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436870">
<div class="comment-container" id="li-comment-436870">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 8, 2018 at 6:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436870" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It turns on output during training so that you can see what the model us doing during training (e.g. skill and progress).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436870" onclick='return addComment.moveForm( "comment-436870", "436870", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-436941">
<div class="comment-container" id="li-comment-436941">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">fatime</span>
<span class="date">May 8, 2018 at 8:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436941" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>so, what is the difference between verbose =1 or 2 or none , and which attention mechanism is the best for machine translation ?</p>
<div class="reply">
<a aria-label="Reply to fatime" class="comment-reply-link" href="#comment-436941" onclick='return addComment.moveForm( "comment-436941", "436941", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-436986">
<div class="comment-container" id="li-comment-436986">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2018 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436986" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Verbose 0 turns off verbose output, verbose 1 gives a progress bar, verbose 2 gives one line per epoch.</p>
<p>See this post on good NMT architectures:<br/>
<a href="https://machinelearningmastery.com/configure-encoder-decoder-model-neural-machine-translation/" rel="nofollow">https://machinelearningmastery.com/configure-encoder-decoder-model-neural-machine-translation/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436986" onclick='return addComment.moveForm( "comment-436986", "436986", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436942">
<div class="comment-container" id="li-comment-436942">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">fatime</span>
<span class="date">May 8, 2018 at 8:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436942" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>so, what is the difference between verbose =1 or 2 or none , and which attention mechanism is the best for machine translation ?</p>
<div class="reply">
<a aria-label="Reply to fatime" class="comment-reply-link" href="#comment-436942" onclick='return addComment.moveForm( "comment-436942", "436942", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-436946">
<div class="comment-container" id="li-comment-436946">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8d4602bb60f153524379c8f64523c445?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8d4602bb60f153524379c8f64523c445?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">radhika</span>
<span class="date">May 8, 2018 at 8:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436946" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi, can we use this model for the translation of one language to another ?</p>
<div class="reply">
<a aria-label="Reply to radhika" class="comment-reply-link" href="#comment-436946" onclick='return addComment.moveForm( "comment-436946", "436946", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-436988">
<div class="comment-container" id="li-comment-436988">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2018 at 6:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-436988" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is an example:<br/>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" rel="nofollow">https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436988" onclick='return addComment.moveForm( "comment-436988", "436988", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-437782">
<div class="comment-container" id="li-comment-437782">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0fdfcf977c6d2d8bdc26088627a7df41?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0fdfcf977c6d2d8bdc26088627a7df41?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">YoonseokHeo</span>
<span class="date">May 17, 2018 at 5:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-437782" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for wonderful tutorial.<br/>
In a Custom Keras Attention Layer(AttentionDecoder Class), I am wondering if you can let me know why you implement the predicted word(yt) at time step t<br/>
in such a way that the previous generated word(ytm), previous hidden state(stm), and calculated context vector(context)<br/>
are added with its weights.</p>
<p>What you implemented is as follows:<br/>
   yt = activations.softmax(<br/>
		K.dot(ytm, self.W_o)<br/>
                 + K.dot(stm, self.U_o)<br/>
                 + K.dot(context, self.C_o)<br/>
                 + self.b_o)</p>
<p>I coudn’t find any mentions except the very first definition about calculating the next word like: P(yt|y1,…yt-1, X) = g(yi-1, si, ci)</p>
<p>I am not sure if this equation indicates the way you did when calculating yt.</p>
<div class="reply">
<a aria-label="Reply to YoonseokHeo" class="comment-reply-link" href="#comment-437782" onclick='return addComment.moveForm( "comment-437782", "437782", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437827">
<div class="comment-container" id="li-comment-437827">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 18, 2018 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-437827" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>As mentioned, I did not implement the custom attention layer. I am not the best person to answer questions about it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437827" onclick='return addComment.moveForm( "comment-437827", "437827", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-437975">
<div class="comment-container" id="li-comment-437975">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2a7016c30c80095e1f922df6c05a4aac?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2a7016c30c80095e1f922df6c05a4aac?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">chris</span>
<span class="date">May 20, 2018 at 1:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-437975" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason I try to understand LSTMs and I am very new. Could you please explain this following code a bit easier:<br/>
# define model<br/>
model = Sequential()<br/>
model.add(LSTM(150, input_shape=(n_timesteps_in, n_features)))<br/>
model.add(RepeatVector(n_timesteps_in))<br/>
model.add(LSTM(150, return_sequences=True))<br/>
model.add(TimeDistributed(Dense(n_features, activation=’softmax’)))</p>
<p>I understand the part of repeatvector and timdistrubuted. What I do not understand are the 150 hidden units, do they have to be the same ? and what happens if they are 1 ? It would be nice if you have any source for a visualized explanation of the structure. Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to chris" class="comment-reply-link" href="#comment-437975" onclick='return addComment.moveForm( "comment-437975", "437975", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-438013">
<div class="comment-container" id="li-comment-438013">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 20, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-438013" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can change the number of units to anything you wish.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438013" onclick='return addComment.moveForm( "comment-438013", "438013", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-438842">
<div class="comment-container" id="li-comment-438842">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4aefa6173df962ad926e8f5397784003?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4aefa6173df962ad926e8f5397784003?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">May 28, 2018 at 1:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-438842" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How could we apply this with multivariable time series ?</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="#comment-438842" onclick='return addComment.moveForm( "comment-438842", "438842", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-438876">
<div class="comment-container" id="li-comment-438876">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 28, 2018 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-438876" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438876" onclick='return addComment.moveForm( "comment-438876", "438876", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-439124">
<div class="comment-container" id="li-comment-439124">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/08dee23d83f4fa21bf5030fc5ced0d14?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/08dee23d83f4fa21bf5030fc5ced0d14?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Santy</span>
<span class="date">May 30, 2018 at 4:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-439124" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!</p>
<p>I am trying to understand image captioning with attention model. I had seen your tutorial on image captioning. Can you please suggest me some resource, so that i can implement it using attention model in keras?</p>
<p>Thanks You!</p>
<div class="reply">
<a aria-label="Reply to Santy" class="comment-reply-link" href="#comment-439124" onclick='return addComment.moveForm( "comment-439124", "439124", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-439180">
<div class="comment-container" id="li-comment-439180">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 31, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-439180" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am waiting for Keras to get official support for attention.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439180" onclick='return addComment.moveForm( "comment-439180", "439180", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-440745">
<div class="comment-container" id="li-comment-440745">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/08dee23d83f4fa21bf5030fc5ced0d14?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/08dee23d83f4fa21bf5030fc5ced0d14?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Santy</span>
<span class="date">June 14, 2018 at 1:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-440745" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason !</p>
<p>I have gone through your tutorial on image captioning as given on following link.</p>
<p><a href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/" rel="nofollow">https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/</a></p>
<p>Can we use this attention model that is given by you for image captioning where CNN is used as Encoder and RNN is used as Decode?</p>
<p>Please suggest me.</p>
<p>Thank You.</p>
<div class="reply">
<a aria-label="Reply to Santy" class="comment-reply-link" href="#comment-440745" onclick='return addComment.moveForm( "comment-440745", "440745", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-440779">
<div class="comment-container" id="li-comment-440779">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 14, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-440779" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps.</p>
<p>I hope to give more examples of attention when Keras officially supports it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440779" onclick='return addComment.moveForm( "comment-440779", "440779", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-444229">
<div class="comment-container" id="li-comment-444229">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ca19fb8278862879e64bf83448cb72cd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ca19fb8278862879e64bf83448cb72cd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gang</span>
<span class="date">July 24, 2018 at 3:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-444229" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for wonderful tutorials. I learned a lot from your site.</p>
<p>I tried your code. It seems to simply removing the first LSTM from the baseline model will get perfect predictions for this example. Not sure attention layer is necessary here.</p>
<p>model = Sequential()<br/>
model.add(LSTM(150, input_shape=(n_timesteps_in, n_features), return_sequences=True))<br/>
model.add(Dense(n_features, activation=’softmax’))</p>
<div class="reply">
<a aria-label="Reply to Gang" class="comment-reply-link" href="#comment-444229" onclick='return addComment.moveForm( "comment-444229", "444229", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444254">
<div class="comment-container" id="li-comment-444254">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 24, 2018 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-444254" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may not be, it’s just a demonstration.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444254" onclick='return addComment.moveForm( "comment-444254", "444254", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-445082">
<div class="comment-container" id="li-comment-445082">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cdf691613872c9cb4edae814deac57ca?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cdf691613872c9cb4edae814deac57ca?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Atilla</span>
<span class="date">August 2, 2018 at 11:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-445082" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I want to to make model encoder Bidirectional-LSTM, decoder Bidirectional-LSTM. In theoretically is it possible as Bi-LSTM in your proposed models?</p>
<div class="reply">
<a aria-label="Reply to Atilla" class="comment-reply-link" href="#comment-445082" onclick='return addComment.moveForm( "comment-445082", "445082", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445113">
<div class="comment-container" id="li-comment-445113">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2018 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-445113" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445113" onclick='return addComment.moveForm( "comment-445113", "445113", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-445797">
<div class="comment-container" id="li-comment-445797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb3b4b366f39f0efa593e45848e3be93?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb3b4b366f39f0efa593e45848e3be93?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Elias Lousseief</span>
<span class="date">August 11, 2018 at 1:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-445797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi J! Thanks for a great hands-on tutorial … It works as intended and results are indeed improved with attention… however, when examining the at vector from attention_decoder, it does not show the desired activations…</p>
<p>Example:</p>
<p>Input: [29, 9, 47, 0, 12], output: [29, 9, 0, 0, 0] (correct)</p>
<p>at vector at first output (rounded): [6.2*10^(-12), 5.6*10^(-7), 1.5, 90.0, 8.4]</p>
<p>I would have expected the first of these numbers to be greatest as it should influence the output more than the remining four… What do you think about this? Could you inspect the at vector and see if you get the same results?</p>
<div class="reply">
<a aria-label="Reply to Elias Lousseief" class="comment-reply-link" href="#comment-445797" onclick='return addComment.moveForm( "comment-445797", "445797", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445818">
<div class="comment-container" id="li-comment-445818">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 11, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-445818" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice observation, it may need further investigation.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445818" onclick='return addComment.moveForm( "comment-445818", "445818", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-448650">
<div class="comment-container" id="li-comment-448650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2574973108f96e7135d0393beaa37423?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2574973108f96e7135d0393beaa37423?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Niranjan</span>
<span class="date">September 13, 2018 at 4:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-448650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Even I am seeing the same thing. Most of the probabilities are on the last 3 digits and it is never on the first 2 digits.</p>
<p>Thanks Jason for the great tutorial! Very helpful.</p>
<div class="reply">
<a aria-label="Reply to Niranjan" class="comment-reply-link" href="#comment-448650" onclick='return addComment.moveForm( "comment-448650", "448650", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-448670">
<div class="comment-container" id="li-comment-448670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2018 at 8:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-448670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-448670" onclick='return addComment.moveForm( "comment-448670", "448670", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-445802">
<div class="comment-container" id="li-comment-445802">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/070be68e6e594dcbed196bac4955792d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/070be68e6e594dcbed196bac4955792d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ling</span>
<span class="date">August 11, 2018 at 4:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-445802" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work, Jason!</p>
<div class="reply">
<a aria-label="Reply to Ling" class="comment-reply-link" href="#comment-445802" onclick='return addComment.moveForm( "comment-445802", "445802", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445820">
<div class="comment-container" id="li-comment-445820">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 11, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-445820" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445820" onclick='return addComment.moveForm( "comment-445820", "445820", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-446078">
<div class="comment-container" id="li-comment-446078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/88af3cbc659ce933126911599e2c2cbf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/88af3cbc659ce933126911599e2c2cbf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nilanjan</span>
<span class="date">August 14, 2018 at 7:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-446078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the wonderful post. I have  a small query, to give you context I am working on text data and in my case the input and output lengths are quite different. So wanted to check if we can tweak this code so that attention can be applied where encoder and decoder have different lengths. It will be helpful if you can direct me to an resource where this has been implemented or guide as to how can I make changes in the Attention class to incorporate this.</p>
<p>Thanks,<br/>
Nilanjan</p>
<div class="reply">
<a aria-label="Reply to Nilanjan" class="comment-reply-link" href="#comment-446078" onclick='return addComment.moveForm( "comment-446078", "446078", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446120">
<div class="comment-container" id="li-comment-446120">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2018 at 5:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-446120" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You might have to use a different implementation of attention.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446120" onclick='return addComment.moveForm( "comment-446120", "446120", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-446100">
<div class="comment-container" id="li-comment-446100">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/12ed3149b74a47f721a8a42d130b88d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/12ed3149b74a47f721a8a42d130b88d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Md. Zakir Hossain</span>
<span class="date">August 14, 2018 at 11:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-446100" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Many thanks for very helpful posts. I have also gone through your image captioning code:</p>
<p>def define_model(vocab_size, max_length):<br/>
	# feature extractor model<br/>
	inputs1 = Input(shape=(4096,))<br/>
	fe1 = Dropout(0.5)(inputs1)<br/>
	fe2 = Dense(256, activation=’relu’)(fe1)<br/>
	# sequence model<br/>
	inputs2 = Input(shape=(max_length,))<br/>
	se1 = Embedding(vocab_size, 256, mask_zero=True)(inputs2)<br/>
	se2 = Dropout(0.5)(se1)<br/>
	se3 = LSTM(256)(se2)<br/>
	# decoder model<br/>
	decoder1 = add([fe2, se3])<br/>
	decoder2 = Dense(256, activation=’relu’)(decoder1)<br/>
	outputs = Dense(vocab_size, activation=’softmax’)(decoder2)<br/>
	# tie it together [image, seq] [word]<br/>
	model = Model(inputs=[inputs1, inputs2], outputs=outputs)<br/>
	model.compile(loss=’categorical_crossentropy’, optimizer=’adam’)<br/>
	# summarize model<br/>
	print(model.summary())<br/>
	plot_model(model, to_file=’model.png’, show_shapes=True)<br/>
	return model</p>
<p>Here how can we use this attention Layer. please, will be grateful to you.</p>
<div class="reply">
<a aria-label="Reply to Md. Zakir Hossain" class="comment-reply-link" href="#comment-446100" onclick='return addComment.moveForm( "comment-446100", "446100", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446132">
<div class="comment-container" id="li-comment-446132">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2018 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-446132" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have an example of attention for the photo captioning. I don’t want to give off the cuff advice without developing the code to back it up.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446132" onclick='return addComment.moveForm( "comment-446132", "446132", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-447128">
<div class="comment-container" id="li-comment-447128">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b5ae3cf3834ddd7e8531c8408d02008d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b5ae3cf3834ddd7e8531c8408d02008d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Raza</span>
<span class="date">August 28, 2018 at 4:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447128" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The aforementioned attention decoder doesn’t seem to work with keras version 2.1.6 or versions above 2.0.0, why is so?</p>
<div class="reply">
<a aria-label="Reply to Raza" class="comment-reply-link" href="#comment-447128" onclick='return addComment.moveForm( "comment-447128", "447128", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-447176">
<div class="comment-container" id="li-comment-447176">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2018 at 8:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447176" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry to hear that. Perhaps contact the developer of the new layer?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447176" onclick='return addComment.moveForm( "comment-447176", "447176", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-447237">
<div class="comment-container" id="li-comment-447237">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b5ae3cf3834ddd7e8531c8408d02008d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b5ae3cf3834ddd7e8531c8408d02008d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Raza</span>
<span class="date">August 29, 2018 at 8:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447237" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can above method be used to correct contextual mistakes in sentences?<br/>
e.g<br/>
Input: fishing is suffering from fever<br/>
Expected output: patient is suffering from fever.</p>
<p>If not above, what will you propose for such problem statement.</p>
<div class="reply">
<a aria-label="Reply to Raza" class="comment-reply-link" href="#comment-447237" onclick='return addComment.moveForm( "comment-447237", "447237", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-447273">
<div class="comment-container" id="li-comment-447273">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2018 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447273" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Maybe. Try it and see?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447273" onclick='return addComment.moveForm( "comment-447273", "447273", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-447229">
<div class="comment-container" id="li-comment-447229">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/680d1a0b03bf342d76e3adc0ab5dda94?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/680d1a0b03bf342d76e3adc0ab5dda94?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alice</span>
<span class="date">August 29, 2018 at 3:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447229" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Janson,</p>
<p>You used a list of random number in this post. </p>
<p>I have a list of number (not random) in sequence. How to use my own number as input data to predict the next number as output?  May you give an example?</p>
<p>Thank you!</p>
<p>regards,<br/>
Alice</p>
<div class="reply">
<a aria-label="Reply to Alice" class="comment-reply-link" href="#comment-447229" onclick='return addComment.moveForm( "comment-447229", "447229", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-447269">
<div class="comment-container" id="li-comment-447269">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447269" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What problem are you having exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447269" onclick='return addComment.moveForm( "comment-447269", "447269", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-447890">
<div class="comment-container" id="li-comment-447890">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87d54be0dd7eccc5a5e0a87fe3c6c211?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87d54be0dd7eccc5a5e0a87fe3c6c211?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yasir</span>
<span class="date">September 5, 2018 at 8:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447890" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I am want to find out if you have an example for Copying Mechanism. Thanks.</p>
<div class="reply">
<a aria-label="Reply to Yasir" class="comment-reply-link" href="#comment-447890" onclick='return addComment.moveForm( "comment-447890", "447890", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-447902">
<div class="comment-container" id="li-comment-447902">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 5, 2018 at 2:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-447902" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you mean by “Copying Mechanism”?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447902" onclick='return addComment.moveForm( "comment-447902", "447902", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-448129">
<div class="comment-container" id="li-comment-448129">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fab433b07536c1ba64ff3f64a235e3cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fab433b07536c1ba64ff3f64a235e3cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jackzy</span>
<span class="date">September 7, 2018 at 7:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-448129" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Do you mean pointer-network ?</p>
<div class="reply">
<a aria-label="Reply to jackzy" class="comment-reply-link" href="#comment-448129" onclick='return addComment.moveForm( "comment-448129", "448129", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-448712">
<div class="comment-container" id="li-comment-448712">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ac7ca7c08091bfc88f9cf5426f270e40?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ac7ca7c08091bfc88f9cf5426f270e40?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">victor eloy</span>
<span class="date">September 13, 2018 at 11:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-448712" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>A quick sugestion if you change your LSTM cell by GRU cells after you add the attention layer you will able to get 100% accuracy (what is pretty amazing).</p>
<div class="reply">
<a aria-label="Reply to victor eloy" class="comment-reply-link" href="#comment-448712" onclick='return addComment.moveForm( "comment-448712", "448712", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-448742">
<div class="comment-container" id="li-comment-448742">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 14, 2018 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-448742" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Cool! Nice tip.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-448742" onclick='return addComment.moveForm( "comment-448742", "448742", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-449345">
<div class="comment-container" id="li-comment-449345">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cc61b67e9312cb3fd46e13913c20956f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cc61b67e9312cb3fd46e13913c20956f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gary</span>
<span class="date">September 20, 2018 at 1:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-449345" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, two questions for yout:</p>
<p>1) If I have a CNN followed by LSTM and then I just add an Attention layer, is the architecture still an encoder-decoder?</p>
<p>2) can encoder-decoder model be used in sequence labeling (outputs are IOB labels only), and if yes, why are they not used very often in tasks like named entity recognition where LSTM-CRFs are more popular?</p>
<div class="reply">
<a aria-label="Reply to Gary" class="comment-reply-link" href="#comment-449345" onclick='return addComment.moveForm( "comment-449345", "449345", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-449372">
<div class="comment-container" id="li-comment-449372">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 20, 2018 at 8:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-449372" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure. I think about a CNN-LSTM as an encoder-decoder.</p>
<p>Yes, CNNs and hybrids do very well in sequence classification. I have examples in my new book for human activity recognition.</p>
<p>Also, they do very well with sequences of text, e.g. state of the art for sentiment analysis (a sequence classification task).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449372" onclick='return addComment.moveForm( "comment-449372", "449372", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-451322">
<div class="comment-container" id="li-comment-451322">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/86f9ee9ce8a36663ee8e9344fd1aa4f6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/86f9ee9ce8a36663ee8e9344fd1aa4f6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dave</span>
<span class="date">October 11, 2018 at 11:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-451322" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Enjoyed the post on attention and was able to get your example running great, then modified it to use some real-world data with interesting preliminary results.  Ran into a problem when I saved the model then tried to reload it.  Seems it didn’t recognize the AttentionDecoder. Has anyone else run into this?  Are you aware of any fix?<br/>
Thanks,<br/>
Dave</p>
<div class="reply">
<a aria-label="Reply to Dave" class="comment-reply-link" href="#comment-451322" onclick='return addComment.moveForm( "comment-451322", "451322", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-451337">
<div class="comment-container" id="li-comment-451337">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 11, 2018 at 4:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-451337" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have not tried to save the model, perhaps it requires special handling to save the custom layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451337" onclick='return addComment.moveForm( "comment-451337", "451337", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-453026">
<div class="comment-container" id="li-comment-453026">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/af076e78f189765475ee6c890d641a37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/af076e78f189765475ee6c890d641a37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Judd Brau</span>
<span class="date">October 29, 2018 at 12:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-453026" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>In this article you use the AttentionDecoder model for Seq2Seq learning, but could this model be used to get a context vector for text classification? For example, could this be used to turn a variable length LSTM output into an input for a Feed-forward NN?</p>
<div class="reply">
<a aria-label="Reply to Judd Brau" class="comment-reply-link" href="#comment-453026" onclick='return addComment.moveForm( "comment-453026", "453026", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-453033">
<div class="comment-container" id="li-comment-453033">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 29, 2018 at 2:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-453033" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure I follow, sorry. Perhaps you could elaborate?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453033" onclick='return addComment.moveForm( "comment-453033", "453033", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-453113">
<div class="comment-container" id="li-comment-453113">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/af076e78f189765475ee6c890d641a37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/af076e78f189765475ee6c890d641a37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Judd brau</span>
<span class="date">October 30, 2018 at 8:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-453113" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure. Could this model be used to get a vector that’s value represents the meaning of the entire text? I’m no expert, but when I was researching text classification I saw lots of papers were talking about attention mechnisms, in particular this one: <a href="http://univagora.ro/jour/index.php/ijccc/article/view/3142/pdf" rel="nofollow">http://univagora.ro/jour/index.php/ijccc/article/view/3142/pdf</a></p>
<p>Could the model that you show in this article be used for that purpose too?</p>
<div class="reply">
<a aria-label="Reply to Judd brau" class="comment-reply-link" href="#comment-453113" onclick='return addComment.moveForm( "comment-453113", "453113", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-453126">
<div class="comment-container" id="li-comment-453126">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2018 at 2:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-453126" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps. Sorry, I don’t have a tutorial of LSTMS with attention for text classification.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453126" onclick='return addComment.moveForm( "comment-453126", "453126", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-455040">
<div class="comment-container" id="li-comment-455040">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4da9475fe9401558a2a3d7421edc281e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4da9475fe9401558a2a3d7421edc281e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jairo</span>
<span class="date">November 17, 2018 at 1:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-455040" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your help, Jason. Do you think it’s practical to try to implement Attention using the functional API instead of using a pre-built layer and Sequential?</p>
<div class="reply">
<a aria-label="Reply to Jairo" class="comment-reply-link" href="#comment-455040" onclick='return addComment.moveForm( "comment-455040", "455040", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-455078">
<div class="comment-container" id="li-comment-455078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 17, 2018 at 5:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-455078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455078" onclick='return addComment.moveForm( "comment-455078", "455078", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-455347">
<div class="comment-container" id="li-comment-455347">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1643aeec057b72c8eb5615c6ba48bc20?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1643aeec057b72c8eb5615c6ba48bc20?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zh LM</span>
<span class="date">November 18, 2018 at 10:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-455347" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Why do we train one sample at a epoch and not more?</p>
<p># train LSTM<br/>
for epoch in range(5000):<br/>
	# generate new random sequence<br/>
	X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)<br/>
	# fit model for one epoch on this sequence<br/>
	model.fit(X, y, epochs=1, verbose=2)</p>
<div class="reply">
<a aria-label="Reply to Zh LM" class="comment-reply-link" href="#comment-455347" onclick='return addComment.moveForm( "comment-455347", "455347", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-455436">
<div class="comment-container" id="li-comment-455436">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 19, 2018 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-455436" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We are manually controlling the training epochs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455436" onclick='return addComment.moveForm( "comment-455436", "455436", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-455508">
<div class="comment-container" id="li-comment-455508">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1643aeec057b72c8eb5615c6ba48bc20?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1643aeec057b72c8eb5615c6ba48bc20?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zh LM</span>
<span class="date">November 19, 2018 at 6:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-455508" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>But when I modified the Seq2Seq without attention code as:</p>
<p>batch_size = 10<br/>
epochs = 10</p>
<p># train LSTM<br/>
X_data = []<br/>
y_data = []<br/>
for sample in range(5000):<br/>
    # generate new random sequence<br/>
    X,y = get_pair(n_timesteps_in, n_timesteps_out, n_features)<br/>
    X_data.append(X)<br/>
    y_data.append(y)</p>
<p>X_data = array(X_data).reshape(5000, X.shape[1], X.shape[2])<br/>
y_data = array(y_data).reshape(5000, X.shape[1], X.shape[2])</p>
<p>model.fit(X_data, y_data, batch_size = batch_size, epochs = epochs, verbose = 2)</p>
<p>I got a much higher test accuracy(91.00%) than yours(19.00%),<br/>
did it means that your networks are not trained well when you train one sample at a epoch?</p>
<div class="reply">
<a aria-label="Reply to Zh LM" class="comment-reply-link" href="#comment-455508" onclick='return addComment.moveForm( "comment-455508", "455508", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-455562">
<div class="comment-container" id="li-comment-455562">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 20, 2018 at 6:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#comment-455562" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455562" onclick='return addComment.moveForm( "comment-455562", "455562", "respond", "4549" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/encoder-decoder-attention-sequence-to-sequence-prediction-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4549"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="f554e05e52"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="244"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center><br/>
<strong>Long Short-Term Memory Networks</strong><br/>
Develop sequence prediction models in Keras.
<p><a href="/lstms-with-python/">Click to Get Started Now!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>