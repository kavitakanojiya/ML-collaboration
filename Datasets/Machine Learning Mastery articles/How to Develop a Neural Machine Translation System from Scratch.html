<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop a Neural Machine Translation System from Scratch</title>
<link href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop a Neural Machine Translation System from Scratch" property="og:title"/>
<meta content="Develop a Deep Learning Model to Automatically Translate from German to English in Python with Keras, Step-by-Step. Machine translation is a challenging task that traditionally involves large statistical models developed using highly sophisticated linguistic knowledge. Neural machine translation is the use of deep neural networks for the problem of machine translation. In this tutorial, you …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Natural Language Processing" property="article:section"/>
<meta content="2018-01-09T18:00:47+00:00" property="article:published_time"/>
<meta content="2018-05-18T04:33:19+00:00" property="article:modified_time"/>
<meta content="2018-05-18T04:33:19+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="360" property="og:image:height"/>
<meta content="How to Develop a Neural Machine Translation System in Keras" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop a Neural Machine Translation System from Scratch Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4579" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-neural-machine-translation-system-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-neural-machine-translation-system-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4579 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Want help with deep learning for text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4579 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Develop a Neural Machine Translation System from Scratch</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-01-10T05:00:47+1100">January 10, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Deep Learning for Natural Language Processing">Deep Learning for Natural Language Processing</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4579 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+a+Neural+Machine+Translation+System+from+Scratch&amp;url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<h4 style="text-align: center;">Develop a Deep Learning Model to Automatically<br/>
Translate from German to English in Python with Keras, Step-by-Step.</h4>
<p>Machine translation is a challenging task that traditionally involves large statistical models developed using highly sophisticated linguistic knowledge.</p>
<p>Neural machine translation is the use of deep neural networks for the problem of machine translation.</p>
<p>In this tutorial, you will discover how to develop a neural machine translation system for translating German phrases to English.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to clean and prepare data ready to train a neural machine translation system.</li>
<li>How to develop an encoder-decoder model for machine translation.</li>
<li>How to use a trained model for inference on new input phrases and evaluate the model skill.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4581" style="width: 650px"><img alt="How to Develop a Neural Machine Translation System in Keras" class="size-full wp-image-4581" height="360" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-300x169.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop a Neural Machine Translation System in Keras<br/>Photo by <a href="https://www.flickr.com/photos/damescalito/34527830324/">Björn Groß</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 4 parts; they are:</p>
<ol>
<li>German to English Translation Dataset</li>
<li>Preparing the Text Data</li>
<li>Train Neural Translation Model</li>
<li>Evaluate Neural Translation Model</li>
</ol>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python 3 SciPy environment installed.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have NumPy and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>German to English Translation Dataset</h2>
<p>In this tutorial, we will use a dataset of German to English terms used as the basis for flashcards for language learning.</p>
<p>The dataset is available from the <a href="http://www.manythings.org">ManyThings.org</a> website, with examples drawn from the <a href="http://tatoeba.org/home">Tatoeba Project</a>. The dataset is comprised of German phrases and their English counterparts and is intended to be used with the <a href="https://apps.ankiweb.net/">Anki flashcard software</a>.</p>
<p>The page provides a list of many language pairs, and I encourage you to explore other languages:</p>
<ul>
<li><a href="http://www.manythings.org/anki/">Tab-delimited Bilingual Sentence Pairs</a></li>
</ul>
<p>The dataset we will use in this tutorial is available for download here:</p>
<ul>
<li><a href="http://www.manythings.org/anki/deu-eng.zip">German – English deu-eng.zip</a></li>
</ul>
<p>Download the dataset to your current working directory and decompress; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f3749fb781258460" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
unzip deu-eng.zip</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f3749fb781258460-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f3749fb781258460-1">unzip deu-eng.zip</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>You will have a file called <em>deu.txt</em> that contains 152,820 pairs of English to German phases, one pair per line with a tab separating the language.</p>
<p>For example, the first 5 lines of the file look as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a05725902865" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Hi.	Hallo!
Hi.	Grüß Gott!
Run!	Lauf!
Wow!	Potzdonner!
Wow!	Donnerwetter!</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a05725902865-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a05725902865-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a05725902865-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a05725902865-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a05725902865-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a05725902865-1">Hi.	Hallo!</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a05725902865-2">Hi.	Grüß Gott!</div><div class="crayon-line" id="crayon-5c0ca4f374a05725902865-3">Run!	Lauf!</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a05725902865-4">Wow!	Potzdonner!</div><div class="crayon-line" id="crayon-5c0ca4f374a05725902865-5">Wow!	Donnerwetter!</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We will frame the prediction problem as given a sequence of words in German as input, translate or predict the sequence of words in English.</p>
<p>The model we will develop will be suitable for some beginner German phrases.</p>
<h2>Preparing the Text Data</h2>
<p>The next step is to prepare the text data ready for modeling.</p>
<p>Take a look at the raw data and note what you see that we might need to handle in a data cleaning operation.</p>
<p>For example, here are some observations I note from reviewing the raw data:</p>
<ul>
<li>There is punctuation.</li>
<li>The text contains uppercase and lowercase.</li>
<li>There are special characters in the German.</li>
<li>There are duplicate phrases in English with different translations in German.</li>
<li>The file is ordered by sentence length with very long sentences toward the end of the file.</li>
</ul>
<p>Did you note anything else that could be important?<br/>
Let me know in the comments below.</p>
<p>A good text cleaning procedure may handle some or all of these observations.</p>
<p>Data preparation is divided into two subsections:</p>
<ol>
<li>Clean Text</li>
<li>Split Text</li>
</ol>
<h3>1. Clean Text</h3>
<p>First, we must load the data in a way that preserves the Unicode German characters. The function below called <em>load_doc()</em> will load the file as a blob of text.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a08440862998" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, mode='rt', encoding='utf-8')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a08440862998-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a08440862998-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a08440862998-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a08440862998-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a08440862998-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a08440862998-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a08440862998-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a08440862998-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a08440862998-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a08440862998-1"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a08440862998-2"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a08440862998-3"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a08440862998-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'rt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a08440862998-5"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a08440862998-6"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a08440862998-7"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a08440862998-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a08440862998-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Each line contains a single pair of phrases, first English and then German, separated by a tab character.</p>
<p>We must split the loaded text by line and then by phrase. The function <em>to_pairs()</em> below will split the loaded text.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a09313695649" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split a loaded document into sentences
def to_pairs(doc):
	lines = doc.strip().split('\n')
	pairs = [line.split('\t') for line in  lines]
	return pairs</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a09313695649-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a09313695649-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a09313695649-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a09313695649-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a09313695649-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a09313695649-1"><span class="crayon-p"># split a loaded document into sentences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a09313695649-2"><span class="crayon-e">def </span><span class="crayon-e">to_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a09313695649-3"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\n'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a09313695649-4"><span class="crayon-h"> </span><span class="crayon-v">pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\t'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h">  </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4f374a09313695649-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pairs</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We are now ready to clean each sentence. The specific cleaning operations we will perform are as follows:</p>
<ul>
<li>Remove all non-printable characters.</li>
<li>Remove all punctuation characters.</li>
<li>Normalize all Unicode characters to ASCII (e.g. Latin characters).</li>
<li>Normalize the case to lowercase.</li>
<li>Remove any remaining tokens that are not alphabetic.</li>
</ul>
<p>We will perform these operations on each phrase for each pair in the loaded dataset.</p>
<p>The <em>clean_pairs()</em> function below implements these operations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a0b691046516" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# clean a list of lines
def clean_pairs(lines):
	cleaned = list()
	# prepare regex for char filtering
	re_print = re.compile('[^%s]' % re.escape(string.printable))
	# prepare translation table for removing punctuation
	table = str.maketrans('', '', string.punctuation)
	for pair in lines:
		clean_pair = list()
		for line in pair:
			# normalize unicode characters
			line = normalize('NFD', line).encode('ascii', 'ignore')
			line = line.decode('UTF-8')
			# tokenize on white space
			line = line.split()
			# convert to lowercase
			line = [word.lower() for word in line]
			# remove punctuation from each token
			line = [word.translate(table) for word in line]
			# remove non-printable chars form each token
			line = [re_print.sub('', w) for w in line]
			# remove tokens with numbers in them
			line = [word for word in line if word.isalpha()]
			# store as string
			clean_pair.append(' '.join(line))
		cleaned.append(clean_pair)
	return array(cleaned)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0b691046516-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0b691046516-27">27</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-1"><span class="crayon-p"># clean a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-2"><span class="crayon-e">def </span><span class="crayon-e">clean_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-3"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-4"><span class="crayon-h"> </span><span class="crayon-p"># prepare regex for char filtering</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-5"><span class="crayon-h"> </span><span class="crayon-v">re_print</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'[^%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">printable</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-6"><span class="crayon-h"> </span><span class="crayon-p"># prepare translation table for removing punctuation</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-7"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pair </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-9"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-10"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pair</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-11"><span class="crayon-h"> </span><span class="crayon-p"># normalize unicode characters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-12"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">normalize</span><span class="crayon-sy">(</span><span class="crayon-s">'NFD'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-s">'ascii'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'ignore'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-13"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'UTF-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-14"><span class="crayon-h"> </span><span class="crayon-p"># tokenize on white space</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-15"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-16"><span class="crayon-h"> </span><span class="crayon-p"># convert to lowercase</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-17"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-18"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-19"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-20"><span class="crayon-h"> </span><span class="crayon-p"># remove non-printable chars form each token</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-21"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">re_print</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-22"><span class="crayon-h"> </span><span class="crayon-p"># remove tokens with numbers in them</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-23"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-24"><span class="crayon-h"> </span><span class="crayon-p"># store as string</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-25"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0b691046516-26"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">clean_pair</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0b691046516-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">cleaned</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>Finally, now that the data has been cleaned, we can save the list of phrase pairs to a file ready for use.</p>
<p>The function <em>save_clean_data()</em> uses the pickle API to save the list of clean text to file.</p>
<p>Pulling all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a0d502823855" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import string
import re
from pickle import dump
from unicodedata import normalize
from numpy import array

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, mode='rt', encoding='utf-8')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# split a loaded document into sentences
def to_pairs(doc):
	lines = doc.strip().split('\n')
	pairs = [line.split('\t') for line in  lines]
	return pairs

# clean a list of lines
def clean_pairs(lines):
	cleaned = list()
	# prepare regex for char filtering
	re_print = re.compile('[^%s]' % re.escape(string.printable))
	# prepare translation table for removing punctuation
	table = str.maketrans('', '', string.punctuation)
	for pair in lines:
		clean_pair = list()
		for line in pair:
			# normalize unicode characters
			line = normalize('NFD', line).encode('ascii', 'ignore')
			line = line.decode('UTF-8')
			# tokenize on white space
			line = line.split()
			# convert to lowercase
			line = [word.lower() for word in line]
			# remove punctuation from each token
			line = [word.translate(table) for word in line]
			# remove non-printable chars form each token
			line = [re_print.sub('', w) for w in line]
			# remove tokens with numbers in them
			line = [word for word in line if word.isalpha()]
			# store as string
			clean_pair.append(' '.join(line))
		cleaned.append(clean_pair)
	return array(cleaned)

# save a list of clean sentences to file
def save_clean_data(sentences, filename):
	dump(sentences, open(filename, 'wb'))
	print('Saved: %s' % filename)

# load dataset
filename = 'deu.txt'
doc = load_doc(filename)
# split into english-german pairs
pairs = to_pairs(doc)
# clean sentences
clean_pairs = clean_pairs(pairs)
# save clean pairs to file
save_clean_data(clean_pairs, 'english-german.pkl')
# spot check
for i in range(100):
	print('[%s] =&gt; [%s]' % (clean_pairs[i,0], clean_pairs[i,1]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a0d502823855-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4f374a0d502823855-67">67</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-1"><span class="crayon-e">import </span><span class="crayon-t">string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-2"><span class="crayon-e">import </span><span class="crayon-e">re</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-3"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">dump</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-4"><span class="crayon-e">from </span><span class="crayon-e">unicodedata </span><span class="crayon-e">import </span><span class="crayon-e">normalize</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-6"> </div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-7"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-8"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-9"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-10"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'rt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-11"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-12"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-13"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-14"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-16"> </div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-17"><span class="crayon-p"># split a loaded document into sentences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-18"><span class="crayon-e">def </span><span class="crayon-e">to_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-19"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\n'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-20"><span class="crayon-h"> </span><span class="crayon-v">pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\t'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h">  </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-22"> </div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-23"><span class="crayon-p"># clean a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-24"><span class="crayon-e">def </span><span class="crayon-e">clean_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-25"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-26"><span class="crayon-h"> </span><span class="crayon-p"># prepare regex for char filtering</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-27"><span class="crayon-h"> </span><span class="crayon-v">re_print</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'[^%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">printable</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-28"><span class="crayon-h"> </span><span class="crayon-p"># prepare translation table for removing punctuation</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-29"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-30"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pair </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-31"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-32"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pair</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-33"><span class="crayon-h"> </span><span class="crayon-p"># normalize unicode characters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-34"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">normalize</span><span class="crayon-sy">(</span><span class="crayon-s">'NFD'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-s">'ascii'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'ignore'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-35"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'UTF-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-36"><span class="crayon-h"> </span><span class="crayon-p"># tokenize on white space</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-37"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-38"><span class="crayon-h"> </span><span class="crayon-p"># convert to lowercase</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-39"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-40"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-41"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-42"><span class="crayon-h"> </span><span class="crayon-p"># remove non-printable chars form each token</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-43"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">re_print</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-44"><span class="crayon-h"> </span><span class="crayon-p"># remove tokens with numbers in them</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-45"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-46"><span class="crayon-h"> </span><span class="crayon-p"># store as string</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-47"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-48"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">clean_pair</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-49"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">cleaned</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-50"> </div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-51"><span class="crayon-p"># save a list of clean sentences to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-52"><span class="crayon-e">def </span><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-53"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-54"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-55"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-56"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-57"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'deu.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-58"><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-59"><span class="crayon-p"># split into english-german pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-60"><span class="crayon-v">pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-61"><span class="crayon-p"># clean sentences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-62"><span class="crayon-v">clean_pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">pairs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-63"><span class="crayon-p"># save clean pairs to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-64"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">clean_pairs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-65"><span class="crayon-p"># spot check</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a0d502823855-66"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a0d502823855-67"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'[%s] =&gt; [%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">clean_pairs</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clean_pairs</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0036 seconds] -->
<p>Running the example creates a new file in the current working directory with the cleaned text called <em>english-german.pkl</em>.</p>
<p>Some examples of the clean text are printed for us to evaluate at the end of the run to confirm that the clean operations were performed as expected.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a11000040632" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[hi] =&gt; [hallo]
[hi] =&gt; [gru gott]
[run] =&gt; [lauf]
[wow] =&gt; [potzdonner]
[wow] =&gt; [donnerwetter]
[fire] =&gt; [feuer]
[help] =&gt; [hilfe]
[help] =&gt; [zu hulf]
[stop] =&gt; [stopp]
[wait] =&gt; [warte]
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a11000040632-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a11000040632-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a11000040632-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a11000040632-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a11000040632-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a11000040632-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a11000040632-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a11000040632-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a11000040632-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a11000040632-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a11000040632-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a11000040632-1">[hi] =&gt; [hallo]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a11000040632-2">[hi] =&gt; [gru gott]</div><div class="crayon-line" id="crayon-5c0ca4f374a11000040632-3">[run] =&gt; [lauf]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a11000040632-4">[wow] =&gt; [potzdonner]</div><div class="crayon-line" id="crayon-5c0ca4f374a11000040632-5">[wow] =&gt; [donnerwetter]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a11000040632-6">[fire] =&gt; [feuer]</div><div class="crayon-line" id="crayon-5c0ca4f374a11000040632-7">[help] =&gt; [hilfe]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a11000040632-8">[help] =&gt; [zu hulf]</div><div class="crayon-line" id="crayon-5c0ca4f374a11000040632-9">[stop] =&gt; [stopp]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a11000040632-10">[wait] =&gt; [warte]</div><div class="crayon-line" id="crayon-5c0ca4f374a11000040632-11">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h3>2. Split Text</h3>
<p>The clean data contains a little over 150,000 phrase pairs and some of the pairs toward the end of the file are very long.</p>
<p>This is a good number of examples for developing a small translation model. The complexity of the model increases with the number of examples, length of phrases, and size of the vocabulary.</p>
<p>Although we have a good dataset for modeling translation, we will simplify the problem slightly to dramatically reduce the size of the model required, and in turn the training time required to fit the model.</p>
<p>You can explore developing a model on the fuller dataset as an extension; I would love to hear how you do.</p>
<p>We will simplify the problem by reducing the dataset to the first 10,000 examples in the file; these will be the shortest phrases in the dataset.</p>
<p>Further, we will then stake the first 9,000 of those as examples for training and the remaining 1,000 examples to test the fit model.</p>
<p>Below is the complete example of loading the clean data, splitting it, and saving the split portions of data to new files.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a14208963565" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from pickle import dump
from numpy.random import rand
from numpy.random import shuffle

# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# save a list of clean sentences to file
def save_clean_data(sentences, filename):
	dump(sentences, open(filename, 'wb'))
	print('Saved: %s' % filename)

# load dataset
raw_dataset = load_clean_sentences('english-german.pkl')

# reduce dataset size
n_sentences = 10000
dataset = raw_dataset[:n_sentences, :]
# random shuffle
shuffle(dataset)
# split into train/test
train, test = dataset[:9000], dataset[9000:]
# save
save_clean_data(dataset, 'english-german-both.pkl')
save_clean_data(train, 'english-german-train.pkl')
save_clean_data(test, 'english-german-test.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4f374a14208963565-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a14208963565-28">28</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-2"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">dump</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-3"><span class="crayon-e">from </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">rand</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-4"><span class="crayon-e">from </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-v">shuffle</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-6"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-7"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-10"><span class="crayon-p"># save a list of clean sentences to file</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-11"><span class="crayon-e">def </span><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-12"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-13"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-14"> </div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-15"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-16"><span class="crayon-v">raw_dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-18"><span class="crayon-p"># reduce dataset size</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-19"><span class="crayon-v">n_sentences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-20"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-21"><span class="crayon-p"># random shuffle</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-22"><span class="crayon-e">shuffle</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-23"><span class="crayon-p"># split into train/test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-24"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">9000</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">9000</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-25"><span class="crayon-p"># save</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-26"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a14208963565-27"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a14208963565-28"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Running the example creates three new files: the <em>english-german-both.pkl</em> that contains all of the train and test examples that we can use to define the parameters of the problem, such as max phrase lengths and the vocabulary, and the <em>english-german-train.pkl</em> and <em>english-german-test.pkl</em> files for the train and test dataset.</p>
<p>We are now ready to start developing our translation model.</p>
<h2>Train Neural Translation Model</h2>
<p>In this section, we will develop the translation model.</p>
<p>This involves both loading and preparing the clean text data ready for modeling and defining and training the model on the prepared data.</p>
<p>Let’s start off by loading the datasets so that we can prepare the data. The function below named <em>load_clean_sentences()</em> can be used to load the train, test, and both datasets in turn.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a16735135319" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a16735135319-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a16735135319-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a16735135319-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a16735135319-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a16735135319-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a16735135319-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a16735135319-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a16735135319-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a16735135319-1"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a16735135319-2"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a16735135319-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a16735135319-4"> </div><div class="crayon-line" id="crayon-5c0ca4f374a16735135319-5"><span class="crayon-p"># load datasets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a16735135319-6"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a16735135319-7"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a16735135319-8"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We will use the “both” or combination of the train and test datasets to define the maximum length and vocabulary of the problem.</p>
<p>This is for simplicity. Alternately, we could define these properties from the training dataset alone and truncate examples in the test set that are too long or have words that are out of the vocabulary.</p>
<p>We can use the Keras <em>Tokenize</em> class to map words to integers, as needed for modeling. We will use separate tokenizer for the English sequences and the German sequences. The function below-named <em>create_tokenizer()</em> will train a tokenizer on a list of phrases.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a18128278700" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a18128278700-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a18128278700-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a18128278700-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a18128278700-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a18128278700-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a18128278700-1"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a18128278700-2"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a18128278700-3"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a18128278700-4"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a18128278700-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Similarly, the function named <em>max_length()</em> below will find the length of the longest sequence in a list of phrases.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a1a998445595" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# max sentence length
def max_length(lines):
	return max(len(line.split()) for line in lines)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a1a998445595-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1a998445595-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1a998445595-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a1a998445595-1"><span class="crayon-p"># max sentence length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1a998445595-2"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1a998445595-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can call these functions with the combined dataset to prepare tokenizers, vocabulary sizes, and maximum lengths for both the English and German phrases.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a1c064905931" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
print('English Vocabulary Size: %d' % eng_vocab_size)
print('English Max Length: %d' % (eng_length))
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
print('German Vocabulary Size: %d' % ger_vocab_size)
print('German Max Length: %d' % (ger_length))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a1c064905931-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1c064905931-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1c064905931-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1c064905931-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1c064905931-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1c064905931-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1c064905931-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1c064905931-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1c064905931-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1c064905931-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1c064905931-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1c064905931-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a1c064905931-1"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1c064905931-2"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1c064905931-3"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1c064905931-4"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1c064905931-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1c064905931-6"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">eng_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1c064905931-7"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1c064905931-8"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1c064905931-9"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1c064905931-10"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1c064905931-11"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1c064905931-12"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ger_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We are now ready to prepare the training dataset.</p>
<p>Each input and output sequence must be encoded to integers and padded to the maximum phrase length. This is because we will use a word embedding for the input sequences and one hot encode the output sequences The function below named <em>encode_sequences()</em> will perform these operations and return the result.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a1e921463805" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# encode and pad sequences
def encode_sequences(tokenizer, length, lines):
	# integer encode sequences
	X = tokenizer.texts_to_sequences(lines)
	# pad sequences with 0 values
	X = pad_sequences(X, maxlen=length, padding='post')
	return X</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a1e921463805-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1e921463805-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1e921463805-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1e921463805-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1e921463805-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1e921463805-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1e921463805-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a1e921463805-1"><span class="crayon-p"># encode and pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1e921463805-2"><span class="crayon-e">def </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1e921463805-3"><span class="crayon-h"> </span><span class="crayon-p"># integer encode sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1e921463805-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1e921463805-5"><span class="crayon-h"> </span><span class="crayon-p"># pad sequences with 0 values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1e921463805-6"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1e921463805-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>The output sequence needs to be one-hot encoded. This is because the model will predict the probability of each word in the vocabulary as output.</p>
<p>The function <em>encode_output()</em> below will one-hot encode English output sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a1f354667317" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# one hot encode target sequence
def encode_output(sequences, vocab_size):
	ylist = list()
	for sequence in sequences:
		encoded = to_categorical(sequence, num_classes=vocab_size)
		ylist.append(encoded)
	y = array(ylist)
	y = y.reshape(sequences.shape[0], sequences.shape[1], vocab_size)
	return y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a1f354667317-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1f354667317-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1f354667317-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1f354667317-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1f354667317-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1f354667317-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1f354667317-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a1f354667317-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a1f354667317-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a1f354667317-1"><span class="crayon-p"># one hot encode target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1f354667317-2"><span class="crayon-e">def </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1f354667317-3"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1f354667317-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">sequence </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1f354667317-5"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1f354667317-6"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1f354667317-7"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">ylist</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a1f354667317-8"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a1f354667317-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can make use of these two functions and prepare both the train and test dataset ready for training the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a21330543290" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare training data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
trainY = encode_sequences(eng_tokenizer, eng_length, train[:, 0])
trainY = encode_output(trainY, eng_vocab_size)
# prepare validation data
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])
testY = encode_sequences(eng_tokenizer, eng_length, test[:, 0])
testY = encode_output(testY, eng_vocab_size)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a21330543290-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a21330543290-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a21330543290-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a21330543290-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a21330543290-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a21330543290-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a21330543290-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a21330543290-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a21330543290-1"><span class="crayon-p"># prepare training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a21330543290-2"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a21330543290-3"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a21330543290-4"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a21330543290-5"><span class="crayon-p"># prepare validation data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a21330543290-6"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a21330543290-7"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a21330543290-8"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We are now ready to define the model.</p>
<p>We will use an encoder-decoder LSTM model on this problem. In this architecture, the input sequence is encoded by a front-end model called the encoder then decoded word by word by a backend model called the decoder.</p>
<p>The function <em>define_model()</em> below defines the model and takes a number of arguments used to configure the model, such as the size of the input and output vocabularies, the maximum length of input and output phrases, and the number of memory units used to configure the model.</p>
<p>The model is trained using the efficient Adam approach to stochastic gradient descent and minimizes the categorical loss function because we have framed the prediction problem as multi-class classification.</p>
<p>The model configuration was not optimized for this problem, meaning that there is plenty of opportunity for you to tune it and lift the skill of the translations. I would love to see what you can come up with.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a23912534980" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define NMT model
def define_model(src_vocab, tar_vocab, src_timesteps, tar_timesteps, n_units):
	model = Sequential()
	model.add(Embedding(src_vocab, n_units, input_length=src_timesteps, mask_zero=True))
	model.add(LSTM(n_units))
	model.add(RepeatVector(tar_timesteps))
	model.add(LSTM(n_units, return_sequences=True))
	model.add(TimeDistributed(Dense(tar_vocab, activation='softmax')))
	return model

# define model
model = define_model(ger_vocab_size, eng_vocab_size, ger_length, eng_length, 256)
model.compile(optimizer='adam', loss='categorical_crossentropy')
# summarize defined model
print(model.summary())
plot_model(model, to_file='model.png', show_shapes=True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a23912534980-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a23912534980-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-1"><span class="crayon-p"># define NMT model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-2"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mask_zero</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-6"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-8"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-10"> </div><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-11"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-12"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-13"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-14"><span class="crayon-p"># summarize defined model</span></div><div class="crayon-line" id="crayon-5c0ca4f374a23912534980-15"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a23912534980-16"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Finally, we can train the model.</p>
<p>We train the model for 30 epochs and a batch size of 64 examples.</p>
<p>We use checkpointing to ensure that each time the model skill on the test set improves, the model is saved to file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a25353603248" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit model
filename = 'model.h5'
checkpoint = ModelCheckpoint(filename, monitor='val_loss', verbose=1, save_best_only=True, mode='min')
model.fit(trainX, trainY, epochs=30, batch_size=64, validation_data=(testX, testY), callbacks=[checkpoint], verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a25353603248-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a25353603248-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a25353603248-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a25353603248-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a25353603248-1"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a25353603248-2"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'model.h5'</span></div><div class="crayon-line" id="crayon-5c0ca4f374a25353603248-3"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a25353603248-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validation_data</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can tie all of this together and fit the neural translation model.</p>
<p>The complete working example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a27775995677" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from numpy import array
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.utils import to_categorical
from keras.utils.vis_utils import plot_model
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import Embedding
from keras.layers import RepeatVector
from keras.layers import TimeDistributed
from keras.callbacks import ModelCheckpoint

# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# max sentence length
def max_length(lines):
	return max(len(line.split()) for line in lines)

# encode and pad sequences
def encode_sequences(tokenizer, length, lines):
	# integer encode sequences
	X = tokenizer.texts_to_sequences(lines)
	# pad sequences with 0 values
	X = pad_sequences(X, maxlen=length, padding='post')
	return X

# one hot encode target sequence
def encode_output(sequences, vocab_size):
	ylist = list()
	for sequence in sequences:
		encoded = to_categorical(sequence, num_classes=vocab_size)
		ylist.append(encoded)
	y = array(ylist)
	y = y.reshape(sequences.shape[0], sequences.shape[1], vocab_size)
	return y

# define NMT model
def define_model(src_vocab, tar_vocab, src_timesteps, tar_timesteps, n_units):
	model = Sequential()
	model.add(Embedding(src_vocab, n_units, input_length=src_timesteps, mask_zero=True))
	model.add(LSTM(n_units))
	model.add(RepeatVector(tar_timesteps))
	model.add(LSTM(n_units, return_sequences=True))
	model.add(TimeDistributed(Dense(tar_vocab, activation='softmax')))
	return model

# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')

# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
print('English Vocabulary Size: %d' % eng_vocab_size)
print('English Max Length: %d' % (eng_length))
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
print('German Vocabulary Size: %d' % ger_vocab_size)
print('German Max Length: %d' % (ger_length))

# prepare training data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
trainY = encode_sequences(eng_tokenizer, eng_length, train[:, 0])
trainY = encode_output(trainY, eng_vocab_size)
# prepare validation data
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])
testY = encode_sequences(eng_tokenizer, eng_length, test[:, 0])
testY = encode_output(testY, eng_vocab_size)

# define model
model = define_model(ger_vocab_size, eng_vocab_size, ger_length, eng_length, 256)
model.compile(optimizer='adam', loss='categorical_crossentropy')
# summarize defined model
print(model.summary())
plot_model(model, to_file='model.png', show_shapes=True)
# fit model
filename = 'model.h5'
checkpoint = ModelCheckpoint(filename, monitor='val_loss', verbose=1, save_best_only=True, mode='min')
model.fit(trainX, trainY, epochs=30, batch_size=64, validation_data=(testX, testY), callbacks=[checkpoint], verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-68">68</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-70">70</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-72">72</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-74">74</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-76">76</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-78">78</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-80">80</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-82">82</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-84">84</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-86">86</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-88">88</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-90">90</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a27775995677-92">92</div><div class="crayon-num" data-line="crayon-5c0ca4f374a27775995677-93">93</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-e">plot_model</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">RepeatVector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-v">ModelCheckpoint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-14"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-15"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-16"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-18"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-19"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-20"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-21"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-22"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-24"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-25"><span class="crayon-p"># max sentence length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-26"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-28"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-29"><span class="crayon-p"># encode and pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-30"><span class="crayon-e">def </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-31"><span class="crayon-h"> </span><span class="crayon-p"># integer encode sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-33"><span class="crayon-h"> </span><span class="crayon-p"># pad sequences with 0 values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-34"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-36"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-37"><span class="crayon-p"># one hot encode target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-38"><span class="crayon-e">def </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-39"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-40"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">sequence </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-41"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-42"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-43"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">ylist</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-44"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-45"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-46"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-47"><span class="crayon-p"># define NMT model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-48"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-49"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-50"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mask_zero</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-51"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-52"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-53"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-55"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-56"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-57"><span class="crayon-p"># load datasets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-58"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-59"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-60"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-61"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-62"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-63"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-64"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-65"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-66"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-67"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">eng_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-68"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-69"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-70"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-71"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-72"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-73"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ger_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-74"> </div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-75"><span class="crayon-p"># prepare training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-76"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-77"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-78"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-79"><span class="crayon-p"># prepare validation data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-80"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-81"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-82"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-83"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-84"><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-85"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-86"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-87"><span class="crayon-p"># summarize defined model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-88"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-89"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-90"><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-91"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'model.h5'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a27775995677-92"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a27775995677-93"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validation_data</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0048 seconds] -->
<p>Running the example first prints a summary of the parameters of the dataset such as vocabulary size and maximum phrase lengths.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a29106616461" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
English Vocabulary Size: 2404
English Max Length: 5
German Vocabulary Size: 3856
German Max Length: 10</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a29106616461-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a29106616461-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a29106616461-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a29106616461-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a29106616461-1">English Vocabulary Size: 2404</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a29106616461-2">English Max Length: 5</div><div class="crayon-line" id="crayon-5c0ca4f374a29106616461-3">German Vocabulary Size: 3856</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a29106616461-4">German Max Length: 10</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Next, a summary of the defined model is printed, allowing us to confirm the model configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a2c178119142" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding_1 (Embedding)      (None, 10, 256)           987136
_________________________________________________________________
lstm_1 (LSTM)                (None, 256)               525312
_________________________________________________________________
repeat_vector_1 (RepeatVecto (None, 5, 256)            0
_________________________________________________________________
lstm_2 (LSTM)                (None, 5, 256)            525312
_________________________________________________________________
time_distributed_1 (TimeDist (None, 5, 2404)           617828
=================================================================
Total params: 2,655,588
Trainable params: 2,655,588
Non-trainable params: 0
_________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2c178119142-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2c178119142-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-1">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-2">Layer (type)                 Output Shape              Param #</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-3">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-4">embedding_1 (Embedding)      (None, 10, 256)           987136</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-5">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-6">lstm_1 (LSTM)                (None, 256)               525312</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-7">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-8">repeat_vector_1 (RepeatVecto (None, 5, 256)            0</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-9">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-10">lstm_2 (LSTM)                (None, 5, 256)            525312</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-11">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-12">time_distributed_1 (TimeDist (None, 5, 2404)           617828</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-13">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-14">Total params: 2,655,588</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-15">Trainable params: 2,655,588</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2c178119142-16">Non-trainable params: 0</div><div class="crayon-line" id="crayon-5c0ca4f374a2c178119142-17">_________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A plot of the model is also created providing another perspective on the model configuration.</p>
<div class="wp-caption aligncenter" id="attachment_4580" style="width: 665px"><img alt="Plot of Model Graph for NMT" class="size-full wp-image-4580" height="627" sizes="(max-width: 655px) 100vw, 655px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-Model-Graph-for-NMT.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-Model-Graph-for-NMT.png 655w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-Model-Graph-for-NMT-300x287.png 300w" width="655"/><p class="wp-caption-text">Plot of Model Graph for NMT</p></div>
<p>Next, the model is trained.</p>
<p>Each epoch takes about 30 seconds on modern CPU hardware; no GPU is required.</p>
<p>During the run, the model will be saved to the file <em>model.h5</em>, ready for inference in the next step.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a2d665776437" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 26/30
Epoch 00025: val_loss improved from 2.20048 to 2.19976, saving model to model.h5
17s - loss: 0.7114 - val_loss: 2.1998
Epoch 27/30
Epoch 00026: val_loss improved from 2.19976 to 2.18255, saving model to model.h5
17s - loss: 0.6532 - val_loss: 2.1826
Epoch 28/30
Epoch 00027: val_loss did not improve
17s - loss: 0.5970 - val_loss: 2.1970
Epoch 29/30
Epoch 00028: val_loss improved from 2.18255 to 2.17872, saving model to model.h5
17s - loss: 0.5474 - val_loss: 2.1787
Epoch 30/30
Epoch 00029: val_loss did not improve
17s - loss: 0.5023 - val_loss: 2.1823</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a2d665776437-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a2d665776437-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-2">Epoch 26/30</div><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-3">Epoch 00025: val_loss improved from 2.20048 to 2.19976, saving model to model.h5</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-4">17s - loss: 0.7114 - val_loss: 2.1998</div><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-5">Epoch 27/30</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-6">Epoch 00026: val_loss improved from 2.19976 to 2.18255, saving model to model.h5</div><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-7">17s - loss: 0.6532 - val_loss: 2.1826</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-8">Epoch 28/30</div><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-9">Epoch 00027: val_loss did not improve</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-10">17s - loss: 0.5970 - val_loss: 2.1970</div><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-11">Epoch 29/30</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-12">Epoch 00028: val_loss improved from 2.18255 to 2.17872, saving model to model.h5</div><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-13">17s - loss: 0.5474 - val_loss: 2.1787</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-14">Epoch 30/30</div><div class="crayon-line" id="crayon-5c0ca4f374a2d665776437-15">Epoch 00029: val_loss did not improve</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a2d665776437-16">17s - loss: 0.5023 - val_loss: 2.1823</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Evaluate Neural Translation Model</h2>
<p>We will evaluate the model on the train and the test dataset.</p>
<p>The model should perform very well on the train dataset and ideally have been generalized to perform well on the test dataset.</p>
<p>Ideally, we would use a separate validation dataset to help with model selection during training instead of the test set. You can try this as an extension.</p>
<p>The clean datasets must be loaded and prepared as before.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a30856295736" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')
# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
# prepare data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a30856295736-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a30856295736-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-2"><span class="crayon-p"># load datasets</span></div><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-3"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-4"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-5"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-6"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-7"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-8"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-9"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-10"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-11"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-12"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-13"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-14"><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0ca4f374a30856295736-15"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a30856295736-16"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Next, the best model saved during training must be loaded.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a32135595791" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load model
model = load_model('model.h5')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a32135595791-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a32135595791-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a32135595791-1"><span class="crayon-p"># load model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a32135595791-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Evaluation involves two steps: first generating a translated output sequence, and then repeating this process for many input examples and summarizing the skill of the model across multiple cases.</p>
<p>Starting with inference, the model can predict the entire output sequence in a one-shot manner.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a33825415828" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
translation = model.predict(source, verbose=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a33825415828-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a33825415828-1"><span class="crayon-v">translation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>This will be a sequence of integers that we can enumerate and lookup in the tokenizer to map back to words.</p>
<p>The function below, named <em>word_for_id()</em>, will perform this reverse mapping.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a35387236649" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# map an integer to a word
def word_for_id(integer, tokenizer):
	for word, index in tokenizer.word_index.items():
		if index == integer:
			return word
	return None</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a35387236649-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a35387236649-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a35387236649-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a35387236649-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a35387236649-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a35387236649-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a35387236649-1"><span class="crayon-p"># map an integer to a word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a35387236649-2"><span class="crayon-e">def </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-t">integer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a35387236649-3"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a35387236649-4"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">integer</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a35387236649-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a35387236649-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can perform this mapping for each integer in the translation and return the result as a string of words.</p>
<p>The function <em>predict_sequence()</em> below performs this operation for a single encoded source phrase.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a36703896937" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate target given source sequence
def predict_sequence(model, tokenizer, source):
	prediction = model.predict(source, verbose=0)[0]
	integers = [argmax(vector) for vector in prediction]
	target = list()
	for i in integers:
		word = word_for_id(i, tokenizer)
		if word is None:
			break
		target.append(word)
	return ' '.join(target)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a36703896937-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a36703896937-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a36703896937-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a36703896937-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a36703896937-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a36703896937-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a36703896937-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a36703896937-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a36703896937-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a36703896937-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a36703896937-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a36703896937-1"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a36703896937-2"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a36703896937-3"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a36703896937-4"><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4f374a36703896937-5"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a36703896937-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a36703896937-7"><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a36703896937-8"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a36703896937-9"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a36703896937-10"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a36703896937-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Next, we can repeat this for each source phrase in a dataset and compare the predicted result to the expected target phrase in English.</p>
<p>We can print some of these comparisons to screen to get an idea of how the model performs in practice.</p>
<p>We will also calculate the BLEU scores to get a quantitative idea of how well the model has performed.</p>
<p>The <em>evaluate_model()</em> function below implements this, calling the above <em>predict_sequence()</em> function for each phrase in a provided dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a38041832481" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate the skill of the model
def evaluate_model(model, tokenizer, sources, raw_dataset):
	actual, predicted = list(), list()
	for i, source in enumerate(sources):
		# translate encoded source text
		source = source.reshape((1, source.shape[0]))
		translation = predict_sequence(model, eng_tokenizer, source)
		raw_target, raw_src = raw_dataset[i]
		if i &lt; 10:
			print('src=[%s], target=[%s], predicted=[%s]' % (raw_src, raw_target, translation))
		actual.append(raw_target.split())
		predicted.append(translation.split())
	# calculate BLEU score
	print('BLEU-1: %f' % corpus_bleu(actual, predicted, weights=(1.0, 0, 0, 0)))
	print('BLEU-2: %f' % corpus_bleu(actual, predicted, weights=(0.5, 0.5, 0, 0)))
	print('BLEU-3: %f' % corpus_bleu(actual, predicted, weights=(0.3, 0.3, 0.3, 0)))
	print('BLEU-4: %f' % corpus_bleu(actual, predicted, weights=(0.25, 0.25, 0.25, 0.25)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a38041832481-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4f374a38041832481-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-1"><span class="crayon-p"># evaluate the skill of the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sources</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-3"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">source </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">sources</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-5"><span class="crayon-h"> </span><span class="crayon-p"># translate encoded source text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-6"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-7"><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-8"><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-10"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'src=[%s], target=[%s], predicted=[%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">raw_src</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-11"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">raw_target</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-12"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">translation</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-13"><span class="crayon-h"> </span><span class="crayon-p"># calculate BLEU score</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-14"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-1: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-15"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-2: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a38041832481-16"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-3: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a38041832481-17"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-4: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>We can tie all of this together and evaluate the loaded model on both the training and test datasets.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a3b902285244" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from numpy import array
from numpy import argmax
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import load_model
from nltk.translate.bleu_score import corpus_bleu

# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# max sentence length
def max_length(lines):
	return max(len(line.split()) for line in lines)

# encode and pad sequences
def encode_sequences(tokenizer, length, lines):
	# integer encode sequences
	X = tokenizer.texts_to_sequences(lines)
	# pad sequences with 0 values
	X = pad_sequences(X, maxlen=length, padding='post')
	return X

# map an integer to a word
def word_for_id(integer, tokenizer):
	for word, index in tokenizer.word_index.items():
		if index == integer:
			return word
	return None

# generate target given source sequence
def predict_sequence(model, tokenizer, source):
	prediction = model.predict(source, verbose=0)[0]
	integers = [argmax(vector) for vector in prediction]
	target = list()
	for i in integers:
		word = word_for_id(i, tokenizer)
		if word is None:
			break
		target.append(word)
	return ' '.join(target)

# evaluate the skill of the model
def evaluate_model(model, tokenizer, sources, raw_dataset):
	actual, predicted = list(), list()
	for i, source in enumerate(sources):
		# translate encoded source text
		source = source.reshape((1, source.shape[0]))
		translation = predict_sequence(model, eng_tokenizer, source)
		raw_target, raw_src = raw_dataset[i]
		if i &lt; 10:
			print('src=[%s], target=[%s], predicted=[%s]' % (raw_src, raw_target, translation))
		actual.append(raw_target.split())
		predicted.append(translation.split())
	# calculate BLEU score
	print('BLEU-1: %f' % corpus_bleu(actual, predicted, weights=(1.0, 0, 0, 0)))
	print('BLEU-2: %f' % corpus_bleu(actual, predicted, weights=(0.5, 0.5, 0, 0)))
	print('BLEU-3: %f' % corpus_bleu(actual, predicted, weights=(0.3, 0.3, 0.3, 0)))
	print('BLEU-4: %f' % corpus_bleu(actual, predicted, weights=(0.25, 0.25, 0.25, 0.25)))

# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')
# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
# prepare data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])

# load model
model = load_model('model.h5')
# test on some training sequences
print('train')
evaluate_model(model, eng_tokenizer, trainX, train)
# test on some test sequences
print('test')
evaluate_model(model, eng_tokenizer, testX, test)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-16">16</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-18">18</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-20">20</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-22">22</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-24">24</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-26">26</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-28">28</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-30">30</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-32">32</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-34">34</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-36">36</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-38">38</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-40">40</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-42">42</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-44">44</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-46">46</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-48">48</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-50">50</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-52">52</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-54">54</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-56">56</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-58">58</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-60">60</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-62">62</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-64">64</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-66">66</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-68">68</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-70">70</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-72">72</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-74">74</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-76">76</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-78">78</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-80">80</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-82">82</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-84">84</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-86">86</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-88">88</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3b902285244-90">90</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3b902285244-91">91</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">load_model</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-7"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-v">translate</span><span class="crayon-sy">.</span><span class="crayon-e">bleu_score </span><span class="crayon-e">import </span><span class="crayon-v">corpus_bleu</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-8"> </div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-9"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-10"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-12"> </div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-13"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-14"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-15"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-16"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-18"> </div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-19"><span class="crayon-p"># max sentence length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-20"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-22"> </div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-23"><span class="crayon-p"># encode and pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-24"><span class="crayon-e">def </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-25"><span class="crayon-h"> </span><span class="crayon-p"># integer encode sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-26"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-27"><span class="crayon-h"> </span><span class="crayon-p"># pad sequences with 0 values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-28"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-30"> </div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-31"><span class="crayon-p"># map an integer to a word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-32"><span class="crayon-e">def </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-t">integer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-33"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-34"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">integer</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-38"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-39"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-40"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-41"><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-42"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-43"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-44"><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-45"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-46"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-47"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-48"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-50"><span class="crayon-p"># evaluate the skill of the model</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-51"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sources</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-52"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-53"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">source </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">sources</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-54"><span class="crayon-h"> </span><span class="crayon-p"># translate encoded source text</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-55"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-56"><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-57"><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-58"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-59"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'src=[%s], target=[%s], predicted=[%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">raw_src</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-60"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">raw_target</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-61"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">translation</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-62"><span class="crayon-h"> </span><span class="crayon-p"># calculate BLEU score</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-63"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-1: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-64"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-2: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-65"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-3: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-66"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-4: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-67"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-68"><span class="crayon-p"># load datasets</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-69"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-70"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-71"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-72"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-73"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-74"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-75"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-76"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-77"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-78"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-79"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-80"><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-81"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-82"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-83"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-84"><span class="crayon-p"># load model</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-85"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-86"><span class="crayon-p"># test on some training sequences</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-87"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-88"><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-89"><span class="crayon-p"># test on some test sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3b902285244-90"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f374a3b902285244-91"><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0049 seconds] -->
<p>Running the example first prints examples of source text, expected and predicted translations, as well as scores for the training dataset, followed by the test dataset.</p>
<p>Your specific results will differ given the random shuffling of the dataset and the stochastic nature of neural networks.</p>
<p>Looking at the results for the test dataset first, we can see that the translations are readable and mostly correct.</p>
<p>For example: “<em>ich liebe dich</em>” was correctly translated to “<em>i love you</em>“.</p>
<p>We can also see that the translations were not perfect, with “<em>ich konnte nicht gehen</em>” translated to “<em>i cant go</em>” instead of the expected “<em>i couldnt walk</em>“.</p>
<p>We can also see the BLEU-4 score of 0.51, which provides an upper bound on what we might expect from this model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a3d321041798" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
src=[ich liebe dich], target=[i love you], predicted=[i love you]
src=[ich sagte du sollst den mund halten], target=[i said shut up], predicted=[i said stop up]
src=[wie geht es eurem vater], target=[hows your dad], predicted=[hows your dad]
src=[das gefallt mir], target=[i like that], predicted=[i like that]
src=[ich gehe immer zu fu], target=[i always walk], predicted=[i will to]
src=[ich konnte nicht gehen], target=[i couldnt walk], predicted=[i cant go]
src=[er ist sehr jung], target=[he is very young], predicted=[he is very young]
src=[versucht es doch einfach], target=[just try it], predicted=[just try it]
src=[sie sind jung], target=[youre young], predicted=[youre young]
src=[er ging surfen], target=[he went surfing], predicted=[he went surfing]

BLEU-1: 0.085682
BLEU-2: 0.284191
BLEU-3: 0.459090
BLEU-4: 0.517571</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3d321041798-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3d321041798-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3d321041798-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3d321041798-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3d321041798-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3d321041798-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a3d321041798-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a3d321041798-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-1">src=[ich liebe dich], target=[i love you], predicted=[i love you]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3d321041798-2">src=[ich sagte du sollst den mund halten], target=[i said shut up], predicted=[i said stop up]</div><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-3">src=[wie geht es eurem vater], target=[hows your dad], predicted=[hows your dad]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3d321041798-4">src=[das gefallt mir], target=[i like that], predicted=[i like that]</div><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-5">src=[ich gehe immer zu fu], target=[i always walk], predicted=[i will to]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3d321041798-6">src=[ich konnte nicht gehen], target=[i couldnt walk], predicted=[i cant go]</div><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-7">src=[er ist sehr jung], target=[he is very young], predicted=[he is very young]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3d321041798-8">src=[versucht es doch einfach], target=[just try it], predicted=[just try it]</div><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-9">src=[sie sind jung], target=[youre young], predicted=[youre young]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3d321041798-10">src=[er ging surfen], target=[he went surfing], predicted=[he went surfing]</div><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3d321041798-12">BLEU-1: 0.085682</div><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-13">BLEU-2: 0.284191</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a3d321041798-14">BLEU-3: 0.459090</div><div class="crayon-line" id="crayon-5c0ca4f374a3d321041798-15">BLEU-4: 0.517571</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Looking at the results on the test set, do see readable translations, which is not an easy task.</p>
<p>For example, we see “<em>ich mag dich nicht</em>” correctly translated to “<em>i dont like you</em>“.</p>
<p>We also see some poor translations and a good case that the model could suffer from further tuning, such as “<em>ich bin etwas beschwipst</em>” translated as “<em>i a bit bit</em>” instead of the expected “<em>im a bit tipsy</em>”</p>
<p>A BLEU-4 score of 0.076238 was achieved, providing a baseline skill to improve upon with further improvements to the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f374a41395046239" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
src=[tom erblasste], target=[tom turned pale], predicted=[tom went pale]
src=[bring mich nach hause], target=[take me home], predicted=[let us at]
src=[ich bin etwas beschwipst], target=[im a bit tipsy], predicted=[i a bit bit]
src=[das ist eine frucht], target=[its a fruit], predicted=[thats a a]
src=[ich bin pazifist], target=[im a pacifist], predicted=[im am]
src=[unser plan ist aufgegangen], target=[our plan worked], predicted=[who is a man]
src=[hallo tom], target=[hi tom], predicted=[hello tom]
src=[sei nicht nervos], target=[dont be nervous], predicted=[dont be crazy]
src=[ich mag dich nicht], target=[i dont like you], predicted=[i dont like you]
src=[tom stellte eine falle], target=[tom set a trap], predicted=[tom has a cough]

BLEU-1: 0.082088
BLEU-2: 0.006182
BLEU-3: 0.046129
BLEU-4: 0.076238</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a41395046239-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a41395046239-4">4</div><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a41395046239-6">6</div><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a41395046239-8">8</div><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a41395046239-10">10</div><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a41395046239-12">12</div><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f374a41395046239-14">14</div><div class="crayon-num" data-line="crayon-5c0ca4f374a41395046239-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-1">src=[tom erblasste], target=[tom turned pale], predicted=[tom went pale]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a41395046239-2">src=[bring mich nach hause], target=[take me home], predicted=[let us at]</div><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-3">src=[ich bin etwas beschwipst], target=[im a bit tipsy], predicted=[i a bit bit]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a41395046239-4">src=[das ist eine frucht], target=[its a fruit], predicted=[thats a a]</div><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-5">src=[ich bin pazifist], target=[im a pacifist], predicted=[im am]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a41395046239-6">src=[unser plan ist aufgegangen], target=[our plan worked], predicted=[who is a man]</div><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-7">src=[hallo tom], target=[hi tom], predicted=[hello tom]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a41395046239-8">src=[sei nicht nervos], target=[dont be nervous], predicted=[dont be crazy]</div><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-9">src=[ich mag dich nicht], target=[i dont like you], predicted=[i dont like you]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a41395046239-10">src=[tom stellte eine falle], target=[tom set a trap], predicted=[tom has a cough]</div><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a41395046239-12">BLEU-1: 0.082088</div><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-13">BLEU-2: 0.006182</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f374a41395046239-14">BLEU-3: 0.046129</div><div class="crayon-line" id="crayon-5c0ca4f374a41395046239-15">BLEU-4: 0.076238</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Data Cleaning</strong>. Different data cleaning operations could be performed on the data, such as not removing punctuation or normalizing case, or perhaps removing duplicate English phrases.</li>
<li><strong>Vocabulary</strong>. The vocabulary could be refined, perhaps removing words used less than 5 or 10 times in the dataset and replaced with “<em>unk</em>“.</li>
<li><strong>More Data</strong>. The dataset used to fit the model could be expanded to 50,000, 100,000 phrases, or more.</li>
<li><strong>Input Order</strong>. The order of input phrases could be reversed, which has been reported to lift skill, or a Bidirectional input layer could be used.</li>
<li><strong>Layers</strong>. The encoder and/or the decoder models could be expanded with additional layers and trained for more epochs, providing more representational capacity for the model.</li>
<li><strong>Units</strong>. The number of memory units in the encoder and decoder could be increased, providing more representational capacity for the model.</li>
<li><strong>Regularization</strong>. The model could use regularization, such as weight or activation regularization, or the use of dropout on the LSTM layers.</li>
<li><strong>Pre-Trained Word Vectors</strong>. Pre-trained word vectors could be used in the model.</li>
<li><strong>Recursive Model</strong>. A recursive formulation of the model could be used where the next word in the output sequence could be conditional on the input sequence and the output sequence generated so far.</li>
</ul>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="http://www.manythings.org/anki/">Tab-delimited Bilingual Sentence Pairs</a></li>
<li><a href="http://www.manythings.org/anki/deu-eng.zip">German – English deu-eng.zip</a></li>
<li><a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/">Encoder-Decoder Long Short-Term Memory Networks</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop a neural machine translation system for translating German phrases to English.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to clean and prepare data ready to train a neural machine translation system.</li>
<li>How to develop an encoder-decoder model for machine translation.</li>
<li>How to use a trained model for inference on new input phrases and evaluate the model skill.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4579 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+a+Neural+Machine+Translation+System+from+Scratch&amp;url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/prepare-french-english-dataset-machine-translation/" rel="prev"><i class="fa fa-angle-left"></i> How to Prepare a French-to-English Dataset for Machine Translation</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" rel="next">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">192 Responses to <em>How to Develop a Neural Machine Translation System from Scratch</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-426079">
<div class="comment-container" id="li-comment-426079">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a309c869da076b74a18bb4b3e40fe5ad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a309c869da076b74a18bb4b3e40fe5ad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Klaas</span>
<span class="date">January 10, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426079" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>amazing work again. One Question. Do you have a seperate tutorial where you explain the LSTM layers (Timedistributed, Repeatvector,…)?</p>
<div class="reply">
<a aria-label="Reply to Klaas" class="comment-reply-link" href="#comment-426079" onclick='return addComment.moveForm( "comment-426079", "426079", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426106">
<div class="comment-container" id="li-comment-426106">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 3:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426106" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you might want to start here:<br/>
<a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" rel="nofollow">https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426106" onclick='return addComment.moveForm( "comment-426106", "426106", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-444705">
<div class="comment-container" id="li-comment-444705">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bc94c7bde8e0c223afa8782c33102b1b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bc94c7bde8e0c223afa8782c33102b1b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mayank</span>
<span class="date">July 29, 2018 at 11:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-444705" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason your work is amazing. I am having one issue . How to convert large dataset in one-hot vectors as it will take more memory??</p>
<div class="reply">
<a aria-label="Reply to Mayank" class="comment-reply-link" href="#comment-444705" onclick='return addComment.moveForm( "comment-444705", "444705", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-444741">
<div class="comment-container" id="li-comment-444741">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 30, 2018 at 5:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-444741" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps progressively load the dataset and convert it?<br/>
Perhaps use a smaller data sample?<br/>
Perhaps use a machine with more ram?<br/>
Perhaps use a big data pipeline like hadoop?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444741" onclick='return addComment.moveForm( "comment-444741", "444741", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426099">
<div class="comment-container" id="li-comment-426099">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/269d5cd1ff057c49e47711ca173fc4b8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/269d5cd1ff057c49e47711ca173fc4b8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mohamed</span>
<span class="date">January 10, 2018 at 1:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426099" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your tutorials are amazing indeed. Thank you!<br/>
Hope you will have the time to work on the Extensions lists above. This will complete this amazing tutorial. </p>
<p>Thanks again!</p>
<div class="reply">
<a aria-label="Reply to Mohamed" class="comment-reply-link" href="#comment-426099" onclick='return addComment.moveForm( "comment-426099", "426099", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426111">
<div class="comment-container" id="li-comment-426111">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 3:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426111" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426111" onclick='return addComment.moveForm( "comment-426111", "426111", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426256">
<div class="comment-container" id="li-comment-426256">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/614a8de8b739c6d7140f8bbef1979702?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/614a8de8b739c6d7140f8bbef1979702?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Richard</span>
<span class="date">January 12, 2018 at 5:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426256" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Brilliant, thanks Jason. I’m looking forward to giving this a try.</p>
<div class="reply">
<a aria-label="Reply to Richard" class="comment-reply-link" href="#comment-426256" onclick='return addComment.moveForm( "comment-426256", "426256", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426263">
<div class="comment-container" id="li-comment-426263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426263" onclick='return addComment.moveForm( "comment-426263", "426263", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426493">
<div class="comment-container" id="li-comment-426493">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Parul</span>
<span class="date">January 14, 2018 at 7:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426493" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hey i want to know one thing that if we are giving english to german translations to the model for training 9000 and for testing 1000.. then what is the encoder decoder model is actually doing ..as we are giving everything to the model at the time of testing.</p>
<div class="reply">
<a aria-label="Reply to Parul" class="comment-reply-link" href="#comment-426493" onclick='return addComment.moveForm( "comment-426493", "426493", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426576">
<div class="comment-container" id="li-comment-426576">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426576" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model is not given the answer, it must translate new examples.</p>
<p>Perhaps I don’t follow your question?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426576" onclick='return addComment.moveForm( "comment-426576", "426576", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426612">
<div class="comment-container" id="li-comment-426612">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a4e7ab81c95260f045e82d13c8bb9a9b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a4e7ab81c95260f045e82d13c8bb9a9b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">abkul orto</span>
<span class="date">January 15, 2018 at 5:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426612" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am regular reader of your articles and purchased books.i want to work on translation of a local language to english.kindly advice on the steps.</p>
<p>thanks you</p>
<div class="reply">
<a aria-label="Reply to abkul orto" class="comment-reply-link" href="#comment-426612" onclick='return addComment.moveForm( "comment-426612", "426612", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426649">
<div class="comment-container" id="li-comment-426649">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426649" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just start!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426649" onclick='return addComment.moveForm( "comment-426649", "426649", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426955">
<div class="comment-container" id="li-comment-426955">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8d4602bb60f153524379c8f64523c445?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8d4602bb60f153524379c8f64523c445?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kannu</span>
<span class="date">January 20, 2018 at 4:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426955" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p># prepare regex for char filtering<br/>
	re_print = re.compile(‘[^%s]’ % re.escape(string.printable))</p>
<p>can u please explain me the meaning of this code for ex what is  string.printable actually doing and what is the meaning of  (‘[^%s]’</p>
<div class="reply">
<a aria-label="Reply to kannu" class="comment-reply-link" href="#comment-426955" onclick='return addComment.moveForm( "comment-426955", "426955", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426993">
<div class="comment-container" id="li-comment-426993">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 20, 2018 at 8:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426993" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am selecting “not the printable characters”.</p>
<p>You can learn more about regex from a good book on Python.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426993" onclick='return addComment.moveForm( "comment-426993", "426993", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427023">
<div class="comment-container" id="li-comment-427023">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harish Yadav</span>
<span class="date">January 20, 2018 at 9:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427023" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent explanation i would say!!!! damn good !!!looking to develop  text-phonemes with your model !!!</p>
<div class="reply">
<a aria-label="Reply to Harish Yadav" class="comment-reply-link" href="#comment-427023" onclick='return addComment.moveForm( "comment-427023", "427023", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427052">
<div class="comment-container" id="li-comment-427052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2018 at 9:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427052" onclick='return addComment.moveForm( "comment-427052", "427052", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427351">
<div class="comment-container" id="li-comment-427351">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b99b5f26e7ded8b18b04219977ee1a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b99b5f26e7ded8b18b04219977ee1a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Drishty</span>
<span class="date">January 23, 2018 at 8:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427351" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi , Jason your wok is amazing and while i was doing this code i found this and i want to know i it’s required ti reshape the sequence ? and what sequence.shape[0],sequence.shape[1] is doing.<br/>
and why we need the vocab size ?<br/>
y = y.reshape(sequences.shape[0], sequences.shape[1], vocab_size)</p>
<div class="reply">
<a aria-label="Reply to Drishty" class="comment-reply-link" href="#comment-427351" onclick='return addComment.moveForm( "comment-427351", "427351", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427432">
<div class="comment-container" id="li-comment-427432">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 24, 2018 at 9:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427432" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can learn more about numpy arrays and their shape in this post:<br/>
<a href="https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/" rel="nofollow">https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427432" onclick='return addComment.moveForm( "comment-427432", "427432", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427352">
<div class="comment-container" id="li-comment-427352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b99b5f26e7ded8b18b04219977ee1a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b99b5f26e7ded8b18b04219977ee1a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Drishty</span>
<span class="date">January 23, 2018 at 8:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>*want to know why it’s required to reshape the sequence ? and what</p>
<div class="reply">
<a aria-label="Reply to Drishty" class="comment-reply-link" href="#comment-427352" onclick='return addComment.moveForm( "comment-427352", "427352", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427433">
<div class="comment-container" id="li-comment-427433">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 24, 2018 at 9:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427433" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We must ensure that the data is the correct shape that is expected by the model, e.g. 2d for MLPs, 3D for LSTMs, etc.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427433" onclick='return addComment.moveForm( "comment-427433", "427433", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427387">
<div class="comment-container" id="li-comment-427387">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/17925ec7c70c1a48e7944726ebcbba4a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/17925ec7c70c1a48e7944726ebcbba4a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">firoz</span>
<span class="date">January 24, 2018 at 4:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427387" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi , </p>
<p>i wanted to ask tyou why we have not done one-hot encoding for text in german.?</p>
<div class="reply">
<a aria-label="Reply to firoz" class="comment-reply-link" href="#comment-427387" onclick='return addComment.moveForm( "comment-427387", "427387", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427440">
<div class="comment-container" id="li-comment-427440">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 24, 2018 at 9:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427440" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The input data is integer encoded and passed through a word embedding. No need to one hot encode in this case.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427440" onclick='return addComment.moveForm( "comment-427440", "427440", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427520">
<div class="comment-container" id="li-comment-427520">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c35e69a6c395647bde32f64fa95c6cba?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c35e69a6c395647bde32f64fa95c6cba?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ravi</span>
<span class="date">January 25, 2018 at 4:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427520" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello sir, </p>
<p>over here the load_model is not defined .</p>
<p>thank you .</p>
<div class="reply">
<a aria-label="Reply to ravi" class="comment-reply-link" href="#comment-427520" onclick='return addComment.moveForm( "comment-427520", "427520", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427536">
<div class="comment-container" id="li-comment-427536">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 25, 2018 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427536" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>from keras.models import load_model</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427536" onclick='return addComment.moveForm( "comment-427536", "427536", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-427540">
<div class="comment-container" id="li-comment-427540">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c35e69a6c395647bde32f64fa95c6cba?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c35e69a6c395647bde32f64fa95c6cba?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ravi</span>
<span class="date">January 25, 2018 at 6:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427540" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>can please tell me where the </p>
<p>translation = model.predict(source, verbose=0)</p>
<p>error: source is not deifined</p>
<div class="reply">
<a aria-label="Reply to ravi" class="comment-reply-link" href="#comment-427540" onclick='return addComment.moveForm( "comment-427540", "427540", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-427553">
<div class="comment-container" id="li-comment-427553">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 25, 2018 at 9:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427553" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I have not seen that error. Perhaps try copying the entire example at the end of the post?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427553" onclick='return addComment.moveForm( "comment-427553", "427553", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427544">
<div class="comment-container" id="li-comment-427544">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f4d4a2030cbc2bc2197a8103097c5050?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f4d4a2030cbc2bc2197a8103097c5050?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">asheesh</span>
<span class="date">January 25, 2018 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427544" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>while running above code i am facing memory error in to_categorical function. I am doing translation for english to hindi. Pls give any suggestion.</p>
<div class="reply">
<a aria-label="Reply to asheesh" class="comment-reply-link" href="#comment-427544" onclick='return addComment.moveForm( "comment-427544", "427544", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427557">
<div class="comment-container" id="li-comment-427557">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 25, 2018 at 9:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427557" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try updating Keras?<br/>
Perhaps try modifying the code to use progressive loading?<br/>
Perhaps try running on AWS with an instance that has more RAM?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427557" onclick='return addComment.moveForm( "comment-427557", "427557", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427588">
<div class="comment-container" id="li-comment-427588">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harish Yadav</span>
<span class="date">January 25, 2018 at 11:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427588" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>please do a model on attention with gru and beam search</p>
<div class="reply">
<a aria-label="Reply to Harish Yadav" class="comment-reply-link" href="#comment-427588" onclick='return addComment.moveForm( "comment-427588", "427588", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427615">
<div class="comment-container" id="li-comment-427615">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 26, 2018 at 5:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427615" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427615" onclick='return addComment.moveForm( "comment-427615", "427615", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427947">
<div class="comment-container" id="li-comment-427947">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harish Yadav</span>
<span class="date">January 30, 2018 at 4:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427947" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i have used bidirectional lstm,got a better result…i want to improve more …but i dont know how to implement attention layer in keras…could you please help me out…</p>
<div class="reply">
<a aria-label="Reply to Harish Yadav" class="comment-reply-link" href="#comment-427947" onclick='return addComment.moveForm( "comment-427947", "427947", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-428006">
<div class="comment-container" id="li-comment-428006">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 31, 2018 at 9:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-428006" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some posts here that may help:<br/>
<a href="https://machinelearningmastery.com/?s=attention&amp;submit=Search" rel="nofollow">https://machinelearningmastery.com/?s=attention&amp;submit=Search</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428006" onclick='return addComment.moveForm( "comment-428006", "428006", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-428055">
<div class="comment-container" id="li-comment-428055">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d25a68c2a599ebf3ca17dd3cbba07ffd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d25a68c2a599ebf3ca17dd3cbba07ffd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hayet</span>
<span class="date">January 31, 2018 at 9:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-428055" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I want know why you use model.add(RepeatVector(tar_timesteps))?</p>
<div class="reply">
<a aria-label="Reply to hayet" class="comment-reply-link" href="#comment-428055" onclick='return addComment.moveForm( "comment-428055", "428055", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-428090">
<div class="comment-container" id="li-comment-428090">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 1, 2018 at 7:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-428090" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>To repeat the encoded input vector n times.</p>
<p>Learn more about this approach here:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428090" onclick='return addComment.moveForm( "comment-428090", "428090", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-428141">
<div class="comment-container" id="li-comment-428141">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d25a68c2a599ebf3ca17dd3cbba07ffd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d25a68c2a599ebf3ca17dd3cbba07ffd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hayet</span>
<span class="date">February 2, 2018 at 12:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-428141" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>is it possible to calculate the NMT model score with this method</p>
<p>model.compile(optimizer=’adam’, loss=’categorical_crossentropy’, metrics=[‘accuracy’])</p>
<p>scores = model.evaluate(testX,testY)</p>
<div class="reply">
<a aria-label="Reply to hayet" class="comment-reply-link" href="#comment-428141" onclick='return addComment.moveForm( "comment-428141", "428141", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-428184">
<div class="comment-container" id="li-comment-428184">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 2, 2018 at 8:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-428184" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It will estimate accuracy and loss, but not bot give you any insight into the skill of the NMT on text data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428184" onclick='return addComment.moveForm( "comment-428184", "428184", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-429978">
<div class="comment-container" id="li-comment-429978">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/241aea37336cf323ad833072f404f779?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/241aea37336cf323ad833072f404f779?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Darren</span>
<span class="date">February 20, 2018 at 5:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-429978" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, brilliant article!</p>
<p>Just a quick question, when you configure the encoder-decoder model, there seems no inference model as you mentioned in your previous articles? If this model has achieved what inference model did, in which layer? If not, how does it compare to the suite of train model, inference-encoder model and inference-decoder model? Thank you so much!</p>
<div class="reply">
<a aria-label="Reply to Darren" class="comment-reply-link" href="#comment-429978" onclick='return addComment.moveForm( "comment-429978", "429978", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430091">
<div class="comment-container" id="li-comment-430091">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 21, 2018 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-430091" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here, the same model is used for inference.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430091" onclick='return addComment.moveForm( "comment-430091", "430091", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-430443">
<div class="comment-container" id="li-comment-430443">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jakobe</span>
<span class="date">February 25, 2018 at 4:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-430443" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Does text_to_sequences encode data ?<br/>
according to the documentation it just transform texts to a list of sequences</p>
<div class="reply">
<a aria-label="Reply to Jakobe" class="comment-reply-link" href="#comment-430443" onclick='return addComment.moveForm( "comment-430443", "430443", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430460">
<div class="comment-container" id="li-comment-430460">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 25, 2018 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-430460" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it encodes words in text to integers.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430460" onclick='return addComment.moveForm( "comment-430460", "430460", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-431300">
<div class="comment-container" id="li-comment-431300">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jakobe</span>
<span class="date">March 6, 2018 at 9:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431300" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could you verify This documentation. It is mentionned that text_to_sequences return STR.<br/>
I am confusing right now.<br/>
<a href="https://keras.io/preprocessing/text/" rel="nofollow">https://keras.io/preprocessing/text/</a></p>
<div class="reply">
<a aria-label="Reply to Jakobe" class="comment-reply-link" href="#comment-431300" onclick='return addComment.moveForm( "comment-431300", "431300", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-431333">
<div class="comment-container" id="li-comment-431333">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 6, 2018 at 2:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431333" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For “texts_to_sequences” on Tokenizer it says:</p>
<p>“Return: list of sequences (one per text input).”</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431333" onclick='return addComment.moveForm( "comment-431333", "431333", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-431311">
<div class="comment-container" id="li-comment-431311">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Emil</span>
<span class="date">March 6, 2018 at 10:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431311" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>ImportError: cannot import name ‘corpus_bleu’<br/>
Did anyone have an idea about this error.</p>
<div class="reply">
<a aria-label="Reply to Emil" class="comment-reply-link" href="#comment-431311" onclick='return addComment.moveForm( "comment-431311", "431311", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-431334">
<div class="comment-container" id="li-comment-431334">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 6, 2018 at 2:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431334" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You must install a modern version of NLTK.</p>
<p>For example, I am using: nltk: 3.2.5</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431334" onclick='return addComment.moveForm( "comment-431334", "431334", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-436384">
<div class="comment-container" id="li-comment-436384">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6e941063172d2a2015f593a03af09172?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6e941063172d2a2015f593a03af09172?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Johny</span>
<span class="date">May 1, 2018 at 9:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436384" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>save in your package the code on this link  as bleu_score: <a href="https://www.nltk.org/_modules/nltk/translate/bleu_score.html" rel="nofollow">https://www.nltk.org/_modules/nltk/translate/bleu_score.html</a></p>
<p>then from bleu_score import corpus_bleu</p>
<div class="reply">
<a aria-label="Reply to Johny" class="comment-reply-link" href="#comment-436384" onclick='return addComment.moveForm( "comment-436384", "436384", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-431786">
<div class="comment-container" id="li-comment-431786">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dirck</span>
<span class="date">March 10, 2018 at 8:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431786" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>By following your tutorial, I was able to find BLEU scores on test dataset as follow :<br/>
BLEU-1: 0.069345<br/>
BLEU-2: 0.255634<br/>
BLEU-3: 0.430785<br/>
BLEU-4: 0.490818</p>
<p>So we can notice that they are very close to the scores on train dataset.<br/>
Is it about overfitting or it is a normal behavior ?</p>
<div class="reply">
<a aria-label="Reply to Dirck" class="comment-reply-link" href="#comment-431786" onclick='return addComment.moveForm( "comment-431786", "431786", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-431831">
<div class="comment-container" id="li-comment-431831">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 11, 2018 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431831" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work!</p>
<p>Similar scores on train and test is a sign of a stable model. If the skill is poor, it might be a stable but underfit model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431831" onclick='return addComment.moveForm( "comment-431831", "431831", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-431805">
<div class="comment-container" id="li-comment-431805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7fc04f718ccda8281da64705dc552388?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7fc04f718ccda8281da64705dc552388?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">vikas dixit</span>
<span class="date">March 10, 2018 at 11:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello sir, you are using test data as validation data. This means model has seen test data during training phase only. I think test data is kept separated. Am I right?? If yes please explain logic behind it.</p>
<div class="reply">
<a aria-label="Reply to vikas dixit" class="comment-reply-link" href="#comment-431805" onclick='return addComment.moveForm( "comment-431805", "431805", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-431835">
<div class="comment-container" id="li-comment-431835">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 11, 2018 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-431835" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, data was split into train and test and used for those purposes.</p>
<p>Learn more about datasets here:<br/>
<a href="https://machinelearningmastery.com/difference-test-validation-datasets/" rel="nofollow">https://machinelearningmastery.com/difference-test-validation-datasets/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-431835" onclick='return addComment.moveForm( "comment-431835", "431835", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-432629">
<div class="comment-container" id="li-comment-432629">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/809e6f4da7997b69b724c3ab603a6eb5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/809e6f4da7997b69b724c3ab603a6eb5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sindhu reddy</span>
<span class="date">March 20, 2018 at 2:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-432629" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello sir, great explanation. everything works well with the given corpus.when i am using the own corpus it says .pkl file is not encoded in utf-8.</p>
<p>can you please share the the encoding of the text files used for the above project?</p>
<p>It is giving following error<br/>
—————————————————————————<br/>
IndexError                                Traceback (most recent call last)<br/>
 in ()<br/>
     65 # spot check<br/>
     66 for i in range(100):<br/>
—&gt; 67         print(‘[%s] =&gt; [%s]’ % (clean_pairs[i,0], clean_pairs[i,1]))</p>
<p>IndexError: too many indices for array</p>
<p>Kindly help</p>
<div class="reply">
<a aria-label="Reply to sindhu reddy" class="comment-reply-link" href="#comment-432629" onclick='return addComment.moveForm( "comment-432629", "432629", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-432670">
<div class="comment-container" id="li-comment-432670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 20, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-432670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps double check you are using Python 3?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-432670" onclick='return addComment.moveForm( "comment-432670", "432670", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-432715">
<div class="comment-container" id="li-comment-432715">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/809e6f4da7997b69b724c3ab603a6eb5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/809e6f4da7997b69b724c3ab603a6eb5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sindhu reddy</span>
<span class="date">March 20, 2018 at 6:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-432715" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>yes i am using python 3.5</p>
<div class="reply">
<a aria-label="Reply to sindhu reddy" class="comment-reply-link" href="#comment-432715" onclick='return addComment.moveForm( "comment-432715", "432715", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-432757">
<div class="comment-container" id="li-comment-432757">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 21, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-432757" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Are you able to confirm that all other libs are up to date and that you copied all of the code from the example?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-432757" onclick='return addComment.moveForm( "comment-432757", "432757", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-432807">
<div class="comment-container" id="li-comment-432807">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/809e6f4da7997b69b724c3ab603a6eb5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/809e6f4da7997b69b724c3ab603a6eb5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sindhu reddy</span>
<span class="date">March 21, 2018 at 5:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-432807" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>yes jason i have updated all the libraries. it is working completely fine for  the deu,txt file .<br/>
when ever i use my own text file it is giving the following error.</p>
<p>can you kindly tell what formatting is used in text file.</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to sindhu reddy" class="comment-reply-link" href="#comment-432807" onclick='return addComment.moveForm( "comment-432807", "432807", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-432857">
<div class="comment-container" id="li-comment-432857">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 22, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-432857" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>As stated in the post, the format is “Tab-delimited Bilingual Sentence Pairs”.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-432857" onclick='return addComment.moveForm( "comment-432857", "432857", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-433050">
<div class="comment-container" id="li-comment-433050">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jigyasa Sakhuja</span>
<span class="date">March 24, 2018 at 3:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-433050" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason i am a fan of yours and i have implemented this machine translation and it was awesome i got all the results perfectly .. now i wanted to generate code using natural language by using RNN.. and when i am reading my file which is of declartaion and docstrings it is not showing as it is the ouput .. like it should show the declarations but it is showing something like x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/x00/</p>
<p>but it should show<br/>
if cint(frappe.db.get_single_value(u’System DCSP Settings’, u’setup_complete’)):</p>
<div class="reply">
<a aria-label="Reply to Jigyasa Sakhuja" class="comment-reply-link" href="#comment-433050" onclick='return addComment.moveForm( "comment-433050", "433050", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-433071">
<div class="comment-container" id="li-comment-433071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 24, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-433071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting project.</p>
<p>Perhaps the model requires more training/tuning or the problem requires reframing?</p>
<p>Here’s a great list of ideas:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433071" onclick='return addComment.moveForm( "comment-433071", "433071", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-433469">
<div class="comment-container" id="li-comment-433469">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0fe411a9390ba408aa7b5988e620d70d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0fe411a9390ba408aa7b5988e620d70d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sasi</span>
<span class="date">March 28, 2018 at 5:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-433469" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In your data x is English and y is german… but in the code x is German, and y is english… why that difference????????????</p>
<div class="reply">
<a aria-label="Reply to sasi" class="comment-reply-link" href="#comment-433469" onclick='return addComment.moveForm( "comment-433469", "433469", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-433530">
<div class="comment-container" id="li-comment-433530">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 29, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-433530" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We are translating from German (X) to English (Y).</p>
<p>You can learn the reverse if you prefer. I chose not to because my english is better than my german.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433530" onclick='return addComment.moveForm( "comment-433530", "433530", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-433611">
<div class="comment-container" id="li-comment-433611">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kam</span>
<span class="date">March 29, 2018 at 8:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-433611" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
I am trying to use pre trained word embeddings to make translation.<br/>
But, after making some researrch I found that pre-trained word embeddings are just only user for initialize encoder and decoder and also we nedd only the src embeddings.<br/>
So, for the moment I am confused.<br/>
Normally, must we provide source and target embeddings to the algorithme ?<br/>
Please if they are some documentation or links about this topic.</p>
<div class="reply">
<a aria-label="Reply to Kam" class="comment-reply-link" href="#comment-433611" onclick='return addComment.moveForm( "comment-433611", "433611", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-433654">
<div class="comment-container" id="li-comment-433654">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 30, 2018 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-433654" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not sure I follow, what do you mean exactly?</p>
<p>You can use a pre-trained embedding. This is separate from needing to have input and output data pairs to train the model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433654" onclick='return addComment.moveForm( "comment-433654", "433654", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-434042">
<div class="comment-container" id="li-comment-434042">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4bb6cf5ffb1a142a5b3f502f7d26e9de?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4bb6cf5ffb1a142a5b3f502f7d26e9de?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sindhura</span>
<span class="date">April 4, 2018 at 3:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-434042" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Regarding recursive model in extensions, isn’t it already implemented in the current code? Because the decoder part is lstm and is lstm output of one unit is fed to the next unit.</p>
<div class="reply">
<a aria-label="Reply to Sindhura" class="comment-reply-link" href="#comment-434042" onclick='return addComment.moveForm( "comment-434042", "434042", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-434043">
<div class="comment-container" id="li-comment-434043">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4bb6cf5ffb1a142a5b3f502f7d26e9de?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4bb6cf5ffb1a142a5b3f502f7d26e9de?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sindhura</span>
<span class="date">April 4, 2018 at 3:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-434043" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>*in the section ‘extensions’<br/>
*and in lstm the output of one time unit is fed to the next time unit.</p>
<div class="reply">
<a aria-label="Reply to Sindhura" class="comment-reply-link" href="#comment-434043" onclick='return addComment.moveForm( "comment-434043", "434043", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-434076">
<div class="comment-container" id="li-comment-434076">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 4, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-434076" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, see this post for more interesting architectures:<br/>
<a href="https://machinelearningmastery.com/caption-generation-inject-merge-architectures-encoder-decoder-model/" rel="nofollow">https://machinelearningmastery.com/caption-generation-inject-merge-architectures-encoder-decoder-model/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434076" onclick='return addComment.moveForm( "comment-434076", "434076", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-435177">
<div class="comment-container" id="li-comment-435177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c7d9bb8a54bd8b83ccbb424d79f690ae?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c7d9bb8a54bd8b83ccbb424d79f690ae?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Max b</span>
<span class="date">April 17, 2018 at 3:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>“be stolen returned” is my systems translation of “vielen dank jason”, which ist supposed to mean: Thank you so much Jason! </p>
<p>This post helped me a lot and I’ll now continue to tune it. Keep up the awesome work!</p>
<div class="reply">
<a aria-label="Reply to Max b" class="comment-reply-link" href="#comment-435177" onclick='return addComment.moveForm( "comment-435177", "435177", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-435196">
<div class="comment-container" id="li-comment-435196">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 17, 2018 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435196" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done!</p>
<p>Thanks Max, I’m glad to hear it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435196" onclick='return addComment.moveForm( "comment-435196", "435196", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-435249">
<div class="comment-container" id="li-comment-435249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a812a777d395a99528624aaf3edb0691?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a812a777d395a99528624aaf3edb0691?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://none" rel="external nofollow">suraj</a></span>
<span class="date">April 17, 2018 at 7:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In machine translation why we need vocabulary with the english text and german text …?</p>
<div class="reply">
<a aria-label="Reply to suraj" class="comment-reply-link" href="#comment-435249" onclick='return addComment.moveForm( "comment-435249", "435249", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-435296">
<div class="comment-container" id="li-comment-435296">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 18, 2018 at 8:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435296" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We need to limit the number of words that we model, it cannot be unbounded, at least in the way I’m choosing to model the problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435296" onclick='return addComment.moveForm( "comment-435296", "435296", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-435455">
<div class="comment-container" id="li-comment-435455">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/168bf42c2e52a04df7b772288b2851f1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/168bf42c2e52a04df7b772288b2851f1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">michael</span>
<span class="date">April 20, 2018 at 12:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435455" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That suggests that it can be unbounded if you model it in a different way.</p>
<div class="reply">
<a aria-label="Reply to michael" class="comment-reply-link" href="#comment-435455" onclick='return addComment.moveForm( "comment-435455", "435455", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-435483">
<div class="comment-container" id="li-comment-435483">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 20, 2018 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435483" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure, it’s all just code.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435483" onclick='return addComment.moveForm( "comment-435483", "435483", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-435828">
<div class="comment-container" id="li-comment-435828">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/686487d35d2dc9aeeebb7030d2e861af?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/686487d35d2dc9aeeebb7030d2e861af?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">AlgoP</span>
<span class="date">April 24, 2018 at 11:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435828" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I have just tested the clean_pairs method against ENG-PL set provided on the same website.One of the characters does not print on the screen( ‘all the other non ASCII chars are converted correctly), it is ignored as per this line I guess:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f3787e0986786281" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# normalize unicode characters
line = normalize('NFD', line).encode('ascii', 'ignore')
line = line.decode('UTF-8')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f3787e0986786281-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca4f3787e0986786281-2">2</div><div class="crayon-num" data-line="crayon-5c0ca4f3787e0986786281-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f3787e0986786281-1"><span class="crayon-p"># normalize unicode characters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca4f3787e0986786281-2"><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">normalize</span><span class="crayon-sy">(</span><span class="crayon-s">'NFD'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-s">'ascii'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'ignore'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca4f3787e0986786281-3"><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'UTF-8'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<p>I did an experiment with replacing the above with  line = normalize(‘NFD’, line).encode(‘utf-8’, ‘ignore’), but there is no difference between these two in results.I am not sure why this is happening as it is only one letter.Also,( I assume your chose was ascii as you built a German to English translator am I correct?).Could you plase share your thoughts, if possible?</p>
<div class="reply">
<a aria-label="Reply to AlgoP" class="comment-reply-link" href="#comment-435828" onclick='return addComment.moveForm( "comment-435828", "435828", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-435853">
<div class="comment-container" id="li-comment-435853">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 25, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435853" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you’re able to inspect the text or search the text for non-ascii chars to see what the offending characters are?</p>
<p>This might give you insight into what is going on.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435853" onclick='return addComment.moveForm( "comment-435853", "435853", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-435859">
<div class="comment-container" id="li-comment-435859">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/686487d35d2dc9aeeebb7030d2e861af?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/686487d35d2dc9aeeebb7030d2e861af?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">AlgoP</span>
<span class="date">April 25, 2018 at 6:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-435859" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am working on it -it looks like it may be the issue with re.escape method rather than with encoding itself.</p>
<div class="reply">
<a aria-label="Reply to AlgoP" class="comment-reply-link" href="#comment-435859" onclick='return addComment.moveForm( "comment-435859", "435859", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-436385">
<div class="comment-container" id="li-comment-436385">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6e941063172d2a2015f593a03af09172?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6e941063172d2a2015f593a03af09172?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Johny</span>
<span class="date">May 1, 2018 at 9:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436385" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Does removing punctuation not preventing the model to be used to predict a paragraph? How can you evaluate it with one sentence or paragraph not in the test set?</p>
<div class="reply">
<a aria-label="Reply to Johny" class="comment-reply-link" href="#comment-436385" onclick='return addComment.moveForm( "comment-436385", "436385", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436415">
<div class="comment-container" id="li-comment-436415">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 2, 2018 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436415" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can provide data to the model and make a prediction.</p>
<p>call the predict_sequence() function we wrote above.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436415" onclick='return addComment.moveForm( "comment-436415", "436415", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436390">
<div class="comment-container" id="li-comment-436390">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/97e041ef9e289d888a86431bd8453bd7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/97e041ef9e289d888a86431bd8453bd7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Umesh</span>
<span class="date">May 1, 2018 at 10:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436390" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>From Keras. Proprocessing. Text import Tokenizer<br/>
..<br/>
Does not woking after installing keras..<br/>
..<br/>
It’s says that no module named tensorflow<br/>
..<br/>
I have windows 32 it machine.<br/>
..<br/>
Your article very good…!<br/>
.<br/>
But I can’t process ahead due to this problem!</p>
<div class="reply">
<a aria-label="Reply to Umesh" class="comment-reply-link" href="#comment-436390" onclick='return addComment.moveForm( "comment-436390", "436390", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436420">
<div class="comment-container" id="li-comment-436420">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 2, 2018 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436420" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It sounds like your environment is not installed correctly.</p>
<p>See thus tutorial:<br/>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" rel="nofollow">https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436420" onclick='return addComment.moveForm( "comment-436420", "436420", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-436613">
<div class="comment-container" id="li-comment-436613">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e433cd0ff23438281629dc723faad612?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e433cd0ff23438281629dc723faad612?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jundong</span>
<span class="date">May 4, 2018 at 9:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436613" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your article, Jason!</p>
<p>I have one question about the difference between your implementation and the Keras Tutorial “https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html”. It seems to me that, there is a ‘teaching forcing’ element in the “Keras Tutorial” using “target” (offset by one step) as “decoder input data”. This element is not presented in your model. My question is: is it necessary? or you just use “RepeatedVector” and “TimeDistributed” to implement the similar function? </p>
<p>Thank you!</p>
<div class="reply">
<a aria-label="Reply to Jundong" class="comment-reply-link" href="#comment-436613" onclick='return addComment.moveForm( "comment-436613", "436613", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436621">
<div class="comment-container" id="li-comment-436621">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 4, 2018 at 1:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436621" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct, we are using a simplified version of the architecture.</p>
<p>I give an example of teacher forcing here:<br/>
<a href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/" rel="nofollow">https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436621" onclick='return addComment.moveForm( "comment-436621", "436621", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436706">
<div class="comment-container" id="li-comment-436706">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e23f6c7b5807d3cfd13b9b16b3235ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e23f6c7b5807d3cfd13b9b16b3235ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Beay</span>
<span class="date">May 5, 2018 at 9:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436706" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great help Jason, thank you one more time, i want to ask you:</p>
<p>How can i implement bidirectional lstm code for further improvements? at below what i did on codes please fix it with your knowledge.</p>
<p>def define_model(src_vocab, tar_vocab, src_timesteps, tar_timesteps, n_units):<br/>
	model = Sequential()<br/>
	model.add(Embedding(src_vocab, n_units, input_length=src_timesteps, mask_zero=True))<br/>
	model.add(Bidirectional(LSTM(n_units)))<br/>
	model.add(RepeatVector(tar_timesteps))<br/>
	model.add(Bidirectional(LSTM(n_units, return_sequences=True)))<br/>
	model.add(TimeDistributed(Dense(tar_vocab, activation=’softmax’)))<br/>
	return model</p>
<div class="reply">
<a aria-label="Reply to Beay" class="comment-reply-link" href="#comment-436706" onclick='return addComment.moveForm( "comment-436706", "436706", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436733">
<div class="comment-container" id="li-comment-436733">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 6, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436733" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe bidirectional would only make sense on the input/encoder.</p>
<p>See this post for configuration suggestions:<br/>
<a href="https://machinelearningmastery.com/configure-encoder-decoder-model-neural-machine-translation/" rel="nofollow">https://machinelearningmastery.com/configure-encoder-decoder-model-neural-machine-translation/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436733" onclick='return addComment.moveForm( "comment-436733", "436733", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-436710">
<div class="comment-container" id="li-comment-436710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e23f6c7b5807d3cfd13b9b16b3235ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e23f6c7b5807d3cfd13b9b16b3235ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Beay</span>
<span class="date">May 6, 2018 at 1:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In this below code </p>
<p># remove non-printable chars form each token<br/>
line = [re_print.sub(”, w) for w in line]</p>
<p>in Turkish words i got this sample errors for example </p>
<p>“kaç” -&gt; “kac” , “koş”-&gt;”kos”</p>
<p>how can i fix it ?</p>
<p>thank you</p>
<div class="reply">
<a aria-label="Reply to Beay" class="comment-reply-link" href="#comment-436710" onclick='return addComment.moveForm( "comment-436710", "436710", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436734">
<div class="comment-container" id="li-comment-436734">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 6, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436734" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t follow sorry. What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436734" onclick='return addComment.moveForm( "comment-436734", "436734", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436739">
<div class="comment-container" id="li-comment-436739">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e23f6c7b5807d3cfd13b9b16b3235ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e23f6c7b5807d3cfd13b9b16b3235ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Beay</span>
<span class="date">May 6, 2018 at 7:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436739" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i have used these codes on a Turkish-English corpus file and some Turkish characters are </p>
<p>missing (ç,ğ,ü,ğ,Ö,Ğ,Ü,İ,ı)</p>
<p>thank you.</p>
<div class="reply">
<a aria-label="Reply to Beay" class="comment-reply-link" href="#comment-436739" onclick='return addComment.moveForm( "comment-436739", "436739", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436785">
<div class="comment-container" id="li-comment-436785">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 7, 2018 at 6:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-436785" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Missing after the conversion? </p>
<p>Perhaps normalizing to Latin characters is not the best approach for your specific problem?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436785" onclick='return addComment.moveForm( "comment-436785", "436785", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-437822">
<div class="comment-container" id="li-comment-437822">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sai</span>
<span class="date">May 18, 2018 at 4:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-437822" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you very much. Could you please help where can I get good dataset for Thai to English. The dataset for Thai language is available from the ManyThings.org website is with lesser data.I am trying to use this approach to build similar for Thai.</p>
<div class="reply">
<a aria-label="Reply to Sai" class="comment-reply-link" href="#comment-437822" onclick='return addComment.moveForm( "comment-437822", "437822", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-437837">
<div class="comment-container" id="li-comment-437837">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 18, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-437837" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t know off hand.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437837" onclick='return addComment.moveForm( "comment-437837", "437837", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-437891">
<div class="comment-container" id="li-comment-437891">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sai</span>
<span class="date">May 18, 2018 at 10:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-437891" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Please ignore my query, i have searched and got the dataset. Thank you for these articles</p>
<div class="reply">
<a aria-label="Reply to Sai" class="comment-reply-link" href="#comment-437891" onclick='return addComment.moveForm( "comment-437891", "437891", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-437924">
<div class="comment-container" id="li-comment-437924">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2018 at 7:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-437924" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437924" onclick='return addComment.moveForm( "comment-437924", "437924", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-453283">
<div class="comment-container" id="li-comment-453283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6716c97823a6f2d8b52f7f9a54535dd4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6716c97823a6f2d8b52f7f9a54535dd4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thirawat</span>
<span class="date">November 1, 2018 at 1:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-453283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sai can you please send me the dataset (eng thai)<br/>
<a href="mailto:fexex44@gmail.com">fexex44@gmail.com</a></p>
<div class="reply">
<a aria-label="Reply to Thirawat" class="comment-reply-link" href="#comment-453283" onclick='return addComment.moveForm( "comment-453283", "453283", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-437882">
<div class="comment-container" id="li-comment-437882">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/37db7daa8217fb3642c17c248f0103c8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/37db7daa8217fb3642c17c248f0103c8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pep</span>
<span class="date">May 18, 2018 at 7:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-437882" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Once the model is trained, could be used the model to predict in both directions, I mean: english-german, german-english.</p>
<div class="reply">
<a aria-label="Reply to pep" class="comment-reply-link" href="#comment-437882" onclick='return addComment.moveForm( "comment-437882", "437882", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437920">
<div class="comment-container" id="li-comment-437920">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2018 at 7:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-437920" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, only in the direction it was trained.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437920" onclick='return addComment.moveForm( "comment-437920", "437920", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-438355">
<div class="comment-container" id="li-comment-438355">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0b17e5f382da271489586505e97426e5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0b17e5f382da271489586505e97426e5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Meghna</span>
<span class="date">May 23, 2018 at 9:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438355" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thank you for the amazing tutorial. It really helped me. I implemented the above code and understood each function. Further, I want to implement Neural conversation model as given in <a href="https://arxiv.org/pdf/1506.05869.pdf" rel="nofollow">https://arxiv.org/pdf/1506.05869.pdf</a> on dialogue data. So, I have 2 questions, first is how to make pairing in dialogue data and second is how to feed previous conversations as input to the decoder model.</p>
<div class="reply">
<a aria-label="Reply to Meghna" class="comment-reply-link" href="#comment-438355" onclick='return addComment.moveForm( "comment-438355", "438355", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-438406">
<div class="comment-container" id="li-comment-438406">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 24, 2018 at 8:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438406" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have an example of a dialog system. I hope to cover it in the future.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438406" onclick='return addComment.moveForm( "comment-438406", "438406", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-438466">
<div class="comment-container" id="li-comment-438466">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b4e939bd2b2bfa518464c231fc818925?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b4e939bd2b2bfa518464c231fc818925?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ahmad Ahmad</span>
<span class="date">May 24, 2018 at 6:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438466" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>G.M Mr Jason …</p>
<p>In my model , I find BLEU scores on train dataset as follow :</p>
<p>BLEU-1: 0.736022<br/>
BLEU-2: 0.717377<br/>
BLEU-3: 0.710192<br/>
BLEU-4: 0.692681</p>
<p>So we can notice that they are higher from the scores on train dataset.<br/>
Is it normal behavior or is it bad ?</p>
<div class="reply">
<a aria-label="Reply to Ahmad Ahmad" class="comment-reply-link" href="#comment-438466" onclick='return addComment.moveForm( "comment-438466", "438466", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-438552">
<div class="comment-container" id="li-comment-438552">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 25, 2018 at 9:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438552" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Better scores on the test set than train set does happen, I explain some ideas about this here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/what-if-model-skill-on-the-test-dataset-is-better-than-the-training-dataset" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/what-if-model-skill-on-the-test-dataset-is-better-than-the-training-dataset</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438552" onclick='return addComment.moveForm( "comment-438552", "438552", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-438907">
<div class="comment-container" id="li-comment-438907">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/33c6a55789a0a02184fa70962ba2de8b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/33c6a55789a0a02184fa70962ba2de8b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">maitha</span>
<span class="date">May 28, 2018 at 1:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438907" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Great and helpful work, I am trying the code to translate Arabic to English but in first step (Clean Text) and it give me an empty [ ]?! how can  I solve this one.<br/>
[hi] =&gt; []<br/>
[run] =&gt; []<br/>
[help] =&gt; []</p>
<div class="reply">
<a aria-label="Reply to maitha" class="comment-reply-link" href="#comment-438907" onclick='return addComment.moveForm( "comment-438907", "438907", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-438939">
<div class="comment-container" id="li-comment-438939">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2350721742ca5939c2ade6d534653d43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2350721742ca5939c2ade6d534653d43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sastry</span>
<span class="date">May 28, 2018 at 11:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438939" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for sharing a easy and simple approach for translations. </p>
<p>I tried your code to work with Indian languages and found Hindi data set in the same location from where you shared the German dataset.</p>
<p>The following normalize code for Hindi removes the character from line. I have tried with NFC, still facing the same problem. If I skip this line then, the non-printable character line is skipping the hindi text. </p>
<p>print(‘Before: ‘, line)<br/>
 # normalize unicode characters<br/>
 line = normalize(‘NFD’, line).encode(‘ascii’, ‘ignore’)<br/>
 print(‘After: ‘,line)</p>
<p>Before:  Go.<br/>
After:  b’Go.’<br/>
Before:  जा.<br/>
After:  b’.’</p>
<p>Does skipping these two lines of code affect the training in any way?</p>
<p>Thanks,<br/>
Sastry</p>
<div class="reply">
<a aria-label="Reply to Sastry" class="comment-reply-link" href="#comment-438939" onclick='return addComment.moveForm( "comment-438939", "438939", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-438967">
<div class="comment-container" id="li-comment-438967">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 29, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438967" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the code example expects to work with Latin characters.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438967" onclick='return addComment.moveForm( "comment-438967", "438967", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-450378">
<div class="comment-container" id="li-comment-450378">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/42c977bd0ab9dcb8eb5f39259dde3f1c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/42c977bd0ab9dcb8eb5f39259dde3f1c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kamal deep garg</span>
<span class="date">October 1, 2018 at 12:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-450378" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Sastry sir</p>
<p>Does your problem with hindi data resolve?</p>
<div class="reply">
<a aria-label="Reply to kamal deep garg" class="comment-reply-link" href="#comment-450378" onclick='return addComment.moveForm( "comment-450378", "450378", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-438998">
<div class="comment-container" id="li-comment-438998">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/42c977bd0ab9dcb8eb5f39259dde3f1c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/42c977bd0ab9dcb8eb5f39259dde3f1c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kamal deep garg</span>
<span class="date">May 29, 2018 at 3:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-438998" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello sir</p>
<p>what is minimum Hardware requirement to train nmt using keras?</p>
<div class="reply">
<a aria-label="Reply to kamal deep garg" class="comment-reply-link" href="#comment-438998" onclick='return addComment.moveForm( "comment-438998", "438998", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-439062">
<div class="comment-container" id="li-comment-439062">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 30, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-439062" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a common question that I answer here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/do-i-need-special-hardware-for-deep-learning" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/do-i-need-special-hardware-for-deep-learning</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439062" onclick='return addComment.moveForm( "comment-439062", "439062", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-439246">
<div class="comment-container" id="li-comment-439246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8ee56191854bbcea6afac46ee02a5f66?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8ee56191854bbcea6afac46ee02a5f66?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Srijan Verma</span>
<span class="date">May 31, 2018 at 6:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-439246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>This post is really helpful. Thanks for this.</p>
<p>I am working on building a translator which translates from English to Hindi (or any other Indian language). But I am facing a problem while cleaning the data.<br/>
The normalize code does not work for Indian languages, and if I skip that line of code then I am not getting any output after training my data.</p>
<p>Is there a way to use the same code on your post and some other way to clean the data for Indian languages to get the desired output..? Like are there any python modules/Libraries that i should install so as to use them for Indian Languages.?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Srijan Verma" class="comment-reply-link" href="#comment-439246" onclick='return addComment.moveForm( "comment-439246", "439246", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-439323">
<div class="comment-container" id="li-comment-439323">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 1, 2018 at 8:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-439323" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may have to research how to prepare hindi data for NLP.</p>
<p>Perhaps converting to latin chars in not the best approach.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439323" onclick='return addComment.moveForm( "comment-439323", "439323", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-439388">
<div class="comment-container" id="li-comment-439388">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/89dcd56513c7fd7815cd5194a562733e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/89dcd56513c7fd7815cd5194a562733e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lakshm</span>
<span class="date">June 1, 2018 at 3:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-439388" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,</p>
<p>Aren’t we supposed to pass the English data along with the encoded data to decoder.As per my understanding only the encoded German data has been passed to the decoder right??</p>
<div class="reply">
<a aria-label="Reply to lakshm" class="comment-reply-link" href="#comment-439388" onclick='return addComment.moveForm( "comment-439388", "439388", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-439467">
<div class="comment-container" id="li-comment-439467">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2018 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-439467" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not in this example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439467" onclick='return addComment.moveForm( "comment-439467", "439467", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-439890">
<div class="comment-container" id="li-comment-439890">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sai</span>
<span class="date">June 5, 2018 at 6:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-439890" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I have now progressed upto Training the model. Cleaning &amp; tokenizing the data set took time as i used a different language, but was a good learning.</p>
<p>Wanted to know whats the significance of “30 epochs and a batch size of 64 examples” in your example. Are these anyways related to Total vocabulary (or) total trainable parameters ?</p>
<p>Also, could you please guide me to any article of yours where i can learn more around what is epochs, what is BLEU score , what is loss etc.</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Sai" class="comment-reply-link" href="#comment-439890" onclick='return addComment.moveForm( "comment-439890", "439890", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-439938">
<div class="comment-container" id="li-comment-439938">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 6, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-439938" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Unrelated. I used trial and error (systematic experiments) to configure the model.</p>
<p>More on epochs here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/what-is-the-difference-between-a-batch-and-an-epoch" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/what-is-the-difference-between-a-batch-and-an-epoch</a></p>
<p>More on BLEU here:<br/>
<a href="https://machinelearningmastery.com/calculate-bleu-score-for-text-python/" rel="nofollow">https://machinelearningmastery.com/calculate-bleu-score-for-text-python/</a></p>
<p>Loss is an error score that is being optimized.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439938" onclick='return addComment.moveForm( "comment-439938", "439938", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-440104">
<div class="comment-container" id="li-comment-440104">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sai</span>
<span class="date">June 7, 2018 at 9:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440104" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I have a silly question, but wanted to seek clarification.</p>
<p>In step “Train Neural Translation Model” :-  have used 10,000 rows from the dataset, and established the model in file model.h5 for xxx number of vocabularies.<br/>
If I extract next 10,000 rows from data and continue to train the model using the same lines of code above, would it use the previously established model from model.h5 or would it be overwritten and start as fresh data being used to train ?</p>
<p>Thank you,</p>
<div class="reply">
<a aria-label="Reply to Sai" class="comment-reply-link" href="#comment-440104" onclick='return addComment.moveForm( "comment-440104", "440104", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-440156">
<div class="comment-container" id="li-comment-440156">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 8, 2018 at 6:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440156" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the model will be trained using the existing model as a starting point.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440156" onclick='return addComment.moveForm( "comment-440156", "440156", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-440193">
<div class="comment-container" id="li-comment-440193">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85f690ef9671e0cea8160e999e2a2145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sai</span>
<span class="date">June 8, 2018 at 3:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440193" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>ok, understood.</p>
<p>Referred to your article <a href="https://machinelearningmastery.com/check-point-deep-learning-models-keras/" rel="nofollow">https://machinelearningmastery.com/check-point-deep-learning-models-keras/</a> and understood that, before compiling the model using model.compile(), i have to load the model from file, to use existing model as starting point in training. </p>
<p>Thank you very much.</p>
<div class="reply">
<a aria-label="Reply to Sai" class="comment-reply-link" href="#comment-440193" onclick='return addComment.moveForm( "comment-440193", "440193", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-440260">
<div class="comment-container" id="li-comment-440260">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2018 at 6:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440260" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad it helped.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440260" onclick='return addComment.moveForm( "comment-440260", "440260", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-440196">
<div class="comment-container" id="li-comment-440196">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d8e024ac9f730475a2b094d59a71e9d3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d8e024ac9f730475a2b094d59a71e9d3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">June 8, 2018 at 3:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440196" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Can Word2Vec be used as the input embedding to boost the LSTM model ? Or say that pre-trained word vector by Word2Vec as input of the model can get better?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="#comment-440196" onclick='return addComment.moveForm( "comment-440196", "440196", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-440261">
<div class="comment-container" id="li-comment-440261">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2018 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440261" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes. I have examples, search word embedding.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440261" onclick='return addComment.moveForm( "comment-440261", "440261", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-440555">
<div class="comment-container" id="li-comment-440555">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cf20274ee62bd0550b77b7c4e5043bc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cf20274ee62bd0550b77b7c4e5043bc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Raghavendra</span>
<span class="date">June 12, 2018 at 11:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440555" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,<br/>
                 Excellently written article with intricate concepts explained in such a simple manner.However it would be great if you can add a attention layer for handling larger sentences.</p>
<p>I tried to add a attention layer to the code above by referring the below one.<br/>
<a href="https://github.com/keras-team/keras/issues/4962" rel="nofollow">https://github.com/keras-team/keras/issues/4962</a></p>
<p>I am unable to add the attention layer..I have read your previous blog on adding attention</p>
<p><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/</a></p>
<p>But the vocabulary at the output end is too large to be processed and this is not solving the problem</p>
<p>It would be great if you add attention ( bahdanu’s or luong’s ) to your above code and solve the problem of larger sentences</p>
<p>Thanking you !</p>
<div class="reply">
<a aria-label="Reply to Raghavendra" class="comment-reply-link" href="#comment-440555" onclick='return addComment.moveForm( "comment-440555", "440555", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-440569">
<div class="comment-container" id="li-comment-440569">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 12, 2018 at 2:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440569" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I hope to develop some attention tutorials once it is officially supported by Keras.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440569" onclick='return addComment.moveForm( "comment-440569", "440569", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-440574">
<div class="comment-container" id="li-comment-440574">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cf20274ee62bd0550b77b7c4e5043bc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cf20274ee62bd0550b77b7c4e5043bc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Raghavendra</span>
<span class="date">June 12, 2018 at 3:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440574" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How about including the attention snippet as you did in the later case.this code is working fine for me except that attention can handle longer sentences and this is where I am facing issues.I was actually asking for adding attention to the above code as you did in the later case.</p>
<div class="reply">
<a aria-label="Reply to Raghavendra" class="comment-reply-link" href="#comment-440574" onclick='return addComment.moveForm( "comment-440574", "440574", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-440633">
<div class="comment-container" id="li-comment-440633">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 13, 2018 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-440633" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot create a custom example for you.</p>
<p>I hope to give more examples of attention when Keras officially supports attention.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440633" onclick='return addComment.moveForm( "comment-440633", "440633", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-441565">
<div class="comment-container" id="li-comment-441565">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5f7fdea283441e787f62b28a6e314ed7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5f7fdea283441e787f62b28a6e314ed7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://apara" rel="external nofollow">Aparajita</a></span>
<span class="date">June 21, 2018 at 9:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441565" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I want to convert from english to german, Please help me what kind of changes required? I did few changes but it didn’t work. Please help me how can I reverse it?</p>
<div class="reply">
<a aria-label="Reply to Aparajita" class="comment-reply-link" href="#comment-441565" onclick='return addComment.moveForm( "comment-441565", "441565", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441605">
<div class="comment-container" id="li-comment-441605">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 22, 2018 at 6:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441605" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It should be straight forward. Sorry, I don’t have the capacity to prepare an example for you.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441605" onclick='return addComment.moveForm( "comment-441605", "441605", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-441663">
<div class="comment-container" id="li-comment-441663">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b1e2a22e9d1a487d33058ff818b5cc51?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b1e2a22e9d1a487d33058ff818b5cc51?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ricky</span>
<span class="date">June 22, 2018 at 5:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441663" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>halo sir, how to modification this project to use existing model (.h5) for next project running without training again, so i just use the model ?</p>
<div class="reply">
<a aria-label="Reply to ricky" class="comment-reply-link" href="#comment-441663" onclick='return addComment.moveForm( "comment-441663", "441663", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441713">
<div class="comment-container" id="li-comment-441713">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 23, 2018 at 6:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441713" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can save the model, then later load it and make predictions.</p>
<p>More on how to make predictions here:<br/>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" rel="nofollow">https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441713" onclick='return addComment.moveForm( "comment-441713", "441713", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-441755">
<div class="comment-container" id="li-comment-441755">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b1e2a22e9d1a487d33058ff818b5cc51?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b1e2a22e9d1a487d33058ff818b5cc51?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ricky</span>
<span class="date">June 23, 2018 at 2:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441755" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i mean is to use pretrained models for next running (example : chatbot), so when i running chatbot for question and answer, must not training a model. thq</p>
<div class="reply">
<a aria-label="Reply to ricky" class="comment-reply-link" href="#comment-441755" onclick='return addComment.moveForm( "comment-441755", "441755", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-441830">
<div class="comment-container" id="li-comment-441830">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 24, 2018 at 7:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441830" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t know about chatbots.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441830" onclick='return addComment.moveForm( "comment-441830", "441830", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-441709">
<div class="comment-container" id="li-comment-441709">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cbe20903f1ff78b9f7c184442ea30e0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cbe20903f1ff78b9f7c184442ea30e0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Basil</span>
<span class="date">June 23, 2018 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441709" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason – What’s your next tutorial, would be waiting for the next one eagerly, how would i get notified about your next one?</p>
<div class="reply">
<a aria-label="Reply to Basil" class="comment-reply-link" href="#comment-441709" onclick='return addComment.moveForm( "comment-441709", "441709", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441726">
<div class="comment-container" id="li-comment-441726">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 23, 2018 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-441726" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I send out an email about new tutorials, you can sign up for it here:<br/>
<a href="https://www.getdrip.com/forms/387997427/submissions/new" rel="nofollow">https://www.getdrip.com/forms/387997427/submissions/new</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441726" onclick='return addComment.moveForm( "comment-441726", "441726", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-442572">
<div class="comment-container" id="li-comment-442572">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ad69a9cf96a4ed3be3066a69eb67c463?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ad69a9cf96a4ed3be3066a69eb67c463?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex J</span>
<span class="date">July 3, 2018 at 4:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442572" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason! Thanks for your amazing tutorial! Very clear and easy to understand. One question comes up during my reproducing of your code: the console warns that “The hypothesis contains 0 counts of 2-gram, 3-gram and 4-gram overlaps”, which leads to BLEU-2 to 4 are 0. I can’t find the reason, coz I just completely copied your code and it still doesn’t work. Can you help me with that? Thank you!</p>
<div class="reply">
<a aria-label="Reply to Alex J" class="comment-reply-link" href="#comment-442572" onclick='return addComment.moveForm( "comment-442572", "442572", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442607">
<div class="comment-container" id="li-comment-442607">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 4, 2018 at 8:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442607" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can ignore that warning, it has to do with the calculation of the performance metric:<br/>
<a href="https://machinelearningmastery.com/calculate-bleu-score-for-text-python/" rel="nofollow">https://machinelearningmastery.com/calculate-bleu-score-for-text-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442607" onclick='return addComment.moveForm( "comment-442607", "442607", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-442591">
<div class="comment-container" id="li-comment-442591">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7a6b9cdff008408a05ce947652051069?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7a6b9cdff008408a05ce947652051069?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hani</span>
<span class="date">July 4, 2018 at 3:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442591" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, </p>
<p>Could you please help me to convert a German word to a sequence of numbers?</p>
<div class="reply">
<a aria-label="Reply to Hani" class="comment-reply-link" href="#comment-442591" onclick='return addComment.moveForm( "comment-442591", "442591", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442616">
<div class="comment-container" id="li-comment-442616">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 4, 2018 at 8:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442616" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/prepare-text-data-deep-learning-keras/" rel="nofollow">https://machinelearningmastery.com/prepare-text-data-deep-learning-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442616" onclick='return addComment.moveForm( "comment-442616", "442616", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-442678">
<div class="comment-container" id="li-comment-442678">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f2dbfa92106944c76c2f5a8f7b7276ba?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f2dbfa92106944c76c2f5a8f7b7276ba?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sree harsha</span>
<span class="date">July 5, 2018 at 2:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442678" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
amazing article! Here we encode the sequences(into one hot vector) and then give them input to encoder lstm and this is passed onto the decoder lstm. Is my understanding correct? how can I give an input to hidden states of an lstm?</p>
<div class="reply">
<a aria-label="Reply to sree harsha" class="comment-reply-link" href="#comment-442678" onclick='return addComment.moveForm( "comment-442678", "442678", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442710">
<div class="comment-container" id="li-comment-442710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 5, 2018 at 8:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, we do not one hot encode the input, we provide sequences of integers to the word embedding.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442710" onclick='return addComment.moveForm( "comment-442710", "442710", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-442692">
<div class="comment-container" id="li-comment-442692">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7a6b9cdff008408a05ce947652051069?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7a6b9cdff008408a05ce947652051069?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hani</span>
<span class="date">July 5, 2018 at 7:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442692" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, </p>
<p>thank you for answering. I have another question. How can I use one hot encoding for the sequences in which it returns a 2D array not a 3D?</p>
<div class="reply">
<a aria-label="Reply to Hani" class="comment-reply-link" href="#comment-442692" onclick='return addComment.moveForm( "comment-442692", "442692", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442719">
<div class="comment-container" id="li-comment-442719">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 5, 2018 at 8:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442719" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this will help:<br/>
<a href="https://machinelearningmastery.com/why-one-hot-encode-data-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/why-one-hot-encode-data-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442719" onclick='return addComment.moveForm( "comment-442719", "442719", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-442768">
<div class="comment-container" id="li-comment-442768">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83b8fbe6dc41a121f926407b463571be?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83b8fbe6dc41a121f926407b463571be?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack</span>
<span class="date">July 6, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442768" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Really amazing post! Was surprised by the accuracy and limited training time. I have tried the model with a different dataset (two columns of sentences), but get a problem in the code for loading the clean data, splitting it, and saving the split portions of data to new files. line 20:<br/>
dataset = raw_dataset[:n_sentences, :] </p>
<p>IndexError: too many indices for array</p>
<p>For print(raw_dataset) with your deu.txt, I get:<br/>
[[‘Sentence A’ ‘Sentence a’]  [‘Sentence B’ ‘Sentence b’] etc. ]</p>
<p>But for print(raw_dataset) with my file, I get:<br/>
 [ list([‘sentence A’, ‘sentence a’]) list([‘sentence B’, ‘sentence b’]) etc.]</p>
<p>Any tips what I could do about this?</p>
<div class="reply">
<a aria-label="Reply to Jack" class="comment-reply-link" href="#comment-442768" onclick='return addComment.moveForm( "comment-442768", "442768", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442785">
<div class="comment-container" id="li-comment-442785">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 6, 2018 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442785" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some suggestions here to try:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442785" onclick='return addComment.moveForm( "comment-442785", "442785", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-442918">
<div class="comment-container" id="li-comment-442918">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6300d351305cd7a2bddcb0dca0df9b40?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6300d351305cd7a2bddcb0dca0df9b40?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Josh Reid</span>
<span class="date">July 8, 2018 at 12:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442918" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason, amazing article, this helped immensely improve my understanding of how NMT works in the background!</p>
<p>I experienced the same issue as Alex J where the evaluation portion of the code where BLEU-2, 3 and 4 scores are all 0 and throw warnings like:<br/>
“The hypothesis contains 0 counts of 2-gram overlaps.<br/>
Therefore the BLEU score evaluates to 0, independently of<br/>
how many N-gram overlaps of lower order it contains.<br/>
Consider using lower n-gram order or use SmoothingFunction()”</p>
<p>I’m not sure if something within nltk.bleu_score.corpus_bleu changed since you created this script but it looks like you need an additional list around each entry in actual. This is fixed by changing line 60 in that script from:<br/>
actual.append(raw_target.split())<br/>
to:<br/>
actual.append([raw_target.split()])</p>
<div class="reply">
<a aria-label="Reply to Josh Reid" class="comment-reply-link" href="#comment-442918" onclick='return addComment.moveForm( "comment-442918", "442918", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442943">
<div class="comment-container" id="li-comment-442943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 8, 2018 at 6:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Josh.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442943" onclick='return addComment.moveForm( "comment-442943", "442943", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-456257">
<div class="comment-container" id="li-comment-456257">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/abe6bc7447a0d3a342d2441433aabb85?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/abe6bc7447a0d3a342d2441433aabb85?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Karim</span>
<span class="date">November 27, 2018 at 4:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-456257" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, indeed it works with:<br/>
 actual.append([raw_target.split()])<br/>
The reference for each sentence should be a list of different correct sentences.</p>
<div class="reply">
<a aria-label="Reply to Karim" class="comment-reply-link" href="#comment-456257" onclick='return addComment.moveForm( "comment-456257", "456257", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-442974">
<div class="comment-container" id="li-comment-442974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83b8fbe6dc41a121f926407b463571be?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83b8fbe6dc41a121f926407b463571be?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack</span>
<span class="date">July 8, 2018 at 10:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason, would it also be possible to use this model to do ‘translations’ within one language? For example, to use duplicate sentences as pairs such as:</p>
<p>[‘The distance from the earth to the moon is 384.400 km’   ‘The moon is located 384.400 km away from the earth’]</p>
<p>Given enough good examples, do you think this would work? I have tried it but get lousy results. Perhaps doing something wrong.</p>
<div class="reply">
<a aria-label="Reply to Jack" class="comment-reply-link" href="#comment-442974" onclick='return addComment.moveForm( "comment-442974", "442974", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-442995">
<div class="comment-container" id="li-comment-442995">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 9, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-442995" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>With enough training data, yes, you could do this.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442995" onclick='return addComment.moveForm( "comment-442995", "442995", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-443831">
<div class="comment-container" id="li-comment-443831">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83b8fbe6dc41a121f926407b463571be?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83b8fbe6dc41a121f926407b463571be?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack</span>
<span class="date">July 19, 2018 at 12:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443831" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason, I have just replaced the deu.txt dataset with a dataset containing two columns of English sentences and get the following (strange) predictions. Any suggestions what might cause this? </p>
<p>src=[the best apps for increasing vocabulary are], target=[what are the best apps for increasing vocabulary], predicted=[and and and and and and and and and and and does does el el el el el]<br/>
BLEU-1: 0.027778<br/>
BLEU-2: 0.166667<br/>
BLEU-3: 0.341279<br/>
BLEU-4: 0.408248</p>
<div class="reply">
<a aria-label="Reply to Jack" class="comment-reply-link" href="#comment-443831" onclick='return addComment.moveForm( "comment-443831", "443831", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-443861">
<div class="comment-container" id="li-comment-443861">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 19, 2018 at 7:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443861" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps confirm that you are loading the dataset as you expect.</p>
<p>You may then have to tune the model to this new dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443861" onclick='return addComment.moveForm( "comment-443861", "443861", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-443270">
<div class="comment-container" id="li-comment-443270">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/61d446f7c69af2c46d61de096b61e1a5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/61d446f7c69af2c46d61de096b61e1a5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sayantika Dey</span>
<span class="date">July 12, 2018 at 8:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443270" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how much time does it take to print the Bleu score?<br/>
Actually that part of the code is not working for me and its not printing the Bleu score and again again when i try to plot the model, it shows install Graphviz but i already have that.</p>
<div class="reply">
<a aria-label="Reply to Sayantika Dey" class="comment-reply-link" href="#comment-443270" onclick='return addComment.moveForm( "comment-443270", "443270", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-443285">
<div class="comment-container" id="li-comment-443285">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2018 at 3:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443285" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends on your hardware, but it should not take excessively long.</p>
<p>If you are getting strange results, ensure you have the latest versions of all of the libraries and that you have copied all of the code required.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443285" onclick='return addComment.moveForm( "comment-443285", "443285", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-443734">
<div class="comment-container" id="li-comment-443734">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/799602465152d73c3f0c52727b1e83d7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/799602465152d73c3f0c52727b1e83d7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">C M Khaled Saifullah</span>
<span class="date">July 18, 2018 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443734" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all thanks for the tutorial, it helps me a lot.</p>
<p>If i like to incorporate attention mechanism and beam search in the decoder, which part of the code need to be changed?</p>
<p>From my basic understanding i received from the your following tutorial:</p>
<p><a href="https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-attention-sequence-to-sequence-prediction-keras/</a></p>
<p> I need to replace the following code:</p>
<p>def define_model(src_vocab, tar_vocab, src_timesteps, tar_timesteps, n_units):<br/>
	model = Sequential()<br/>
	model.add(Embedding(src_vocab, n_units, input_length=src_timesteps, mask_zero=True))<br/>
	model.add(LSTM(n_units))<br/>
	model.add(RepeatVector(tar_timesteps))<br/>
	model.add(LSTM(n_units, return_sequences=True))<br/>
	model.add(TimeDistributed(Dense(tar_vocab, activation=’softmax’)))<br/>
	return model</p>
<p>into</p>
<p>def define_model(src_vocab, tar_vocab, src_timesteps, tar_timesteps, n_units):<br/>
	model = Sequential()<br/>
	model.add(Embedding(src_vocab, n_units, input_length=src_timesteps, mask_zero=True))<br/>
	model.add(LSTM(n_units))<br/>
	model.add(AttentionDecoder(n_units, n_features))<br/>
	return model</p>
<p>After writing the custom attention layer code given in that post.</p>
<p>I am not sure about the parameter n_features for this problem. Can you clarify it? Beside, can you help me to find the implementation of beam search?</p>
<p>Thanks for your time.</p>
<div class="reply">
<a aria-label="Reply to C M Khaled Saifullah" class="comment-reply-link" href="#comment-443734" onclick='return addComment.moveForm( "comment-443734", "443734", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-443760">
<div class="comment-container" id="li-comment-443760">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 18, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443760" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot help with these extensions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443760" onclick='return addComment.moveForm( "comment-443760", "443760", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-443797">
<div class="comment-container" id="li-comment-443797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/297de9ddea637fdb3b17858a75356e0a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/297de9ddea637fdb3b17858a75356e0a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Parul Singla</span>
<span class="date">July 18, 2018 at 3:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sir, i’m using english-hindi translation dataset. while printing the saved file code is showing the output like…</p>
<p>[has tom left] =&gt; []<br/>
[he is french] =&gt; []<br/>
[i am at home] =&gt; []<br/>
[i cant move] =&gt; []<br/>
[i dont know] =&gt; []</p>
<p>Why i’m not able to see Hindi text. Is there any requirement of encoding decoding again?</p>
<div class="reply">
<a aria-label="Reply to Parul Singla" class="comment-reply-link" href="#comment-443797" onclick='return addComment.moveForm( "comment-443797", "443797", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-443848">
<div class="comment-container" id="li-comment-443848">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 19, 2018 at 7:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-443848" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t know. I don’t have any examples working with Hindi text.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443848" onclick='return addComment.moveForm( "comment-443848", "443848", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-444137">
<div class="comment-container" id="li-comment-444137">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f358c01bc75f5a61d1f1f1b2d9b8f6fb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f358c01bc75f5a61d1f1f1b2d9b8f6fb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Souraj</span>
<span class="date">July 22, 2018 at 11:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-444137" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Would it be possible to include a diagram or visualization to show how the dimensions match up in layers used? I am having a hard time figuring out how does the network exactly look like. Thanks in advance. For example, why repeat vector is necessary.</p>
<div class="reply">
<a aria-label="Reply to Souraj" class="comment-reply-link" href="#comment-444137" onclick='return addComment.moveForm( "comment-444137", "444137", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444173">
<div class="comment-container" id="li-comment-444173">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 23, 2018 at 6:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-444173" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can summarize what the model expects:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f377e4a116272046" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.summary()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f377e4a116272046-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f377e4a116272046-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<p>And you can review your data:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca4f377e52391874895" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
print(X.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca4f377e52391874895-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca4f377e52391874895-1"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444173" onclick='return addComment.moveForm( "comment-444173", "444173", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-444714">
<div class="comment-container" id="li-comment-444714">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/524a5db86a5519a09a0335fd9aa2723b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/524a5db86a5519a09a0335fd9aa2723b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nitin</span>
<span class="date">July 30, 2018 at 12:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-444714" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>After save the model and load the model then i want to translate only one line randomly then how can i do that?</p>
<div class="reply">
<a aria-label="Reply to Nitin" class="comment-reply-link" href="#comment-444714" onclick='return addComment.moveForm( "comment-444714", "444714", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444743">
<div class="comment-container" id="li-comment-444743">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 30, 2018 at 5:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-444743" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>model.predict(…)</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444743" onclick='return addComment.moveForm( "comment-444743", "444743", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-445173">
<div class="comment-container" id="li-comment-445173">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29bfe750256fd99509635d947ec6dcfb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29bfe750256fd99509635d947ec6dcfb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kamalika</span>
<span class="date">August 3, 2018 at 11:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-445173" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>H Jason,<br/>
Thanks for this tutorial.<br/>
I was trying to translate from Chinese to English and looking at clean_pairs function, I think for Chinese characters, this can’t be applied.<br/>
Can you give me some pointers on how to generate the clean text for translation model.<br/>
I am using the dataset from many.org.</p>
<div class="reply">
<a aria-label="Reply to kamalika" class="comment-reply-link" href="#comment-445173" onclick='return addComment.moveForm( "comment-445173", "445173", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-445203">
<div class="comment-container" id="li-comment-445203">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 4, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-445203" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may have to update the example to work with unicode instead of chars.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445203" onclick='return addComment.moveForm( "comment-445203", "445203", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-447230">
<div class="comment-container" id="li-comment-447230">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7a17b8762a12026ab17b43ab01171cec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7a17b8762a12026ab17b43ab01171cec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rohit</span>
<span class="date">August 29, 2018 at 4:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-447230" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, It was a great article. I tried to implement it for ger – eng and it worked fine. But when I am implementing it for Korean to English junk output is coming</p>
<p>src=[경고 고마워], target=[thanks for the warning], predicted=[i i the]<br/>
src=[입조심해라], target=[watch your language], predicted=[i i you]<br/>
src=[없다], target=[there arent any], predicted=[i i you]<br/>
src=[톰은 외롭고 불행해], target=[tom is lonely and unhappy], predicted=[i i the]<br/>
src=[그녀의 신앙심은 굳건하다], target=[her faith in god is unshaken], predicted=[i i the to]<br/>
src=[세계는 너를 중심으로 돌아가지 않는다], target=[the world doesnt revolve around you], predicted=[i i i to to]<br/>
src=[못 믿겠는데], target=[i can hardly believe it], predicted=[i i the]<br/>
src=[그 약은 효과가 있었다], target=[that medicine worked], predicted=[i i]<br/>
src=[모두 그녀를 사랑한다], target=[everybody loves her], predicted=[i i]</p>
<p>I have used training data from manythings.org having 773 lines(600 lines for training ,173 lines for testing). </p>
<p>Can you please guide me what can be the issue.</p>
<div class="reply">
<a aria-label="Reply to Rohit" class="comment-reply-link" href="#comment-447230" onclick='return addComment.moveForm( "comment-447230", "447230", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-447270">
<div class="comment-container" id="li-comment-447270">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-447270" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps the Korean characters need special handling?</p>
<p>Perhaps the model needs further tuning?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447270" onclick='return addComment.moveForm( "comment-447270", "447270", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-448331">
<div class="comment-container" id="li-comment-448331">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4db05f47f723edbef7f0169e0149b0ce?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4db05f47f723edbef7f0169e0149b0ce?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ajita</span>
<span class="date">September 10, 2018 at 9:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-448331" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason,thanks for such an awesome content.I have a doubt regarding why it is necessary to convert unicode to ascii for preparing the dataset.And why NFD format is exclusively used?</p>
<div class="reply">
<a aria-label="Reply to Ajita" class="comment-reply-link" href="#comment-448331" onclick='return addComment.moveForm( "comment-448331", "448331", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-448359">
<div class="comment-container" id="li-comment-448359">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 11, 2018 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-448359" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is not required, it just made my example simpler.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-448359" onclick='return addComment.moveForm( "comment-448359", "448359", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-449845">
<div class="comment-container" id="li-comment-449845">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d8012b3251b5fea3eebc3c3e8fa00ad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d8012b3251b5fea3eebc3c3e8fa00ad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bhimasen</span>
<span class="date">September 26, 2018 at 3:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-449845" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI, Very Nice works in this blog. This LSTM also i applied for native Indian languages and got good results and scores. Great tutorial.!!!</p>
<p>My question is, i want to make kind of federated learning here. The model created by this dataset will be kept as general model.  Suppose I have a another dataset (similar, but small), and I train a model using same code and a new model is generated. Now i want to merge the weights of this new model with the one previously generated. </p>
<p>How can I work around to achieve this. ? Any suggestions would be greatly appreciated.</p>
<div class="reply">
<a aria-label="Reply to Bhimasen" class="comment-reply-link" href="#comment-449845" onclick='return addComment.moveForm( "comment-449845", "449845", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-449888">
<div class="comment-container" id="li-comment-449888">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 27, 2018 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-449888" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work!</p>
<p>You could keep both models and use them in an ensemble.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449888" onclick='return addComment.moveForm( "comment-449888", "449888", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-450379">
<div class="comment-container" id="li-comment-450379">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/42c977bd0ab9dcb8eb5f39259dde3f1c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/42c977bd0ab9dcb8eb5f39259dde3f1c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kamal deep garg</span>
<span class="date">October 1, 2018 at 12:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-450379" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Bhimasen </p>
<p>i am also doing work on Indian languages.</p>
<p>getting stuck in preprocessing of Punjabi</p>
<div class="reply">
<a aria-label="Reply to kamal deep garg" class="comment-reply-link" href="#comment-450379" onclick='return addComment.moveForm( "comment-450379", "450379", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-449851">
<div class="comment-container" id="li-comment-449851">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c574ee43cc6cc6c21c452ca57e6a9006?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c574ee43cc6cc6c21c452ca57e6a9006?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michał</span>
<span class="date">September 26, 2018 at 5:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-449851" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
great tutorial – works fine with german -&gt; english, but when I am using my own dictoniary then the predicted output is empty (“[]”).<br/>
My dictionary is quite specific, it is sentence to sentence, like:<br/>
“when raining then use umbrella6” -&gt; “trigger raining check umbrella6”<br/>
I  have like 1000 lines (maybe too little) of simillar sentences and they contain this strange “umbrella6” strings (so string+ID).<br/>
I was expecting that the results may not make any sense, but empty predict is something strange – there should be something?</p>
<div class="reply">
<a aria-label="Reply to Michał" class="comment-reply-link" href="#comment-449851" onclick='return addComment.moveForm( "comment-449851", "449851", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-449890">
<div class="comment-container" id="li-comment-449890">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 27, 2018 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-449890" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may need to change and tune the model to the new dataset.</p>
<p>The smaller number of samples may mean the model may overfit quickly, you can try to limit this with regularization.</p>
<p>For future ref, comments are moderated and I process them once per day. No need to re-post if they don’t appear immediately. More here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/where-is-my-blog-comment" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/where-is-my-blog-comment</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449890" onclick='return addComment.moveForm( "comment-449890", "449890", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-450008">
<div class="comment-container" id="li-comment-450008">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0778faf204b9483da4a82fec77488e63?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0778faf204b9483da4a82fec77488e63?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ash</span>
<span class="date">September 28, 2018 at 7:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-450008" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>May be I missed that but what happens if there is a new/unseen word in the input text? Rather what is expected in the output?</p>
<div class="reply">
<a aria-label="Reply to Ash" class="comment-reply-link" href="#comment-450008" onclick='return addComment.moveForm( "comment-450008", "450008", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-450059">
<div class="comment-container" id="li-comment-450059">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 28, 2018 at 2:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-450059" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Unseen words are marked as 0 by the Tokenizer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-450059" onclick='return addComment.moveForm( "comment-450059", "450059", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-450830">
<div class="comment-container" id="li-comment-450830">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0d52aaa26bdbc455c03fc9520a94a1a2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0d52aaa26bdbc455c03fc9520a94a1a2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Cathal</span>
<span class="date">October 6, 2018 at 7:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-450830" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great tutorial, love your blog! I was just wondering how I can pass in my own input to be translated. How do I just pass in one sentence. Everything I have tried is not working!</p>
<div class="reply">
<a aria-label="Reply to Cathal" class="comment-reply-link" href="#comment-450830" onclick='return addComment.moveForm( "comment-450830", "450830", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-450840">
<div class="comment-container" id="li-comment-450840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 6, 2018 at 11:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-450840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If you have text to be translated, you can use google translate.</p>
<p>If you want to use the model to make a prediction, you must encode new text using the same scheme used to prepare the training data then call model.predict().</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-450840" onclick='return addComment.moveForm( "comment-450840", "450840", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-451376">
<div class="comment-container" id="li-comment-451376">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cbe6263712d1a9a4bfacbbe4c96ec572?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cbe6263712d1a9a4bfacbbe4c96ec572?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tom Chan</span>
<span class="date">October 12, 2018 at 2:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-451376" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for your detailed step by step process in walking everyone through.  I have one help needed.</p>
<p>What needs to be changed above for Chinese Portuguese machine translator?   </p>
<p>I target to do a (bi-directional) LSTM but cannot find existing word data file as the source.   </p>
<p>Hope you can point me the direction and thanks.</p>
<p>B.Rgds,<br/>
Tom</p>
<div class="reply">
<a aria-label="Reply to Tom Chan" class="comment-reply-link" href="#comment-451376" onclick='return addComment.moveForm( "comment-451376", "451376", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451399">
<div class="comment-container" id="li-comment-451399">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 12, 2018 at 6:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-451399" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model may need to be tuned for your new dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451399" onclick='return addComment.moveForm( "comment-451399", "451399", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-451637">
<div class="comment-container" id="li-comment-451637">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a90d15ed18fe62466584418f0f649d1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a90d15ed18fe62466584418f0f649d1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ali</span>
<span class="date">October 15, 2018 at 3:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-451637" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I run the evaluation I get the following result:<br/>
UserWarning:<br/>
The hypothesis contains 0 counts of 4-gram overlaps.<br/>
Therefore the BLEU score evaluates to 0, independently of<br/>
how many N-gram overlaps of lower order it contains.<br/>
Consider using lower n-gram order or use SmoothingFunction()<br/>
  warnings.warn(_msg)<br/>
BLEU-1: 0.077830<br/>
BLEU-2: 0.000000<br/>
BLEU-3: 0.000000<br/>
BLEU-4: 0.000000</p>
<p>How can I fix this?</p>
<div class="reply">
<a aria-label="Reply to Ali" class="comment-reply-link" href="#comment-451637" onclick='return addComment.moveForm( "comment-451637", "451637", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451659">
<div class="comment-container" id="li-comment-451659">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 15, 2018 at 7:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-451659" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps check the types of text generated by your model, your model may not have converged to a useful solution.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451659" onclick='return addComment.moveForm( "comment-451659", "451659", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-452374">
<div class="comment-container" id="li-comment-452374">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/70e1c9b1ffb4783ba65d93a49d37fb4e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/70e1c9b1ffb4783ba65d93a49d37fb4e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bond</span>
<span class="date">October 23, 2018 at 12:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452374" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How do we fix the issue? I tried re-running the model from the start again. It is showing the same result.</p>
<p>/usr/local/lib/python3.5/dist-packages/nltk/translate/bleu_score.py:503: UserWarning:<br/>
The hypothesis contains 0 counts of 4-gram overlaps.<br/>
Therefore the BLEU score evaluates to 0, independently of<br/>
how many N-gram overlaps of lower order it contains.<br/>
Consider using lower n-gram order or use SmoothingFunction()<br/>
  warnings.warn(_msg)<br/>
BLEU-1: 0.077346<br/>
BLEU-2: 0.000000<br/>
BLEU-3: 0.000000<br/>
BLEU-4: 0.000000</p>
<p>The same warning is there for 2-gram and 3-gram.</p>
<div class="reply">
<a aria-label="Reply to Bond" class="comment-reply-link" href="#comment-452374" onclick='return addComment.moveForm( "comment-452374", "452374", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-452403">
<div class="comment-container" id="li-comment-452403">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 23, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452403" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try changing the configuration of the model?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452403" onclick='return addComment.moveForm( "comment-452403", "452403", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-452354">
<div class="comment-container" id="li-comment-452354">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/70e1c9b1ffb4783ba65d93a49d37fb4e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/70e1c9b1ffb4783ba65d93a49d37fb4e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bond</span>
<span class="date">October 22, 2018 at 5:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452354" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thanks for your contribution.</p>
<p>Could you please clarify some of the doubts:</p>
<p>1. In the CLEAN TEXT step, inside clean_pairs() function, line number 7 talks about making a translation table for removing punctuation.</p>
<p>In the code, str.maketrans(”, ”, string.punctuation)<br/>
gives error with str as an undefined attribute.</p>
<p>And also what is “maketrans” function?</p>
<p>2. Regarding the function “to_pairs”, this function converts the dataset in the following format:</p>
<p>Original:<br/>
Hi.	Hallo!<br/>
Hi.	Grüß Gott!<br/>
Run!	Lauf!</p>
<p>After:<br/>
Hi.<br/>
Hallo!<br/>
Hi.<br/>
Grüß Gott!<br/>
Run!<br/>
Lauf!</p>
<p>i.e. put the corresponding translation in the next line by splitting the phrase pairs.</p>
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Bond" class="comment-reply-link" href="#comment-452354" onclick='return addComment.moveForm( "comment-452354", "452354", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-452395">
<div class="comment-container" id="li-comment-452395">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 23, 2018 at 6:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452395" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may be trying to use Python 2.7, I recommend using Python 3.5 or higher.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452395" onclick='return addComment.moveForm( "comment-452395", "452395", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-452698">
<div class="comment-container" id="li-comment-452698">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d932edb0bacf6aa031c1b80c33bbe15d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d932edb0bacf6aa031c1b80c33bbe15d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">satya</span>
<span class="date">October 25, 2018 at 5:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452698" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how this implementation differs from keras implemenation ?</p>
<p><a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html" rel="nofollow">https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html</a></p>
<p>which one to prefer ?</p>
<div class="reply">
<a aria-label="Reply to satya" class="comment-reply-link" href="#comment-452698" onclick='return addComment.moveForm( "comment-452698", "452698", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-452752">
<div class="comment-container" id="li-comment-452752">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2018 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452752" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here we use an auto-encoder approach, in the keras blog post an encoder-decoder using only internal state is used instead.</p>
<p>Use an approach that results in the best performance for your problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452752" onclick='return addComment.moveForm( "comment-452752", "452752", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-452898">
<div class="comment-container" id="li-comment-452898">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83387d5c2bc991b63faa681de2ae846f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83387d5c2bc991b63faa681de2ae846f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Akshat Jain</span>
<span class="date">October 28, 2018 at 12:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452898" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hiii Jason,<br/>
Thanks for this wonderful article. I have been trying to implement this and I got a doubt in </p>
<p>prediction = model.predict(testX, verbose=1)[0]<br/>
​<br/>
Why we only take single encoded source?</p>
<div class="reply">
<a aria-label="Reply to Akshat Jain" class="comment-reply-link" href="#comment-452898" onclick='return addComment.moveForm( "comment-452898", "452898", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-452930">
<div class="comment-container" id="li-comment-452930">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 28, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-452930" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There is only one prediction/row, so we take it from the 2D array.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452930" onclick='return addComment.moveForm( "comment-452930", "452930", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-453054">
<div class="comment-container" id="li-comment-453054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83387d5c2bc991b63faa681de2ae846f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83387d5c2bc991b63faa681de2ae846f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Akshat Jain</span>
<span class="date">October 29, 2018 at 8:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-453054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry I don’t understand, the shape of prediction would be (1000, 5, 2309) but we only take the zeroth element from it. Why?</p>
<div class="reply">
<a aria-label="Reply to Akshat Jain" class="comment-reply-link" href="#comment-453054" onclick='return addComment.moveForm( "comment-453054", "453054", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-453093">
<div class="comment-container" id="li-comment-453093">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2018 at 6:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-453093" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, we are only translating one sentence of words at a time.</p>
<p>To confirm, print the shape of the input and output of the predict function prior to only selecting the zero’th element.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-453093" onclick='return addComment.moveForm( "comment-453093", "453093", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-455631">
<div class="comment-container" id="li-comment-455631">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/20f3008e1eda564ea6b472f478d0e795?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/20f3008e1eda564ea6b472f478d0e795?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.barcodecoin.net" rel="external nofollow">Daniel Fernandez Boada</a></span>
<span class="date">November 20, 2018 at 6:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-455631" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for sharing this great article. Because of my null progress in learning German, after four years living in a German speaking country, I decided to create an application that I think could help me with it, and maybe to others too.</p>
<p>As a first step I think your approach may fit well with my requirements. My question is, are all the codes shown here free to reproduce or is there and copyright? </p>
<p>Thanks again,<br/>
Dani.</p>
<div class="reply">
<a aria-label="Reply to Daniel Fernandez Boada" class="comment-reply-link" href="#comment-455631" onclick='return addComment.moveForm( "comment-455631", "455631", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455690">
<div class="comment-container" id="li-comment-455690">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 21, 2018 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-455690" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>They are copyright, but you can use them as long as you clearly credit their origin.</p>
<p>More details here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/can-i-use-your-code-in-my-own-project" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/can-i-use-your-code-in-my-own-project</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455690" onclick='return addComment.moveForm( "comment-455690", "455690", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-456253">
<div class="comment-container" id="li-comment-456253">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/72a2f88cf01da38ed607d741b9117ad7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/72a2f88cf01da38ed607d741b9117ad7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">saas</span>
<span class="date">November 27, 2018 at 3:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-456253" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello<br/>
could you please help me<br/>
i m doing same work neural translation from English to arabic !!<br/>
how I follow the steps which is provided but I got an error</p>
<div class="reply">
<a aria-label="Reply to saas" class="comment-reply-link" href="#comment-456253" onclick='return addComment.moveForm( "comment-456253", "456253", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-456283">
<div class="comment-container" id="li-comment-456283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2018 at 6:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-456283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps post your error to stackoverflow?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456283" onclick='return addComment.moveForm( "comment-456283", "456283", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-456557">
<div class="comment-container" id="li-comment-456557">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f4e782c2245c8cb6e480e24f0f4b65fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f4e782c2245c8cb6e480e24f0f4b65fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nikos</span>
<span class="date">November 29, 2018 at 9:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-456557" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent work! Thank you, Jason!</p>
<div class="reply">
<a aria-label="Reply to Nikos" class="comment-reply-link" href="#comment-456557" onclick='return addComment.moveForm( "comment-456557", "456557", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-456586">
<div class="comment-container" id="li-comment-456586">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2018 at 2:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-456586" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456586" onclick='return addComment.moveForm( "comment-456586", "456586", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-457024">
<div class="comment-container" id="li-comment-457024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/124174c14fc5dfbc11397c83be0ee9c4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/124174c14fc5dfbc11397c83be0ee9c4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Naresh</span>
<span class="date">December 3, 2018 at 3:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-457024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can i use this model to train chinese to english translation, as chinese is something different then other language what precaution i need to take care.</p>
<div class="reply">
<a aria-label="Reply to Naresh" class="comment-reply-link" href="#comment-457024" onclick='return addComment.moveForm( "comment-457024", "457024", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457050">
<div class="comment-container" id="li-comment-457050">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 3, 2018 at 6:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-457050" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457050" onclick='return addComment.moveForm( "comment-457050", "457050", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-457265">
<div class="comment-container" id="li-comment-457265">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b1e834e2e6ee40f2b3b77d602110be7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b1e834e2e6ee40f2b3b77d602110be7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sourabh</span>
<span class="date">December 5, 2018 at 12:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-457265" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Sir, Thank you very much for this wonderful guide!!!<br/>
I just have one doubt….Can we build a model which could translate both-ways…i.e. Language1 to Language2 and also Language2 to Language1?</p>
<div class="reply">
<a aria-label="Reply to Sourabh" class="comment-reply-link" href="#comment-457265" onclick='return addComment.moveForm( "comment-457265", "457265", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457313">
<div class="comment-container" id="li-comment-457313">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 5, 2018 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-457313" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Maybe, I don’t see how off the cuff.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457313" onclick='return addComment.moveForm( "comment-457313", "457313", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-neural-machine-translation-system-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4579"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="36dbea7ce0"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="132"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for NLP</strong><br/>
Develop deep learning models for text data.
<p><a href="/deep-learning-for-nlp/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>