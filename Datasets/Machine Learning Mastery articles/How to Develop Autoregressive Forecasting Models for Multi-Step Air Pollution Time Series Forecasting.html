<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop Autoregressive Forecasting Models for Multi-Step Air Pollution Time Series Forecasting</title>
<link href="https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop Autoregressive Forecasting Models for Multi-Step Air Pollution Time Series Forecasting" property="og:title"/>
<meta content="Real-world time series forecasting is challenging for a whole host of reasons not limited to problem features such as having multiple input variables, the requirement to predict multiple time steps, and the need to perform the same type of prediction for multiple physical sites. The EMC Data Science Global Hackathon dataset, or the ‘Air Quality …" property="og:description"/>
<meta content="https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Time Series" property="article:section"/>
<meta content="2018-10-16T18:00:01+00:00" property="article:published_time"/>
<meta content="2018-10-16T21:06:40+00:00" property="article:modified_time"/>
<meta content="2018-10-16T21:06:40+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2019/01/Impact-of-Dataset-Size-on-Deep-Learning-Model-Skill-And-Performance-Estimates.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2019/01/Impact-of-Dataset-Size-on-Deep-Learning-Model-Skill-And-Performance-Estimates.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="425" property="og:image:height"/>
<meta content="Impact of Dataset Size on Deep Learning Model Skill And Performance Estimates" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop Autoregressive Forecasting Models for Multi-Step Air Pollution Time Series Forecasting Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=6323" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-6323 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-53"> <div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-6323 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
<header>
<h1 class="title entry-title">How to Develop Autoregressive Forecasting Models for Multi-Step Air Pollution Time Series Forecasting</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-17T05:00:01+1100">October 17, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6323 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+Autoregressive+Forecasting+Models+for+Multi-Step+Air+Pollution+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Real-world time series forecasting is challenging for a whole host of reasons not limited to problem features such as having multiple input variables, the requirement to predict multiple time steps, and the need to perform the same type of prediction for multiple physical sites.</p>
<p>The EMC Data Science Global Hackathon dataset, or the ‘Air Quality Prediction’ dataset for short, describes weather conditions at multiple sites and requires a prediction of air quality measurements over the subsequent three days.</p>
<p>Before diving into sophisticated machine learning and deep learning methods for time series forecasting, it is important to find the limits of classical methods, such as developing autoregressive models using the AR or ARIMA method.</p>
<p>In this tutorial, you will discover how to develop autoregressive models for multi-step time series forecasting for a multivariate air pollution time series.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to analyze and impute missing values for time series data.</li>
<li>How to develop and evaluate an autoregressive model for multi-step time series forecasting.</li>
<li>How to improve an autoregressive model using alternate data imputation methods.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_6747" style="width: 650px"><img alt="Impact of Dataset Size on Deep Learning Model Skill And Performance Estimates" class="size-full wp-image-6747" height="425" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2019/01/Impact-of-Dataset-Size-on-Deep-Learning-Model-Skill-And-Performance-Estimates.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2019/01/Impact-of-Dataset-Size-on-Deep-Learning-Model-Skill-And-Performance-Estimates.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2019/01/Impact-of-Dataset-Size-on-Deep-Learning-Model-Skill-And-Performance-Estimates-300x199.jpg 300w" width="640"/><p class="wp-caption-text">Impact of Dataset Size on Deep Learning Model Skill And Performance Estimates<br/>Photo by <a href="https://www.flickr.com/photos/eneas/13632855754/">Eneas De Troya</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into six parts; they are:</p>
<ol>
<li>Problem Description</li>
<li>Model Evaluation</li>
<li>Data Analysis</li>
<li>Develop an Autoregressive Model</li>
<li>Autoregressive Model with Global Impute Strategy</li>
</ol>
<h2>Problem Description</h2>
<p>The Air Quality Prediction dataset describes weather conditions at multiple sites and requires a prediction of air quality measurements over the subsequent three days.</p>
<p>Specifically, weather observations such as temperature, pressure, wind speed, and wind direction are provided hourly for eight days for multiple sites. The objective is to predict air quality measurements for the next 3 days at multiple sites. The forecast lead times are not contiguous; instead, specific lead times must be forecast over the 72 hour forecast period. They are:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396a1098892629" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396a1098892629-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396a1098892629-1">+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Further, the dataset is divided into disjoint but contiguous chunks of data, with eight days of data followed by three days that require a forecast.</p>
<p>Not all observations are available at all sites or chunks and not all output variables are available at all sites and chunks. There are large portions of missing data that must be addressed.</p>
<p>The dataset was used as the basis for a <a href="https://www.kaggle.com/c/dsg-hackathon">short duration machine learning competition</a> (or hackathon) on the Kaggle website in 2012.</p>
<p>Submissions for the competition were evaluated against the true observations that were withheld from participants and scored using Mean Absolute Error (MAE). Submissions required the value of -1,000,000 to be specified in those cases where a forecast was not possible due to missing data. In fact, a template of where to insert missing values was provided and required to be adopted for all submissions (what a pain).</p>
<p>A winning entrant achieved a MAE of 0.21058 on the withheld test set (<a href="https://www.kaggle.com/c/dsg-hackathon/leaderboard">private leaderboard</a>) using random forest on lagged observations. A writeup of this solution is available in the post:</p>
<ul>
<li><a href="http://blog.kaggle.com/2012/05/01/chucking-everything-into-a-random-forest-ben-hamner-on-winning-the-air-quality-prediction-hackathon/">Chucking everything into a Random Forest: Ben Hamner on Winning The Air Quality Prediction Hackathon</a>, 2012.</li>
</ul>
<p>In this tutorial, we will explore how to develop naive forecasts for the problem that can be used as a baseline to determine whether a model has skill on the problem or not.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Download Your FREE Mini-Course</a><script data-config="%7B%7D" data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Model Evaluation</h2>
<p>Before we can evaluate naive forecasting methods, we must develop a test harness.</p>
<p>This includes at least how the data will be prepared and how forecasts will be evaluated.</p>
<h3>Load Dataset</h3>
<p>The first step is to download the dataset and load it into memory.</p>
<p>The dataset can be downloaded for free from the Kaggle website. You may have to create an account and log in, in order to be able to download the dataset.</p>
<p>Download the entire dataset, e.g. “<em>Download All</em>” to your workstation and unzip the archive in your current working directory with the folder named ‘<em>AirQualityPrediction</em>‘.</p>
<ul>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/data">EMC Data Science Global Hackathon (Air Quality Prediction) Data</a></li>
</ul>
<p>Our focus will be the ‘<em>TrainingData.csv</em>‘ file that contains the training dataset, specifically data in chunks where each chunk is eight contiguous days of observations and target variables.</p>
<p>We can load the data file into memory using the Pandas <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">read_csv() function</a> and specify the header row on line 0.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396aa612195032" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396aa612195032-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396aa612195032-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396aa612195032-1"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396aa612195032-2"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can group data by the ‘chunkID’ variable (column index 1).</p>
<p>First, let’s get a list of the unique chunk identifiers.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396af433571794" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
chunk_ids = unique(values[:, 1])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396af433571794-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396af433571794-1"><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can then collect all rows for each chunk identifier and store them in a dictionary for easy access.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396b0007709911" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
chunks = dict()
# sort rows by chunk id
for chunk_id in chunk_ids:
	selection = values[:, chunk_ix] == chunk_id
	chunks[chunk_id] = values[selection, :]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396b0007709911-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b0007709911-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396b0007709911-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b0007709911-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396b0007709911-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396b0007709911-1"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b0007709911-2"><span class="crayon-p"># sort rows by chunk id</span></div><div class="crayon-line" id="crayon-5c0c9a99396b0007709911-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b0007709911-4"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5c0c9a99396b0007709911-5"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Below defines a function named <em>to_chunks()</em> that takes a NumPy array of the loaded data and returns a dictionary of <em>chunk_id</em> to rows for the chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396b2383371310" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396b2383371310-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b2383371310-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396b2383371310-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b2383371310-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396b2383371310-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b2383371310-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396b2383371310-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b2383371310-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396b2383371310-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b2383371310-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396b2383371310-1"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b2383371310-2"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396b2383371310-3"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b2383371310-4"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5c0c9a99396b2383371310-5"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b2383371310-6"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5c0c9a99396b2383371310-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b2383371310-8"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5c0c9a99396b2383371310-9"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b2383371310-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The complete example that loads the dataset and splits it into chunks is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396b4146347468" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load data and split into chunks
from numpy import unique
from pandas import read_csv

# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks

# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)
# group data by chunks
values = dataset.values
chunks = to_chunks(values)
print('Total Chunks: %d' % len(chunks))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b4146347468-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396b4146347468-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-1"><span class="crayon-p"># load data and split into chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-4"> </div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-5"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-6"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-7"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-8"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-9"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-10"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-12"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-13"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-16"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-17"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-18"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-19"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b4146347468-20"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396b4146347468-21"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total Chunks: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Running the example prints the number of chunks in the dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396b6307722828" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total Chunks: 208</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396b6307722828-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396b6307722828-1">Total Chunks: 208</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h3>Data Preparation</h3>
<p>Now that we know how to load the data and split it into chunks, we can separate into train and test datasets.</p>
<p>Each chunk covers an interval of eight days of hourly observations, although the number of actual observations within each chunk may vary widely.</p>
<p>We can split each chunk into the first five days of observations for training and the last three for test.</p>
<p>Each observation has a row called ‘<em>position_within_chunk</em>‘ that varies from 1 to 192 (8 days * 24 hours). We can therefore take all rows with a value in this column that is less than or equal to 120 (5 * 24) as training data and any values more than 120 as test data.</p>
<p>Further, any chunks that don’t have any observations in the train or test split can be dropped as not viable.</p>
<p>When working with the naive models, we are only interested in the target variables, and none of the input meteorological variables. Therefore, we can remove the input data and have the train and test data only comprised of the 39 target variables for each chunk, as well as the position within chunk and hour of observation.</p>
<p>The <em>split_train_test()</em> function below implements this behavior; given a dictionary of chunks, it will split each into a list of train and test chunk data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396b7261517873" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split each chunk into train/test sets
def split_train_test(chunks, row_in_chunk_ix=2):
	train, test = list(), list()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	# enumerate chunks
	for k,rows in chunks.items():
		# split chunk rows by 'position_within_chunk'
		train_rows = rows[rows[:,row_in_chunk_ix] &lt;= cut_point, :]
		test_rows = rows[rows[:,row_in_chunk_ix] &gt; cut_point, :]
		if len(train_rows) == 0 or len(test_rows) == 0:
			print('&gt;dropping chunk=%d: train=%s, test=%s' % (k, train_rows.shape, test_rows.shape))
			continue
		# store with chunk id, position in chunk, hour and all targets
		indices = [1,2,5] + [x for x in range(56,train_rows.shape[1])]
		train.append(train_rows[:, indices])
		test.append(test_rows[:, indices])
	return train, test</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396b7261517873-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396b7261517873-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-1"><span class="crayon-p"># split each chunk into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-2"><span class="crayon-e">def </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-3"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-4"><span class="crayon-h"> </span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-5"><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-6"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-8"><span class="crayon-h"> </span><span class="crayon-p"># split chunk rows by 'position_within_chunk'</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-9"><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-10"><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-11"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-12"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;dropping chunk=%d: train=%s, test=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-13"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-14"><span class="crayon-h"> </span><span class="crayon-p"># store with chunk id, position in chunk, hour and all targets</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-15"><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-16"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396b7261517873-17"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396b7261517873-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>We do not require the entire test dataset; instead, we only require the observations at specific lead times over the three day period, specifically the lead times:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396ba173862118" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396ba173862118-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396ba173862118-1">+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Where, each lead time is relative to the end of the training period.</p>
<p>First, we can put these lead times into a function for easy reference:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396bc199196418" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396bc199196418-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bc199196418-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396bc199196418-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396bc199196418-1"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bc199196418-2"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bc199196418-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we can reduce the test dataset down to just the data at the preferred lead times.</p>
<p>We can do that by looking at the ‘<em>position_within_chunk</em>‘ column and using the lead time as an offset from the end of the training dataset, e.g. 120 + 1, 120 +2, etc.</p>
<p>If we find a matching row in the test set, it is saved, otherwise a row of NaN observations is generated.</p>
<p>The function <em>to_forecasts()</em> below implements this and returns a NumPy array with one row for each forecast lead time for each chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396bd047243122" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convert the rows in a test chunk to forecasts
def to_forecasts(test_chunks, row_in_chunk_ix=1):
	# get lead times
	lead_times = get_lead_times()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	forecasts = list()
	# enumerate each chunk
	for rows in test_chunks:
		chunk_id = rows[0, 0]
		# enumerate each lead time
		for tau in lead_times:
			# determine the row in chunk we want for the lead time
			offset = cut_point + tau
			# retrieve data for the lead time using row number in chunk
			row_for_tau = rows[rows[:,row_in_chunk_ix]==offset, :]
			# check if we have data
			if len(row_for_tau) == 0:
				# create a mock row [chunk, position, hour] + [nan...]
				row = [chunk_id, offset, nan] + [nan for _ in range(39)]
				forecasts.append(row)
			else:
				# store the forecast row
				forecasts.append(row_for_tau[0])
	return array(forecasts)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bd047243122-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396bd047243122-25">25</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-1"><span class="crayon-p"># convert the rows in a test chunk to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-2"><span class="crayon-e">def </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-3"><span class="crayon-h"> </span><span class="crayon-p"># get lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-4"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-5"><span class="crayon-h"> </span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-6"><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-7"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-8"><span class="crayon-h"> </span><span class="crayon-p"># enumerate each chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-10"><span class="crayon-h"> </span><span class="crayon-v">chunk_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-11"><span class="crayon-h"> </span><span class="crayon-p"># enumerate each lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">tau </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-13"><span class="crayon-h"> </span><span class="crayon-p"># determine the row in chunk we want for the lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-14"><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tau</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-15"><span class="crayon-h"> </span><span class="crayon-p"># retrieve data for the lead time using row number in chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-16"><span class="crayon-h"> </span><span class="crayon-v">row_for_tau</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-17"><span class="crayon-h"> </span><span class="crayon-p"># check if we have data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-18"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-19"><span class="crayon-h"> </span><span class="crayon-p"># create a mock row [chunk, position, hour] + [nan...]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-20"><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-21"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-22"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-23"><span class="crayon-h"> </span><span class="crayon-p"># store the forecast row</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bd047243122-24"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bd047243122-25"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>We can tie all of this together and split the dataset into train and test sets and save the results to new files.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396bf179843490" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split data into train and test sets
from numpy import unique
from numpy import nan
from numpy import array
from numpy import savetxt
from pandas import read_csv

# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks

# split each chunk into train/test sets
def split_train_test(chunks, row_in_chunk_ix=2):
	train, test = list(), list()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	# enumerate chunks
	for k,rows in chunks.items():
		# split chunk rows by 'position_within_chunk'
		train_rows = rows[rows[:,row_in_chunk_ix] &lt;= cut_point, :]
		test_rows = rows[rows[:,row_in_chunk_ix] &gt; cut_point, :]
		if len(train_rows) == 0 or len(test_rows) == 0:
			print('&gt;dropping chunk=%d: train=%s, test=%s' % (k, train_rows.shape, test_rows.shape))
			continue
		# store with chunk id, position in chunk, hour and all targets
		indices = [1,2,5] + [x for x in range(56,train_rows.shape[1])]
		train.append(train_rows[:, indices])
		test.append(test_rows[:, indices])
	return train, test

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]

# convert the rows in a test chunk to forecasts
def to_forecasts(test_chunks, row_in_chunk_ix=1):
	# get lead times
	lead_times = get_lead_times()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	forecasts = list()
	# enumerate each chunk
	for rows in test_chunks:
		chunk_id = rows[0, 0]
		# enumerate each lead time
		for tau in lead_times:
			# determine the row in chunk we want for the lead time
			offset = cut_point + tau
			# retrieve data for the lead time using row number in chunk
			row_for_tau = rows[rows[:,row_in_chunk_ix]==offset, :]
			# check if we have data
			if len(row_for_tau) == 0:
				# create a mock row [chunk, position, hour] + [nan...]
				row = [chunk_id, offset, nan] + [nan for _ in range(39)]
				forecasts.append(row)
			else:
				# store the forecast row
				forecasts.append(row_for_tau[0])
	return array(forecasts)

# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)
# group data by chunks
values = dataset.values
chunks = to_chunks(values)
# split into train/test
train, test = split_train_test(chunks)
# flatten training chunks to rows
train_rows = array([row for rows in train for row in rows])
# print(train_rows.shape)
print('Train Rows: %s' % str(train_rows.shape))
# reduce train to forecast lead times only
test_rows = to_forecasts(test)
print('Test Rows: %s' % str(test_rows.shape))
# save datasets
savetxt('AirQualityPrediction/naive_train.csv', train_rows, delimiter=',')
savetxt('AirQualityPrediction/naive_test.csv', test_rows, delimiter=',')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a99396bf179843490-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396bf179843490-84">84</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-1"><span class="crayon-p"># split data into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">savetxt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-8"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-9"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-10"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-11"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-12"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-13"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-15"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-16"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-18"> </div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-19"><span class="crayon-p"># split each chunk into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-20"><span class="crayon-e">def </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-21"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-22"><span class="crayon-h"> </span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-23"><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-24"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-25"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-26"><span class="crayon-h"> </span><span class="crayon-p"># split chunk rows by 'position_within_chunk'</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-27"><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-28"><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-29"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-30"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;dropping chunk=%d: train=%s, test=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-31"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-32"><span class="crayon-h"> </span><span class="crayon-p"># store with chunk id, position in chunk, hour and all targets</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-33"><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-34"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-35"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-38"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-39"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-40"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-41"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-42"><span class="crayon-p"># convert the rows in a test chunk to forecasts</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-43"><span class="crayon-e">def </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-44"><span class="crayon-h"> </span><span class="crayon-p"># get lead times</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-45"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-46"><span class="crayon-h"> </span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-47"><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-48"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-49"><span class="crayon-h"> </span><span class="crayon-p"># enumerate each chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-50"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-51"><span class="crayon-h"> </span><span class="crayon-v">chunk_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-52"><span class="crayon-h"> </span><span class="crayon-p"># enumerate each lead time</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-53"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">tau </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-54"><span class="crayon-h"> </span><span class="crayon-p"># determine the row in chunk we want for the lead time</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-55"><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tau</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-56"><span class="crayon-h"> </span><span class="crayon-p"># retrieve data for the lead time using row number in chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-57"><span class="crayon-h"> </span><span class="crayon-v">row_for_tau</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-58"><span class="crayon-h"> </span><span class="crayon-p"># check if we have data</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-59"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-60"><span class="crayon-h"> </span><span class="crayon-p"># create a mock row [chunk, position, hour] + [nan...]</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-61"><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-62"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-63"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-64"><span class="crayon-h"> </span><span class="crayon-p"># store the forecast row</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-65"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-66"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-67"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-68"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-69"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-70"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-71"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-72"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-73"><span class="crayon-p"># split into train/test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-74"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-75"><span class="crayon-p"># flatten training chunks to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-76"><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">row </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">train </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-77"><span class="crayon-p"># print(train_rows.shape)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-78"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Rows: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-79"><span class="crayon-p"># reduce train to forecast lead times only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-80"><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-81"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Rows: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-82"><span class="crayon-p"># save datasets</span></div><div class="crayon-line" id="crayon-5c0c9a99396bf179843490-83"><span class="crayon-e">savetxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396bf179843490-84"><span class="crayon-e">savetxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0042 seconds] -->
<p>Running the example first comments that chunk 69 is removed from the dataset for having insufficient data.</p>
<p>We can then see that we have 42 columns in each of the train and test sets, one for the chunk id, position within chunk, hour of day, and the 39 training variables.</p>
<p>We can also see the dramatically smaller version of the test dataset with rows only at the forecast lead times.</p>
<p>The new train and test datasets are saved in the ‘<em>naive_train.csv</em>‘ and ‘<em>naive_test.csv</em>‘ files respectively.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396c2184859596" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
&gt;dropping chunk=69: train=(0, 95), test=(28, 95)
Train Rows: (23514, 42)
Test Rows: (2070, 42)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396c2184859596-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c2184859596-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396c2184859596-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396c2184859596-1">&gt;dropping chunk=69: train=(0, 95), test=(28, 95)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c2184859596-2">Train Rows: (23514, 42)</div><div class="crayon-line" id="crayon-5c0c9a99396c2184859596-3">Test Rows: (2070, 42)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h3>Forecast Evaluation</h3>
<p>Once forecasts have been made, they need to be evaluated.</p>
<p>It is helpful to have a simpler format when evaluating forecasts. For example, we will use the three-dimensional structure of <em>[chunks][variables][time]</em>, where variable is the target variable number from 0 to 38 and time is the lead time index from 0 to 9.</p>
<p>Models are expected to make predictions in this format.</p>
<p>We can also restructure the test dataset to have this dataset for comparison. The <em>prepare_test_forecasts()</em> function below implements this.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396c4229678981" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396c4229678981-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c4229678981-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396c4229678981-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c4229678981-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396c4229678981-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c4229678981-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396c4229678981-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c4229678981-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396c4229678981-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c4229678981-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396c4229678981-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c4229678981-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396c4229678981-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396c4229678981-1"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c4229678981-2"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c4229678981-3"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c4229678981-4"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5c0c9a99396c4229678981-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c4229678981-6"><span class="crayon-h"> </span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396c4229678981-7"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c4229678981-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c4229678981-9"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c4229678981-10"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396c4229678981-11"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c4229678981-12"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396c4229678981-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>We will evaluate a model using the mean absolute error, or MAE. This is the metric that was used in the competition and is a sensible choice given the non-Gaussian distribution of the target variables.</p>
<p>If a lead time contains no data in the test set (e.g. <em>NaN</em>), then no error will be calculated for that forecast. If the lead time does have data in the test set but no data in the forecast, then the full magnitude of the observation will be taken as error. Finally, if the test set has an observation and a forecast was made, then the absolute difference will be recorded as the error.</p>
<p>The <em>calculate_error()</em> function implements these rules and returns the error for a given forecast.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396c6014808465" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396c6014808465-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c6014808465-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396c6014808465-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c6014808465-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396c6014808465-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c6014808465-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396c6014808465-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396c6014808465-1"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c6014808465-2"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c6014808465-3"><span class="crayon-h"> </span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c6014808465-4"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c6014808465-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c6014808465-6"><span class="crayon-h"> </span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line" id="crayon-5c0c9a99396c6014808465-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Errors are summed across all chunks and all lead times, then averaged.</p>
<p>The overall MAE will be calculated, but we will also calculate a MAE for each forecast lead time. This can help with model selection generally as some models may perform differently at different lead times.</p>
<p>The evaluate_forecasts() function below implements this, calculating the MAE and per-lead time MAE for the provided predictions and expected values in <em>[chunk][variable][time]</em> format.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396c9464437709" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396c9464437709-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396c9464437709-28">28</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-1"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-3"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-4"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-5"><span class="crayon-h"> </span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-6"><span class="crayon-h"> </span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-8"><span class="crayon-h"> </span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-9"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-10"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-11"><span class="crayon-h"> </span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-13"><span class="crayon-h"> </span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-15"><span class="crayon-h"> </span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-16"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-17"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-18"><span class="crayon-h"> </span><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-19"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-20"><span class="crayon-h"> </span><span class="crayon-p"># update statistics</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-21"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-22"><span class="crayon-e"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-23"><span class="crayon-e"> </span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-24"><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-25"><span class="crayon-h"> </span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-26"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line" id="crayon-5c0c9a99396c9464437709-27"><span class="crayon-e"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396c9464437709-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>Once we have the evaluation of a model, we can present it.</p>
<p>The <em>summarize_error()</em> function below first prints a one-line summary of a model’s performance then creates a plot of MAE per forecast lead time.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396cb726925630" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396cb726925630-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cb726925630-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396cb726925630-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cb726925630-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396cb726925630-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cb726925630-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396cb726925630-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cb726925630-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396cb726925630-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cb726925630-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396cb726925630-1"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cb726925630-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396cb726925630-3"><span class="crayon-h"> </span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cb726925630-4"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396cb726925630-5"><span class="crayon-h"> </span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cb726925630-6"><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396cb726925630-7"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cb726925630-8"><span class="crayon-h"> </span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5c0c9a99396cb726925630-9"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cb726925630-10"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We are now ready to start exploring the performance of naive forecasting methods.</p>
<h2>Data Analysis</h2>
<p>The first step in fitting classical time series models to this data is to take a closer look at the data.</p>
<p>There are 208 (actually 207) usable chunks of data, and each chunk has 39 time series to fit; that is a total of 8,073 separate models that would need to be fit on the data. That is a lot of models, but the models are trained on a relatively small amount of data, at most (5 * 24) or 120 observations and the model is linear so it will find a fit quickly.</p>
<p>We have choices about how to configure models to the data; for example:</p>
<ul>
<li>One model configuration for all time series (simplest).</li>
<li>One model configuration for all variables across chunks (reasonable).</li>
<li>One model configuration per variable per chunk (most complex).</li>
</ul>
<p>We will investigate the simplest approach of one model configuration for all series, but you may want to explore one or more of the other approaches.</p>
<p>This section is divided into three parts; they are:</p>
<ol>
<li>Missing Data</li>
<li>Impute Missing Data</li>
<li>Autocorrelation Plots</li>
</ol>
<h3>Missing Data</h3>
<p>Classical time series methods require that the time series to be complete, e.g. that there are no missing values.</p>
<p>Therefore the first step is to investigate how complete or incomplete the target variables are.</p>
<p>For a given variable, there may be missing observations defined by missing rows. Specifically, each observation has a ‘<em>position_within_chunk</em>‘. We expect each chunk in the training dataset to have 120 observations, with ‘<em>positions_within_chunk</em>‘ from 1 to 120 inclusively.</p>
<p>Therefore, we can create an array of 120 nan values for each variable, mark all observations in the chunk using the ‘<em>positions_within_chunk</em>‘ values, and anything left will be marked <em>NaN</em>. We can then plot each variable and look for gaps.</p>
<p>The <em>variable_to_series()</em> function below will take the rows for a chunk and a given column index for the target variable and will return a series of 120 time steps for the variable with all available data marked with the value from the chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396cd386025084" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396cd386025084-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cd386025084-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396cd386025084-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cd386025084-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396cd386025084-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cd386025084-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396cd386025084-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cd386025084-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396cd386025084-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396cd386025084-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396cd386025084-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396cd386025084-1"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cd386025084-2"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396cd386025084-3"><span class="crayon-h"> </span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cd386025084-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396cd386025084-5"><span class="crayon-h"> </span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cd386025084-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396cd386025084-7"><span class="crayon-h"> </span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cd386025084-8"><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396cd386025084-9"><span class="crayon-h"> </span><span class="crayon-p"># store data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396cd386025084-10"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396cd386025084-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can then call this function for each target variable in one chunk and create a line plot.</p>
<p>The function below named <em>plot_variables()</em> will implement this and create a figure with 39 line plots stacked horizontally.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396d0289379586" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot variables horizontally with gaps for missing data
def plot_variables(chunk_train, n_vars=39):
	pyplot.figure()
	for i in range(n_vars):
		# convert target number into column number
		col_ix = 3 + i
		# mark missing obs for variable
		series = variable_to_series(chunk_train, col_ix)
		# plot
		ax = pyplot.subplot(n_vars, 1, i+1)
		ax.set_xticklabels([])
		ax.set_yticklabels([])
		pyplot.plot(series)
	# show plot
	pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d0289379586-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d0289379586-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d0289379586-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d0289379586-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d0289379586-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d0289379586-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d0289379586-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396d0289379586-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-1"><span class="crayon-p"># plot variables horizontally with gaps for missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d0289379586-2"><span class="crayon-e">def </span><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-3"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d0289379586-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-5"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d0289379586-6"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span></div><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-7"><span class="crayon-h"> </span><span class="crayon-p"># mark missing obs for variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d0289379586-8"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-9"><span class="crayon-h"> </span><span class="crayon-p"># plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d0289379586-10"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-11"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d0289379586-12"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-13"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d0289379586-14"><span class="crayon-h"> </span><span class="crayon-p"># show plot</span></div><div class="crayon-line" id="crayon-5c0c9a99396d0289379586-15"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Tying this together, the complete example is listed below. A plot of all variables in the first chunk is created.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396d2326529985" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot missing
from numpy import loadtxt
from numpy import nan
from numpy import unique
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data

# plot variables horizontally with gaps for missing data
def plot_variables(chunk_train, n_vars=39):
	pyplot.figure()
	for i in range(n_vars):
		# convert target number into column number
		col_ix = 3 + i
		# mark missing obs for variable
		series = variable_to_series(chunk_train, col_ix)
		# plot
		ax = pyplot.subplot(n_vars, 1, i+1)
		ax.set_xticklabels([])
		ax.set_yticklabels([])
		pyplot.plot(series)
	# show plot
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
# pick one chunk
rows = train_chunks[0]
# plot variables
plot_variables(rows)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d2326529985-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a99396d2326529985-53">53</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-1"><span class="crayon-p"># plot missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-5"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-6"> </div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-7"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-8"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-9"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-10"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-11"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-12"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-14"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-15"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-18"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-19"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-20"><span class="crayon-h"> </span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-21"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-22"><span class="crayon-h"> </span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-23"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-24"><span class="crayon-h"> </span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-25"><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-26"><span class="crayon-h"> </span><span class="crayon-p"># store data</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-27"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-30"><span class="crayon-p"># plot variables horizontally with gaps for missing data</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-31"><span class="crayon-e">def </span><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-32"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-33"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-34"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-35"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-36"><span class="crayon-h"> </span><span class="crayon-p"># mark missing obs for variable</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-37"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-38"><span class="crayon-h"> </span><span class="crayon-p"># plot</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-39"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-40"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-41"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-42"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-43"><span class="crayon-h"> </span><span class="crayon-p"># show plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-44"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-45"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-46"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-47"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-48"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-49"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-50"><span class="crayon-p"># pick one chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-51"><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d2326529985-52"><span class="crayon-p"># plot variables</span></div><div class="crayon-line" id="crayon-5c0c9a99396d2326529985-53"><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>Running the example creates a figure with 39 line plots, one for each target variable in the first chunk.</p>
<p>We can see a seasonal structure in many of the variables. This suggests it may be beneficial to perform a 24-hour seasonal differencing of each series prior to modeling.</p>
<p>The plots are small, and you may need to increase the size of the figure to clearly see the data.</p>
<p>We can see that there are variables for which we have no data. These can be detected and ignored as we cannot model or forecast them.</p>
<p>We can see gaps in many of the series, but the gaps are short, lasting for a few hours at most. These could be imputed either with persistence of previous values or values at the same hours within the same series.</p>
<div class="wp-caption aligncenter" id="attachment_6324" style="width: 1290px"><img alt="Line Plots for All Targets in Chunk 1 With Missing Values Marked" class="size-full wp-image-6324" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Missing-Values-Marked.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Missing-Values-Marked.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Missing-Values-Marked-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Missing-Values-Marked-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Missing-Values-Marked-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plots for All Targets in Chunk 1 With Missing Values Marked</p></div>
<p>Looking at a few other chunks randomly, many result in plots with much the same observations.</p>
<p>This is not always the case though.</p>
<p>Update the example to plot the 4th chunk in the dataset (index 3).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396d4287329742" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# pick one chunk
rows = train_chunks[3]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396d4287329742-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d4287329742-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396d4287329742-1"><span class="crayon-p"># pick one chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d4287329742-2"><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The result is a figure that tells a very different story.</p>
<p>We see gaps in the data that last for many hours, perhaps up to a day or more.</p>
<p>These series will require dramatic repair before they can be used to fit a classical model.</p>
<p>Imputing the missing data using persistence or observations within the series with the same hour will likely not be sufficient. They may have to be filled with average values taken across the entire training dataset.</p>
<div class="wp-caption aligncenter" id="attachment_6325" style="width: 1290px"><img alt="Line Plots for All Targets in Chunk 4 With Missing Values Marked" class="size-full wp-image-6325" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Missing-Values-Marked.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Missing-Values-Marked.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Missing-Values-Marked-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Missing-Values-Marked-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Missing-Values-Marked-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plots for All Targets in Chunk 4 With Missing Values Marked</p></div>
<h3>Impute Missing Data</h3>
<p>There are many ways to impute the missing data, and we cannot know which is best a priori.</p>
<p>One approach would be to prepare the data using multiple different imputation methods and use the skill of the models fit on the data to help guide the best approach.</p>
<p>Some imputation approaches already suggested include:</p>
<ul>
<li>Persist the last observation in the series, also called linear interpolation.</li>
<li>Fill with values or average values within the series with the same hour of day.</li>
<li>Fill with values or average values with the same hour of day across the training dataset.</li>
</ul>
<p>It may also be useful to use combinations, e.g. persist or fill from the series for small gaps and draw from the whole dataset for large gaps.</p>
<p>We can also investigate the effect of imputing methods by filling in the missing data and looking at plots to see if the series looks reasonable. It’s crude, effective, and fast.</p>
<p>First, we need to calculate a parallel series of the hour of day for each chunk that we can use for imputing hour-specific data for each variable in the chunk.</p>
<p>Given a series of partially filled hours of day, the <em>interpolate_hours()</em> function below will fill in the missing hours of day. It does this by finding the first marked hour, then counting forward, filling in the hour of day, then performing the same operation backwards.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396d6792321927" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396d6792321927-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d6792321927-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-1"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-2"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-3"><span class="crayon-h"> </span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-4"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-7"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-8"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-9"><span class="crayon-h"> </span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-10"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-12"><span class="crayon-h"> </span><span class="crayon-p"># increment hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-13"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-14"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-15"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-16"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-17"><span class="crayon-h"> </span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-18"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-19"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-20"><span class="crayon-h"> </span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-21"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-22"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396d6792321927-23"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d6792321927-24"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>I’m sure there is a more Pythonic way to write this function, but I wanted to lay it all out to make it obvious what was going on.</p>
<p>We can test this out on a mock list of hours with missing data. The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396d8432143493" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# interpolate hours
from numpy import nan
from numpy import isnan

# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24

# define hours with missing data
data = [nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, 0, nan, 2, nan, nan, nan, nan, nan, nan, 9, 10, 11, 12, 13, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]
print(data)
# fill in missing hours
interpolate_hours(data)
print(data)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396d8432143493-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a99396d8432143493-35">35</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-1"><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-v">isnan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-4"> </div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-5"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-6"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-7"><span class="crayon-h"> </span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-8"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-10"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-11"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-12"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-13"><span class="crayon-h"> </span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-14"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-16"><span class="crayon-h"> </span><span class="crayon-p"># increment hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-17"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-18"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-19"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-20"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-21"><span class="crayon-h"> </span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-22"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-23"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-24"><span class="crayon-h"> </span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-25"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-26"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-27"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-28"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-30"><span class="crayon-p"># define hours with missing data</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-31"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-32"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-33"><span class="crayon-p"># fill in missing hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396d8432143493-34"><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396d8432143493-35"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>Running the example first prints the hour data with missing values, then the same sequence with all of the hours filled in correctly.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396da526510871" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, 0, nan, 2, nan, nan, nan, nan, nan, nan, 9, 10, 11, 12, 13, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]
[11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396da526510871-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396da526510871-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396da526510871-1">[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, 0, nan, 2, nan, nan, nan, nan, nan, nan, 9, 10, 11, 12, 13, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396da526510871-2">[11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can use this function to prepare a series of hours for a chunk that can be used to fill in missing values for a chunk using hour-specific information.</p>
<p>We can call the same <em>variable_to_series()</em> function from the previous section to create the series of hours with missing values (column index 2), then call <em>interpolate_hours()</em> to fill in the gaps.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396dc681047406" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare sequence of hours for the chunk
hours = variable_to_series(rows, 2)
# interpolate hours
interpolate_hours(hours)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396dc681047406-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dc681047406-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396dc681047406-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dc681047406-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396dc681047406-1"><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dc681047406-2"><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396dc681047406-3"><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dc681047406-4"><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can then pass the hours to any impute function that may make use of it.</p>
<p>Let’s try filling in missing values in a chunk with values within the same series with the same hour. Specifically, we will find all rows with the same hour on the series and calculate the median value.</p>
<p>The <em>impute_missing()</em> below takes all of the rows in a chunk, the prepared sequence of hours of the day for the chunk, and the series with missing values for a variable and the column index for a variable.</p>
<p>It first checks to see if the series is all missing data and returns immediately if this is the case as no impute can be performed. It then enumerates over the time steps of the series and when it detects a time step with no data, it collects all rows in the series with data for the same hour and calculates the median value.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396dd972138991" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# impute missing data
def impute_missing(rows, hours, series, col_ix):
	# count missing observations
	n_missing = count_nonzero(isnan(series))
	# calculate ratio of missing
	ratio = n_missing / float(len(series)) * 100
	# check for no data
	if ratio == 100.0:
		return series
	# impute missing using the median value for hour in the series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# get all rows with the same hour
			matches = rows[rows[:,2]==hours[i]]
			# fill with median value
			value = nanmedian(matches[:, col_ix])
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396dd972138991-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396dd972138991-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-1"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-2"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-3"><span class="crayon-h"> </span><span class="crayon-p"># count missing observations</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-4"><span class="crayon-h"> </span><span class="crayon-v">n_missing</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-5"><span class="crayon-h"> </span><span class="crayon-p"># calculate ratio of missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-6"><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_missing</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-7"><span class="crayon-h"> </span><span class="crayon-p"># check for no data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-8"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-10"><span class="crayon-h"> </span><span class="crayon-p"># impute missing using the median value for hour in the series</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-11"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-13"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-14"><span class="crayon-h"> </span><span class="crayon-p"># get all rows with the same hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-15"><span class="crayon-h"> </span><span class="crayon-v">matches</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-16"><span class="crayon-h"> </span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-17"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">matches</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-18"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-19"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396dd972138991-20"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396dd972138991-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>To see the impact of this impute strategy, we can update the <em>plot_variables()</em> function from the previous section to first plot the imputed series then plot the original series with missing values.</p>
<p>This will allow the imputed values to shine through in the gaps of the original series and we can see if the results look reasonable.</p>
<p>The updated version of the <em>plot_variables()</em> function is listed below with this change, calling the <em>impute_missing()</em> function to create the imputed version of the series and taking the hours series as an argument.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396df804592363" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot variables horizontally with gaps for missing data
def plot_variables(chunk_train, hours, n_vars=39):
	pyplot.figure()
	for i in range(n_vars):
		# convert target number into column number
		col_ix = 3 + i
		# mark missing obs for variable
		series = variable_to_series(chunk_train, col_ix)
		ax = pyplot.subplot(n_vars, 1, i+1)
		ax.set_xticklabels([])
		ax.set_yticklabels([])
		# imputed
		imputed = impute_missing(chunk_train, hours, series, col_ix)
		# plot imputed
		pyplot.plot(imputed)
		# plot with missing
		pyplot.plot(series)
	# show plot
	pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396df804592363-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396df804592363-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396df804592363-1"><span class="crayon-p"># plot variables horizontally with gaps for missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-2"><span class="crayon-e">def </span><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-3"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-5"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-6"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-7"><span class="crayon-h"> </span><span class="crayon-p"># mark missing obs for variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-8"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-9"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-10"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-11"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-12"><span class="crayon-h"> </span><span class="crayon-p"># imputed</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-13"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-14"><span class="crayon-h"> </span><span class="crayon-p"># plot imputed</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-15"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-16"><span class="crayon-h"> </span><span class="crayon-p"># plot with missing</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-17"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396df804592363-18"><span class="crayon-h"> </span><span class="crayon-p"># show plot</span></div><div class="crayon-line" id="crayon-5c0c9a99396df804592363-19"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Tying all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396e1333067148" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# impute missing
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import nanmedian
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# impute missing data
def impute_missing(rows, hours, series, col_ix):
	# count missing observations
	n_missing = count_nonzero(isnan(series))
	# calculate ratio of missing
	ratio = n_missing / float(len(series)) * 100
	# check for no data
	if ratio == 100.0:
		return series
	# impute missing using the median value for hour in the series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# get all rows with the same hour
			matches = rows[rows[:,2]==hours[i]]
			# fill with median value
			value = nanmedian(matches[:, col_ix])
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed

# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24

# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data

# plot variables horizontally with gaps for missing data
def plot_variables(chunk_train, hours, n_vars=39):
	pyplot.figure()
	for i in range(n_vars):
		# convert target number into column number
		col_ix = 3 + i
		# mark missing obs for variable
		series = variable_to_series(chunk_train, col_ix)
		ax = pyplot.subplot(n_vars, 1, i+1)
		ax.set_xticklabels([])
		ax.set_yticklabels([])
		# imputed
		imputed = impute_missing(chunk_train, hours, series, col_ix)
		# plot imputed
		pyplot.plot(imputed)
		# plot with missing
		pyplot.plot(series)
	# show plot
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
# pick one chunk
rows = train_chunks[0]
# prepare sequence of hours for the chunk
hours = variable_to_series(rows, 2)
# interpolate hours
interpolate_hours(hours)
# plot variables
plot_variables(rows, hours)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e1333067148-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a99396e1333067148-111">111</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-1"><span class="crayon-p"># impute missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-8"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-10"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-11"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-12"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-13"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-14"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-15"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-16"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-17"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-18"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-20"> </div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-21"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-22"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-23"><span class="crayon-h"> </span><span class="crayon-p"># count missing observations</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-24"><span class="crayon-h"> </span><span class="crayon-v">n_missing</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-25"><span class="crayon-h"> </span><span class="crayon-p"># calculate ratio of missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-26"><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_missing</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-27"><span class="crayon-h"> </span><span class="crayon-p"># check for no data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-28"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-30"><span class="crayon-h"> </span><span class="crayon-p"># impute missing using the median value for hour in the series</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-31"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-32"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-33"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-34"><span class="crayon-h"> </span><span class="crayon-p"># get all rows with the same hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-35"><span class="crayon-h"> </span><span class="crayon-v">matches</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-36"><span class="crayon-h"> </span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-37"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">matches</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-38"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-39"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-40"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-41"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-42"> </div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-43"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-44"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-45"><span class="crayon-h"> </span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-46"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-47"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-48"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-49"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-50"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-51"><span class="crayon-h"> </span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-52"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-53"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-54"><span class="crayon-h"> </span><span class="crayon-p"># increment hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-55"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-56"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-57"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-58"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-59"><span class="crayon-h"> </span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-60"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-61"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-62"><span class="crayon-h"> </span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-63"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-64"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-65"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-66"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-67"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-68"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-69"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-70"><span class="crayon-h"> </span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-71"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-72"><span class="crayon-h"> </span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-73"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-74"><span class="crayon-h"> </span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-75"><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-76"><span class="crayon-h"> </span><span class="crayon-p"># store data</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-77"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-78"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-79"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-80"><span class="crayon-p"># plot variables horizontally with gaps for missing data</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-81"><span class="crayon-e">def </span><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-82"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-83"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-84"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-85"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-86"><span class="crayon-h"> </span><span class="crayon-p"># mark missing obs for variable</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-87"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-88"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-89"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-90"><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-91"><span class="crayon-h"> </span><span class="crayon-p"># imputed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-92"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-93"><span class="crayon-h"> </span><span class="crayon-p"># plot imputed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-94"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-95"><span class="crayon-h"> </span><span class="crayon-p"># plot with missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-96"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-97"><span class="crayon-h"> </span><span class="crayon-p"># show plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-98"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-99"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-100"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-101"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-102"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-103"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-104"><span class="crayon-p"># pick one chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-105"><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-106"><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-107"><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-108"><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-109"><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e1333067148-110"><span class="crayon-p"># plot variables</span></div><div class="crayon-line" id="crayon-5c0c9a99396e1333067148-111"><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0046 seconds] -->
<p>Running the example creates a single figure with 39 line plots: one for each target variable in the first chunk in the training dataset.</p>
<p>We can see that the series is orange, showing the original data and the gaps have been imputed and are marked in blue.</p>
<p>The blue segments seem reasonable.</p>
<div class="wp-caption aligncenter" id="attachment_6326" style="width: 1290px"><img alt="Line Plots for All Targets in Chunk 1 With Imputed Missing Values" class="size-full wp-image-6326" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Imputed-Missing-Values.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Imputed-Missing-Values.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Imputed-Missing-Values-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Imputed-Missing-Values-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-1-With-Imputed-Missing-Values-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plots for All Targets in Chunk 1 With Imputed Missing Values</p></div>
<p>We can try the same approach on the 4th chunk in the dataset that has a lot more missing data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396e4605538713" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# pick one chunk
rows = train_chunks[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396e4605538713-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e4605538713-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396e4605538713-1"><span class="crayon-p"># pick one chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e4605538713-2"><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Running the example creates the same kind of figure, but here we can see the large missing segments filled in with imputed values.</p>
<p>Again, the sequences seem reasonable, even showing daily seasonal cycle structure where appropriate.</p>
<div class="wp-caption aligncenter" id="attachment_6327" style="width: 1290px"><img alt="Line Plots for All Targets in Chunk 4 With Imputed Missing Values" class="size-full wp-image-6327" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Imputed-Missing-Values.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Imputed-Missing-Values.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Imputed-Missing-Values-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Imputed-Missing-Values-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plots-for-All-Targets-in-Chunk-4-With-Imputed-Missing-Values-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plots for All Targets in Chunk 4 With Imputed Missing Values</p></div>
<p>This looks like a good start; you can explore other imputation strategies and see how they compare either in terms of line plots or on the resulting model skill.</p>
<h3>Autocorrelation Plots</h3>
<p>Now that we know how to fill in the missing values, we can take a look at autocorrelation plots for the series data.</p>
<p>Autocorrelation plots summarize the relationship of each observation with observations at prior time steps. Together with partial autocorrelation plots, they can be used to determine the configuration for an ARMA model.</p>
<p>The statsmodels library provides the <a href="http://www.statsmodels.org/dev/generated/statsmodels.graphics.tsaplots.plot_acf.html">plot_acf()</a> and <a href="http://www.statsmodels.org/dev/generated/statsmodels.graphics.tsaplots.plot_pacf.html">plot_pacf()</a> functions that can be used to plot ACF and PACF plots respectively.</p>
<p>We can update the <em>plot_variables()</em> to create these plots, one of each type for each of the 39 series. That is a lot of plots.</p>
<p>We will stack all ACF plots on the left vertically and all PACF plots on the right vertically. That is two columns of 39 plots. We will limit the lags considered by the plot to 24 time steps (hours) and ignore the correlation of each variable with itself as it is redundant.</p>
<p>The updated <em>plot_variables()</em> function for plotting ACF and PACF plots is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396e7050121219" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot acf and pacf plots for each imputed variable series
def plot_variables(chunk_train, hours, n_vars=39):
	pyplot.figure()
	n_plots = n_vars * 2
	j = 0
	lags = 24
	for i in range(1, n_plots, 2):
		# convert target number into column number
		col_ix = 3 + j
		j += 1
		# get series
		series = variable_to_series(chunk_train, col_ix)
		imputed = impute_missing(chunk_train, hours, series, col_ix)
		# acf
		axis = pyplot.subplot(n_vars, 2, i)
		plot_acf(imputed, ax=axis, lags=lags, zero=False)
		axis.set_title('')
		axis.set_xticklabels([])
		axis.set_yticklabels([])
		# pacf
		axis = pyplot.subplot(n_vars, 2, i+1)
		plot_pacf(imputed, ax=axis, lags=lags, zero=False)
		axis.set_title('')
		axis.set_xticklabels([])
		axis.set_yticklabels([])
	# show plot
	pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e7050121219-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396e7050121219-27">27</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-1"><span class="crayon-p"># plot acf and pacf plots for each imputed variable series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-2"><span class="crayon-e">def </span><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-3"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-4"><span class="crayon-h"> </span><span class="crayon-v">n_plots</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_vars *</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-5"><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-6"><span class="crayon-h"> </span><span class="crayon-v">lags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_plots</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-8"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-9"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">j</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-10"><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-11"><span class="crayon-h"> </span><span class="crayon-p"># get series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-12"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-13"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-14"><span class="crayon-h"> </span><span class="crayon-p"># acf</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-15"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-16"><span class="crayon-h"> </span><span class="crayon-e">plot_acf</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-o">=</span><span class="crayon-v">axis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lags</span><span class="crayon-o">=</span><span class="crayon-v">lags</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">zero</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-17"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_title</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-18"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-19"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-20"><span class="crayon-h"> </span><span class="crayon-p"># pacf</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-21"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-22"><span class="crayon-h"> </span><span class="crayon-e">plot_pacf</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-o">=</span><span class="crayon-v">axis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lags</span><span class="crayon-o">=</span><span class="crayon-v">lags</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">zero</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-23"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_title</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-24"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-25"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e7050121219-26"><span class="crayon-h"> </span><span class="crayon-p"># show plot</span></div><div class="crayon-line" id="crayon-5c0c9a99396e7050121219-27"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396e9458562579" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# acf and pacf plots
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import nanmedian
from matplotlib import pyplot
from statsmodels.graphics.tsaplots import plot_acf
from statsmodels.graphics.tsaplots import plot_pacf

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# impute missing data
def impute_missing(rows, hours, series, col_ix):
	# count missing observations
	n_missing = count_nonzero(isnan(series))
	# calculate ratio of missing
	ratio = n_missing / float(len(series)) * 100
	# check for no data
	if ratio == 100.0:
		return series
	# impute missing using the median value for hour in the series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# get all rows with the same hour
			matches = rows[rows[:,2]==hours[i]]
			# fill with median value
			value = nanmedian(matches[:, col_ix])
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed

# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24

# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data

# plot acf and pacf plots for each imputed variable series
def plot_variables(chunk_train, hours, n_vars=39):
	pyplot.figure()
	n_plots = n_vars * 2
	j = 0
	lags = 24
	for i in range(1, n_plots, 2):
		# convert target number into column number
		col_ix = 3 + j
		j += 1
		# get series
		series = variable_to_series(chunk_train, col_ix)
		imputed = impute_missing(chunk_train, hours, series, col_ix)
		# acf
		axis = pyplot.subplot(n_vars, 2, i)
		plot_acf(imputed, ax=axis, lags=lags, zero=False)
		axis.set_title('')
		axis.set_xticklabels([])
		axis.set_yticklabels([])
		# pacf
		axis = pyplot.subplot(n_vars, 2, i+1)
		plot_pacf(imputed, ax=axis, lags=lags, zero=False)
		axis.set_title('')
		axis.set_xticklabels([])
		axis.set_yticklabels([])
	# show plot
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
# pick one chunk
rows = train_chunks[0]
# prepare sequence of hours for the chunk
hours = variable_to_series(rows, 2)
# interpolate hours
interpolate_hours(hours)
# plot variables
plot_variables(rows, hours)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-112">112</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-114">114</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-116">116</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-118">118</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396e9458562579-120">120</div><div class="crayon-num" data-line="crayon-5c0c9a99396e9458562579-121">121</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-1"><span class="crayon-p"># acf and pacf plots</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-8"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-9"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">graphics</span><span class="crayon-sy">.</span><span class="crayon-e">tsaplots </span><span class="crayon-e">import </span><span class="crayon-e">plot_acf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-10"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">graphics</span><span class="crayon-sy">.</span><span class="crayon-e">tsaplots </span><span class="crayon-e">import </span><span class="crayon-v">plot_pacf</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-12"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-13"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-14"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-15"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-16"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-17"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-18"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-19"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-20"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-22"> </div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-23"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-24"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-25"><span class="crayon-h"> </span><span class="crayon-p"># count missing observations</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-26"><span class="crayon-h"> </span><span class="crayon-v">n_missing</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-27"><span class="crayon-h"> </span><span class="crayon-p"># calculate ratio of missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-28"><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_missing</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-29"><span class="crayon-h"> </span><span class="crayon-p"># check for no data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-30"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-31"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-32"><span class="crayon-h"> </span><span class="crayon-p"># impute missing using the median value for hour in the series</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-33"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-34"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-35"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-36"><span class="crayon-h"> </span><span class="crayon-p"># get all rows with the same hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-37"><span class="crayon-h"> </span><span class="crayon-v">matches</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-38"><span class="crayon-h"> </span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-39"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">matches</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-40"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-41"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-42"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-44"> </div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-45"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-46"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-47"><span class="crayon-h"> </span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-48"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-49"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-50"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-51"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-52"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-53"><span class="crayon-h"> </span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-54"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-55"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-56"><span class="crayon-h"> </span><span class="crayon-p"># increment hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-57"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-58"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-59"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-60"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-61"><span class="crayon-h"> </span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-62"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-63"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-64"><span class="crayon-h"> </span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-65"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-66"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-67"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-68"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-69"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-70"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-71"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-72"><span class="crayon-h"> </span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-73"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-74"><span class="crayon-h"> </span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-75"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-76"><span class="crayon-h"> </span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-77"><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-78"><span class="crayon-h"> </span><span class="crayon-p"># store data</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-79"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-80"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-82"><span class="crayon-p"># plot acf and pacf plots for each imputed variable series</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-83"><span class="crayon-e">def </span><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-84"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-85"><span class="crayon-h"> </span><span class="crayon-v">n_plots</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_vars *</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-86"><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-87"><span class="crayon-h"> </span><span class="crayon-v">lags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-88"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_plots</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-89"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-90"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">j</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-91"><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-92"><span class="crayon-h"> </span><span class="crayon-p"># get series</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-93"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-94"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-95"><span class="crayon-h"> </span><span class="crayon-p"># acf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-96"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-97"><span class="crayon-h"> </span><span class="crayon-e">plot_acf</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-o">=</span><span class="crayon-v">axis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lags</span><span class="crayon-o">=</span><span class="crayon-v">lags</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">zero</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-98"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_title</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-99"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-100"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-101"><span class="crayon-h"> </span><span class="crayon-p"># pacf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-102"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-103"><span class="crayon-h"> </span><span class="crayon-e">plot_pacf</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ax</span><span class="crayon-o">=</span><span class="crayon-v">axis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lags</span><span class="crayon-o">=</span><span class="crayon-v">lags</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">zero</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-104"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_title</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-105"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_xticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-106"><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-sy">.</span><span class="crayon-e">set_yticklabels</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-107"><span class="crayon-h"> </span><span class="crayon-p"># show plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-108"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-109"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-110"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-111"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-112"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-113"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-114"><span class="crayon-p"># pick one chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-115"><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-116"><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-117"><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-118"><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-119"><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396e9458562579-120"><span class="crayon-p"># plot variables</span></div><div class="crayon-line" id="crayon-5c0c9a99396e9458562579-121"><span class="crayon-e">plot_variables</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0054 seconds] -->
<p>Running the example creates a figure with a lot of plots for the target variables in the first chunk of the training dataset.</p>
<p>You may need to increase the size of the plot window to better see the details of each plot.</p>
<p>We can see on the left that most ACF plots show significant correlations (dots above the significance region) at lags 1-2 steps, maybe lags 1-3 steps in some cases, with a slow, steady decrease over the lags</p>
<p>Similarly, on the right, we can see significant lags in the PACF plot at 1-2 time steps with steep fall-off.</p>
<p>This strongly suggests an autocorrelation process with an order of perhaps 1, 2, or 3, e.g. AR(3).</p>
<p>In the ACF plots on the left we can also see a daily cycle in the correlations. This may suggest some benefit in a seasonal differencing of the data prior to modeling or the use of an AR model capable of seasonal differencing.</p>
<div class="wp-caption aligncenter" id="attachment_6328" style="width: 1290px"><img alt="ACF and PACF Plots for Target Variables in Chunk 1" class="size-full wp-image-6328" height="2018" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/ACF-and-PACF-Plots-for-Target-Variables-in-Chunk-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/ACF-and-PACF-Plots-for-Target-Variables-in-Chunk-1.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/ACF-and-PACF-Plots-for-Target-Variables-in-Chunk-1-190x300.png 190w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/ACF-and-PACF-Plots-for-Target-Variables-in-Chunk-1-768x1211.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/ACF-and-PACF-Plots-for-Target-Variables-in-Chunk-1-650x1024.png 650w" width="1280"/><p class="wp-caption-text">ACF and PACF Plots for Target Variables in Chunk 1</p></div>
<p>We can repeat this analysis of the target variables for other chunks and we see much the same picture.</p>
<p>It suggests we may be able to get away with a general AR model configuration for all series across all chunks.</p>
<h2>Develop an Autoregressive Model</h2>
<p>In this section, we will develop an autoregressive model for the imputed target series data.</p>
<p>The first step is to implement a general function for making a forecast for each chunk.</p>
<p>The function tasks the training dataset and the input columns (chunk id, position in chunk, and hour) for the test set and returns forecasts for all chunks with the expected 3D format of <em>[chunk][variable][time]</em>.</p>
<p>The function enumerates the chunks in the forecast, then enumerates the 39 target columns, calling another new function named <em>forecast_variable()</em> in order to make a prediction for each lead time for a given target variable.</p>
<p>The complete function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396ec181130125" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# prepare sequence of hours for the chunk
		hours = variable_to_series(train_chunks[i], 2)
		# interpolate hours
		interpolate_hours(hours)
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(hours, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396ec181130125-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ec181130125-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-1"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-3"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-4"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-5"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-7"><span class="crayon-h"> </span><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-8"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-9"><span class="crayon-h"> </span><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-10"><span class="crayon-h"> </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-11"><span class="crayon-h"> </span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-12"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-14"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-15"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-16"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ec181130125-17"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ec181130125-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We can now implement a version of the <em>forecast_variable()</em>.</p>
<p>For each variable, we first check if there is no data (e.g. all NaNs) and if so, we return a forecast that is a NaN for each forecast lead time.</p>
<p>We then create a series from the variable using the <em>variable_to_series()</em> and then impute the missing values using the median within the series by calling <em>impute_missing()</em>, both of which were developed in the previous section.</p>
<p>Finally, we call a new function named <em>fit_and_forecast()</em> that fits a model and predicts the 10 forecast lead times.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396ef409054215" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast all lead times for one variable
def forecast_variable(hours, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# check for no data
	if not has_data(chunk_train[:, col_ix]):
		forecast = [nan for _ in range(len(lead_times))]
		return forecast
	# get series
	series = variable_to_series(chunk_train, col_ix)
	# impute
	imputed = impute_missing(chunk_train, hours, series, col_ix)
	# fit AR model and forecast
	forecast = fit_and_forecast(imputed)
	return forecast</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ef409054215-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ef409054215-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ef409054215-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ef409054215-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ef409054215-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ef409054215-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396ef409054215-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396ef409054215-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-1"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ef409054215-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-3"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ef409054215-4"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-5"><span class="crayon-h"> </span><span class="crayon-p"># check for no data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ef409054215-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-7"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ef409054215-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-9"><span class="crayon-h"> </span><span class="crayon-p"># get series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ef409054215-10"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-11"><span class="crayon-h"> </span><span class="crayon-p"># impute</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ef409054215-12"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-13"><span class="crayon-h"> </span><span class="crayon-p"># fit AR model and forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396ef409054215-14"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_and_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396ef409054215-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We will fit an AR model to a given imputed series. To do this, we will use the <a href="http://www.statsmodels.org/dev/generated/statsmodels.tsa.arima_model.ARIMA.html">statsmodels ARIMA class</a>. We will use ARIMA instead of AR to offer some flexibility if you would like to explore any of the family of ARIMA models.</p>
<p>First, we must define the model, including the order of the autoregressive process, such as AR(1).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396f1095722382" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define the model
model = ARIMA(series, order=(1,0,0))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396f1095722382-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f1095722382-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396f1095722382-1"><span class="crayon-p"># define the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f1095722382-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ARIMA</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Next, the model is fit on the imputed series. We turn off the verbose information during the fit by setting <em>disp</em> to <em>False</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396f3164608938" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit the model
model_fit = model.fit(disp=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396f3164608938-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f3164608938-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396f3164608938-1"><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f3164608938-2"><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The fit model is then used to forecast the next 72 hours beyond the end of the series.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396f5451896746" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast 72 hours
yhat = model_fit.predict(len(series), len(series)+72)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396f5451896746-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f5451896746-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396f5451896746-1"><span class="crayon-p"># forecast 72 hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f5451896746-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">72</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We are only interested in specific lead times, so we prepare an array of those lead times, subtract 1 to turn them into array indices, then use them to select the values at the 10 forecast lead times in which we are interested.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396f6329765631" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# extract lead times
lead_times = array(get_lead_times())
indices = lead_times - 1
return yhat[indices]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396f6329765631-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f6329765631-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396f6329765631-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f6329765631-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396f6329765631-1"><span class="crayon-p"># extract lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f6329765631-2"><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f6329765631-3"><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f6329765631-4"><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-v">indices</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The statsmodels ARIMA models use linear algebra libraries to fit the model under the covers, and sometimes the fit process can be unstable on some data. As such, it can throw an exception or report a lot of warnings.</p>
<p>We will trap exceptions and return a <em>NaN</em> forecast, and ignore all warnings during the fit and evaluation.</p>
<p>The <em>fit_and_forecast()</em> function below ties all of this together.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396f8760721121" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit AR model and generate a forecast
def fit_and_forecast(series):
	# define the model
	model = ARIMA(series, order=(1,0,0))
	# return a nan forecast in case of exception
	try:
		# ignore statsmodels warnings
		with catch_warnings():
			filterwarnings("ignore")
			# fit the model
			model_fit = model.fit(disp=False)
			# forecast 72 hours
			yhat = model_fit.predict(len(series), len(series)+72)
			# extract lead times
			lead_times = array(get_lead_times())
			indices = lead_times - 1
			return yhat[indices]
	except:
		return [nan for _ in range(len(get_lead_times()))]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f8760721121-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396f8760721121-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-1"><span class="crayon-p"># fit AR model and generate a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-2"><span class="crayon-e">def </span><span class="crayon-e">fit_and_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-3"><span class="crayon-h"> </span><span class="crayon-p"># define the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ARIMA</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-5"><span class="crayon-h"> </span><span class="crayon-p"># return a nan forecast in case of exception</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-6"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-7"><span class="crayon-h"> </span><span class="crayon-p"># ignore statsmodels warnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-8"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-9"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-10"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-11"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-12"><span class="crayon-h"> </span><span class="crayon-p"># forecast 72 hours</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">72</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-14"><span class="crayon-h"> </span><span class="crayon-p"># extract lead times</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-15"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-16"><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-v">indices</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f8760721121-18"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f8760721121-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We are now ready to evaluate an autoregressive process for each of the 39 series in each of the 207 training chunks.</p>
<p>We will start off by testing an AR(1) process.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396f9356936694" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# autoregression forecast
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmedian
from statsmodels.tsa.arima_model import ARIMA
from matplotlib import pyplot
from warnings import catch_warnings
from warnings import filterwarnings

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24

# return true if the array has any non-nan values
def has_data(data):
	return count_nonzero(isnan(data)) &lt; len(data)

# impute missing data
def impute_missing(rows, hours, series, col_ix):
	# impute missing using the median value for hour in the series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# get all rows with the same hour
			matches = rows[rows[:,2]==hours[i]]
			# fill with median value
			value = nanmedian(matches[:, col_ix])
			if isnan(value):
				value = 0.0
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed

# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data

# fit AR model and generate a forecast
def fit_and_forecast(series):
	# define the model
	model = ARIMA(series, order=(1,0,0))
	# return a nan forecast in case of exception
	try:
		# ignore statsmodels warnings
		with catch_warnings():
			filterwarnings("ignore")
			# fit the model
			model_fit = model.fit(disp=False)
			# forecast 72 hours
			yhat = model_fit.predict(len(series), len(series)+72)
			# extract lead times
			lead_times = array(get_lead_times())
			indices = lead_times - 1
			return yhat[indices]
	except:
		return [nan for _ in range(len(get_lead_times()))]

# forecast all lead times for one variable
def forecast_variable(hours, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# check for no data
	if not has_data(chunk_train[:, col_ix]):
		forecast = [nan for _ in range(len(lead_times))]
		return forecast
	# get series
	series = variable_to_series(chunk_train, col_ix)
	# impute
	imputed = impute_missing(chunk_train, hours, series, col_ix)
	# fit AR model and forecast
	forecast = fit_and_forecast(imputed)
	return forecast

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# prepare sequence of hours for the chunk
		hours = variable_to_series(train_chunks[i], 2)
		# interpolate hours
		interpolate_hours(hours)
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(hours, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('AR', total_mae, times_mae)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-112">112</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-114">114</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-116">116</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-118">118</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-120">120</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-122">122</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-124">124</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-126">126</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-128">128</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-130">130</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-132">132</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-134">134</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-136">136</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-138">138</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-140">140</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-142">142</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-144">144</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-146">146</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-148">148</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-150">150</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-152">152</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-154">154</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-156">156</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-158">158</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-160">160</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-162">162</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-164">164</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-166">166</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-168">168</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-170">170</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-172">172</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-174">174</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-176">176</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-178">178</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-180">180</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-182">182</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-183">183</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-184">184</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-185">185</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-186">186</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-187">187</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-188">188</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-189">189</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-190">190</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-191">191</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-192">192</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-193">193</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-194">194</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-195">195</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-196">196</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-197">197</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-198">198</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-199">199</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-200">200</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-201">201</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-202">202</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-203">203</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-204">204</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-205">205</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-206">206</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-207">207</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-208">208</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-209">209</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-210">210</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-211">211</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-212">212</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-213">213</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-214">214</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-215">215</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a99396f9356936694-216">216</div><div class="crayon-num" data-line="crayon-5c0c9a99396f9356936694-217">217</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-1"><span class="crayon-p"># autoregression forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-9"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">tsa</span><span class="crayon-sy">.</span><span class="crayon-e">arima_model </span><span class="crayon-e">import </span><span class="crayon-e">ARIMA</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-10"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-11"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">catch_warnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-12"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-v">filterwarnings</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-14"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-15"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-16"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-17"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-18"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-19"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-21"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-22"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-24"> </div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-25"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-26"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-28"> </div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-29"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-30"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-31"><span class="crayon-h"> </span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-32"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-33"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-34"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-35"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-36"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-37"><span class="crayon-h"> </span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-38"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-40"><span class="crayon-h"> </span><span class="crayon-p"># increment hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-41"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-42"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-44"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-45"><span class="crayon-h"> </span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-46"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-47"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-48"><span class="crayon-h"> </span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-49"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-50"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-51"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-52"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-53"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-54"><span class="crayon-p"># return true if the array has any non-nan values</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-55"><span class="crayon-e">def </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-56"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-57"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-58"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-59"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-60"><span class="crayon-h"> </span><span class="crayon-p"># impute missing using the median value for hour in the series</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-61"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-62"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-63"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-64"><span class="crayon-h"> </span><span class="crayon-p"># get all rows with the same hour</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-65"><span class="crayon-h"> </span><span class="crayon-v">matches</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-66"><span class="crayon-h"> </span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-67"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">matches</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-68"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-69"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-70"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-71"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-72"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-73"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-74"> </div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-75"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-76"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-77"><span class="crayon-h"> </span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-78"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-79"><span class="crayon-h"> </span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-80"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-81"><span class="crayon-h"> </span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-82"><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-83"><span class="crayon-h"> </span><span class="crayon-p"># store data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-84"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-85"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-86"> </div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-87"><span class="crayon-p"># fit AR model and generate a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-88"><span class="crayon-e">def </span><span class="crayon-e">fit_and_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-89"><span class="crayon-h"> </span><span class="crayon-p"># define the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-90"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ARIMA</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-91"><span class="crayon-h"> </span><span class="crayon-p"># return a nan forecast in case of exception</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-92"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-93"><span class="crayon-h"> </span><span class="crayon-p"># ignore statsmodels warnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-94"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-95"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-96"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-97"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-98"><span class="crayon-h"> </span><span class="crayon-p"># forecast 72 hours</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-99"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">72</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-100"><span class="crayon-h"> </span><span class="crayon-p"># extract lead times</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-101"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-102"><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-103"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-v">indices</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-104"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-105"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-106"> </div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-107"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-108"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-109"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-110"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-111"><span class="crayon-h"> </span><span class="crayon-p"># check for no data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-112"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-113"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-114"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-115"><span class="crayon-h"> </span><span class="crayon-p"># get series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-116"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-117"><span class="crayon-h"> </span><span class="crayon-p"># impute</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-118"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-119"><span class="crayon-h"> </span><span class="crayon-p"># fit AR model and forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-120"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_and_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-121"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-122"> </div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-123"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-124"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-125"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-126"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-127"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-128"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-129"><span class="crayon-h"> </span><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-130"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-131"><span class="crayon-h"> </span><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-132"><span class="crayon-h"> </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-133"><span class="crayon-h"> </span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-134"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-135"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-136"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-137"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-138"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-139"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-140"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-141"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-142"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-143"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-144"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-145"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-146"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-147"><span class="crayon-h"> </span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-148"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-149"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-150"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-151"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-152"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-153"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-154"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-155"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-156"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-157"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-158"><span class="crayon-h"> </span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-159"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-160"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-161"><span class="crayon-h"> </span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-162"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-163"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-164"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-165"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-166"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-167"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-168"><span class="crayon-h"> </span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-169"><span class="crayon-h"> </span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-170"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-171"><span class="crayon-h"> </span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-172"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-173"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-174"><span class="crayon-h"> </span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-175"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-176"><span class="crayon-h"> </span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-177"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-178"><span class="crayon-h"> </span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-179"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-180"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-181"><span class="crayon-h"> </span><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-182"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-183"><span class="crayon-h"> </span><span class="crayon-p"># update statistics</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-184"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-185"><span class="crayon-e"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-186"><span class="crayon-e"> </span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-187"><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-188"><span class="crayon-h"> </span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-189"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-190"><span class="crayon-e"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-191"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-192"> </div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-193"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-194"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-195"><span class="crayon-h"> </span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-196"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-197"><span class="crayon-h"> </span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-198"><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-199"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-200"><span class="crayon-h"> </span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-201"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-202"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-203"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-204"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-205"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-206"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-207"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-208"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-209"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-210"><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-211"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-212"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-213"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-214"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-215"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a99396f9356936694-216"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line" id="crayon-5c0c9a99396f9356936694-217"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'AR'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0101 seconds] -->
<p>Running the example first reports the overall MAE for the test set, followed by the MAE for each forecast lead time.</p>
<p>We can see that the model achieves a MAE of about 0.492, which is less than a MAE 0.520 achieved by a naive persistence model. This shows that indeed the approach has some skill.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a99396fc725856029" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
AR: [0.492 MAE] +1 0.225, +2 0.342, +3 0.410, +4 0.475, +5 0.512, +10 0.593, +17 0.586, +24 0.588, +48 0.588, +72 0.604</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a99396fc725856029-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a99396fc725856029-1">AR: [0.492 MAE] +1 0.225, +2 0.342, +3 0.410, +4 0.475, +5 0.512, +10 0.593, +17 0.586, +24 0.588, +48 0.588, +72 0.604</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A line plot of MAE per forecast lead time is created, showing the linear increase in forecast error with the increase in forecast lead time.</p>
<div class="wp-caption aligncenter" id="attachment_6329" style="width: 1290px"><img alt="MAE vs Forecast Lead Time for AR(1)" class="size-full wp-image-6329" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR1.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR1-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR1-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR1-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">MAE vs Forecast Lead Time for AR(1)</p></div>
<p>We can change the code to test other AR models. Specifically the order of the ARIMA model in the <em>fit_and_forecast()</em> function.</p>
<p>An AR(2) model can be defined as:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a9939700217006944" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = ARIMA(series, order=(2,0,0))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a9939700217006944-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a9939700217006944-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ARIMA</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Running the code with this update shows a further drop in error to an overall MAE of about 0.490.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a9939702402773409" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
AR: [0.490 MAE] +1 0.229, +2 0.342, +3 0.412, +4 0.470, +5 0.503, +10 0.563, +17 0.576, +24 0.605, +48 0.597, +72 0.608</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a9939702402773409-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a9939702402773409-1">AR: [0.490 MAE] +1 0.229, +2 0.342, +3 0.412, +4 0.470, +5 0.503, +10 0.563, +17 0.576, +24 0.605, +48 0.597, +72 0.608</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can also try an AR(3):</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a9939704506224448" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = ARIMA(series, order=(3,0,0))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a9939704506224448-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a9939704506224448-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ARIMA</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Re-running the example with the update shows an increase in the overall MAE compared to an AR(2).</p>
<p>An AR(2) might be a good global level configuration to use, although it is expected that models tailored to each variable or each series may perform better overall.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a9939705229341123" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
AR: [0.491 MAE] +1 0.232, +2 0.345, +3 0.412, +4 0.472, +5 0.504, +10 0.556, +17 0.575, +24 0.607, +48 0.599, +72 0.611</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a9939705229341123-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a9939705229341123-1">AR: [0.491 MAE] +1 0.232, +2 0.345, +3 0.412, +4 0.472, +5 0.504, +10 0.556, +17 0.575, +24 0.607, +48 0.599, +72 0.611</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Autoregressive Model with Global Impute Strategy</h2>
<p>We can evaluate the AR(2) model with an alternate imputation strategy.</p>
<p>Instead of calculating the median value for the same hour across the series in the chunk, we can calculate the same value across the variable in all chunks.</p>
<p>We can update the <em>impute_missing()</em> to take all training chunks as an argument, then collect rows from all chunks for a given hour in order to calculate the median value used to impute. The updated version of the function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a9939707081616309" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# impute missing data
def impute_missing(train_chunks, rows, hours, series, col_ix):
	# impute missing using the median value for hour in all series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# collect all rows across all chunks for the hour
			all_rows = list()
			for rows in train_chunks:
				[all_rows.append(row) for row in rows[rows[:,2]==hours[i]]]
			# calculate the central tendency for target
			all_rows = array(all_rows)
			# fill with median value
			value = nanmedian(all_rows[:, col_ix])
			if isnan(value):
				value = 0.0
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a9939707081616309-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939707081616309-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a9939707081616309-1"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-2"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-3"><span class="crayon-h"> </span><span class="crayon-p"># impute missing using the median value for hour in all series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-4"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-7"><span class="crayon-h"> </span><span class="crayon-p"># collect all rows across all chunks for the hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-8"><span class="crayon-h"> </span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-10"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">all_rows</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-11"><span class="crayon-h"> </span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-12"><span class="crayon-h"> </span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-13"><span class="crayon-h"> </span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-14"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-15"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-16"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-17"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-18"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939707081616309-19"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939707081616309-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>In order to pass the train_chunks to the <em>impute_missing()</em> function, we must update the <em>forecast_variable()</em> function to also take <em>train_chunks</em> as an argument and pass it along, and in turn update the <em>forecast_chunks()</em> function to pass <em>train_chunks</em>.</p>
<p>The complete example using a global imputation strategy is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a9939709416285597" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# autoregression forecast with global impute strategy
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmedian
from statsmodels.tsa.arima_model import ARIMA
from matplotlib import pyplot
from warnings import catch_warnings
from warnings import filterwarnings

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24

# return true if the array has any non-nan values
def has_data(data):
	return count_nonzero(isnan(data)) &lt; len(data)

# impute missing data
def impute_missing(train_chunks, rows, hours, series, col_ix):
	# impute missing using the median value for hour in all series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# collect all rows across all chunks for the hour
			all_rows = list()
			for rows in train_chunks:
				[all_rows.append(row) for row in rows[rows[:,2]==hours[i]]]
			# calculate the central tendency for target
			all_rows = array(all_rows)
			# fill with median value
			value = nanmedian(all_rows[:, col_ix])
			if isnan(value):
				value = 0.0
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed

# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data

# fit AR model and generate a forecast
def fit_and_forecast(series):
	# define the model
	model = ARIMA(series, order=(2,0,0))
	# return a nan forecast in case of exception
	try:
		# ignore statsmodels warnings
		with catch_warnings():
			filterwarnings("ignore")
			# fit the model
			model_fit = model.fit(disp=False)
			# forecast 72 hours
			yhat = model_fit.predict(len(series), len(series)+72)
			# extract lead times
			lead_times = array(get_lead_times())
			indices = lead_times - 1
			return yhat[indices]
	except:
		return [nan for _ in range(len(get_lead_times()))]

# forecast all lead times for one variable
def forecast_variable(hours, train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# check for no data
	if not has_data(chunk_train[:, col_ix]):
		forecast = [nan for _ in range(len(lead_times))]
		return forecast
	# get series
	series = variable_to_series(chunk_train, col_ix)
	# impute
	imputed = impute_missing(train_chunks, chunk_train, hours, series, col_ix)
	# fit AR model and forecast
	forecast = fit_and_forecast(imputed)
	return forecast

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# prepare sequence of hours for the chunk
		hours = variable_to_series(train_chunks[i], 2)
		# interpolate hours
		interpolate_hours(hours)
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(hours, train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('AR', total_mae, times_mae)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-2">2</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-4">4</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-6">6</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-8">8</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-10">10</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-12">12</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-14">14</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-16">16</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-18">18</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-20">20</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-22">22</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-24">24</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-26">26</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-28">28</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-30">30</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-32">32</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-34">34</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-36">36</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-38">38</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-40">40</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-42">42</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-44">44</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-46">46</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-48">48</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-50">50</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-52">52</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-54">54</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-56">56</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-58">58</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-60">60</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-62">62</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-64">64</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-66">66</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-68">68</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-70">70</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-72">72</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-74">74</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-76">76</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-78">78</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-80">80</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-82">82</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-84">84</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-86">86</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-88">88</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-90">90</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-92">92</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-94">94</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-96">96</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-98">98</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-100">100</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-102">102</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-104">104</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-106">106</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-108">108</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-110">110</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-112">112</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-114">114</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-116">116</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-118">118</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-120">120</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-122">122</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-124">124</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-126">126</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-128">128</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-130">130</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-132">132</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-134">134</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-136">136</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-138">138</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-140">140</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-142">142</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-144">144</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-146">146</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-148">148</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-150">150</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-152">152</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-154">154</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-156">156</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-158">158</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-160">160</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-162">162</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-164">164</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-166">166</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-168">168</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-170">170</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-172">172</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-174">174</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-176">176</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-178">178</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-180">180</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-182">182</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-183">183</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-184">184</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-185">185</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-186">186</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-187">187</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-188">188</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-189">189</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-190">190</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-191">191</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-192">192</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-193">193</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-194">194</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-195">195</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-196">196</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-197">197</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-198">198</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-199">199</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-200">200</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-201">201</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-202">202</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-203">203</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-204">204</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-205">205</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-206">206</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-207">207</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-208">208</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-209">209</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-210">210</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-211">211</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-212">212</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-213">213</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-214">214</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-215">215</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-216">216</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-217">217</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-218">218</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-219">219</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0c9a9939709416285597-220">220</div><div class="crayon-num" data-line="crayon-5c0c9a9939709416285597-221">221</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a9939709416285597-1"><span class="crayon-p"># autoregression forecast with global impute strategy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-9"><span class="crayon-e">from </span><span class="crayon-v">statsmodels</span><span class="crayon-sy">.</span><span class="crayon-v">tsa</span><span class="crayon-sy">.</span><span class="crayon-e">arima_model </span><span class="crayon-e">import </span><span class="crayon-e">ARIMA</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-10"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-11"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-e">catch_warnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-12"><span class="crayon-e">from </span><span class="crayon-e">warnings </span><span class="crayon-e">import </span><span class="crayon-v">filterwarnings</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-14"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-15"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-16"><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-17"><span class="crayon-h"> </span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-18"><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-19"><span class="crayon-h"> </span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-21"><span class="crayon-h"> </span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-22"><span class="crayon-e"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-24"> </div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-25"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-26"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-28"> </div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-29"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-30"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-31"><span class="crayon-h"> </span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-32"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-33"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-34"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-35"><span class="crayon-h"> </span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-36"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-37"><span class="crayon-h"> </span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-38"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-40"><span class="crayon-h"> </span><span class="crayon-p"># increment hour</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-41"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-42"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-44"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-45"><span class="crayon-h"> </span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-46"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-47"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-48"><span class="crayon-h"> </span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-49"><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-50"><span class="crayon-h"> </span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-51"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-52"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-53"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-54"><span class="crayon-p"># return true if the array has any non-nan values</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-55"><span class="crayon-e">def </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-56"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-57"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-58"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-59"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-60"><span class="crayon-h"> </span><span class="crayon-p"># impute missing using the median value for hour in all series</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-61"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-62"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-63"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-64"><span class="crayon-h"> </span><span class="crayon-p"># collect all rows across all chunks for the hour</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-65"><span class="crayon-h"> </span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-66"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-67"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">all_rows</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-68"><span class="crayon-h"> </span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-69"><span class="crayon-h"> </span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-70"><span class="crayon-h"> </span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-71"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-72"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-73"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-74"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-75"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-76"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-77"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-78"> </div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-79"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-80"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-81"><span class="crayon-h"> </span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-82"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-83"><span class="crayon-h"> </span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-84"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-85"><span class="crayon-h"> </span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-86"><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-87"><span class="crayon-h"> </span><span class="crayon-p"># store data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-88"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-89"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-90"> </div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-91"><span class="crayon-p"># fit AR model and generate a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-92"><span class="crayon-e">def </span><span class="crayon-e">fit_and_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-93"><span class="crayon-h"> </span><span class="crayon-p"># define the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-94"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ARIMA</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-95"><span class="crayon-h"> </span><span class="crayon-p"># return a nan forecast in case of exception</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-96"><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-97"><span class="crayon-h"> </span><span class="crayon-p"># ignore statsmodels warnings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-98"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">catch_warnings</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-99"><span class="crayon-h"> </span><span class="crayon-e">filterwarnings</span><span class="crayon-sy">(</span><span class="crayon-s">"ignore"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-100"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-101"><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">disp</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-102"><span class="crayon-h"> </span><span class="crayon-p"># forecast 72 hours</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-103"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_fit</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">72</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-104"><span class="crayon-h"> </span><span class="crayon-p"># extract lead times</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-105"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-106"><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-107"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-v">indices</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-108"><span class="crayon-h"> </span><span class="crayon-v">except</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-109"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-110"> </div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-111"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-112"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-113"><span class="crayon-h"> </span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-114"><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-115"><span class="crayon-h"> </span><span class="crayon-p"># check for no data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-116"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-117"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-118"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-119"><span class="crayon-h"> </span><span class="crayon-p"># get series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-120"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-121"><span class="crayon-h"> </span><span class="crayon-p"># impute</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-122"><span class="crayon-h"> </span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-123"><span class="crayon-h"> </span><span class="crayon-p"># fit AR model and forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-124"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_and_forecast</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-125"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-126"> </div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-127"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-128"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-129"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-130"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-131"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-132"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-133"><span class="crayon-h"> </span><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-134"><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-135"><span class="crayon-h"> </span><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-136"><span class="crayon-h"> </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-137"><span class="crayon-h"> </span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-138"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-139"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-140"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-141"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-142"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-143"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-144"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-145"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-146"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-147"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-148"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-149"><span class="crayon-h"> </span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-150"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-151"><span class="crayon-h"> </span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-152"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-153"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-154"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-155"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-156"><span class="crayon-h"> </span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-157"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-158"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-159"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-160"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-161"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-162"><span class="crayon-h"> </span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-163"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-164"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-165"><span class="crayon-h"> </span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-166"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-167"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-168"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-169"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-170"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-171"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-172"><span class="crayon-h"> </span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-173"><span class="crayon-h"> </span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-174"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-175"><span class="crayon-h"> </span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-176"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-177"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-178"><span class="crayon-h"> </span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-179"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-180"><span class="crayon-h"> </span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-181"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-182"><span class="crayon-h"> </span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-183"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-184"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-185"><span class="crayon-h"> </span><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-186"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-187"><span class="crayon-h"> </span><span class="crayon-p"># update statistics</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-188"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-189"><span class="crayon-e"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-190"><span class="crayon-e"> </span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-191"><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-192"><span class="crayon-h"> </span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-193"><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-194"><span class="crayon-e"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-195"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-196"> </div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-197"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-198"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-199"><span class="crayon-h"> </span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-200"><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-201"><span class="crayon-h"> </span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-202"><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-203"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-204"><span class="crayon-h"> </span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-205"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-206"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-207"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-208"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-209"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-210"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-211"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-212"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-213"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-214"><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-215"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-216"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-217"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-218"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-219"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0c9a9939709416285597-220"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line" id="crayon-5c0c9a9939709416285597-221"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'AR'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0104 seconds] -->
<p>Running the example shows a further drop in the overall MAE to about 0.487.</p>
<p>It may be interesting to explore imputation strategies that alternate the method used to fill in missing values based on how much missing data a series has or the gap being filled.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0c9a993970c557968482" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
AR: [0.487 MAE] +1 0.228, +2 0.339, +3 0.409, +4 0.469, +5 0.499, +10 0.560, +17 0.573, +24 0.600, +48 0.595, +72 0.606</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0c9a993970c557968482-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0c9a993970c557968482-1">AR: [0.487 MAE] +1 0.228, +2 0.339, +3 0.409, +4 0.469, +5 0.499, +10 0.560, +17 0.573, +24 0.600, +48 0.595, +72 0.606</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A line plot of MAE vs. forecast lead time is also created.</p>
<div class="wp-caption aligncenter" id="attachment_6330" style="width: 1290px"><img alt="MAE vs Forecast Lead Time for AR(2) Impute With Global Strategy" class="size-full wp-image-6330" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR2-Impute-With-Global-Strategy.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR2-Impute-With-Global-Strategy.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR2-Impute-With-Global-Strategy-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR2-Impute-With-Global-Strategy-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-vs-Forecast-Lead-Time-for-AR2-Impute-With-Global-Strategy-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">MAE vs Forecast Lead Time for AR(2) Impute With Global Strategy</p></div>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Imputation Strategies</strong>. Develop and evaluate one additional alternate imputation strategy for the missing data in each series.</li>
<li><strong>Data Preparation</strong>. Explore whether data preparation techniques applied to each can improve model skill, such as standardization, normalization, and power transforms.</li>
<li><strong>Differencing</strong>. Explore whether differencing, such as 1-step or 24-step (seasonal differencing), can make each series stationary, and in turn result in better forecasts.</li>
</ul>
<p>If you explore any of these extensions, I’d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>Posts</h3>
<ul>
<li><a href="https://machinelearningmastery.com/standard-multivariate-multi-step-multi-site-time-series-forecasting-problem/">A Standard Multivariate, Multi-Step, and Multi-Site Time Series Forecasting Problem</a></li>
<li><a href="https://machinelearningmastery.com/gentle-introduction-autocorrelation-partial-autocorrelation/">A Gentle Introduction to Autocorrelation and Partial Autocorrelation</a></li>
<li><a href="https://machinelearningmastery.com/grid-search-arima-hyperparameters-with-python/">How to Grid Search ARIMA Model Hyperparameters with Python</a></li>
</ul>
<h3>API</h3>
<ul>
<li><a href="http://www.statsmodels.org/dev/generated/statsmodels.graphics.tsaplots.plot_acf.html">statsmodels.graphics.tsaplots.plot_acf API</a></li>
<li><a href="http://www.statsmodels.org/dev/generated/statsmodels.graphics.tsaplots.plot_pacf.html">statsmodels.graphics.tsaplots.plot_pacf API</a></li>
<li><a href="http://www.statsmodels.org/dev/generated/statsmodels.tsa.arima_model.ARIMA.html">statsmodels.tsa.arima_model.ARIMA API</a></li>
</ul>
<h3>Articles</h3>
<ul>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/data">EMC Data Science Global Hackathon (Air Quality Prediction)</a></li>
<li><a href="http://blog.kaggle.com/2012/05/01/chucking-everything-into-a-random-forest-ben-hamner-on-winning-the-air-quality-prediction-hackathon/">Chucking everything into a Random Forest: Ben Hamner on Winning The Air Quality Prediction Hackathon</a></li>
<li><a href="https://github.com/benhamner/Air-Quality-Prediction-Hackathon-Winning-Model">Winning Code for the EMC Data Science Global Hackathon (Air Quality Prediction)</a></li>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/discussion/1821">General approaches to partitioning the models?</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop autoregressive models for multi-step time series forecasting for a multivariate air pollution time series.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to analyze and impute missing values for time series data.</li>
<li>How to develop and evaluate an autoregressive model for multi-step time series forecasting.</li>
<li>How to improve an autoregressive model using alternate data imputation methods.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img align="left" alt="Deep Learning for Time Series Forecasting" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br/>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6323 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+Autoregressive+Forecasting+Models+for+Multi-Step+Air+Pollution+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/" rel="next">How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">2 Responses to <em>How to Develop Autoregressive Forecasting Models for Multi-Step Air Pollution Time Series Forecasting</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-451983">
<div class="comment-container" id="li-comment-451983">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/02f7d73376d98037732992f5dbefc47d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/02f7d73376d98037732992f5dbefc47d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">San</span>
<span class="date">October 18, 2018 at 1:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/#comment-451983" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dr. Brownlee! Awesome job done as always! Thank you so much for your contribution.<br/>
I wonder is it possible to implement some kind of Machine Learning methods to fill missing data by neighboring stations. I mean if there are several stations with correlated observed timeseries and I want to use them to fill missing timeseries data in the station that I use for modeling. Usually pairwise correlation method used for such tasks and it is statistically based approach, maybe it would be better to use Neural Networks. What do you think? Thanks.</p>
<div class="reply">
<a aria-label="Reply to San" class="comment-reply-link" href="#comment-451983" onclick='return addComment.moveForm( "comment-451983", "451983", "respond", "6323" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451991">
<div class="comment-container" id="li-comment-451991">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 18, 2018 at 2:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/#comment-451991" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure, try it and let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451991" onclick='return addComment.moveForm( "comment-451991", "451991", "respond", "6323" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="6323"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="2e6c316bb5"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="142"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-51"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for Time Series</strong><br/>
Forecast the future with MLPs, CNNs, and LSTMs.
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
<script type="text/javascript">		var ssb_admin_ajax = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
		var ssb_post_id = 6323 ;
		var ssb_post_url = 'https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/';
		var ssb_alternate_post_url = 'http://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/';
		jQuery( document ).ready(function(){
		var is_ssb_used = jQuery('.simplesocialbuttons');
		if( is_ssb_used ) {

			var data = {
			'action': 'ssb_fetch_data',
			'postID': ssb_post_id
		};
			jQuery.post(ssb_admin_ajax, data, function(data, textStatus, xhr) {
				var array = JSON.parse(data);

				jQuery.each( array, function( index, value ){

					if( index == 'total' ){
						jQuery('.ssb_'+ index +'_counter').html(value + '<span>Shares</span>');
					}else{
						jQuery('.ssb_'+ index +'_counter').html(value);
					}
				});

			});
		}
		})

		document.addEventListener("DOMContentLoaded", function() {
			var if_ssb_exist = document.getElementsByClassName( "simplesocialbuttons" ).length > 0;
			if (if_ssb_exist) {
				ssbPlugin.fetchFacebookShares();
			}
		});;
		</script></body>
</html>