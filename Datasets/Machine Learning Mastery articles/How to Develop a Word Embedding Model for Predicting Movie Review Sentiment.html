<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop a Word Embedding Model for Predicting Movie Review Sentiment</title>
<link href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop a Word Embedding Model for Predicting Movie Review Sentiment" property="og:title"/>
<meta content="Word embeddings are a technique for representing text where different words with similar meaning have a similar real-valued vector representation. They are a key breakthrough that has led to great performance of neural network models on a suite of challenging natural language processing problems. In this tutorial, you will discover how to develop word embedding …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Natural Language Processing" property="article:section"/>
<meta content="2017-10-29T18:00:39+00:00" property="article:published_time"/>
<meta content="2017-11-21T00:04:12+00:00" property="article:modified_time"/>
<meta content="2017-11-21T00:04:12+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg" property="og:image:secure_url"/>
<meta content="800" property="og:image:width"/>
<meta content="537" property="og:image:height"/>
<meta content="How to Develop a Word Embedding Model for Predicting Movie Review Sentiment" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop a Word Embedding Model for Predicting Movie Review Sentiment Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4401" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-word-embedding-model-predicting-movie-review-sentiment%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-word-embedding-model-predicting-movie-review-sentiment%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4401 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Want help with deep learning for text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4401 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Develop a Word Embedding Model for Predicting Movie Review Sentiment</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-10-30T05:00:39+1100">October 30, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Deep Learning for Natural Language Processing">Deep Learning for Natural Language Processing</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4401 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+a+Word+Embedding+Model+for+Predicting+Movie+Review+Sentiment&amp;url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Word embeddings are a technique for representing text where different words with similar meaning have a similar real-valued vector representation.</p>
<p>They are a key breakthrough that has led to great performance of neural network models on a suite of challenging natural language processing problems.</p>
<p>In this tutorial, you will discover how to develop word embedding models for neural networks to classify movie reviews.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to prepare movie review text data for classification with deep learning methods.</li>
<li>How to learn a word embedding as part of fitting a deep learning model.</li>
<li>How to learn a standalone word embedding and how to use a pre-trained embedding in a neural network model.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4402" style="width: 810px"><img alt="How to Develop a Word Embedding Model for Predicting Movie Review Sentiment" class="size-full wp-image-4402" height="537" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment-300x201.jpg 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment-768x516.jpg 768w" width="800"/><p class="wp-caption-text">How to Develop a Word Embedding Model for Predicting Movie Review Sentiment<br/>Photo by <a href="https://www.flickr.com/photos/fuzzyblue/6351564408/">Katrina Br*?#*!@nd</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 5 parts; they are:</p>
<ol>
<li>Movie Review Dataset</li>
<li>Data Preparation</li>
<li>Train Embedding Layer</li>
<li>Train word2vec Embedding</li>
<li>Use Pre-trained Embedding</li>
</ol>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>1. Movie Review Dataset</h2>
<p>The Movie Review Data is a collection of movie reviews retrieved from the imdb.com website in the early 2000s by Bo Pang and Lillian Lee. The reviews were collected and made available as part of their research on natural language processing.</p>
<p>The reviews were originally released in 2002, but an updated and cleaned up version were released in 2004, referred to as “v2.0”.</p>
<p>The dataset is comprised of 1,000 positive and 1,000 negative movie reviews drawn from an archive of the rec.arts.movies.reviews newsgroup hosted at <a href="http://reviews.imdb.com/Reviews">imdb.com</a>. The authors refer to this dataset as the “polarity dataset.”</p>
<blockquote><p>Our data contains 1000 positive and 1000 negative reviews all written before 2002, with a cap of 20 reviews per author (312 authors total) per category. We refer to this corpus as the polarity dataset.</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>The data has been cleaned up somewhat, for example:</p>
<ul>
<li>The dataset is comprised of only English reviews.</li>
<li>All text has been converted to lowercase.</li>
<li>There is white space around punctuation like periods, commas, and brackets.</li>
<li>Text has been split into one sentence per line.</li>
</ul>
<p>The data has been used for a few related natural language processing tasks. For classification, the performance of machine learning models (such as Support Vector Machines) on the data is in the range of high 70% to low 80% (e.g. 78%-82%).</p>
<p>More sophisticated data preparation may see results as high as 86% with 10-fold cross validation. This gives us a ballpark of low-to-mid 80s if we were looking to use this dataset in experiments of modern methods.</p>
<blockquote><p>… depending on choice of downstream polarity classifier, we can achieve highly statistically significant improvement (from 82.8% to 86.4%)</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>You can download the dataset from here:</p>
<ul>
<li><a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz">Movie Review Polarity Dataset</a> (review_polarity.tar.gz, 3MB)</li>
</ul>
<p>After unzipping the file, you will have a directory called “<em>txt_sentoken</em>” with two sub-directories containing the text “<em>neg</em>” and “<em>pos</em>” for negative and positive reviews. Reviews are stored one per file with a naming convention cv000 to cv999 for each neg and pos.</p>
<p>Next, let’s look at loading and preparing the text data.</p>
<h2>2. Data Preparation</h2>
<p>In this section, we will look at 3 things:</p>
<ol>
<li>Separation of data into training and test sets.</li>
<li>Loading and cleaning the data to remove punctuation and numbers.</li>
<li>Defining a vocabulary of preferred words.</li>
</ol>
<h3>Split into Train and Test Sets</h3>
<p>We are pretending that we are developing a system that can predict the sentiment of a textual movie review as either positive or negative.</p>
<p>This means that after the model is developed, we will need to make predictions on new textual reviews. This will require all of the same data preparation to be performed on those new reviews as is performed on the training data for the model.</p>
<p>We will ensure that this constraint is built into the evaluation of our models by splitting the training and test datasets prior to any data preparation. This means that any knowledge in the data in the test set that could help us better prepare the data (e.g. the words used) are unavailable in the preparation of data used for training the model.</p>
<p>That being said, we will use the last 100 positive reviews and the last 100 negative reviews as a test set (100 reviews) and the remaining 1,800 reviews as the training dataset.</p>
<p>This is a 90% train, 10% split of the data.</p>
<p>The split can be imposed easily by using the filenames of the reviews where reviews named 000 to 899 are for training data and reviews named 900 onwards are for test.</p>
<h3>Loading and Cleaning Reviews</h3>
<p>The text data is already pretty clean; not much preparation is required.</p>
<p>Without getting bogged down too much in the details, we will prepare the data using the following way:</p>
<ul>
<li>Split tokens on white space.</li>
<li>Remove all punctuation from words.</li>
<li>Remove all words that are not purely comprised of alphabetical characters.</li>
<li>Remove all words that are known stop words.</li>
<li>Remove all words that have a length &lt;= 1 character.</li>
</ul>
<p>We can put all of these steps into a function called <em>clean_doc()</em> that takes as an argument the raw text loaded from a file and returns a list of cleaned tokens. We can also define a function <em>load_doc()</em> that loads a document from file ready for use with the <em>clean_doc()</em> function.</p>
<p>An example of cleaning the first positive review is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3a0703094299" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from nltk.corpus import stopwords
import string

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', string.punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	return tokens

# load the document
filename = 'txt_sentoken/pos/cv000_29590.txt'
text = load_doc(filename)
tokens = clean_doc(text)
print(tokens)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-20">20</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-22">22</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-24">24</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-26">26</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-28">28</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-30">30</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-32">32</div><div class="crayon-num" data-line="crayon-5c0ca097de3a0703094299-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a0703094299-34">34</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-1"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-e">stopwords</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-2"><span class="crayon-e">import </span><span class="crayon-t">string</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-4"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-5"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-6"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-7"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-8"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-9"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-10"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-11"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-14"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-15"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-16"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-17"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-18"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-19"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-20"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-21"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-23"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-24"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-25"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-26"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-30"><span class="crayon-p"># load the document</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-31"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'txt_sentoken/pos/cv000_29590.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-32"><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3a0703094299-33"><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a0703094299-34"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>Running the example prints a long list of clean tokens.</p>
<p>There are many more cleaning steps we may want to explore and I leave them as further exercises.</p>
<p>I’d love to see what you can come up with.<br/>
Post your approaches and findings in the comments at the end.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3a9110203976" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3a9110203976-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3a9110203976-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3a9110203976-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3a9110203976-2">'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Define a Vocabulary</h3>
<p>It is important to define a vocabulary of known words when using a bag-of-words or embedding model.</p>
<p>The more words, the larger the representation of documents, therefore it is important to constrain the words to only those believed to be predictive. This is difficult to know beforehand and often it is important to test different hypotheses about how to construct a useful vocabulary.</p>
<p>We have already seen how we can remove punctuation and numbers from the vocabulary in the previous section. We can repeat this for all documents and build a set of all known words.</p>
<p>We can develop a vocabulary as a Counter, which is a dictionary mapping of words and their counts that allow us to easily update and query.</p>
<p>Each document can be added to the counter (a new function called <em>add_doc_to_vocab()</em>) and we can step over all of the reviews in the negative directory and then the positive directory (a new function called <em>process_docs()</em>).</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3ac149325884" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from collections import Counter
from nltk.corpus import stopwords

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	return tokens

# load doc and add to vocab
def add_doc_to_vocab(filename, vocab):
	# load doc
	doc = load_doc(filename)
	# clean doc
	tokens = clean_doc(doc)
	# update counts
	vocab.update(tokens)

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# add doc to vocab
		add_doc_to_vocab(path, vocab)

# define vocab
vocab = Counter()
# add all docs to vocab
process_docs('txt_sentoken/neg', vocab, True)
process_docs('txt_sentoken/pos', vocab, True)
# print the size of the vocab
print(len(vocab))
# print the top words in the vocab
print(vocab.most_common(50))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-20">20</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-22">22</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-24">24</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-26">26</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-28">28</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-30">30</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-32">32</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-34">34</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-36">36</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-38">38</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-40">40</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-42">42</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-44">44</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-46">46</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-48">48</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-50">50</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-52">52</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-54">54</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-56">56</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-58">58</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-60">60</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ac149325884-62">62</div><div class="crayon-num" data-line="crayon-5c0ca097de3ac149325884-63">63</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-3"><span class="crayon-e">from </span><span class="crayon-e">collections </span><span class="crayon-e">import </span><span class="crayon-e">Counter</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-4"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-v">stopwords</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-6"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-7"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-8"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-9"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-10"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-11"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-12"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-13"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-16"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-17"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-18"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-19"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-20"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-21"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-23"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-24"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-25"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-26"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-28"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-29"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-32"><span class="crayon-p"># load doc and add to vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-33"><span class="crayon-e">def </span><span class="crayon-e">add_doc_to_vocab</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-34"><span class="crayon-h"> </span><span class="crayon-p"># load doc</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-35"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-36"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-37"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-38"><span class="crayon-h"> </span><span class="crayon-p"># update counts</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-39"><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-40"> </div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-41"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-42"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-43"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-44"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-45"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-46"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-47"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-48"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-49"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-50"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-51"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-52"><span class="crayon-h"> </span><span class="crayon-p"># add doc to vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-53"><span class="crayon-h"> </span><span class="crayon-e">add_doc_to_vocab</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-54"> </div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-55"><span class="crayon-p"># define vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-56"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Counter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-57"><span class="crayon-p"># add all docs to vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-58"><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-59"><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-60"><span class="crayon-p"># print the size of the vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-61"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ac149325884-62"><span class="crayon-p"># print the top words in the vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3ac149325884-63"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">most_common</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0026 seconds] -->
<p>Running the example shows that we have a vocabulary of 44,276 words.</p>
<p>We also can see a sample of the top 50 most used words in the movie reviews.</p>
<p>Note, that this vocabulary was constructed based on only those reviews in the training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3ad387360048" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
44276
[('film', 7983), ('one', 4946), ('movie', 4826), ('like', 3201), ('even', 2262), ('good', 2080), ('time', 2041), ('story', 1907), ('films', 1873), ('would', 1844), ('much', 1824), ('also', 1757), ('characters', 1735), ('get', 1724), ('character', 1703), ('two', 1643), ('first', 1588), ('see', 1557), ('way', 1515), ('well', 1511), ('make', 1418), ('really', 1407), ('little', 1351), ('life', 1334), ('plot', 1288), ('people', 1269), ('could', 1248), ('bad', 1248), ('scene', 1241), ('movies', 1238), ('never', 1201), ('best', 1179), ('new', 1140), ('scenes', 1135), ('man', 1131), ('many', 1130), ('doesnt', 1118), ('know', 1092), ('dont', 1086), ('hes', 1024), ('great', 1014), ('another', 992), ('action', 985), ('love', 977), ('us', 967), ('go', 952), ('director', 948), ('end', 946), ('something', 945), ('still', 936)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3ad387360048-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ad387360048-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3ad387360048-1">44276</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ad387360048-2">[('film', 7983), ('one', 4946), ('movie', 4826), ('like', 3201), ('even', 2262), ('good', 2080), ('time', 2041), ('story', 1907), ('films', 1873), ('would', 1844), ('much', 1824), ('also', 1757), ('characters', 1735), ('get', 1724), ('character', 1703), ('two', 1643), ('first', 1588), ('see', 1557), ('way', 1515), ('well', 1511), ('make', 1418), ('really', 1407), ('little', 1351), ('life', 1334), ('plot', 1288), ('people', 1269), ('could', 1248), ('bad', 1248), ('scene', 1241), ('movies', 1238), ('never', 1201), ('best', 1179), ('new', 1140), ('scenes', 1135), ('man', 1131), ('many', 1130), ('doesnt', 1118), ('know', 1092), ('dont', 1086), ('hes', 1024), ('great', 1014), ('another', 992), ('action', 985), ('love', 977), ('us', 967), ('go', 952), ('director', 948), ('end', 946), ('something', 945), ('still', 936)]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can step through the vocabulary and remove all words that have a low occurrence, such as only being used once or twice in all reviews.</p>
<p>For example, the following snippet will retrieve only the tokens that of appears 2 or more times in all reviews.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3af732614260" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# keep tokens with a min occurrence
min_occurane = 2
tokens = [k for k,c in vocab.items() if c &gt;= min_occurane]
print(len(tokens))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3af732614260-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3af732614260-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3af732614260-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3af732614260-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3af732614260-1"><span class="crayon-p"># keep tokens with a min occurrence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3af732614260-2"><span class="crayon-v">min_occurane</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c0ca097de3af732614260-3"><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-v">min_occurane</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3af732614260-4"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Running the above example with this addition shows that the vocabulary size drops by a little more than half its size from 44,276 to 25,767 words.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3b1210055751" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
25767</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3b1210055751-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3b1210055751-1">25767</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Finally, the vocabulary can be saved to a new file called <em>vocab.txt</em> that we can later load and use to filter movie reviews prior to encoding them for modeling. We define a new function called <em>save_list()</em> that saves the vocabulary to file, with one word per file.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3b2059667297" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# save list to file
def save_list(lines, filename):
	# convert lines to a single blob of text
	data = '\n'.join(lines)
	# open file
	file = open(filename, 'w')
	# write text
	file.write(data)
	# close file
	file.close()

# save tokens to a vocabulary file
save_list(tokens, 'vocab.txt')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3b2059667297-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b2059667297-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3b2059667297-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b2059667297-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3b2059667297-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b2059667297-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3b2059667297-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b2059667297-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3b2059667297-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b2059667297-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3b2059667297-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b2059667297-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3b2059667297-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3b2059667297-1"><span class="crayon-p"># save list to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b2059667297-2"><span class="crayon-e">def </span><span class="crayon-e">save_list</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3b2059667297-3"><span class="crayon-h"> </span><span class="crayon-p"># convert lines to a single blob of text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b2059667297-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\n'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3b2059667297-5"><span class="crayon-h"> </span><span class="crayon-p"># open file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b2059667297-6"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'w'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3b2059667297-7"><span class="crayon-h"> </span><span class="crayon-p"># write text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b2059667297-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3b2059667297-9"><span class="crayon-h"> </span><span class="crayon-p"># close file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b2059667297-10"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3b2059667297-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b2059667297-12"><span class="crayon-p"># save tokens to a vocabulary file</span></div><div class="crayon-line" id="crayon-5c0ca097de3b2059667297-13"><span class="crayon-e">save_list</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Running the min occurrence filter on the vocabulary and saving it to file, you should now have a new file called <em>vocab.txt</em> with only the words we are interested in.</p>
<p>The order of words in your file will differ, but should look something like the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3b9792209427" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
aberdeen
dupe
burt
libido
hamlet
arlene
available
corners
web
columbia
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3b9792209427-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b9792209427-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3b9792209427-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b9792209427-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3b9792209427-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b9792209427-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3b9792209427-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b9792209427-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3b9792209427-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3b9792209427-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3b9792209427-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3b9792209427-1">aberdeen</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b9792209427-2">dupe</div><div class="crayon-line" id="crayon-5c0ca097de3b9792209427-3">burt</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b9792209427-4">libido</div><div class="crayon-line" id="crayon-5c0ca097de3b9792209427-5">hamlet</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b9792209427-6">arlene</div><div class="crayon-line" id="crayon-5c0ca097de3b9792209427-7">available</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b9792209427-8">corners</div><div class="crayon-line" id="crayon-5c0ca097de3b9792209427-9">web</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3b9792209427-10">columbia</div><div class="crayon-line" id="crayon-5c0ca097de3b9792209427-11">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We are now ready to look at learning features from the reviews.</p>
<h2>3. Train Embedding Layer</h2>
<p>In this section, we will learn a word embedding while training a neural network on the classification problem.</p>
<p>A word embedding is a way of representing text where each word in the vocabulary is represented by a real valued vector in a high-dimensional space. The vectors are learned in such a way that words that have similar meanings will have similar representation in the vector space (close in the vector space). This is a more expressive representation for text than more classical methods like bag-of-words, where relationships between words or tokens are ignored, or forced in bigram and trigram approaches.</p>
<p>The real valued vector representation for words can be learned while training the neural network. We can do this in the Keras deep learning library using the <a href="https://keras.io/layers/embeddings/">Embedding layer</a>.</p>
<p>The first step is to load the vocabulary. We will use it to filter out words from movie reviews that we are not interested in.</p>
<p>If you have worked through the previous section, you should have a local file called ‘<em>vocab.txt</em>‘ with one word per line. We can load that file and build a vocabulary as a set for checking the validity of tokens.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3ba675910355" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ba675910355-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ba675910355-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ba675910355-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ba675910355-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ba675910355-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ba675910355-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ba675910355-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3ba675910355-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-1"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ba675910355-2"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-3"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ba675910355-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-5"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ba675910355-6"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-7"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ba675910355-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ba675910355-10"> </div><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-11"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ba675910355-12"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-13"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ba675910355-14"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ba675910355-15"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Next, we need to load all of the training data movie reviews. For that we can adapt the <em>process_docs()</em> from the previous section to load the documents, clean them, and return them as a list of strings, with one document per string. We want each document to be a string for easy encoding as a sequence of integers later.</p>
<p>Cleaning the document involves splitting each review based on white space, removing punctuation, and then filtering out all tokens not in the vocabulary.</p>
<p>The updated <em>clean_doc()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3bc663018901" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3bc663018901-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3bc663018901-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3bc663018901-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3bc663018901-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3bc663018901-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3bc663018901-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3bc663018901-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3bc663018901-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3bc663018901-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3bc663018901-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3bc663018901-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3bc663018901-1"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3bc663018901-2"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3bc663018901-3"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3bc663018901-4"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3bc663018901-5"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3bc663018901-6"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3bc663018901-7"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3bc663018901-8"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3bc663018901-9"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3bc663018901-10"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3bc663018901-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>The updated <em>process_docs()</em> can then call the <em>clean_doc()</em> for each document on the ‘<em>pos</em>‘ and ‘<em>neg</em>‘ directories that are in our training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3be586555771" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-20">20</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-22">22</div><div class="crayon-num" data-line="crayon-5c0ca097de3be586555771-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3be586555771-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3be586555771-1"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-2"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-3"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-4"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-6"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-8"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-10"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-11"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-12"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-13"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-14"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-15"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-16"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-17"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-18"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-20"> </div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-21"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-22"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3be586555771-23"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3be586555771-24"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>The next step is to encode each document as a sequence of integers.</p>
<p>The Keras Embedding layer requires integer inputs where each integer maps to a single token that has a specific real-valued vector representation within the embedding. These vectors are random at the beginning of training, but during training become meaningful to the network.</p>
<p>We can encode the training documents as sequences of integers using the <a href="https://keras.io/preprocessing/text/#tokenizer">Tokenizer</a> class in the Keras API.</p>
<p>First, we must construct an instance of the class then train it on all documents in the training dataset. In this case, it develops a vocabulary of all tokens in the training dataset and develops a consistent mapping from words in the vocabulary to unique integers. We could just as easily develop this mapping ourselves using our vocabulary file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3c0990199418" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3c0990199418-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c0990199418-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3c0990199418-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c0990199418-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3c0990199418-1"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c0990199418-2"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3c0990199418-3"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c0990199418-4"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Now that the mapping of words to integers has been prepared, we can use it to encode the reviews in the training dataset. We can do that by calling the <em>texts_to_sequences()</em> function on the Tokenizer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3c2324882329" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3c2324882329-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c2324882329-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3c2324882329-1"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c2324882329-2"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We also need to ensure that all documents have the same length.</p>
<p>This is a requirement of Keras for efficient computation. We could truncate reviews to the smallest size or zero-pad (pad with the value ‘0’) reviews to the maximum length, or some hybrid. In this case, we will pad all reviews to the length of the longest review in the training dataset.</p>
<p>First, we can find the longest review using the <em>max()</em> function on the training dataset and take its length. We can then call the Keras function <em>pad_sequences()</em> to pad the sequences to the maximum length by adding 0 values on the end.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3c3091611396" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3c3091611396-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c3091611396-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3c3091611396-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3c3091611396-1"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c3091611396-2"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3c3091611396-3"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Finally, we can define the class labels for the training dataset, needed to fit the supervised neural network model to predict the sentiment of reviews.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3c5522917681" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3c5522917681-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c5522917681-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3c5522917681-1"><span class="crayon-p"># define training labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c5522917681-2"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can then encode and pad the test dataset, needed later to evaluate the model after we train it.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3c7041946324" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3c7041946324-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c7041946324-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3c7041946324-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c7041946324-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3c7041946324-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c7041946324-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3c7041946324-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c7041946324-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3c7041946324-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c7041946324-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3c7041946324-1"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c7041946324-2"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3c7041946324-3"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c7041946324-4"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line" id="crayon-5c0ca097de3c7041946324-5"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c7041946324-6"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3c7041946324-7"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c7041946324-8"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3c7041946324-9"><span class="crayon-p"># define test labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c7041946324-10"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>We are now ready to define our neural network model.</p>
<p>The model will use an Embedding layer as the first hidden layer. The Embedding requires the specification of the vocabulary size, the size of the real-valued vector space, and the maximum length of input documents.</p>
<p>The vocabulary size is the total number of words in our vocabulary, plus one for unknown words. This could be the vocab set length or the size of the vocab within the tokenizer used to integer encode the documents, for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3c9606314286" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3c9606314286-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3c9606314286-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3c9606314286-1"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3c9606314286-2"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We will use a 100-dimensional vector space, but you could try other values, such as 50 or 150. Finally, the maximum document length was calculated above in the <em>max_length</em> variable used during padding.</p>
<p>The complete model definition is listed below including the Embedding layer.</p>
<p>We use a Convolutional Neural Network (CNN) as they have proven to be successful at document classification problems. A conservative CNN configuration is used with 32 filters (parallel fields for processing words) and a kernel size of 8 with a rectified linear (‘relu’) activation function. This is followed by a pooling layer that reduces the output of the convolutional layer by half.</p>
<p>Next, the 2D output from the CNN part of the model is flattened to one long 2D vector to represent the ‘features’ extracted by the CNN. The back-end of the model is a standard Multilayer Perceptron layers to interpret the CNN features. The output layer uses a sigmoid activation function to output a value between 0 and 1 for the negative and positive sentiment in the review.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3cb178368917" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(Embedding(vocab_size, 100, input_length=max_length))
model.add(Conv1D(filters=32, kernel_size=8, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(10, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
print(model.summary())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3cb178368917-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cb178368917-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3cb178368917-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cb178368917-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3cb178368917-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cb178368917-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3cb178368917-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cb178368917-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3cb178368917-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3cb178368917-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cb178368917-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3cb178368917-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cb178368917-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3cb178368917-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cb178368917-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3cb178368917-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cb178368917-8"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3cb178368917-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Running just this piece provides a summary of the defined network.</p>
<p>We can see that the Embedding layer expects documents with a length of 442 words as input and encodes each word in the document as a 100 element vector.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3cc398536321" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding_1 (Embedding)      (None, 442, 100)          2576800
_________________________________________________________________
conv1d_1 (Conv1D)            (None, 435, 32)           25632
_________________________________________________________________
max_pooling1d_1 (MaxPooling1 (None, 217, 32)           0
_________________________________________________________________
flatten_1 (Flatten)          (None, 6944)              0
_________________________________________________________________
dense_1 (Dense)              (None, 10)                69450
_________________________________________________________________
dense_2 (Dense)              (None, 1)                 11
=================================================================
Total params: 2,671,893
Trainable params: 2,671,893
Non-trainable params: 0
_________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3cc398536321-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3cc398536321-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-1">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-2">Layer (type)                 Output Shape              Param #</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-3">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-4">embedding_1 (Embedding)      (None, 442, 100)          2576800</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-5">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-6">conv1d_1 (Conv1D)            (None, 435, 32)           25632</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-7">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-8">max_pooling1d_1 (MaxPooling1 (None, 217, 32)           0</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-9">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-10">flatten_1 (Flatten)          (None, 6944)              0</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-11">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-12">dense_1 (Dense)              (None, 10)                69450</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-13">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-14">dense_2 (Dense)              (None, 1)                 11</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-15">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-16">Total params: 2,671,893</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-17">Trainable params: 2,671,893</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3cc398536321-18">Non-trainable params: 0</div><div class="crayon-line" id="crayon-5c0ca097de3cc398536321-19">_________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, we fit the network on the training data.</p>
<p>We use a binary cross entropy loss function because the problem we are learning is a binary classification problem. The efficient Adam implementation of stochastic gradient descent is used and we keep track of accuracy in addition to loss during training. The model is trained for 10 epochs, or 10 passes through the training data.</p>
<p>The network configuration and training schedule were found with a little trial and error, but are by no means optimal for this problem. If you can get better results with a different configuration, let me know.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3ce661066593" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3ce661066593-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ce661066593-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3ce661066593-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ce661066593-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3ce661066593-1"><span class="crayon-p"># compile network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ce661066593-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3ce661066593-3"><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ce661066593-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>After the model is fit, it is evaluated on the test dataset. This dataset contains words that we have not seen before and reviews not seen during training.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3d0957103955" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3d0957103955-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d0957103955-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3d0957103955-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3d0957103955-1"><span class="crayon-p"># evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d0957103955-2"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d0957103955-3"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can tie all of this together.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3d2924707368" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from numpy import array
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs

# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)

# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])

# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])

# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1

# define model
model = Sequential()
model.add(Embedding(vocab_size, 100, input_length=max_length))
model.add(Conv1D(filters=32, kernel_size=8, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(10, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
print(model.summary())
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-20">20</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-22">22</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-24">24</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-26">26</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-28">28</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-30">30</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-32">32</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-34">34</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-36">36</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-38">38</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-40">40</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-42">42</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-44">44</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-46">46</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-48">48</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-50">50</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-52">52</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-54">54</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-56">56</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-58">58</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-60">60</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-62">62</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-64">64</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-66">66</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-68">68</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-70">70</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-72">72</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-74">74</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-76">76</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-78">78</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-80">80</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-82">82</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-84">84</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-86">86</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-88">88</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-90">90</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-92">92</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-94">94</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-96">96</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-98">98</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-100">100</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-102">102</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-104">104</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-106">106</div><div class="crayon-num" data-line="crayon-5c0ca097de3d2924707368-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d2924707368-108">108</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-12"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-13"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-14"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-15"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-16"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-17"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-18"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-19"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-20"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-22"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-23"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-24"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-25"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-26"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-27"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-28"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-29"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-30"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-31"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-32"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-34"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-35"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-36"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-37"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-38"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-40"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-41"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-42"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-44"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-45"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-46"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-47"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-48"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-49"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-50"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-51"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-52"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-53"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-54"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-55"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-56"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-57"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-58"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-59"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-60"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-61"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-62"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-63"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-64"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-65"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-66"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-67"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-68"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-69"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-70"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-71"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-72"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-73"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-74"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-75"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-76"><span class="crayon-p"># define training labels</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-77"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-78"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-79"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-80"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-81"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-82"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-83"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-84"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-85"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-86"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-87"><span class="crayon-p"># define test labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-88"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-89"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-90"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-91"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-92"> </div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-93"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-94"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-95"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-96"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-97"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-98"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-99"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-100"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-101"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-102"><span class="crayon-p"># compile network</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-103"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-104"><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-105"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-106"><span class="crayon-p"># evaluate</span></div><div class="crayon-line" id="crayon-5c0ca097de3d2924707368-107"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d2924707368-108"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0051 seconds] -->
<p>Running the example prints the loss and accuracy at the end of each training epoch. We can see that the model very quickly achieves 100% accuracy on the training dataset.</p>
<p>At the end of the run, the model achieves an accuracy of 84.5% on the test dataset, which is a great score.</p>
<p>Given the stochastic nature of neural networks, your specific results will vary. Consider running the example a few times and taking the average score as the skill of the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3d4919997484" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
2s - loss: 0.0013 - acc: 1.0000
Epoch 7/10
2s - loss: 8.4573e-04 - acc: 1.0000
Epoch 8/10
2s - loss: 5.8323e-04 - acc: 1.0000
Epoch 9/10
2s - loss: 4.3155e-04 - acc: 1.0000
Epoch 10/10
2s - loss: 3.3083e-04 - acc: 1.0000
Test Accuracy: 84.500000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3d4919997484-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d4919997484-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3d4919997484-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d4919997484-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3d4919997484-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d4919997484-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3d4919997484-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d4919997484-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3d4919997484-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d4919997484-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3d4919997484-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d4919997484-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3d4919997484-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d4919997484-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5c0ca097de3d4919997484-3">2s - loss: 0.0013 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d4919997484-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5c0ca097de3d4919997484-5">2s - loss: 8.4573e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d4919997484-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5c0ca097de3d4919997484-7">2s - loss: 5.8323e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d4919997484-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5c0ca097de3d4919997484-9">2s - loss: 4.3155e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d4919997484-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5c0ca097de3d4919997484-11">2s - loss: 3.3083e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d4919997484-12">Test Accuracy: 84.500000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We have just seen an example of how we can learn a word embedding as part of fitting a neural network model.</p>
<p>Next, let’s look at how we can efficiently learn a standalone embedding that we could later use in our neural network.</p>
<h2>4. Train word2vec Embedding</h2>
<p>In this section, we will discover how to learn a standalone word embedding using an efficient algorithm called word2vec.</p>
<p>A downside of learning a word embedding as part of the network is that it can be very slow, especially for very large text datasets.</p>
<p>The word2vec algorithm is an approach to learning a word embedding from a text corpus in a standalone way. The benefit of the method is that it can produce high-quality word embeddings very efficiently, in terms of space and time complexity.</p>
<p>The first step is to prepare the documents ready for learning the embedding.</p>
<p>This involves the same data cleaning steps from the previous section, namely splitting documents by their white space, removing punctuation, and filtering out tokens not in the vocabulary.</p>
<p>The word2vec algorithm processes documents sentence by sentence. This means we will preserve the sentence-based structure during cleaning.</p>
<p>We start by loading the vocabulary, as before.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3d6858043956" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d6858043956-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d6858043956-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d6858043956-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d6858043956-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d6858043956-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d6858043956-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d6858043956-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3d6858043956-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-1"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d6858043956-2"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-3"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d6858043956-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-5"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d6858043956-6"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-7"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d6858043956-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d6858043956-10"> </div><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-11"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d6858043956-12"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-13"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d6858043956-14"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d6858043956-15"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Next, we define a function named <em>doc_to_clean_lines()</em> to clean a loaded document line by line and return a list of the cleaned lines.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3d8532476101" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# turn a doc into clean tokens
def doc_to_clean_lines(doc, vocab):
	clean_lines = list()
	lines = doc.splitlines()
	for line in lines:
		# split into tokens by white space
		tokens = line.split()
		# remove punctuation from each token
		table = str.maketrans('', '', punctuation)
		tokens = [w.translate(table) for w in tokens]
		# filter out tokens not in vocab
		tokens = [w for w in tokens if w in vocab]
		clean_lines.append(tokens)
	return clean_lines</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3d8532476101-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d8532476101-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3d8532476101-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d8532476101-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3d8532476101-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d8532476101-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3d8532476101-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d8532476101-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3d8532476101-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d8532476101-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3d8532476101-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d8532476101-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3d8532476101-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3d8532476101-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3d8532476101-1"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d8532476101-2"><span class="crayon-e">def </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3d8532476101-3"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d8532476101-4"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">splitlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3d8532476101-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d8532476101-6"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5c0ca097de3d8532476101-7"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d8532476101-8"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca097de3d8532476101-9"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d8532476101-10"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3d8532476101-11"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d8532476101-12"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3d8532476101-13"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3d8532476101-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Next, we adapt the process_docs() function to load and clean all of the documents in a folder and return a list of all document lines.</p>
<p>The results from this function will be the training data for the word2vec model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3da503521359" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	lines = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load and clean the doc
		doc = load_doc(path)
		doc_lines = doc_to_clean_lines(doc, vocab)
		# add lines to list
		lines += doc_lines
	return lines</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3da503521359-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3da503521359-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3da503521359-1"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-2"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-3"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-4"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-6"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-8"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-10"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-11"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-12"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-13"><span class="crayon-h"> </span><span class="crayon-p"># load and clean the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-14"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-15"><span class="crayon-h"> </span><span class="crayon-v">doc_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-16"><span class="crayon-h"> </span><span class="crayon-p"># add lines to list</span></div><div class="crayon-line" id="crayon-5c0ca097de3da503521359-17"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">doc_lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3da503521359-18"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lines</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We can then load all of the training data and convert it into a long list of ‘sentences’ (lists of tokens) ready for fitting the word2vec model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3dc678034342" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load training data
positive_lines = process_docs('txt_sentoken/pos', vocab, True)
negative_lines = process_docs('txt_sentoken/neg', vocab, True)
sentences = negative_docs + positive_docs
print('Total training sentences: %d' % len(sentences))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3dc678034342-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3dc678034342-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3dc678034342-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3dc678034342-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3dc678034342-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3dc678034342-1"><span class="crayon-p"># load training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3dc678034342-2"><span class="crayon-v">positive_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3dc678034342-3"><span class="crayon-v">negative_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3dc678034342-4"><span class="crayon-v">sentences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line" id="crayon-5c0ca097de3dc678034342-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total training sentences: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We will use the word2vec implementation provided in the Gensim Python library. Specifically the <a href="https://radimrehurek.com/gensim/models/word2vec.html">Word2Vec class</a>.</p>
<p>The model is fit when constructing the class. We pass in the list of clean sentences from the training data, then specify the size of the embedding vector space (we use 100 again), the number of neighboring words to look at when learning how to embed each word in the training sentences (we use 5 neighbors), the number of threads to use when fitting the model (we use 8, but change this if you have more or less CPU cores), and the minimum occurrence count for words to consider in the vocabulary (we set this to 1 as we have already prepared the vocabulary).</p>
<p>After the model is fit, we print the size of the learned vocabulary, which should match the size of our vocabulary in vocab.txt of 25,767 tokens.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3dd491786058" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train word2vec model
model = Word2Vec(sentences, size=100, window=5, workers=8, min_count=1)
# summarize vocabulary size in model
words = list(model.wv.vocab)
print('Vocabulary size: %d' % len(words))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3dd491786058-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3dd491786058-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3dd491786058-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3dd491786058-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3dd491786058-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3dd491786058-1"><span class="crayon-p"># train word2vec model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3dd491786058-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Word2Vec</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">workers</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">min_count</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3dd491786058-3"><span class="crayon-p"># summarize vocabulary size in model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3dd491786058-4"><span class="crayon-v">words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">wv</span><span class="crayon-sy">.</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3dd491786058-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">words</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Finally, we save the learned embedding vectors to file using the <a href="https://radimrehurek.com/gensim/models/keyedvectors.html">save_word2vec_format()</a> on the model’s ‘<em>wv</em>‘ (word vector) attribute. The embedding is saved in ASCII format with one word and vector per line.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3df784652895" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from gensim.models import Word2Vec

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def doc_to_clean_lines(doc, vocab):
	clean_lines = list()
	lines = doc.splitlines()
	for line in lines:
		# split into tokens by white space
		tokens = line.split()
		# remove punctuation from each token
		table = str.maketrans('', '', punctuation)
		tokens = [w.translate(table) for w in tokens]
		# filter out tokens not in vocab
		tokens = [w for w in tokens if w in vocab]
		clean_lines.append(tokens)
	return clean_lines

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	lines = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load and clean the doc
		doc = load_doc(path)
		doc_lines = doc_to_clean_lines(doc, vocab)
		# add lines to list
		lines += doc_lines
	return lines

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load training data
positive_lines = process_docs('txt_sentoken/pos', vocab, True)
negative_lines = process_docs('txt_sentoken/neg', vocab, True)
sentences = negative_docs + positive_docs
print('Total training sentences: %d' % len(sentences))

# train word2vec model
model = Word2Vec(sentences, size=100, window=5, workers=8, min_count=1)
# summarize vocabulary size in model
words = list(model.wv.vocab)
print('Vocabulary size: %d' % len(words))

# save model in ASCII (word2vec) format
filename = 'embedding_word2vec.txt'
model.wv.save_word2vec_format(filename, binary=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-20">20</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-22">22</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-24">24</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-26">26</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-28">28</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-30">30</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-32">32</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-34">34</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-36">36</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-38">38</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-40">40</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-42">42</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-44">44</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-46">46</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-48">48</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-50">50</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-52">52</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-54">54</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-56">56</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-58">58</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-60">60</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-62">62</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-64">64</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-66">66</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3df784652895-68">68</div><div class="crayon-num" data-line="crayon-5c0ca097de3df784652895-69">69</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3df784652895-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-3"><span class="crayon-e">from </span><span class="crayon-v">gensim</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-v">Word2Vec</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-4"> </div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-5"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-6"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-7"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-9"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-10"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-11"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-12"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-14"> </div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-15"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-16"><span class="crayon-e">def </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-17"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-18"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">splitlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-19"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-20"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-21"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-22"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-23"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-24"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-25"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-26"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-27"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-30"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-31"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-32"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-33"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-34"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-35"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-36"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-37"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-38"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-39"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-40"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-41"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-42"><span class="crayon-h"> </span><span class="crayon-p"># load and clean the doc</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-43"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-44"><span class="crayon-h"> </span><span class="crayon-v">doc_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-45"><span class="crayon-h"> </span><span class="crayon-p"># add lines to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-46"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">doc_lines</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-47"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-48"> </div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-49"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-50"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-51"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-52"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-53"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-54"> </div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-55"><span class="crayon-p"># load training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-56"><span class="crayon-v">positive_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-57"><span class="crayon-v">negative_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-58"><span class="crayon-v">sentences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-59"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total training sentences: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-60"> </div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-61"><span class="crayon-p"># train word2vec model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-62"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Word2Vec</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">workers</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">min_count</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-63"><span class="crayon-p"># summarize vocabulary size in model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-64"><span class="crayon-v">words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">wv</span><span class="crayon-sy">.</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-65"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">words</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-66"> </div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-67"><span class="crayon-p"># save model in ASCII (word2vec) format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3df784652895-68"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'embedding_word2vec.txt'</span></div><div class="crayon-line" id="crayon-5c0ca097de3df784652895-69"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">wv</span><span class="crayon-sy">.</span><span class="crayon-e">save_word2vec_format</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">binary</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0029 seconds] -->
<p>Running the example loads 58,109 sentences from the training data and creates an embedding for a vocabulary of 25,767 words.</p>
<p>You should now have a file ’embedding_word2vec.txt’ with the learned vectors in your current working directory.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3e1704249285" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total training sentences: 58109
Vocabulary size: 25767</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3e1704249285-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e1704249285-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3e1704249285-1">Total training sentences: 58109</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e1704249285-2">Vocabulary size: 25767</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Next, let’s look at using these learned vectors in our model.</p>
<h2>5. Use Pre-trained Embedding</h2>
<p>In this section, we will use a pre-trained word embedding prepared on a very large text corpus.</p>
<p>We can use the pre-trained word embedding developed in the previous section and the CNN model developed in the section before that.</p>
<p>The first step is to load the word embedding as a directory of words to vectors. The word embedding was saved in so-called ‘<em>word2vec</em>‘ format that contains a header line. We will skip this header line when loading the embedding.</p>
<p>The function below named <em>load_embedding()</em> loads the embedding and returns a directory of words mapped to the vectors in NumPy format.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3e3716441681" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()[1:]
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3e3716441681-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e3716441681-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3e3716441681-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e3716441681-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3e3716441681-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e3716441681-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3e3716441681-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e3716441681-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3e3716441681-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e3716441681-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3e3716441681-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e3716441681-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3e3716441681-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3e3716441681-1"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e3716441681-2"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3e3716441681-3"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e3716441681-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e3716441681-5"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e3716441681-6"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e3716441681-7"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e3716441681-8"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e3716441681-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e3716441681-10"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e3716441681-11"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e3716441681-12"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e3716441681-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Now that we have all of the vectors in memory, we can order them in such a way as to match the integer encoding prepared by the Keras Tokenizer.</p>
<p>Recall that we integer encode the review documents prior to passing them to the Embedding layer. The integer maps to the index of a specific vector in the embedding layer. Therefore, it is important that we lay the vectors out in the Embedding layer such that the encoded words map to the correct vector.</p>
<p>Below defines a function <em>get_weight_matrix()</em> that takes the loaded embedding and the tokenizer.word_index vocabulary as arguments and returns a matrix with the word vectors in the correct locations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3e5034877428" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		weight_matrix[i] = embedding.get(word)
	return weight_matrix</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3e5034877428-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e5034877428-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3e5034877428-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e5034877428-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3e5034877428-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e5034877428-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3e5034877428-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e5034877428-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3e5034877428-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e5034877428-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3e5034877428-1"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e5034877428-2"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3e5034877428-3"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e5034877428-4"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca097de3e5034877428-5"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e5034877428-6"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e5034877428-7"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e5034877428-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3e5034877428-9"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e5034877428-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Now we can use these functions to create our new Embedding layer for our model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3e7035999009" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
# load embedding from file
raw_embedding = load_embedding('embedding_word2vec.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3e7035999009-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e7035999009-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3e7035999009-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e7035999009-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3e7035999009-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e7035999009-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3e7035999009-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3e7035999009-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e7035999009-2"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line" id="crayon-5c0ca097de3e7035999009-3"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'embedding_word2vec.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e7035999009-4"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line" id="crayon-5c0ca097de3e7035999009-5"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e7035999009-6"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line" id="crayon-5c0ca097de3e7035999009-7"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Note that the prepared weight matrix <em>embedding_vectors</em> is passed to the new Embedding layer as an argument and that we set the ‘<em>trainable</em>‘ argument to ‘<em>False</em>‘ to ensure that the network does not try to adapt the pre-learned vectors as part of training the network.</p>
<p>We can now add this layer to our model. We also have a slightly different model configuration with a lot more filters (128) in the CNN model and a kernel that matches the 5 words used as neighbors when developing the word2vec embedding. Finally, the back-end of the model was simplified.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3e9934102004" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(embedding_layer)
model.add(Conv1D(filters=128, kernel_size=5, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1, activation='sigmoid'))
print(model.summary())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3e9934102004-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e9934102004-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3e9934102004-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e9934102004-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3e9934102004-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e9934102004-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3e9934102004-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3e9934102004-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3e9934102004-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e9934102004-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e9934102004-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">embedding_layer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e9934102004-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e9934102004-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e9934102004-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3e9934102004-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3e9934102004-8"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>These changes were found with a little trial and error.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3eb137881570" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from numpy import array
from numpy import asarray
from numpy import zeros
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()[1:]
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding

# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		weight_matrix[i] = embedding.get(word)
	return weight_matrix

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs

# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)

# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])

# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])

# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1

# load embedding from file
raw_embedding = load_embedding('embedding_word2vec.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)

# define model
model = Sequential()
model.add(embedding_layer)
model.add(Conv1D(filters=128, kernel_size=5, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1, activation='sigmoid'))
print(model.summary())
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-20">20</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-22">22</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-24">24</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-26">26</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-28">28</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-30">30</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-32">32</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-34">34</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-36">36</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-38">38</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-40">40</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-42">42</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-44">44</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-46">46</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-48">48</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-50">50</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-52">52</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-54">54</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-56">56</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-58">58</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-60">60</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-62">62</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-64">64</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-66">66</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-68">68</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-70">70</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-72">72</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-74">74</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-76">76</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-78">78</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-80">80</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-82">82</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-84">84</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-86">86</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-88">88</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-90">90</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-92">92</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-94">94</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-96">96</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-98">98</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-100">100</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-102">102</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-104">104</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-106">106</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-108">108</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-110">110</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-112">112</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-114">114</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-116">116</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-118">118</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-120">120</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-122">122</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-124">124</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-126">126</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-128">128</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-130">130</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-132">132</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-134">134</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-136">136</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-138">138</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3eb137881570-140">140</div><div class="crayon-num" data-line="crayon-5c0ca097de3eb137881570-141">141</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">asarray</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">zeros</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-14"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-15"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-16"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-17"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-18"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-19"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-20"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-21"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-22"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-24"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-25"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-26"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-27"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-28"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-29"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-30"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-31"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-32"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-33"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-34"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-36"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-37"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-38"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-39"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-40"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-41"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-42"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-44"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-45"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-46"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-47"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-48"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-49"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-50"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-51"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-52"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-53"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-54"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-55"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-56"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-57"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-58"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-59"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-60"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-61"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-62"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-63"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-64"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-65"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-66"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-67"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-68"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-69"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-70"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-71"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-72"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-73"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-74"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-75"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-76"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-77"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-78"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-79"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-80"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-82"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-83"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-84"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-85"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-86"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-88"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-89"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-90"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-91"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-92"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-93"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-94"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-95"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-96"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-97"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-98"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-99"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-100"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-101"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-102"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-103"><span class="crayon-p"># define training labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-104"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-105"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-106"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-107"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-108"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-109"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-110"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-111"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-112"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-113"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-114"><span class="crayon-p"># define test labels</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-115"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-116"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-117"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-118"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-119"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-120"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-121"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'embedding_word2vec.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-122"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-123"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-124"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-125"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-126"> </div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-127"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-128"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-129"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">embedding_layer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-130"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-131"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-132"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-133"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-134"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-135"><span class="crayon-p"># compile network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-136"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-137"><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-138"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-139"><span class="crayon-p"># evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3eb137881570-140"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3eb137881570-141"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0064 seconds] -->
<p>Running the example shows that performance was not improved.</p>
<p>In fact, performance was a lot worse. The results show that the training dataset was learned successfully, but evaluation on the test dataset was very poor, at just above 50% accuracy.</p>
<p>The cause of the poor test performance may be because of the chosen word2vec configuration or the chosen neural network configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3ed143972117" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
2s - loss: 0.3306 - acc: 0.8778
Epoch 7/10
2s - loss: 0.2888 - acc: 0.8917
Epoch 8/10
2s - loss: 0.1878 - acc: 0.9439
Epoch 9/10
2s - loss: 0.1255 - acc: 0.9750
Epoch 10/10
2s - loss: 0.0812 - acc: 0.9928
Test Accuracy: 53.000000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3ed143972117-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ed143972117-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3ed143972117-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ed143972117-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3ed143972117-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ed143972117-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3ed143972117-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ed143972117-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3ed143972117-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ed143972117-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3ed143972117-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3ed143972117-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3ed143972117-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ed143972117-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5c0ca097de3ed143972117-3">2s - loss: 0.3306 - acc: 0.8778</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ed143972117-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5c0ca097de3ed143972117-5">2s - loss: 0.2888 - acc: 0.8917</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ed143972117-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5c0ca097de3ed143972117-7">2s - loss: 0.1878 - acc: 0.9439</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ed143972117-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5c0ca097de3ed143972117-9">2s - loss: 0.1255 - acc: 0.9750</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ed143972117-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5c0ca097de3ed143972117-11">2s - loss: 0.0812 - acc: 0.9928</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3ed143972117-12">Test Accuracy: 53.000000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The weights in the embedding layer can be used as a starting point for the network, and adapted during the training of the network. We can do this by setting ‘<em>trainable=True</em>‘ (the default) in the creation of the embedding layer.</p>
<p>Repeating the experiment with this change shows slightly better results, but still poor.</p>
<p>I would encourage you to explore alternate configurations of the embedding and network to see if you can do better. Let me know how you do.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3f0959013442" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
4s - loss: 0.0950 - acc: 0.9917
Epoch 7/10
4s - loss: 0.0355 - acc: 0.9983
Epoch 8/10
4s - loss: 0.0158 - acc: 1.0000
Epoch 9/10
4s - loss: 0.0080 - acc: 1.0000
Epoch 10/10
4s - loss: 0.0050 - acc: 1.0000
Test Accuracy: 57.500000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3f0959013442-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f0959013442-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3f0959013442-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f0959013442-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3f0959013442-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f0959013442-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3f0959013442-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f0959013442-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3f0959013442-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f0959013442-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3f0959013442-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f0959013442-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3f0959013442-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f0959013442-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5c0ca097de3f0959013442-3">4s - loss: 0.0950 - acc: 0.9917</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f0959013442-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5c0ca097de3f0959013442-5">4s - loss: 0.0355 - acc: 0.9983</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f0959013442-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5c0ca097de3f0959013442-7">4s - loss: 0.0158 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f0959013442-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5c0ca097de3f0959013442-9">4s - loss: 0.0080 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f0959013442-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5c0ca097de3f0959013442-11">4s - loss: 0.0050 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f0959013442-12">Test Accuracy: 57.500000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>It is possible to use pre-trained word vectors prepared on very large corpora of text data.</p>
<p>For example, both Google and Stanford provide pre-trained word vectors that you can download, trained with the efficient word2vec and GloVe methods respectively.</p>
<p>Let’s try to use pre-trained vectors in our model.</p>
<p>You can download <a href="https://nlp.stanford.edu/projects/glove/">pre-trained GloVe vectors</a> from the Stanford webpage. Specifically, vectors trained on Wikipedia data:</p>
<ul>
<li><a href="http://nlp.stanford.edu/data/glove.6B.zip">glove.6B.zip</a> (822 Megabyte download)</li>
</ul>
<p>Unzipping the file, you will find pre-trained embeddings for various different dimensions. We will load the 100 dimension version in the file ‘<em>glove.6B.100d.txt</em>‘</p>
<p>The Glove file does not contain a header file, so we do not need to skip the first line when loading the embedding into memory. The updated <em>load_embedding()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3f1747419932" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3f1747419932-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f1747419932-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3f1747419932-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f1747419932-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3f1747419932-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f1747419932-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3f1747419932-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f1747419932-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3f1747419932-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f1747419932-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3f1747419932-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f1747419932-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3f1747419932-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3f1747419932-1"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f1747419932-2"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f1747419932-3"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f1747419932-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f1747419932-5"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f1747419932-6"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f1747419932-7"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f1747419932-8"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f1747419932-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f1747419932-10"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f1747419932-11"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f1747419932-12"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f1747419932-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>It is possible that the loaded embedding does not contain all of the words in our chosen vocabulary. As such, when creating the Embedding weight matrix, we need to skip words that do not have a corresponding vector in the loaded GloVe data. Below is the updated, more defensive version of the <em>get_weight_matrix()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3f4584348763" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		vector = embedding.get(word)
		if vector is not None:
			weight_matrix[i] = vector
	return weight_matrix</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3f4584348763-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f4584348763-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3f4584348763-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f4584348763-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3f4584348763-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f4584348763-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3f4584348763-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f4584348763-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3f4584348763-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f4584348763-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3f4584348763-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f4584348763-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3f4584348763-1"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f4584348763-2"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f4584348763-3"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f4584348763-4"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca097de3f4584348763-5"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f4584348763-6"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f4584348763-7"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f4584348763-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f4584348763-9"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f4584348763-10"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f4584348763-11"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f4584348763-12"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can now load the GloVe embedding and create the Embedding layer as before.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3f5990679509" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load embedding from file
raw_embedding = load_embedding('glove.6B.100d.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3f5990679509-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f5990679509-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3f5990679509-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f5990679509-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3f5990679509-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f5990679509-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3f5990679509-1"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f5990679509-2"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'glove.6B.100d.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f5990679509-3"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f5990679509-4"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f5990679509-5"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f5990679509-6"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We will use the same model as before.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3f7465520453" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from numpy import array
from numpy import asarray
from numpy import zeros
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding

# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		vector = embedding.get(word)
		if vector is not None:
			weight_matrix[i] = vector
	return weight_matrix

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs

# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)

# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])

# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])

# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1

# load embedding from file
raw_embedding = load_embedding('glove.6B.100d.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)

# define model
model = Sequential()
model.add(embedding_layer)
model.add(Conv1D(filters=128, kernel_size=5, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1, activation='sigmoid'))
print(model.summary())
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-12">12</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-14">14</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-16">16</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-18">18</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-20">20</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-22">22</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-24">24</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-26">26</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-28">28</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-30">30</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-32">32</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-34">34</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-36">36</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-38">38</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-40">40</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-42">42</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-44">44</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-46">46</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-48">48</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-50">50</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-52">52</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-54">54</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-56">56</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-58">58</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-60">60</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-62">62</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-64">64</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-66">66</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-68">68</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-70">70</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-72">72</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-74">74</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-76">76</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-78">78</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-80">80</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-82">82</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-84">84</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-86">86</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-88">88</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-90">90</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-92">92</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-94">94</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-96">96</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-98">98</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-100">100</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-102">102</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-104">104</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-106">106</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-108">108</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-110">110</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-112">112</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-114">114</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-116">116</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-118">118</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-120">120</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-122">122</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-124">124</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-126">126</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-128">128</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-130">130</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-132">132</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-134">134</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-136">136</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-138">138</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-140">140</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f7465520453-142">142</div><div class="crayon-num" data-line="crayon-5c0ca097de3f7465520453-143">143</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">asarray</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">zeros</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-14"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-15"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-16"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-17"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-18"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-19"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-20"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-21"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-22"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-24"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-25"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-26"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-27"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-28"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-29"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-30"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-31"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-32"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-33"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-34"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-36"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-37"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-38"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-39"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-40"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-41"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-42"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-44"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-45"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-46"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-47"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-48"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-49"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-50"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-51"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-52"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-53"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-54"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-55"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-56"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-57"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-58"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-59"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-60"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-61"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-62"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-63"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-64"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-65"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-66"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-67"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-68"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-69"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-70"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-71"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-72"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-73"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-74"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-75"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-76"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-77"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-78"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-79"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-80"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-81"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-82"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-83"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-84"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-85"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-86"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-87"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-88"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-89"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-90"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-91"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-92"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-93"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-94"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-95"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-96"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-97"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-98"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-99"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-100"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-101"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-102"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-103"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-104"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-105"><span class="crayon-p"># define training labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-106"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-107"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-108"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-109"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-110"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-111"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-112"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-113"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-114"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-115"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-116"><span class="crayon-p"># define test labels</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-117"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-118"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-119"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-120"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-121"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-122"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-123"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'glove.6B.100d.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-124"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-125"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-126"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-127"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-128"> </div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-129"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-130"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-131"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">embedding_layer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-132"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-133"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-134"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-135"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-136"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-137"><span class="crayon-p"># compile network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-138"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-139"><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-140"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-141"><span class="crayon-p"># evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f7465520453-142"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca097de3f7465520453-143"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0065 seconds] -->
<p>Running the example shows better performance.</p>
<p>Again, the training dataset is easily learned and the model achieves 76% accuracy on the test dataset. This is good, but not as good as using a learned Embedding layer.</p>
<p>This may be cause of the higher quality vectors trained on more data and/or using a slightly different training process.</p>
<p>Your specific results may vary given the stochastic nature of neural networks. Try running the example a few times.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097de3f9616369756" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
2s - loss: 0.0278 - acc: 1.0000
Epoch 7/10
2s - loss: 0.0174 - acc: 1.0000
Epoch 8/10
2s - loss: 0.0117 - acc: 1.0000
Epoch 9/10
2s - loss: 0.0086 - acc: 1.0000
Epoch 10/10
2s - loss: 0.0068 - acc: 1.0000
Test Accuracy: 76.000000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097de3f9616369756-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f9616369756-2">2</div><div class="crayon-num" data-line="crayon-5c0ca097de3f9616369756-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f9616369756-4">4</div><div class="crayon-num" data-line="crayon-5c0ca097de3f9616369756-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f9616369756-6">6</div><div class="crayon-num" data-line="crayon-5c0ca097de3f9616369756-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f9616369756-8">8</div><div class="crayon-num" data-line="crayon-5c0ca097de3f9616369756-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f9616369756-10">10</div><div class="crayon-num" data-line="crayon-5c0ca097de3f9616369756-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097de3f9616369756-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097de3f9616369756-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f9616369756-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5c0ca097de3f9616369756-3">2s - loss: 0.0278 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f9616369756-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5c0ca097de3f9616369756-5">2s - loss: 0.0174 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f9616369756-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5c0ca097de3f9616369756-7">2s - loss: 0.0117 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f9616369756-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5c0ca097de3f9616369756-9">2s - loss: 0.0086 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f9616369756-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5c0ca097de3f9616369756-11">2s - loss: 0.0068 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097de3f9616369756-12">Test Accuracy: 76.000000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>In this case, it seems that learning the embedding as part of the learning task may be a better direction than using a specifically trained embedding or a more general pre-trained embedding.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking go deeper.</p>
<h3>Dataset</h3>
<ul>
<li><a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/">Movie Review Data</a></li>
<li><a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</li>
<li><a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz">Movie Review Polarity Dataset</a> (.tgz)</li>
<li>Dataset Readme <a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/poldata.README.2.0.txt">v2.0</a> and <a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/README.1.1">v1.1</a>.</li>
</ul>
<h3>APIs</h3>
<ul>
<li><a href="https://docs.python.org/3/library/collections.html">collections API – Container datatypes</a></li>
<li><a href="https://keras.io/preprocessing/text/#tokenizer">Tokenizer Keras API</a></li>
<li><a href="https://keras.io/layers/embeddings/">Embedding Keras API</a></li>
<li><a href="https://radimrehurek.com/gensim/models/word2vec.html">Gensim Word2Vec API</a></li>
<li><a href="https://radimrehurek.com/gensim/models/keyedvectors.html">Gensim WordVector API</a></li>
</ul>
<h3>Embedding Methods</h3>
<ul>
<li><a href="https://code.google.com/archive/p/word2vec/">word2vec on Google Code</a></li>
<li><a href="https://nlp.stanford.edu/projects/glove/">GloVe on Stanford</a></li>
</ul>
<h3>Related Posts</h3>
<ul>
<li><a href="https://blog.keras.io/using-pre-trained-word-embeddings-in-a-keras-model.html">Using pre-trained word embeddings in a Keras model</a>, 2016.</li>
<li><a href="http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/">Implementing a CNN for Text Classification in TensorFlow</a>, 2015.</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop word embeddings for the classification of movie reviews.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to prepare movie review text data for classification with deep learning methods.</li>
<li>How to learn a word embedding as part of fitting a deep learning model.</li>
<li>How to learn a standalone word embedding and how to use a pre-trained embedding in a neural network model.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4401 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+a+Word+Embedding+Model+for+Predicting+Movie+Review+Sentiment&amp;url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="prev"><i class="fa fa-angle-left"></i> How to Use the Keras Functional API for Deep Learning</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/global-attention-for-encoder-decoder-recurrent-neural-networks/" rel="next">Gentle Introduction to Global Attention for Encoder-Decoder Recurrent Neural Networks <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">69 Responses to <em>How to Develop a Word Embedding Model for Predicting Movie Review Sentiment</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-418478">
<div class="comment-container" id="li-comment-418478">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 30, 2017 at 7:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418478" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for interest work.<br/>
Jason, help me please.<br/>
Imagine that we have an dataset which contains reviews with very different lengths (from just two words “good film” to long description “I remember the first work of this director….”.<br/>
Which length should we choose when we talk about “pad_sequence”?</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="#comment-418478" onclick='return addComment.moveForm( "comment-418478", "418478", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418526">
<div class="comment-container" id="li-comment-418526">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2017 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418526" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>All reviews must be padded to the same length.</p>
<p>You can use the longest review, you can use the average length, etc. Try a few and see what works best.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418526" onclick='return addComment.moveForm( "comment-418526", "418526", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418513">
<div class="comment-container" id="li-comment-418513">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ec3c1db58c0d354e88c4a098fc2be505?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ec3c1db58c0d354e88c4a098fc2be505?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JingChunzhen</span>
<span class="date">October 31, 2017 at 2:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418513" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
I think it’s difficult to distinguish ”good” and “bad” using word2vec,  but it’s important in sentiment analysis anyway .<br/>
Is there a good method to solve this ? Thank you and sorry for my poor English .</p>
<div class="reply">
<a aria-label="Reply to JingChunzhen" class="comment-reply-link" href="#comment-418513" onclick='return addComment.moveForm( "comment-418513", "418513", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418532">
<div class="comment-container" id="li-comment-418532">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418532" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, the model will minimize a loss function. We want the loss to be low.</p>
<p>I agree, it feels like clustering to some degree.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418532" onclick='return addComment.moveForm( "comment-418532", "418532", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418608">
<div class="comment-container" id="li-comment-418608">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 31, 2017 at 10:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418608" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for feedback.<br/>
Jason, sorry i don’t understand one thing. Help me please.<br/>
I read you works about technique “Word Embeddings”. And I saw that when you use Embedding layer with Convolutional layer as feature extractor you always use 1D version.<br/>
Since the machine sees the sentence in form of matrix why we don’t base on Conv2D?</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="#comment-418608" onclick='return addComment.moveForm( "comment-418608", "418608", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418631">
<div class="comment-container" id="li-comment-418631">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 5:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418631" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question.</p>
<p>A sequence of words is a one dimensions vector of integers. The embedding maps each integer onto a real vector, so now we have a sequence of vectors. It is still a one-dimensional sequence, it just so happens each item in the sequence has many features.</p>
<p>It is not like an image that has spatial relationships in two dimensions.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418631" onclick='return addComment.moveForm( "comment-418631", "418631", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418687">
<div class="comment-container" id="li-comment-418687">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">November 1, 2017 at 6:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418687" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank for clear explanation, Jason.<br/>
I try to find an opportunity to use knowledges we have in Embedding layer the best way.</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="#comment-418687" onclick='return addComment.moveForm( "comment-418687", "418687", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418731">
<div class="comment-container" id="li-comment-418731">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2017 at 5:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418731" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad it helped Alexander.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418731" onclick='return addComment.moveForm( "comment-418731", "418731", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419049">
<div class="comment-container" id="li-comment-419049">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c35f435a9bd84ccf70bffe9267340b92?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c35f435a9bd84ccf70bffe9267340b92?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ramesh Subrahmanyam</span>
<span class="date">November 5, 2017 at 9:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-419049" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent post.  Thanks.</p>
<div class="reply">
<a aria-label="Reply to Ramesh Subrahmanyam" class="comment-reply-link" href="#comment-419049" onclick='return addComment.moveForm( "comment-419049", "419049", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419103">
<div class="comment-container" id="li-comment-419103">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 6, 2017 at 4:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-419103" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-419103" onclick='return addComment.moveForm( "comment-419103", "419103", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-420104">
<div class="comment-container" id="li-comment-420104">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/36f88e5579f209ca739f0d765f0b2db3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/36f88e5579f209ca739f0d765f0b2db3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amit Adesara</span>
<span class="date">November 15, 2017 at 9:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-420104" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for amazing posts. Eagerly waiting for your new book launch. I had one query on test,train split. Rather than defining a X and Y test/train, can’t we just use split model from sklearn. Doesn’t is automatically split the entire dataset into train and test? Thank you.</p>
<div class="reply">
<a aria-label="Reply to Amit Adesara" class="comment-reply-link" href="#comment-420104" onclick='return addComment.moveForm( "comment-420104", "420104", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420179">
<div class="comment-container" id="li-comment-420179">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2017 at 10:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-420179" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Amit!</p>
<p>Yes, you can use sklearn if you wish.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420179" onclick='return addComment.moveForm( "comment-420179", "420179", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423200">
<div class="comment-container" id="li-comment-423200">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 15, 2017 at 8:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-423200" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason,</p>
<p>Sorry once again I am asking the same question which I mentioned in some other blog that what if I am using my own dataset. How can I make my dataset compatible to the above pre-built dataset ? I have a dataset of tweets so how can i make my dataset of positive and negative tweets and then use them as a test and train set ?</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="#comment-423200" onclick='return addComment.moveForm( "comment-423200", "423200", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423231">
<div class="comment-container" id="li-comment-423231">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 15, 2017 at 3:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-423231" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The post above shows how to prepare data.</p>
<p>Also, this post shows how to clean text:<br/>
<a href="https://machinelearningmastery.com/clean-text-machine-learning-python/" rel="nofollow">https://machinelearningmastery.com/clean-text-machine-learning-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-423231" onclick='return addComment.moveForm( "comment-423231", "423231", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427192">
<div class="comment-container" id="li-comment-427192">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/04d1e6feb86036ca3bc8d606febe70af?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/04d1e6feb86036ca3bc8d606febe70af?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://silversurfer0.github.io" rel="external nofollow">Vladimir</a></span>
<span class="date">January 23, 2018 at 1:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-427192" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason for a valuable article! It is an exploration on it’s own.<br/>
I also get better results if Embedding Layer is learned as part of the model, rather than using predifined embeddings.</p>
<p>First I was very much excited about using GloVe embeddings, yet it gives quite poor results. I think it is because real-world texts contain different word forms (for. example: cat, cats), while GloVe has embeddings only for a single form of each word (for. example: cat). And even a small deviation is considered as a different word, and thus ignored. Probably if this “word-forms” problem is solved, GloVe could show tremendous results…</p>
<div class="reply">
<a aria-label="Reply to Vladimir" class="comment-reply-link" href="#comment-427192" onclick='return addComment.moveForm( "comment-427192", "427192", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427251">
<div class="comment-container" id="li-comment-427251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 23, 2018 at 8:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-427251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may be right in the general case. It is also critical that the vocab/word usage/etc is a good fit for the problem being solved.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427251" onclick='return addComment.moveForm( "comment-427251", "427251", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-430622">
<div class="comment-container" id="li-comment-430622">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/394dcd2124c28f78bbe8896f0428a77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/394dcd2124c28f78bbe8896f0428a77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michelle</span>
<span class="date">February 27, 2018 at 2:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-430622" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, </p>
<p>I am following this example to classify malicious urls. I am able to filter out words, encode and pad my training and testing data. However, when I apply the training data to the model, I get errors.</p>
<p>Do you have the code up on github? I’d like to run through the code to debug.</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Michelle" class="comment-reply-link" href="#comment-430622" onclick='return addComment.moveForm( "comment-430622", "430622", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430628">
<div class="comment-container" id="li-comment-430628">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 27, 2018 at 2:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-430628" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot help you debug your code.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430628" onclick='return addComment.moveForm( "comment-430628", "430628", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-432024">
<div class="comment-container" id="li-comment-432024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/367b86b117b982953f94953db66458d6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/367b86b117b982953f94953db66458d6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">A.S</span>
<span class="date">March 13, 2018 at 7:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-432024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, This is very helpful thanks! Is there a java version of this please?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to A.S" class="comment-reply-link" href="#comment-432024" onclick='return addComment.moveForm( "comment-432024", "432024", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-432095">
<div class="comment-container" id="li-comment-432095">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 14, 2018 at 6:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-432095" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I do not have Java versions at this stage.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-432095" onclick='return addComment.moveForm( "comment-432095", "432095", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-433102">
<div class="comment-container" id="li-comment-433102">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c868e5601a6dfc960cc529f0f0f45fe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c868e5601a6dfc960cc529f0f0f45fe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pANTHER</span>
<span class="date">March 24, 2018 at 9:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-433102" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how this fucntion                                                                                                    </p>
<p> “encoded_docs = tokenizer.texts_to_sequences(test_docs)”</p>
<p>index test vocabs when we didn’t call </p>
<p> “tokenizer.fit_on_texts(train_docs)”</p>
<p>on test_docs.</p>
<div class="reply">
<a aria-label="Reply to pANTHER" class="comment-reply-link" href="#comment-433102" onclick='return addComment.moveForm( "comment-433102", "433102", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-433148">
<div class="comment-container" id="li-comment-433148">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 25, 2018 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-433148" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It uses the vocab learned from the training data to index words in test. If there are new works, they are marked as zero.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433148" onclick='return addComment.moveForm( "comment-433148", "433148", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-433777">
<div class="comment-container" id="li-comment-433777">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c868e5601a6dfc960cc529f0f0f45fe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c868e5601a6dfc960cc529f0f0f45fe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pANTHER</span>
<span class="date">April 1, 2018 at 1:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-433777" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, really appreciate your help.</p>
<div class="reply">
<a aria-label="Reply to pANTHER" class="comment-reply-link" href="#comment-433777" onclick='return addComment.moveForm( "comment-433777", "433777", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-433124">
<div class="comment-container" id="li-comment-433124">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c868e5601a6dfc960cc529f0f0f45fe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c868e5601a6dfc960cc529f0f0f45fe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pANTHER</span>
<span class="date">March 24, 2018 at 11:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-433124" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>can we use CNN with multiclass problem?</p>
<div class="reply">
<a aria-label="Reply to pANTHER" class="comment-reply-link" href="#comment-433124" onclick='return addComment.moveForm( "comment-433124", "433124", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-433152">
<div class="comment-container" id="li-comment-433152">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 25, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-433152" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433152" onclick='return addComment.moveForm( "comment-433152", "433152", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-435662">
<div class="comment-container" id="li-comment-435662">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/52b1e04ebda32c0d51a3e04cf4601986?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/52b1e04ebda32c0d51a3e04cf4601986?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jin</span>
<span class="date">April 23, 2018 at 3:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-435662" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for your sharing, For word embedding layer in keras, what is the window size? For example, in word2vec, we can set the window size to 5, but in keras embedding layer, there is no parameter for that.</p>
<div class="reply">
<a aria-label="Reply to Jin" class="comment-reply-link" href="#comment-435662" onclick='return addComment.moveForm( "comment-435662", "435662", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435679">
<div class="comment-container" id="li-comment-435679">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 23, 2018 at 6:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-435679" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The window size is the number of words around each word to consider, e.g. the context, when building the model.</p>
<p>Keras does not need this, as the embedding is built via back-propagating error during training, ideally using BPTT which builds up error over input time steps.</p>
<p>From my experiments, I find the Keras approach results in better skill than using a prebuilt model. It should be the other way around according to intuition, but not in my experience.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435679" onclick='return addComment.moveForm( "comment-435679", "435679", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-435690">
<div class="comment-container" id="li-comment-435690">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/52b1e04ebda32c0d51a3e04cf4601986?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/52b1e04ebda32c0d51a3e04cf4601986?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jin Zhou</span>
<span class="date">April 23, 2018 at 10:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-435690" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I read your blog about building language model with LSTM, and I tried work with pre-trained embedding weights, actually results in lower perplexity, but a little lower BLEU. So, it is hard for me to say which one is better.</p>
<p>Thanks for your blogs! I learned a lot from them.</p>
<div class="reply">
<a aria-label="Reply to Jin Zhou" class="comment-reply-link" href="#comment-435690" onclick='return addComment.moveForm( "comment-435690", "435690", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-435700">
<div class="comment-container" id="li-comment-435700">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 23, 2018 at 2:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-435700" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435700" onclick='return addComment.moveForm( "comment-435700", "435700", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436929">
<div class="comment-container" id="li-comment-436929">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7776166284a100b753b5c179a3a36443?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7776166284a100b753b5c179a3a36443?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://None" rel="external nofollow">Anam</a></span>
<span class="date">May 8, 2018 at 4:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-436929" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,<br/>
    In above post, you have used a CNN model after data preparation and embedding layer training tasks. Kindly, can you help that how I can perform<br/>
(i) .Data Preparation<br/>
(ii).Train Embedding Layer<br/>
to use in LSTM Recurrent Neural Networks instead of CNN OR How can I use LSTM Recurrent Neural Networks instead of CNN after these two tasks?<br/>
 Thanks for your time!</p>
<div class="reply">
<a aria-label="Reply to Anam" class="comment-reply-link" href="#comment-436929" onclick='return addComment.moveForm( "comment-436929", "436929", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436978">
<div class="comment-container" id="li-comment-436978">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2018 at 6:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-436978" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is an example:<br/>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436978" onclick='return addComment.moveForm( "comment-436978", "436978", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-437015">
<div class="comment-container" id="li-comment-437015">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7776166284a100b753b5c179a3a36443?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7776166284a100b753b5c179a3a36443?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://None" rel="external nofollow">Anam</a></span>
<span class="date">May 9, 2018 at 1:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-437015" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Sir, but I have an issue that, In the provided link training of embedding layer is not performed. Kindly can you guide me how to train embedding layer for LSTM RNN Model?</p>
<div class="reply">
<a aria-label="Reply to Anam" class="comment-reply-link" href="#comment-437015" onclick='return addComment.moveForm( "comment-437015", "437015", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-437022">
<div class="comment-container" id="li-comment-437022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2018 at 2:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-437022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot prepare a specific case for you.</p>
<p>You can use a code example that shows how to use an embedding on the front end and combine it with the tutorial.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437022" onclick='return addComment.moveForm( "comment-437022", "437022", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-437024">
<div class="comment-container" id="li-comment-437024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7776166284a100b753b5c179a3a36443?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7776166284a100b753b5c179a3a36443?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anam</span>
<span class="date">May 9, 2018 at 2:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-437024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Sir for your guidance.</p>
<div class="reply">
<a aria-label="Reply to Anam" class="comment-reply-link" href="#comment-437024" onclick='return addComment.moveForm( "comment-437024", "437024", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-437076">
<div class="comment-container" id="li-comment-437076">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 10, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-437076" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437076" onclick='return addComment.moveForm( "comment-437076", "437076", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-440650">
<div class="comment-container" id="li-comment-440650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d95cc0796f07e552a88f0c616c8a59aa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d95cc0796f07e552a88f0c616c8a59aa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Maryam</span>
<span class="date">June 13, 2018 at 8:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-440650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I am so grateful for the practical tutorial. I am a beginner at keras and deep learning. I applied a data set which is about 2 diseases. I wanna to train RNN via GloVe in order to classification but the output result is as follow :<br/>
precision 0.0<br/>
FPR 0.9999999999807433<br/>
TPR 0.0<br/>
FNR 0.999999999980609<br/>
specificity 0.0<br/>
accuracy 0.0<br/>
F_score 0.0</p>
<p>I think just because GloVe did not pre-train for disease dataset???<br/>
am I right ?? or it needs to train in many eopche?<br/>
thank you for guiding me.<br/>
Best<br/>
Maram</p>
<div class="reply">
<a aria-label="Reply to Maryam" class="comment-reply-link" href="#comment-440650" onclick='return addComment.moveForm( "comment-440650", "440650", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-440688">
<div class="comment-container" id="li-comment-440688">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 13, 2018 at 3:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-440688" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There are many possible reasons. Perhaps this framework will help you debug your model:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440688" onclick='return addComment.moveForm( "comment-440688", "440688", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-441507">
<div class="comment-container" id="li-comment-441507">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/37dc265632c5d360be81988b137f8c18?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/37dc265632c5d360be81988b137f8c18?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sarah</span>
<span class="date">June 21, 2018 at 9:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-441507" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
that was awesome like the others tutorials. I do not have a separate data set for  train dataset and test data set as I want to select test dataset randomly each time. so I have already done it by this statment:<br/>
‘from sklearn.model_selection import train_test_split<br/>
X_train, X_test, y_train, y_test = train_test_split(x_datasetpad,y_datasetpad,stratify=y_datasetpad,test_size=0.25)’<br/>
according to your tutorial, you set ytest in this way :<br/>
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])</p>
<p>I have already created x_dataset but I do not know how i can create ydataset??<br/>
please guide me Jason, I realy need it.</p>
<p>Sarah</p>
<div class="reply">
<a aria-label="Reply to Sarah" class="comment-reply-link" href="#comment-441507" onclick='return addComment.moveForm( "comment-441507", "441507", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-441537">
<div class="comment-container" id="li-comment-441537">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 21, 2018 at 4:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-441537" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The output will be the sentiment, or an integer representing the sentiment classes for each input review.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441537" onclick='return addComment.moveForm( "comment-441537", "441537", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-441573">
<div class="comment-container" id="li-comment-441573">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e45888fad95203963940b9a05719add5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e45888fad95203963940b9a05719add5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hegg</span>
<span class="date">June 21, 2018 at 11:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-441573" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, </p>
<p>I was following your awesome tutorial but in the end I was asking myself: How can I predict a new sentence represented as a string for its sentiment? I think there will be some more people who would like to test their trained network for some example inputs. Could you maybe add such a section to this tutorial or give a short explanation on how to do this exactly? In such a way:</p>
<p>exampleSentence = ‘The weather is very good today’<br/>
prediction = trainedModel.predict(exampleSentence)</p>
<p>print(sentimentForPrediction(prediction))</p>
<p>Kind regards</p>
<p>Hegg</p>
<div class="reply">
<a aria-label="Reply to Hegg" class="comment-reply-link" href="#comment-441573" onclick='return addComment.moveForm( "comment-441573", "441573", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-441607">
<div class="comment-container" id="li-comment-441607">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 22, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-441607" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can use:;</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca097e03f3008354568" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X = ...
yhat = model.predict(X)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca097e03f3008354568-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca097e03f3008354568-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca097e03f3008354568-1"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca097e03f3008354568-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441607" onclick='return addComment.moveForm( "comment-441607", "441607", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-443724">
<div class="comment-container" id="li-comment-443724">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e3089eec95dc2d5e060c1decf544479d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e3089eec95dc2d5e060c1decf544479d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Srijan Verma</span>
<span class="date">July 18, 2018 at 12:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-443724" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I tried implementing one of your codes for predicting the sentiment for a sentence.<br/>
First i trained the model the way you have. I am getting an accuracy of 86% on test data.<br/>
This is the function that i used for predicting on a new sentence.</p>
<p># classify a review as negative (0) or positive (1)<br/>
def predict_sentiment(review, vocab, tokenizer, model):<br/>
	# clean<br/>
	tokens = clean_doc(review)<br/>
	# filter by vocab<br/>
	tokens = [w for w in tokens if w in vocab]<br/>
	# convert to line<br/>
	line = ‘ ‘.join(tokens)<br/>
	#print(line)<br/>
	# encode<br/>
	tokenizer.fit_on_texts(line)<br/>
	encoded = tokenizer.texts_to_sequences(line)<br/>
	#print(encoded)<br/>
	# prediction<br/>
	max_length = max([len(s.split()) for s in line])<br/>
	pred = pad_sequences(encoded, maxlen=1317, padding=’post’)<br/>
	#print(pred)<br/>
	yhat = model.predict(pred, verbose=0)<br/>
	return round(yhat[0,0])</p>
<p># test positive text<br/>
text = ‘this is a good movie’<br/>
print(predict_sentiment(text, vocab, tokenizer, model))<br/>
# test negative text<br/>
text = ‘This is a bad movie.’<br/>
print(predict_sentiment(text, vocab, tokenizer, model))</p>
<p>somehow, I am getting a ‘0’ in both the cases. I tried using other test cases as well, but it is always giving a zero.</p>
<p>I cant find where I am going wrong.</p>
<p>Any insights would be really helpful.</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Srijan Verma" class="comment-reply-link" href="#comment-443724" onclick='return addComment.moveForm( "comment-443724", "443724", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-443756">
<div class="comment-container" id="li-comment-443756">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 18, 2018 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-443756" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have the capacity to debug your code. Perhaps try stackoverflow?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443756" onclick='return addComment.moveForm( "comment-443756", "443756", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-443809">
<div class="comment-container" id="li-comment-443809">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e3089eec95dc2d5e060c1decf544479d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e3089eec95dc2d5e060c1decf544479d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Srijan</span>
<span class="date">July 18, 2018 at 7:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-443809" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Let us say I have a raw text which I want to predict using model.predict().<br/>
First step would be to assign the same index value (on which the model was trained on) to each of the words in the raw text .<br/>
Then we would have to convert it to sequences (using texts_to_sequences())<br/>
Then will be the padding (max_length would be the same of that of the training set)<br/>
And then this will be given to the model.predict()</p>
<p>Is that correct ? ^</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-443853">
<div class="comment-container" id="li-comment-443853">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 19, 2018 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-443853" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes. All preparation performed to training data must also be performed to any new data when you want to make a prediction with the trained model.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-442015">
<div class="comment-container" id="li-comment-442015">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d7083832b44ac93669e08b72660d02b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d7083832b44ac93669e08b72660d02b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sara</span>
<span class="date">June 26, 2018 at 12:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-442015" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you so much for your great post. I always enjoy your work and they help me a lot. </p>
<p>My question is that how can I handle other features and text feature at the same time in my classification. I mean if I have other features like the number of words, the number of punctuation, category, etc for each review how can I use them in my classification. </p>
<p>Best</p>
<div class="reply">
<a aria-label="Reply to Sara" class="comment-reply-link" href="#comment-442015" onclick='return addComment.moveForm( "comment-442015", "442015", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-442050">
<div class="comment-container" id="li-comment-442050">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 26, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-442050" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question, perhaps a two-headed model would be appropriate. One head for text data and one with a vector summarizing the document.</p>
<p>This tutorial will help:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442050" onclick='return addComment.moveForm( "comment-442050", "442050", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-444816">
<div class="comment-container" id="li-comment-444816">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/92fcfd455d7d8cd85e39db40ff6c4987?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/92fcfd455d7d8cd85e39db40ff6c4987?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anjali Batra</span>
<span class="date">July 31, 2018 at 2:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-444816" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, awesome article.  Can you please tell which python version can I use to run the code?<br/>
As nltk wont work on pythong 2.7 and Keras is not available for python 3.6.</p>
<p>Looking forward to your response.</p>
<p>Thanks,<br/>
Anjali Batra</p>
<div class="reply">
<a aria-label="Reply to Anjali Batra" class="comment-reply-link" href="#comment-444816" onclick='return addComment.moveForm( "comment-444816", "444816", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444840">
<div class="comment-container" id="li-comment-444840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 31, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-444840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Python 3.5 or 3.6. I believe Python 2.7 would work too, perhaps with minor tweaks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444840" onclick='return addComment.moveForm( "comment-444840", "444840", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-444902">
<div class="comment-container" id="li-comment-444902">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7efa7695483e220fa0a7730b0360605b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7efa7695483e220fa0a7730b0360605b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shreyas Jeet</span>
<span class="date">July 31, 2018 at 7:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-444902" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Great tutorial, helped a lot.<br/>
I am working on a multi-class classification , could you help me on how I would have to tweak the network to facilitate a 8 class classifier.</p>
<p>Thank You</p>
<div class="reply">
<a aria-label="Reply to Shreyas Jeet" class="comment-reply-link" href="#comment-444902" onclick='return addComment.moveForm( "comment-444902", "444902", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444953">
<div class="comment-container" id="li-comment-444953">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 1, 2018 at 7:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-444953" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Change the number of nodes in the output layer to 8, the transfer function to softmax and the loss function to categorical cross entropy.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444953" onclick='return addComment.moveForm( "comment-444953", "444953", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-447011">
<div class="comment-container" id="li-comment-447011">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2f616360f6dccd2c34ed68fa3708edcd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2f616360f6dccd2c34ed68fa3708edcd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alberto</span>
<span class="date">August 27, 2018 at 1:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-447011" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I’ve a question. To develop the vocab I’ve to use both training and testing reviews?<br/>
Thanks a lot.</p>
<div class="reply">
<a aria-label="Reply to Alberto" class="comment-reply-link" href="#comment-447011" onclick='return addComment.moveForm( "comment-447011", "447011", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-447025">
<div class="comment-container" id="li-comment-447025">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 27, 2018 at 6:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-447025" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ideally, you would just use training data to develop your vocab when evaluating the model.</p>
<p>You would use all data when preparing the final model.</p>
<p>It really comes down to your project goals.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447025" onclick='return addComment.moveForm( "comment-447025", "447025", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-449393">
<div class="comment-container" id="li-comment-449393">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a0cd1af064c2a3ad46e1149f272407db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a0cd1af064c2a3ad46e1149f272407db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arghyadeep Giri</span>
<span class="date">September 20, 2018 at 1:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-449393" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,</p>
<p>Absolutely loved the tutorial. Nevertheless, I had a question regarding the convolution. You already answered a question regarding that, but I still have a doubt. You mentioned that the output of the embedding layer is a one-dimensional sequence.<br/>
But the output shape of the embedding layer is (None, 1317, 100). I know the “None” refers to the batch size of the number of training examples. But, how is convolution possible with a (1317,100) shape with a one-dimensional filter size of 8. I want to get into the depth of it. How are these values getting multiplied? Since the output shape of the convoluted layer is (1310,32), the only way I can make sense is that for every filter there are 100 values which are getting multiplied with every sequence for a certain word. Kindly correct me if I am wrong.</p>
<p>Regards,<br/>
Arghyadeep</p>
<div class="reply">
<a aria-label="Reply to Arghyadeep Giri" class="comment-reply-link" href="#comment-449393" onclick='return addComment.moveForm( "comment-449393", "449393", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-449399">
<div class="comment-container" id="li-comment-449399">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 20, 2018 at 2:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-449399" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, the input is a sequence of integers. The output is a sequence of vectors.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449399" onclick='return addComment.moveForm( "comment-449399", "449399", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-449400">
<div class="comment-container" id="li-comment-449400">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a0cd1af064c2a3ad46e1149f272407db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a0cd1af064c2a3ad46e1149f272407db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arghyadeep Giri</span>
<span class="date">September 20, 2018 at 3:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-449400" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, absolutely! But I believe that is for the embedding layer.</p>
<p>But my question is about the convolution layer. How is the input shape (None, 1317, 100) getting converted to (None, 1310, 32)? </p>
<p>The 32 comes from the number of filters.<br/>
1317 gets converted to 1310 for (1317-8+1) which is the kernel size.<br/>
What about the number 100?</p>
<div class="reply">
<a aria-label="Reply to Arghyadeep Giri" class="comment-reply-link" href="#comment-449400" onclick='return addComment.moveForm( "comment-449400", "449400", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-449446">
<div class="comment-container" id="li-comment-449446">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 21, 2018 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-449446" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The 100 is the length of each word vector.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449446" onclick='return addComment.moveForm( "comment-449446", "449446", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-449466">
<div class="comment-container" id="li-comment-449466">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a0cd1af064c2a3ad46e1149f272407db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a0cd1af064c2a3ad46e1149f272407db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arghyadeep Giri</span>
<span class="date">September 21, 2018 at 10:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-449466" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks 🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-455007">
<div class="comment-container" id="li-comment-455007">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be41effb0730f26ea6698e19e4207fc5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be41effb0730f26ea6698e19e4207fc5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ikib Kilam</span>
<span class="date">November 16, 2018 at 6:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-455007" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, </p>
<p>In the ‘Training Embedding Layer’ code, why did you add a 1 to the size of vocabulary, before passing the size of the vocabulary to the Embedding? You say, ‘….plus one for unknown words…’ – but by definition there are no unknown words in the training data. When I run your code without adding the one, it croaks at the point when it is fitting the training data. It runs fine when I add the 1 to the vocabulary.  I am not certain why, and hoping you can elaborate.</p>
<div class="reply">
<a aria-label="Reply to Ikib Kilam" class="comment-reply-link" href="#comment-455007" onclick='return addComment.moveForm( "comment-455007", "455007", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455071">
<div class="comment-container" id="li-comment-455071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 17, 2018 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-455071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There can be unknown words when using the model, e.g. test data or new data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455071" onclick='return addComment.moveForm( "comment-455071", "455071", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-455101">
<div class="comment-container" id="li-comment-455101">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be41effb0730f26ea6698e19e4207fc5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be41effb0730f26ea6698e19e4207fc5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ikib</span>
<span class="date">November 17, 2018 at 9:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-455101" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason. If I understood your response correctly…Unknown words in the test data or any new data, are not ascribed an integer encoding, because we are using the same tokenizer that was built for the training data, when working with these new data sets as well. So unknown words will not show up when we run these new datasets. I am still unsure why we need to add a 1, since again by definition the training data has no unknown words. I am missing something, esp. since when 1 is not added the code croaks at the fitting of training data stage, and well before we work with test/other datasets. One difference from your code is that I am using a MLP instead of CNN to train. I shall attempt to dig into this more, however if you have additional insight, please do reply.</p>
<div class="reply">
<a aria-label="Reply to ikib" class="comment-reply-link" href="#comment-455101" onclick='return addComment.moveForm( "comment-455101", "455101", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-455224">
<div class="comment-container" id="li-comment-455224">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 18, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-455224" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes. We add one because known words start at 1 not 0, e.g. 1-offset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455224" onclick='return addComment.moveForm( "comment-455224", "455224", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-455284">
<div class="comment-container" id="li-comment-455284">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be41effb0730f26ea6698e19e4207fc5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be41effb0730f26ea6698e19e4207fc5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ikib Kilam</span>
<span class="date">November 18, 2018 at 2:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-455284" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you. Of course. I should have seen the offset.</p>
<div class="reply">
<a aria-label="Reply to Ikib Kilam" class="comment-reply-link" href="#comment-455284" onclick='return addComment.moveForm( "comment-455284", "455284", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-455915">
<div class="comment-container" id="li-comment-455915">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bb10f09d412efac99faccd244674394f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bb10f09d412efac99faccd244674394f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Johnny</span>
<span class="date">November 23, 2018 at 2:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-455915" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for your sharing. I have trained a CNN model with pre-trained Glove vectors to do the text classification on resume data. I have the result in the vector forms and I wonder how could we transfer it back to text so that we could interpret it with actual meanings. Or is there better ways to do it?</p>
<p>Thanks,</p>
<div class="reply">
<a aria-label="Reply to Johnny" class="comment-reply-link" href="#comment-455915" onclick='return addComment.moveForm( "comment-455915", "455915", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-455971">
<div class="comment-container" id="li-comment-455971">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2018 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-455971" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure I follow. You can plot words from the embedding, but it won’t tell you much about the resumes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455971" onclick='return addComment.moveForm( "comment-455971", "455971", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-456242">
<div class="comment-container" id="li-comment-456242">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0d9c92ab687d49030dab9d06d4f73e03?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0d9c92ab687d49030dab9d06d4f73e03?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">chakib arsalan</span>
<span class="date">November 27, 2018 at 2:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-456242" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, i have two doubt ,<br/>
– you explain the ( 3. Train Embedding Layer ) and ( 4. Train word2vec Embedding) ,<br/>
we must chose on of those method or one complete the other ?</p>
<p>– Also , if i wan’t to give a new sentence and classify it (positive or negative), how can i do that ?</p>
<div class="reply">
<a aria-label="Reply to chakib arsalan" class="comment-reply-link" href="#comment-456242" onclick='return addComment.moveForm( "comment-456242", "456242", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-456279">
<div class="comment-container" id="li-comment-456279">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2018 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-456279" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use a final model to make a prediction as follows:</p>
<p>yhat = model.predict([asdasdasd])</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456279" onclick='return addComment.moveForm( "comment-456279", "456279", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-456561">
<div class="comment-container" id="li-comment-456561">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0d9c92ab687d49030dab9d06d4f73e03?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0d9c92ab687d49030dab9d06d4f73e03?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">chakib arsalan</span>
<span class="date">November 29, 2018 at 10:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-456561" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When i do a predict for a new sentence for example :</p>
<p>phrase = “very bad feeling”<br/>
tokens = tokenizer.texts_to_sequences([phrase])<br/>
model.predict(np.array(tokens))</p>
<p>its give me :<br/>
array([[0.99999934]], dtype=float32)</p>
<p>how can i now it about (positive or negative) sentiment ?</p>
<div class="reply">
<a aria-label="Reply to chakib arsalan" class="comment-reply-link" href="#comment-456561" onclick='return addComment.moveForm( "comment-456561", "456561", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-456588">
<div class="comment-container" id="li-comment-456588">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2018 at 2:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-456588" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use predict_class() to get the 0/1 value or you can interpret the probability directly.</p>
<p>I think values close to 0 is negative, values close to 1 is positive.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456588" onclick='return addComment.moveForm( "comment-456588", "456588", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-word-embedding-model-predicting-movie-review-sentiment/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4401"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="07734cab11"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="75"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for NLP</strong><br/>
Develop deep learning models for text data.
<p><a href="/deep-learning-for-nlp/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>