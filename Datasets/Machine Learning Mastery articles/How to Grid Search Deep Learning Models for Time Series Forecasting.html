<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Grid Search Deep Learning Models for Time Series Forecasting</title>
<link href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Grid Search Deep Learning Models for Time Series Forecasting" property="og:title"/>
<meta content="Grid searching is generally not an operation that we can perform with deep learning methods. This is because deep learning methods often require large amounts of data and large models, together resulting in models that take hours, days, or weeks to train. In those cases where the datasets are smaller, such as univariate time series, …" property="og:description"/>
<meta content="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Time Series" property="article:section"/>
<meta content="2018-11-15T18:00:41+00:00" property="article:published_time"/>
<meta content="2018-08-30T00:37:53+00:00" property="article:modified_time"/>
<meta content="2018-08-30T00:37:53+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/11/How-to-Grid-Search-Deep-Learning-Models-for-Time-Series-Forecasting.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/11/How-to-Grid-Search-Deep-Learning-Models-for-Time-Series-Forecasting.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="360" property="og:image:height"/>
<meta content="How to Grid Search Deep Learning Models for Time Series Forecasting" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/feed/" rel="alternate" title="Machine Learning Mastery » How to Grid Search Deep Learning Models for Time Series Forecasting Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=6441" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-grid-search-deep-learning-models-for-time-series-forecasting%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-grid-search-deep-learning-models-for-time-series-forecasting%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-6441 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-53"> <div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-6441 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
<header>
<h1 class="title entry-title">How to Grid Search Deep Learning Models for Time Series Forecasting</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-11-16T05:00:41+1100">November 16, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6441 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Grid+Search+Deep+Learning+Models+for+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Grid searching is generally not an operation that we can perform with deep learning methods.</p>
<p>This is because deep learning methods often require large amounts of data and large models, together resulting in models that take hours, days, or weeks to train.</p>
<p>In those cases where the datasets are smaller, such as univariate time series, it may be possible to use a grid search to tune the hyperparameters of a deep learning model.</p>
<p>In this tutorial, you will discover how to develop a framework to grid search hyperparameters for deep learning models.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a generic grid searching framework for tuning model hyperparameters.</li>
<li>How to grid search hyperparameters for a Multilayer Perceptron model on the airline passengers univariate time series forecasting problem.</li>
<li>How to adapt the framework to grid search hyperparameters for convolutional and long short-term memory neural networks.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_6446" style="width: 650px"><img alt="How to Grid Search Deep Learning Models for Time Series Forecasting" class="size-full wp-image-6446" height="360" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/11/How-to-Grid-Search-Deep-Learning-Models-for-Time-Series-Forecasting.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/11/How-to-Grid-Search-Deep-Learning-Models-for-Time-Series-Forecasting.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/11/How-to-Grid-Search-Deep-Learning-Models-for-Time-Series-Forecasting-300x169.jpg 300w" width="640"/><p class="wp-caption-text">How to Grid Search Deep Learning Models for Time Series Forecasting<br/>Photo by <a href="https://www.flickr.com/photos/hannesflo/40192605640/">Hannes Flo</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into five parts; they are:</p>
<ol>
<li>Time Series Problem</li>
<li>Grid Search Framework</li>
<li>Grid Search Multilayer Perceptron</li>
<li>Grid Search Convolutional Neural Network</li>
<li>Grid Search Long Short-Term Memory Network</li>
</ol>
<h2>Time Series Problem</h2>
<p>The ‘<em>monthly airline passenger</em>‘ dataset summarizes the monthly total number of international passengers in thousands on for an airline from 1949 to 1960.</p>
<p>Download the dataset directly from here:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv">monthly-airline-passengers.csv</a></li>
</ul>
<p>Save the file with the filename ‘<em>monthly-airline-passengers.csv</em>‘ in your current working directory.</p>
<p>We can load this dataset as a Pandas series using the function <em>read_csv()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dc9c863934299" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load
series = read_csv('monthly-airline-passengers.csv', header=0, index_col=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dc9c863934299-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dc9c863934299-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dc9c863934299-1"><span class="crayon-p"># load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dc9c863934299-2"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Once loaded, we can summarize the shape of the dataset in order to determine the number of observations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dca4049530928" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# summarize shape
print(series.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dca4049530928-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dca4049530928-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dca4049530928-1"><span class="crayon-p"># summarize shape</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dca4049530928-2"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can then create a line plot of the series to get an idea of the structure of the series.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dca7628617866" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot
pyplot.plot(series)
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dca7628617866-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dca7628617866-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dca7628617866-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dca7628617866-1"><span class="crayon-p"># plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dca7628617866-2"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dca7628617866-3"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can tie all of this together; the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dca9463790107" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load and plot dataset
from pandas import read_csv
from matplotlib import pyplot
# load
series = read_csv('monthly-airline-passengers.csv', header=0, index_col=0)
# summarize shape
print(series.shape)
# plot
pyplot.plot(series)
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dca9463790107-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dca9463790107-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dca9463790107-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dca9463790107-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dca9463790107-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dca9463790107-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dca9463790107-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dca9463790107-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dca9463790107-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dca9463790107-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dca9463790107-1"><span class="crayon-p"># load and plot dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dca9463790107-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dca9463790107-3"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dca9463790107-4"><span class="crayon-p"># load</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dca9463790107-5"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dca9463790107-6"><span class="crayon-p"># summarize shape</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dca9463790107-7"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dca9463790107-8"><span class="crayon-p"># plot</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dca9463790107-9"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dca9463790107-10"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Running the example first prints the shape of the dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcaa700120777" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(144, 1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcaa700120777-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcaa700120777-1">(144, 1)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The dataset is monthly and has 12 years, or 144 observations. In our testing, we will use the last year, or 12 observations, as the test set.</p>
<p>A line plot is created. The dataset has an obvious trend and seasonal component. The period of the seasonal component is 12 months.</p>
<div class="wp-caption aligncenter" id="attachment_6445" style="width: 1290px"><img alt="Line Plot of Monthly International Airline Passengers" class="size-full wp-image-6445" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-International-Airline-Passengers.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-International-Airline-Passengers.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-International-Airline-Passengers-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-International-Airline-Passengers-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Line-Plot-of-Monthly-International-Airline-Passengers-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Line Plot of Monthly International Airline Passengers</p></div>
<p>In this tutorial, we will introduce the tools for grid searching, but we will not optimize the model hyperparameters for this problem. Instead, we will demonstrate how to grid search the deep learning model hyperparameters generally and find models with some skill compared to a naive model.</p>
<p>From prior experiments, a naive model can achieve a root mean squared error, or RMSE, of 50.70 (remember the units are thousands of passengers) by persisting the value from 12 months ago (relative index -12).</p>
<p>The performance of this naive model provides a bound on a model that is considered skillful for this problem. Any model that achieves a predictive performance of lower than 50.70 on the last 12 months has skill.</p>
<p>It should be noted that a tuned ETS model can achieve an RMSE of 17.09 and a tuned SARIMA can achieve an RMSE of 13.89. These provide a lower bound on the expectations of a well-tuned deep learning model for this problem.</p>
<p>Now that we have defined our problem and expectations of model skill, we can look at defining the grid search test harness.</p>
<h2>Grid Search Framework</h2>
<p>In this section, we will develop a grid search test harness that can be used to evaluate a range of hyperparameters for different neural network models, such as MLPs, CNNs, and LSTMs.</p>
<p>This section is divided into the following parts:</p>
<ol>
<li>Train-Test Split</li>
<li>Series as Supervised Learning</li>
<li>Walk-Forward Validation</li>
<li>Repeat Evaluation</li>
<li>Summarize Performance</li>
<li>Worked Example</li>
</ol>
<h3>Train-Test Split</h3>
<p>The first step is to split the loaded series into train and test sets.</p>
<p>We will use the first 11 years (132 observations) for training and the last 12 for the test set.</p>
<p>The <em>train_test_split()</em> function below will split the series taking the raw observations and the number of observations to use in the test set as arguments.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcac165889058" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcac165889058-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcac165889058-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcac165889058-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcac165889058-1"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcac165889058-2"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcac165889058-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<h3>Series as Supervised Learning</h3>
<p>Next, we need to be able to frame the univariate series of observations as a supervised learning problem so that we can train neural network models.</p>
<p>A supervised learning framing of a series means that the data needs to be split into multiple examples that the model learns from and generalizes across.</p>
<p>Each sample must have both an input component and an output component.</p>
<p>The input component will be some number of prior observations, such as three years, or 36 time steps.</p>
<p>The output component will be the total sales in the next month because we are interested in developing a model to make one-step forecasts.</p>
<p>We can implement this using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.shift.html">shift() function</a> on the pandas DataFrame. It allows us to shift a column down (forward in time) or back (backward in time). We can take the series as a column of data, then create multiple copies of the column, shifted forward or backward in time in order to create the samples with the input and output elements we require.</p>
<p>When a series is shifted down, NaN values are introduced because we don’t have values beyond the start of the series.</p>
<p>For example, the series defined as a column:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcaf704743620" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(t)
1
2
3
4</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcaf704743620-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcaf704743620-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcaf704743620-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcaf704743620-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcaf704743620-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcaf704743620-1">(t)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcaf704743620-2">1</div><div class="crayon-line" id="crayon-5c0ca5ad1dcaf704743620-3">2</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcaf704743620-4">3</div><div class="crayon-line" id="crayon-5c0ca5ad1dcaf704743620-5">4</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>This column can be shifted and inserted as a column beforehand:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcb1261850829" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(t-1),		(t)
Nan,		1
1,			2
2,			3
3,			4
4			NaN</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb1261850829-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb1261850829-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb1261850829-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb1261850829-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb1261850829-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb1261850829-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcb1261850829-1">(t-1),		(t)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb1261850829-2">Nan,		1</div><div class="crayon-line" id="crayon-5c0ca5ad1dcb1261850829-3">1,			2</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb1261850829-4">2,			3</div><div class="crayon-line" id="crayon-5c0ca5ad1dcb1261850829-5">3,			4</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb1261850829-6">4			NaN</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see that on the second row, the value 1 is provided as input as an observation at the prior time step, and 2 is the next value in the series that can be predicted, or learned by the model to be predicted when 1 is presented as input.</p>
<p>Rows with NaN values can be removed.</p>
<p>The <em>series_to_supervised()</em> function below implements this behavior, allowing you to specify the number of lag observations to use in the input and the number to use in the output for each sample. It will also remove rows that have NaN values as they cannot be used to train or test a model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcb3973581193" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb3973581193-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb3973581193-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb3973581193-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb3973581193-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb3973581193-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb3973581193-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb3973581193-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb3973581193-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-1"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb3973581193-2"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-3"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb3973581193-4"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-5"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb3973581193-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-7"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb3973581193-8"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb3973581193-10"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-11"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb3973581193-12"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-13"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb3973581193-14"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb3973581193-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p></p>
<h3>Walk-Forward Validation</h3>
<p>Time series forecasting models can be evaluated on a test set using walk-forward validation.</p>
<p>Walk-forward validation is an approach where the model makes a forecast for each observation in the test dataset one at a time. After each forecast is made for a time step in the test dataset, the true observation for the forecast is added to the test dataset and made available to the model.</p>
<p>Simpler models can be refit with the observation prior to making the subsequent prediction. More complex models, such as neural networks, are not refit given the much greater computational cost.</p>
<p>Nevertheless, the true observation for the time step can then be used as part of the input for making the prediction on the next time step.</p>
<p>First, the dataset is split into train and test sets. We will call the <em>train_test_split()</em> function to perform this split and pass in the pre-specified number of observations to use as the test data.</p>
<p>A model will be fit once on the training dataset for a given configuration.</p>
<p>We will define a generic <em>model_fit()</em> function to perform this operation that can be filled in for the given type of neural network that we may be interested in later. The function takes the training dataset and the model configuration and returns the fit model ready for making predictions.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcb5075723773" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	return None</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb5075723773-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb5075723773-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb5075723773-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcb5075723773-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb5075723773-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb5075723773-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Each time step of the test dataset is enumerated. A prediction is made using the fit model.</p>
<p>Again, we will define a generic function named <em>model_predict()</em> that takes the fit model, the history, and the model configuration and makes a single one-step prediction.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcb7746779101" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, config):
	return 0.0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb7746779101-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb7746779101-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb7746779101-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcb7746779101-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb7746779101-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb7746779101-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The prediction is added to a list of predictions and the true observation from the test set is added to a list of observations that was seeded with all observations from the training dataset. This list is built up during each step in the walk-forward validation, allowing the model to make a one-step prediction using the most recent history.</p>
<p>All of the predictions can then be compared to the true values in the test set and an error measure calculated.</p>
<p>We will calculate the root mean squared error, or RMSE, between predictions and the true values.</p>
<p>RMSE is calculated as the square root of the average of the squared differences between the forecasts and the actual values. The <em>measure_rmse()</em> implements this below using the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">mean_squared_error() scikit-learn</a> function to first calculate the mean squared error, or MSE, before calculating the square root.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcb9314735322" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb9314735322-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcb9314735322-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcb9314735322-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcb9314735322-1"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcb9314735322-2"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcb9314735322-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete <em>walk_forward_validation()</em> function that ties all of this together is listed below.</p>
<p>It takes the dataset, the number of observations to use as the test set, and the configuration for the model, and returns the RMSE for the model performance on the test set.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcba652134210" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcba652134210-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcba652134210-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-1"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-2"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-3"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-4"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-5"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-6"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-8"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-9"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-10"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-12"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-14"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-15"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-16"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-17"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-18"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-19"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcba652134210-20"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcba652134210-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p></p>
<h3>Repeat Evaluation</h3>
<p>Neural network models are stochastic.</p>
<p>This means that, given the same model configuration and the same training dataset, a different internal set of weights will result each time the model is trained that will, in turn, have a different performance.</p>
<p>This is a benefit, allowing the model to be adaptive and find high performing configurations to complex problems.</p>
<p>It is also a problem when evaluating the performance of a model and in choosing a final model to use to make predictions.</p>
<p>To address model evaluation, we will evaluate a model configuration multiple times via <a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/">walk-forward validation</a> and report the error as the average error across each evaluation.</p>
<p>This is not always possible for large neural networks and may only make sense for small networks that can be fit in minutes or hours.</p>
<p>The <em>repeat_evaluate()</em> function below implements this and allows the number of repeats to be specified as an optional parameter that defaults to 10 and returns the mean RMSE score from all repeats.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcbc132445556" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# score a model, return None on failure
def repeat_evaluate(data, config, n_test, n_repeats=10):
	# convert config to a key
	key = str(config)
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	# summarize score
	result = mean(scores)
	print('&gt; Model[%s] %.3f' % (key, result))
	return (key, result)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbc132445556-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbc132445556-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbc132445556-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbc132445556-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbc132445556-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbc132445556-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbc132445556-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbc132445556-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbc132445556-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbc132445556-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcbc132445556-1"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbc132445556-2"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcbc132445556-3"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbc132445556-4"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcbc132445556-5"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbc132445556-6"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcbc132445556-7"><span class="crayon-h"> </span><span class="crayon-p"># summarize score</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbc132445556-8"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcbc132445556-9"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbc132445556-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p>
<h3>Grid Search</h3>
<p>We now have all the pieces of the framework.</p>
<p>All that is left is a function to drive the search. We can define a <em>grid_search()</em> function that takes the dataset, a list of configurations to search, and the number of observations to use as the test set and perform the search.</p>
<p>Once mean scores are calculated for each config, the list of configurations is sorted in ascending order so that the best scores are listed first.</p>
<p>The complete function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcbf207765930" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search configs
def grid_search(data, cfg_list, n_test):
	# evaluate configs
	scores = scores = [score_model(data, n_test, cfg) for cfg in cfg_list]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbf207765930-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbf207765930-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbf207765930-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbf207765930-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbf207765930-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcbf207765930-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcbf207765930-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcbf207765930-1"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbf207765930-2"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcbf207765930-3"><span class="crayon-h"> </span><span class="crayon-p"># evaluate configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbf207765930-4"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">score_model</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcbf207765930-5"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcbf207765930-6"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcbf207765930-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<h3>Worked Example</h3>
<p>Now that we have defined the elements of the test harness, we can tie them all together and define a simple persistence model.</p>
<p>We do not need to fit a model so the <em>model_fit()</em> function will be implemented to simply return None.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcc0298364227" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	return None</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc0298364227-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc0298364227-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc0298364227-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcc0298364227-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc0298364227-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc0298364227-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We will use the config to define a list of index offsets in the prior observations relative to the time to be forecasted that will be used as the prediction. For example, 12 will use the observation 12 months ago (-12) relative to the time to be forecasted.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcc2302365772" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define config
cfg_list = [1, 6, 12, 24, 36]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc2302365772-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc2302365772-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcc2302365772-1"><span class="crayon-p"># define config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc2302365772-2"><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">36</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The <em>model_predict()</em> function can be implemented to use this configuration to persist the value at the negative relative offset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcc4983151509" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with a pre-fit model
def model_predict(model, history, offset):
	history[-offset]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc4983151509-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc4983151509-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc4983151509-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcc4983151509-1"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc4983151509-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc4983151509-3"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">offset</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete example of using the framework with a simple persistence model is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcc6507814138" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search persistence models for airline passengers
from math import sqrt
from numpy import mean
from pandas import read_csv
from sklearn.metrics import mean_squared_error

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# fit a model
def model_fit(train, config):
	return None

# forecast with a pre-fit model
def model_predict(model, history, offset):
	return history[-offset]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# score a model, return None on failure
def repeat_evaluate(data, config, n_test, n_repeats=10):
	# convert config to a key
	key = str(config)
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	# summarize score
	result = mean(scores)
	print('&gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test):
	# evaluate configs
	scores = scores = [repeat_evaluate(data, cfg, n_test) for cfg in cfg_list]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# define dataset
series = read_csv('monthly-airline-passengers.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# model configs
cfg_list = [1, 6, 12, 24, 36]
# grid search
scores = grid_search(data, cfg_list, n_test)
print('done')
# list top 10 configs
for cfg, error in scores[:10]:
	print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-22">22</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-24">24</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-26">26</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-28">28</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-30">30</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-32">32</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-34">34</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-36">36</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-38">38</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-40">40</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-42">42</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-44">44</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-46">46</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-48">48</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-50">50</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-52">52</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-54">54</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-56">56</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-58">58</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-60">60</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-62">62</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-64">64</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-66">66</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-68">68</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-70">70</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-72">72</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-74">74</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc6507814138-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc6507814138-76">76</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-1"><span class="crayon-p"># grid search persistence models for airline passengers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-5"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-6"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-7"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-8"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-10"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-11"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-12"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-14"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-15"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-16"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-18"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-19"><span class="crayon-p"># forecast with a pre-fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-20"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">offset</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-22"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-23"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-24"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-25"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-26"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-27"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-28"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-29"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-30"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-31"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-32"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-33"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-34"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-35"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-36"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-37"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-38"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-39"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-40"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-41"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-42"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-44"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-45"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-46"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-47"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-48"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-49"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-50"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-51"><span class="crayon-h"> </span><span class="crayon-p"># summarize score</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-52"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-53"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-54"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-55"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-56"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-57"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-58"><span class="crayon-h"> </span><span class="crayon-p"># evaluate configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-59"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-60"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-61"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-62"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-63"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-64"><span class="crayon-p"># define dataset</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-65"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-66"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-67"><span class="crayon-p"># data split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-68"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-69"><span class="crayon-p"># model configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-70"><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">36</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-71"><span class="crayon-p"># grid search</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-72"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-73"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-74"><span class="crayon-p"># list top 10 configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcc6507814138-75"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">10</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc6507814138-76"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0033 seconds] -->
<p>Running the example prints the RMSE of the model evaluated using walk-forward validation on the final 12 months of data.</p>
<p>Each model configuration is evaluated 10 times, although, because the model has no stochastic element, the score is the same each time.</p>
<p>At the end of the run, the configurations and RMSE for the top three performing model configurations are reported.</p>
<p>We can see, as we might have expected, that persisting the value from one year ago (relative offset -12) resulted in the best performance for the persistence model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcc8077675216" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
 &gt; 110.274
 &gt; 110.274
 &gt; 110.274
&gt; Model[36] 110.274
done
12 50.708316214732804
1 53.1515129919491
24 97.10990337413241
36 110.27352356753639
6 126.73495965991387</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc8077675216-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc8077675216-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc8077675216-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc8077675216-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc8077675216-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc8077675216-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc8077675216-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc8077675216-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc8077675216-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcc8077675216-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcc8077675216-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcc8077675216-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc8077675216-2"> &gt; 110.274</div><div class="crayon-line" id="crayon-5c0ca5ad1dcc8077675216-3"> &gt; 110.274</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc8077675216-4"> &gt; 110.274</div><div class="crayon-line" id="crayon-5c0ca5ad1dcc8077675216-5">&gt; Model[36] 110.274</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc8077675216-6">done</div><div class="crayon-line" id="crayon-5c0ca5ad1dcc8077675216-7">12 50.708316214732804</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc8077675216-8">1 53.1515129919491</div><div class="crayon-line" id="crayon-5c0ca5ad1dcc8077675216-9">24 97.10990337413241</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcc8077675216-10">36 110.27352356753639</div><div class="crayon-line" id="crayon-5c0ca5ad1dcc8077675216-11">6 126.73495965991387</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Now that we have a robust test harness for grid searching model hyperparameters, we can use it to evaluate a suite of neural network models.</p>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Download Your FREE Mini-Course</a><script data-config="%7B%7D" data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Grid Search Multilayer Perceptron</h2>
<p>There are many aspects of the MLP that we may wish to tune.</p>
<p>We will define a very simple model with one hidden layer and define five hyperparameters to tune. They are:</p>
<ul>
<li><strong>n_input</strong>: The number of prior inputs to use as input for the model (e.g. 12 months).</li>
<li><strong>n_nodes</strong>: The number of nodes to use in the hidden layer (e.g. 50).</li>
<li><strong>n_epochs</strong>: The number of training epochs (e.g. 1000).</li>
<li><strong>n_batch</strong>: The number of samples to include in each mini-batch (e.g. 32).</li>
<li><strong>n_diff</strong>: The difference order (e.g. 0 or 12).</li>
</ul>
<p>Modern neural networks can handle raw data with little pre-processing, such as scaling and differencing. Nevertheless, when it comes to time series data, sometimes differencing the series can make a problem easier to model.</p>
<p>Recall that <a href="https://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/">differencing</a> is the transform of the data such that a value of a prior observation is subtracted from the current observation, removing trend or seasonality structure.</p>
<p>We will add support for differencing to the grid search test harness, just in case it adds value to your specific problem. It does add value for the internal airline passengers dataset.</p>
<p>The <em>difference()</em> function below will calculate the difference of a given order for the dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcca260830296" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# difference dataset
def difference(data, order):
	return [data[i] - data[i - order] for i in range(order, len(data))]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcca260830296-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcca260830296-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcca260830296-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcca260830296-1"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcca260830296-2"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcca260830296-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Differencing will be optional, where an order of 0 suggests no differencing, whereas an order 1 or order 12 will require that the data be differenced prior to fitting the model and that the predictions of the model will need the differencing reversed prior to returning the forecast.</p>
<p>We can now define the elements required to fit the MLP model in the test harness.</p>
<p>First, we must unpack the list of hyperparameters.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dccc930772425" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# unpack config
n_input, n_nodes, n_epochs, n_batch, n_diff = config</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dccc930772425-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dccc930772425-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dccc930772425-1"><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dccc930772425-2"><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Next, we must prepare the data, including the differencing, transforming the data to a supervised format and separating out the input and output aspects of the data samples.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcce975429923" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare data
if n_diff &gt; 0:
	train = difference(train, n_diff)
# transform series into supervised format
data = series_to_supervised(train, n_in=n_input)
# separate inputs and outputs
train_x, train_y = data[:, :-1], data[:, -1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcce975429923-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcce975429923-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcce975429923-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcce975429923-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcce975429923-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcce975429923-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcce975429923-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcce975429923-1"><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcce975429923-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcce975429923-3"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcce975429923-4"><span class="crayon-p"># transform series into supervised format</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcce975429923-5"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcce975429923-6"><span class="crayon-p"># separate inputs and outputs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcce975429923-7"><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can now define and fit the model with the provided configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcd0614486143" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(Dense(n_nodes, activation='relu', input_dim=n_input))
model.add(Dense(1))
model.compile(loss='mse', optimizer='adam')
# fit model
model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd0614486143-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd0614486143-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd0614486143-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd0614486143-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd0614486143-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd0614486143-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd0614486143-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcd0614486143-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd0614486143-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd0614486143-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd0614486143-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd0614486143-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd0614486143-6"><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd0614486143-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The complete implementation of the <em>model_fit()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcd1478119475" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	# transform series into supervised format
	data = series_to_supervised(train, n_in=n_input)
	# separate inputs and outputs
	train_x, train_y = data[:, :-1], data[:, -1]
	# define model
	model = Sequential()
	model.add(Dense(n_nodes, activation='relu', input_dim=n_input))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit model
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd1478119475-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd1478119475-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-7"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-8"><span class="crayon-h"> </span><span class="crayon-p"># transform series into supervised format</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-9"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-10"><span class="crayon-h"> </span><span class="crayon-p"># separate inputs and outputs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-11"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-12"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-15"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-17"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd1478119475-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd1478119475-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>The five chosen hyperparameters are by no means the only or best hyperparameters of the model to tune. You may modify the function to tune other parameters, such as the addition and size of more hidden layers and much more.</p>
<p>Once the model is fit, we can use it to make forecasts.</p>
<p>If the data was differenced, the difference must be inverted for the prediction of the model. This involves adding the value at the relative offset from the history back to the value predicted by the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcd3351230988" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# invert difference
correction = 0.0
if n_diff &gt; 0:
	correction = history[-n_diff]
...
# correct forecast if it was differenced
return correction + yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd3351230988-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd3351230988-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd3351230988-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd3351230988-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd3351230988-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd3351230988-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd3351230988-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcd3351230988-1"><span class="crayon-p"># invert difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd3351230988-2"><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd3351230988-3"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd3351230988-4"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd3351230988-5"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd3351230988-6"><span class="crayon-p"># correct forecast if it was differenced</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcd3351230988-7"><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>It also means that the history must be differenced so that the input data used to make the prediction has the expected form.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcd5613853739" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# calculate difference
history = difference(history, n_diff)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd5613853739-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd5613853739-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcd5613853739-1"><span class="crayon-p"># calculate difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd5613853739-2"><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Once prepared, we can use the history data to create a single sample as input to the model for making a one-step prediction.</p>
<p>The shape of one sample must be [1, n_input] where <em>n_input</em> is the chosen number of lag observations to use.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcd6247433656" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# shape input for model
x_input = array(history[-n_input:]).reshape((1, n_input))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd6247433656-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd6247433656-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcd6247433656-1"><span class="crayon-p"># shape input for model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd6247433656-2"><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Finally, a prediction can be made.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcd8267835636" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make forecast
yhat = model.predict(x_input, verbose=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcd8267835636-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcd8267835636-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcd8267835636-1"><span class="crayon-p"># make forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcd8267835636-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete implementation of the <em>model_predict()</em> function is listed below.</p>
<p>Next, we must define the range of values to try for each hyperparameter.</p>
<p>We can define a <em>model_configs()</em> function that creates a list of the different combinations of parameters to try.</p>
<p>We will define a small subset of configurations to try as an example, including a differencing of 12 months, which we expect will be required. You are encouraged to experiment with standalone models, review learning curve diagnostic plots, and use information about the domain to set ranges of values of the hyperparameters to grid search.</p>
<p>You are also encouraged to repeat the grid search to narrow in on ranges of values that appear to show better performance.</p>
<p>An implementation of the <em>model_configs()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcda692276980" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a list of configs to try
def model_configs():
	# define scope of configs
	n_input = [12]
	n_nodes = [50, 100]
	n_epochs = [100]
	n_batch = [1, 150]
	n_diff = [0, 12]
	# create configs
	configs = list()
	for i in n_input:
		for j in n_nodes:
			for k in n_epochs:
				for l in n_batch:
					for m in n_diff:
						cfg = [i, j, k, l, m]
						configs.append(cfg)
	print('Total configs: %d' % len(configs))
	return configs</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcda692276980-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcda692276980-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-1"><span class="crayon-p"># create a list of configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-2"><span class="crayon-e">def </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-3"><span class="crayon-h"> </span><span class="crayon-p"># define scope of configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-5"><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-6"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-7"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-8"><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-9"><span class="crayon-h"> </span><span class="crayon-p"># create configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-10"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">l</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-16"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-17"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcda692276980-18"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total configs: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">configs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcda692276980-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">configs</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We now have all of the pieces needed to grid search MLP models for a univariate time series forecasting problem.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcdb394447698" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search mlps for airline passengers
from math import sqrt
from numpy import array
from numpy import mean
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# difference dataset
def difference(data, order):
	return [data[i] - data[i - order] for i in range(order, len(data))]

# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	# transform series into supervised format
	data = series_to_supervised(train, n_in=n_input)
	# separate inputs and outputs
	train_x, train_y = data[:, :-1], data[:, -1]
	# define model
	model = Sequential()
	model.add(Dense(n_nodes, activation='relu', input_dim=n_input))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit model
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with the fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, n_diff = config
	# prepare data
	correction = 0.0
	if n_diff &gt; 0:
		correction = history[-n_diff]
		history = difference(history, n_diff)
	# shape input for model
	x_input = array(history[-n_input:]).reshape((1, n_input))
	# make forecast
	yhat = model.predict(x_input, verbose=0)
	# correct forecast if it was differenced
	return correction + yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# score a model, return None on failure
def repeat_evaluate(data, config, n_test, n_repeats=10):
	# convert config to a key
	key = str(config)
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	# summarize score
	result = mean(scores)
	print('&gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test):
	# evaluate configs
	scores = scores = [repeat_evaluate(data, cfg, n_test) for cfg in cfg_list]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a list of configs to try
def model_configs():
	# define scope of configs
	n_input = [12]
	n_nodes = [50, 100]
	n_epochs = [100]
	n_batch = [1, 150]
	n_diff = [0, 12]
	# create configs
	configs = list()
	for i in n_input:
		for j in n_nodes:
			for k in n_epochs:
				for l in n_batch:
					for m in n_diff:
						cfg = [i, j, k, l, m]
						configs.append(cfg)
	print('Total configs: %d' % len(configs))
	return configs

# define dataset
series = read_csv('monthly-airline-passengers.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# model configs
cfg_list = model_configs()
# grid search
scores = grid_search(data, cfg_list, n_test)
print('done')
# list top 3 configs
for cfg, error in scores[:3]:
	print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-22">22</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-24">24</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-26">26</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-28">28</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-30">30</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-32">32</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-34">34</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-36">36</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-38">38</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-40">40</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-42">42</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-44">44</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-46">46</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-48">48</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-50">50</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-52">52</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-54">54</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-56">56</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-58">58</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-60">60</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-62">62</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-64">64</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-66">66</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-68">68</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-70">70</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-72">72</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-74">74</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-76">76</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-78">78</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-80">80</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-82">82</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-84">84</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-86">86</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-88">88</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-90">90</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-92">92</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-94">94</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-96">96</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-98">98</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-100">100</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-102">102</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-104">104</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-106">106</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-108">108</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-110">110</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-112">112</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-114">114</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-116">116</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-118">118</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-120">120</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-122">122</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-124">124</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-126">126</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-128">128</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-130">130</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-132">132</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-134">134</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-136">136</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-138">138</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-140">140</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-142">142</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-144">144</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-146">146</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcdb394447698-148">148</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcdb394447698-149">149</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-1"><span class="crayon-p"># grid search mlps for airline passengers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-12"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-13"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-16"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-17"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-18"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-19"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-20"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-21"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-22"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-23"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-25"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-26"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-27"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-28"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-29"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-32"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-33"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-34"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-36"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-37"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-38"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-39"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-40"><span class="crayon-p"># fit a model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-41"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-42"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-43"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-44"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-45"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-46"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-47"><span class="crayon-h"> </span><span class="crayon-p"># transform series into supervised format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-48"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-49"><span class="crayon-h"> </span><span class="crayon-p"># separate inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-50"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-51"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-52"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-53"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-55"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-56"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-57"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-58"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-59"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-60"><span class="crayon-p"># forecast with the fit model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-61"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-62"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-63"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-64"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-65"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-66"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-67"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-68"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-69"><span class="crayon-h"> </span><span class="crayon-p"># shape input for model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-70"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-71"><span class="crayon-h"> </span><span class="crayon-p"># make forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-72"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-73"><span class="crayon-h"> </span><span class="crayon-p"># correct forecast if it was differenced</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-74"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-75"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-76"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-77"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-78"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-79"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-80"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-81"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-82"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-83"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-84"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-85"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-86"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-87"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-88"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-89"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-90"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-91"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-92"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-93"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-94"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-95"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-96"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-97"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-98"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-99"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-100"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-101"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-102"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-103"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-104"><span class="crayon-h"> </span><span class="crayon-p"># summarize score</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-105"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-106"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-107"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-108"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-109"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-110"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-111"><span class="crayon-h"> </span><span class="crayon-p"># evaluate configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-112"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-113"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-114"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-115"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-116"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-117"><span class="crayon-p"># create a list of configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-118"><span class="crayon-e">def </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-119"><span class="crayon-h"> </span><span class="crayon-p"># define scope of configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-120"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-121"><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-122"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-123"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-124"><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-125"><span class="crayon-h"> </span><span class="crayon-p"># create configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-126"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-127"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-128"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-129"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-130"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">l</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-131"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-132"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-133"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-134"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total configs: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">configs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-135"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-136"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-137"><span class="crayon-p"># define dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-138"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-139"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-140"><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-141"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-142"><span class="crayon-p"># model configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-143"><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-144"><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-145"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-146"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-147"><span class="crayon-p"># list top 3 configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcdb394447698-148"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcdb394447698-149"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0071 seconds] -->
<p>Running the example, we can see that there are a total of eight configurations to be evaluated by the framework.</p>
<p>Each config will be evaluated 10 times; that means 10 models will be created and evaluated using walk-forward validation to calculate an RMSE score before an average of those 10 scores is reported and used to score the configuration.</p>
<p>The scores are then sorted and the top 3 configurations with the lowest RMSE are reported at the end. A skillful model configuration was found as compared to a naive model that reported an RMSE of 50.70.</p>
<p>We can see that the best RMSE of 18.98 was achieved with a configuration of [12, 100, 100, 1, 12], which we know can be interpreted as:</p>
<ul>
<li><strong>n_input</strong>: 12</li>
<li><strong>n_nodes</strong>: 100</li>
<li><strong>n_epochs</strong>: 100</li>
<li><strong>n_batch</strong>: 1</li>
<li><strong>n_diff</strong>: 12</li>
</ul>
<p>A truncated example output of the grid search is listed below.</p>
<p>Your specific scores may vary given the stochastic nature of the algorithm.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcde368335847" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total configs: 8
 &gt; 20.707
 &gt; 29.111
 &gt; 17.499
 &gt; 18.918
 &gt; 28.817
...
 &gt; 21.015
 &gt; 20.208
 &gt; 18.503
&gt; Model[[12, 100, 100, 150, 12]] 19.674
done
[12, 100, 100, 1, 12] 18.982720013625606
[12, 50, 100, 150, 12] 19.33004059448595
[12, 100, 100, 1, 0] 19.5389405532858</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcde368335847-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcde368335847-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcde368335847-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcde368335847-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcde368335847-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcde368335847-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcde368335847-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcde368335847-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-1">Total configs: 8</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcde368335847-2"> &gt; 20.707</div><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-3"> &gt; 29.111</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcde368335847-4"> &gt; 17.499</div><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-5"> &gt; 18.918</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcde368335847-6"> &gt; 28.817</div><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-7">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcde368335847-8"> &gt; 21.015</div><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-9"> &gt; 20.208</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcde368335847-10"> &gt; 18.503</div><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-11">&gt; Model[[12, 100, 100, 150, 12]] 19.674</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcde368335847-12">done</div><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-13">[12, 100, 100, 1, 12] 18.982720013625606</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcde368335847-14">[12, 50, 100, 150, 12] 19.33004059448595</div><div class="crayon-line" id="crayon-5c0ca5ad1dcde368335847-15">[12, 100, 100, 1, 0] 19.5389405532858</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Grid Search Convolutional Neural Network</h2>
<p>We can now adapt the framework to grid search CNN models.</p>
<p>Much the same set of hyperparameters can be searched as with the MLP model, except the number of nodes in the hidden layer can be replaced by the number of filter maps and kernel size in the convolutional layers.</p>
<p>The chosen set of hyperparameters to grid search in the CNN model are as follows:</p>
<ul>
<li><strong>n_input</strong>: The number of prior inputs to use as input for the model (e.g. 12 months).</li>
<li><strong>n_filters</strong>: The number of filter maps in the convolutional layer (e.g. 32).</li>
<li><strong>n_kernel</strong>: The kernel size in the convolutional layer (e.g. 3).</li>
<li><strong>n_epochs</strong>: The number of training epochs (e.g. 1000).</li>
<li><strong>n_batch</strong>: The number of samples to include in each mini-batch (e.g. 32).</li>
<li><strong>n_diff</strong>: The difference order (e.g. 0 or 12).</li>
</ul>
<p>Some additional hyperparameters that you may wish to investigate are the use of two convolutional layers before a pooling layer, the repetition of the convolutional and pooling layer pattern, the use of dropout, and more.</p>
<p>We will define a very simple CNN model with one convolutional layer and one max pooling layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dce0774760115" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(n_input, n_features)))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1))
model.compile(loss='mse', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dce0774760115-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce0774760115-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce0774760115-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce0774760115-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce0774760115-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce0774760115-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce0774760115-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dce0774760115-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce0774760115-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce0774760115-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce0774760115-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce0774760115-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce0774760115-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce0774760115-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The data must be prepared in much the same way as for the MLP.</p>
<p>Unlike the MLP that expects the input data to have the shape [samples, features], the 1D CNN model expects the data to have the shape [<em>samples, timesteps, features</em>] where features maps onto channels and in this case 1 for the one variable we measure each month.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dce3528538192" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape input data into [samples, timesteps, features]
n_features = 1
train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], n_features))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dce3528538192-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce3528538192-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce3528538192-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dce3528538192-1"><span class="crayon-p"># reshape input data into [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce3528538192-2"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce3528538192-3"><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The complete implementation of the <em>model_fit()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dce5819040638" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_filters, n_kernel, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	# transform series into supervised format
	data = series_to_supervised(train, n_in=n_input)
	# separate inputs and outputs
	train_x, train_y = data[:, :-1], data[:, -1]
	# reshape input data into [samples, timesteps, features]
	n_features = 1
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], n_features))
	# define model
	model = Sequential()
	model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(n_input, n_features)))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-22">22</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce5819040638-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce5819040638-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-7"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-8"><span class="crayon-h"> </span><span class="crayon-p"># transform series into supervised format</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-9"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-10"><span class="crayon-h"> </span><span class="crayon-p"># separate inputs and outputs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-11"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-12"><span class="crayon-h"> </span><span class="crayon-p"># reshape input data into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-13"><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-14"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-15"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-17"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-19"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-20"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-21"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-22"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce5819040638-23"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce5819040638-24"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Making a prediction with a fit CNN model is very much like making a prediction with a fit MLP.</p>
<p>Again, the only difference is that the one sample worth of input data must have a three-dimensional shape.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dce6609655190" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
x_input = array(history[-n_input:]).reshape((1, n_input, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dce6609655190-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dce6609655190-1"><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete implementation of the <em>model_predict()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dce8395728280" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with the fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, _, n_diff = config
	# prepare data
	correction = 0.0
	if n_diff &gt; 0:
		correction = history[-n_diff]
		history = difference(history, n_diff)
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return correction + yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dce8395728280-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce8395728280-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce8395728280-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce8395728280-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce8395728280-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce8395728280-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce8395728280-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce8395728280-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce8395728280-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce8395728280-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce8395728280-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dce8395728280-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dce8395728280-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dce8395728280-1"><span class="crayon-p"># forecast with the fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce8395728280-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce8395728280-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce8395728280-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce8395728280-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce8395728280-6"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce8395728280-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce8395728280-8"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce8395728280-9"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce8395728280-10"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce8395728280-11"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dce8395728280-12"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dce8395728280-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Finally, we can define a list of configurations for the model to evaluate. As before, we can do this by defining lists of hyperparameter values to try that are combined into a list. We will try a small number of configurations to ensure the example executes in a reasonable amount of time.</p>
<p>The complete <em>model_configs()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcea060439879" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a list of configs to try
def model_configs():
	# define scope of configs
	n_input = [12]
	n_filters = [64]
	n_kernels = [3, 5]
	n_epochs = [100]
	n_batch = [1, 150]
	n_diff = [0, 12]
	# create configs
	configs = list()
	for a in n_input:
		for b in n_filters:
			for c in n_kernels:
				for d in n_epochs:
					for e in n_batch:
						for f in n_diff:
							cfg = [a,b,c,d,e,f]
							configs.append(cfg)
	print('Total configs: %d' % len(configs))
	return configs</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcea060439879-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcea060439879-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-1"><span class="crayon-p"># create a list of configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-2"><span class="crayon-e">def </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-3"><span class="crayon-h"> </span><span class="crayon-p"># define scope of configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-5"><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">64</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-6"><span class="crayon-h"> </span><span class="crayon-v">n_kernels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-7"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-8"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-9"><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-10"><span class="crayon-h"> </span><span class="crayon-p"># create configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-11"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">b</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_kernels</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-16"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-17"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">f</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-18"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-v">b</span><span class="crayon-sy">,</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-v">f</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-19"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcea060439879-20"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total configs: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">configs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcea060439879-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">configs</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We now have all of the elements needed to grid search the hyperparameters of a convolutional neural network for univariate time series forecasting.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcec468306867" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search cnn for airline passengers
from math import sqrt
from numpy import array
from numpy import mean
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# difference dataset
def difference(data, order):
	return [data[i] - data[i - order] for i in range(order, len(data))]

# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_filters, n_kernel, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	# transform series into supervised format
	data = series_to_supervised(train, n_in=n_input)
	# separate inputs and outputs
	train_x, train_y = data[:, :-1], data[:, -1]
	# reshape input data into [samples, timesteps, features]
	n_features = 1
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], n_features))
	# define model
	model = Sequential()
	model.add(Conv1D(filters=n_filters, kernel_size=n_kernel, activation='relu', input_shape=(n_input, n_features)))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with the fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, _, n_diff = config
	# prepare data
	correction = 0.0
	if n_diff &gt; 0:
		correction = history[-n_diff]
		history = difference(history, n_diff)
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return correction + yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# score a model, return None on failure
def repeat_evaluate(data, config, n_test, n_repeats=10):
	# convert config to a key
	key = str(config)
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	# summarize score
	result = mean(scores)
	print('&gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test):
	# evaluate configs
	scores = scores = [repeat_evaluate(data, cfg, n_test) for cfg in cfg_list]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a list of configs to try
def model_configs():
	# define scope of configs
	n_input = [12]
	n_filters = [64]
	n_kernels = [3, 5]
	n_epochs = [100]
	n_batch = [1, 150]
	n_diff = [0, 12]
	# create configs
	configs = list()
	for a in n_input:
		for b in n_filters:
			for c in n_kernels:
				for d in n_epochs:
					for e in n_batch:
						for f in n_diff:
							cfg = [a,b,c,d,e,f]
							configs.append(cfg)
	print('Total configs: %d' % len(configs))
	return configs

# define dataset
series = read_csv('monthly-airline-passengers.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# model configs
cfg_list = model_configs()
# grid search
scores = grid_search(data, cfg_list, n_test)
print('done')
# list top 10 configs
for cfg, error in scores[:3]:
	print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-22">22</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-24">24</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-26">26</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-28">28</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-30">30</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-32">32</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-34">34</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-36">36</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-38">38</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-40">40</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-42">42</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-44">44</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-46">46</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-48">48</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-50">50</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-52">52</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-54">54</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-56">56</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-58">58</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-60">60</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-62">62</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-64">64</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-66">66</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-68">68</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-70">70</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-72">72</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-74">74</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-76">76</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-78">78</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-80">80</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-82">82</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-84">84</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-86">86</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-88">88</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-90">90</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-92">92</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-94">94</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-96">96</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-98">98</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-100">100</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-102">102</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-104">104</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-106">106</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-108">108</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-110">110</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-112">112</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-114">114</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-116">116</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-118">118</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-120">120</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-122">122</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-124">124</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-126">126</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-128">128</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-130">130</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-132">132</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-134">134</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-136">136</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-138">138</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-140">140</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-142">142</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-144">144</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-146">146</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-148">148</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-150">150</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-152">152</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-154">154</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcec468306867-156">156</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcec468306867-157">157</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-1"><span class="crayon-p"># grid search cnn for airline passengers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-14"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-15"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-16"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-18"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-19"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-20"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-21"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-22"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-23"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-25"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-26"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-27"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-28"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-29"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-30"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-31"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-32"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-34"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-35"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-36"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-38"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-39"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-40"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-41"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-42"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-43"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-44"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-45"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-46"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-47"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-48"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-49"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-50"><span class="crayon-h"> </span><span class="crayon-p"># transform series into supervised format</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-51"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-52"><span class="crayon-h"> </span><span class="crayon-p"># separate inputs and outputs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-53"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-54"><span class="crayon-h"> </span><span class="crayon-p"># reshape input data into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-55"><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-56"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-57"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-58"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-59"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-v">n_filters</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-v">n_kernel</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-60"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-61"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-62"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-63"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-64"><span class="crayon-h"> </span><span class="crayon-p"># fit</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-65"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-66"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-67"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-68"><span class="crayon-p"># forecast with the fit model</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-69"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-70"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-71"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-72"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-73"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-74"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-75"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-76"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-77"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-78"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-79"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-80"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-82"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-83"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-84"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-85"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-86"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-87"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-88"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-89"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-90"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-91"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-92"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-93"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-94"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-95"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-96"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-97"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-98"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-99"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-100"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-101"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-102"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-103"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-104"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-105"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-106"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-107"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-108"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-109"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-110"><span class="crayon-h"> </span><span class="crayon-p"># summarize score</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-111"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-112"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-113"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-114"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-115"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-116"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-117"><span class="crayon-h"> </span><span class="crayon-p"># evaluate configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-118"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-119"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-120"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-121"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-122"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-123"><span class="crayon-p"># create a list of configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-124"><span class="crayon-e">def </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-125"><span class="crayon-h"> </span><span class="crayon-p"># define scope of configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-126"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-127"><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">64</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-128"><span class="crayon-h"> </span><span class="crayon-v">n_kernels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-129"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-130"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-131"><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-132"><span class="crayon-h"> </span><span class="crayon-p"># create configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-133"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-134"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-135"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">b</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_filters</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-136"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_kernels</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-137"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-138"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-139"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">f</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-140"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-v">b</span><span class="crayon-sy">,</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-v">f</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-141"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-142"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total configs: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">configs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-143"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-144"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-145"><span class="crayon-p"># define dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-146"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-147"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-148"><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-149"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-150"><span class="crayon-p"># model configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-151"><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-152"><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-153"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-154"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-155"><span class="crayon-p"># list top 10 configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcec468306867-156"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcec468306867-157"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0077 seconds] -->
<p>Running the example, we can see that only eight distinct configurations are evaluated.</p>
<p>We can see that a configuration of [12, 64, 5, 100, 1, 12] achieved an RMSE of 18.89, which is skillful as compared to a naive forecast model that achieved 50.70.</p>
<p>We can unpack this configuration as:</p>
<ul>
<li><strong>n_input</strong>: 12</li>
<li><strong>n_filters</strong>: 64</li>
<li><strong>n_kernel</strong>: 5</li>
<li><strong>n_epochs</strong>: 100</li>
<li><strong>n_batch</strong>: 1</li>
<li><strong>n_diff</strong>: 12</li>
</ul>
<p>A truncated example output of the grid search is listed below.</p>
<p>Your specific scores may vary given the stochastic nature of the algorithm.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcef483922854" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total configs: 8
 &gt; 23.372
 &gt; 28.317
 &gt; 31.070
...
 &gt; 20.923
 &gt; 18.700
 &gt; 18.210
&gt; Model[[12, 64, 5, 100, 150, 12]] 19.152
done
[12, 64, 5, 100, 1, 12] 18.89593462072732
[12, 64, 5, 100, 150, 12] 19.152486150334234
[12, 64, 3, 100, 150, 12] 19.44680151564605</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcef483922854-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcef483922854-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcef483922854-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcef483922854-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcef483922854-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcef483922854-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcef483922854-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcef483922854-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcef483922854-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcef483922854-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcef483922854-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcef483922854-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcef483922854-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcef483922854-1">Total configs: 8</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcef483922854-2"> &gt; 23.372</div><div class="crayon-line" id="crayon-5c0ca5ad1dcef483922854-3"> &gt; 28.317</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcef483922854-4"> &gt; 31.070</div><div class="crayon-line" id="crayon-5c0ca5ad1dcef483922854-5">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcef483922854-6"> &gt; 20.923</div><div class="crayon-line" id="crayon-5c0ca5ad1dcef483922854-7"> &gt; 18.700</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcef483922854-8"> &gt; 18.210</div><div class="crayon-line" id="crayon-5c0ca5ad1dcef483922854-9">&gt; Model[[12, 64, 5, 100, 150, 12]] 19.152</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcef483922854-10">done</div><div class="crayon-line" id="crayon-5c0ca5ad1dcef483922854-11">[12, 64, 5, 100, 1, 12] 18.89593462072732</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcef483922854-12">[12, 64, 5, 100, 150, 12] 19.152486150334234</div><div class="crayon-line" id="crayon-5c0ca5ad1dcef483922854-13">[12, 64, 3, 100, 150, 12] 19.44680151564605</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Grid Search Long Short-Term Memory Network</h2>
<p>We can now adopt the framework for grid searching the hyperparameters of an LSTM model.</p>
<p>The hyperparameters for the LSTM model will be the same five as the MLP; they are:</p>
<ul>
<li><strong>n_input</strong>: The number of prior inputs to use as input for the model (e.g. 12 months).</li>
<li><strong>n_nodes</strong>: The number of nodes to use in the hidden layer (e.g. 50).</li>
<li><strong>n_epochs</strong>: The number of training epochs (e.g. 1000).</li>
<li><strong>n_batch</strong>: The number of samples to include in each mini-batch (e.g. 32).</li>
<li><strong>n_diff</strong>: The difference order (e.g. 0 or 12).</li>
</ul>
<p>We will define a simple LSTM model with a single hidden LSTM layer and the number of nodes specifying the number of units in this layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcf1190317429" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(LSTM(n_nodes, activation='relu', input_shape=(n_input, n_features)))
model.add(Dense(n_nodes, activation='relu'))
model.add(Dense(1))
model.compile(loss='mse', optimizer='adam')
# fit model
model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf1190317429-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf1190317429-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf1190317429-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf1190317429-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf1190317429-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf1190317429-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf1190317429-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf1190317429-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcf1190317429-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf1190317429-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf1190317429-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf1190317429-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf1190317429-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf1190317429-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf1190317429-7"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf1190317429-8"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>It may be interesting to explore tuning additional configurations such as the use of a bidirectional input layer, stacked LSTM layers, and even hybrid models with CNN or ConvLSTM input models.</p>
<p>As with the CNN model, the LSTM model expects input data to have a three-dimensional shape for the samples, time steps, and features.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcf4979647122" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape input data into [samples, timesteps, features]
n_features = 1
train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], n_features))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf4979647122-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf4979647122-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf4979647122-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcf4979647122-1"><span class="crayon-p"># reshape input data into [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf4979647122-2"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf4979647122-3"><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The complete implementation of the <em>model_fit()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcf7565680381" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	# transform series into supervised format
	data = series_to_supervised(train, n_in=n_input)
	# separate inputs and outputs
	train_x, train_y = data[:, :-1], data[:, -1]
	# reshape input data into [samples, timesteps, features]
	n_features = 1
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], n_features))
	# define model
	model = Sequential()
	model.add(LSTM(n_nodes, activation='relu', input_shape=(n_input, n_features)))
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit model
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcf7565680381-22">22</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcf7565680381-23">23</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-1"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-2"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-7"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-8"><span class="crayon-h"> </span><span class="crayon-p"># transform series into supervised format</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-9"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-10"><span class="crayon-h"> </span><span class="crayon-p"># separate inputs and outputs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-11"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-12"><span class="crayon-h"> </span><span class="crayon-p"># reshape input data into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-13"><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-14"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-15"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-17"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-18"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-19"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-20"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-21"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcf7565680381-22"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcf7565680381-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Also like the CNN, the single input sample used to make a prediction must also be reshaped into the expected three-dimensional structure.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcfa262246800" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape sample into [samples, timesteps, features]
x_input = array(history[-n_input:]).reshape((1, n_input, 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfa262246800-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfa262246800-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcfa262246800-1"><span class="crayon-p"># reshape sample into [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfa262246800-2"><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The complete <em>model_predict()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dcfd263850158" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# forecast with the fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, n_diff = config
	# prepare data
	correction = 0.0
	if n_diff &gt; 0:
		correction = history[-n_diff]
		history = difference(history, n_diff)
	# reshape sample into [samples, timesteps, features]
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return correction + yhat[0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfd263850158-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfd263850158-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfd263850158-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfd263850158-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfd263850158-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfd263850158-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfd263850158-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfd263850158-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfd263850158-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfd263850158-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfd263850158-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfd263850158-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dcfd263850158-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dcfd263850158-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dcfd263850158-1"><span class="crayon-p"># forecast with the fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfd263850158-2"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcfd263850158-3"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfd263850158-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcfd263850158-5"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfd263850158-6"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcfd263850158-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfd263850158-8"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcfd263850158-9"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfd263850158-10"><span class="crayon-h"> </span><span class="crayon-p"># reshape sample into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcfd263850158-11"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfd263850158-12"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dcfd263850158-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dcfd263850158-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We can now define the function used to create the list of model configurations to evaluate.</p>
<p>The LSTM model is quite a bit slower to train than MLP and CNN models; as such, you may want to evaluate fewer configurations per run.</p>
<p>We will define a very simple set of two configurations to explore: stochastic and batch gradient descent.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dd00954738870" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a list of configs to try
def model_configs():
	# define scope of configs
	n_input = [12]
	n_nodes = [100]
	n_epochs = [50]
	n_batch = [1, 150]
	n_diff = [12]
	# create configs
	configs = list()
	for i in n_input:
		for j in n_nodes:
			for k in n_epochs:
				for l in n_batch:
					for m in n_diff:
						cfg = [i, j, k, l, m]
						configs.append(cfg)
	print('Total configs: %d' % len(configs))
	return configs</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd00954738870-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd00954738870-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-1"><span class="crayon-p"># create a list of configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-2"><span class="crayon-e">def </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-3"><span class="crayon-h"> </span><span class="crayon-p"># define scope of configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-4"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-5"><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-6"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">50</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-7"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-8"><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-9"><span class="crayon-h"> </span><span class="crayon-p"># create configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-10"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">l</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-16"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-17"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd00954738870-18"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total configs: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">configs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd00954738870-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">configs</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We now have everything we need to grid search hyperparameters for the LSTM model for univariate time series forecasting.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dd03287184617" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# grid search lstm for airline passengers
from math import sqrt
from numpy import array
from numpy import mean
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM

# split a univariate dataset into train/test sets
def train_test_split(data, n_test):
	return data[:-n_test], data[-n_test:]

# transform list into supervised learning format
def series_to_supervised(data, n_in=1, n_out=1):
	df = DataFrame(data)
	cols = list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
	# put it all together
	agg = concat(cols, axis=1)
	# drop rows with NaN values
	agg.dropna(inplace=True)
	return agg.values

# root mean squared error or rmse
def measure_rmse(actual, predicted):
	return sqrt(mean_squared_error(actual, predicted))

# difference dataset
def difference(data, order):
	return [data[i] - data[i - order] for i in range(order, len(data))]

# fit a model
def model_fit(train, config):
	# unpack config
	n_input, n_nodes, n_epochs, n_batch, n_diff = config
	# prepare data
	if n_diff &gt; 0:
		train = difference(train, n_diff)
	# transform series into supervised format
	data = series_to_supervised(train, n_in=n_input)
	# separate inputs and outputs
	train_x, train_y = data[:, :-1], data[:, -1]
	# reshape input data into [samples, timesteps, features]
	n_features = 1
	train_x = train_x.reshape((train_x.shape[0], train_x.shape[1], n_features))
	# define model
	model = Sequential()
	model.add(LSTM(n_nodes, activation='relu', input_shape=(n_input, n_features)))
	model.add(Dense(n_nodes, activation='relu'))
	model.add(Dense(1))
	model.compile(loss='mse', optimizer='adam')
	# fit model
	model.fit(train_x, train_y, epochs=n_epochs, batch_size=n_batch, verbose=0)
	return model

# forecast with the fit model
def model_predict(model, history, config):
	# unpack config
	n_input, _, _, _, n_diff = config
	# prepare data
	correction = 0.0
	if n_diff &gt; 0:
		correction = history[-n_diff]
		history = difference(history, n_diff)
	# reshape sample into [samples, timesteps, features]
	x_input = array(history[-n_input:]).reshape((1, n_input, 1))
	# forecast
	yhat = model.predict(x_input, verbose=0)
	return correction + yhat[0]

# walk-forward validation for univariate data
def walk_forward_validation(data, n_test, cfg):
	predictions = list()
	# split dataset
	train, test = train_test_split(data, n_test)
	# fit model
	model = model_fit(train, cfg)
	# seed history with training dataset
	history = [x for x in train]
	# step over each time-step in the test set
	for i in range(len(test)):
		# fit model and make forecast for history
		yhat = model_predict(model, history, cfg)
		# store forecast in list of predictions
		predictions.append(yhat)
		# add actual observation to history for the next loop
		history.append(test[i])
	# estimate prediction error
	error = measure_rmse(test, predictions)
	print(' &gt; %.3f' % error)
	return error

# score a model, return None on failure
def repeat_evaluate(data, config, n_test, n_repeats=10):
	# convert config to a key
	key = str(config)
	# fit and evaluate the model n times
	scores = [walk_forward_validation(data, n_test, config) for _ in range(n_repeats)]
	# summarize score
	result = mean(scores)
	print('&gt; Model[%s] %.3f' % (key, result))
	return (key, result)

# grid search configs
def grid_search(data, cfg_list, n_test):
	# evaluate configs
	scores = scores = [repeat_evaluate(data, cfg, n_test) for cfg in cfg_list]
	# sort configs by error, asc
	scores.sort(key=lambda tup: tup[1])
	return scores

# create a list of configs to try
def model_configs():
	# define scope of configs
	n_input = [12]
	n_nodes = [100]
	n_epochs = [50]
	n_batch = [1, 150]
	n_diff = [12]
	# create configs
	configs = list()
	for i in n_input:
		for j in n_nodes:
			for k in n_epochs:
				for l in n_batch:
					for m in n_diff:
						cfg = [i, j, k, l, m]
						configs.append(cfg)
	print('Total configs: %d' % len(configs))
	return configs

# define dataset
series = read_csv('monthly-airline-passengers.csv', header=0, index_col=0)
data = series.values
# data split
n_test = 12
# model configs
cfg_list = model_configs()
# grid search
scores = grid_search(data, cfg_list, n_test)
print('done')
# list top 10 configs
for cfg, error in scores[:3]:
	print(cfg, error)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-12">12</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-14">14</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-16">16</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-18">18</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-20">20</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-22">22</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-24">24</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-26">26</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-28">28</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-30">30</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-32">32</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-34">34</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-36">36</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-38">38</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-40">40</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-42">42</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-44">44</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-46">46</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-48">48</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-50">50</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-52">52</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-54">54</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-56">56</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-58">58</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-60">60</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-62">62</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-64">64</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-66">66</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-68">68</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-70">70</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-72">72</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-74">74</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-76">76</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-78">78</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-80">80</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-82">82</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-84">84</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-86">86</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-88">88</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-90">90</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-92">92</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-94">94</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-96">96</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-98">98</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-100">100</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-102">102</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-104">104</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-106">106</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-108">108</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-110">110</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-112">112</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-114">114</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-116">116</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-118">118</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-120">120</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-122">122</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-124">124</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-126">126</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-128">128</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-130">130</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-132">132</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-134">134</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-136">136</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-138">138</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-140">140</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-142">142</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-144">144</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-146">146</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-148">148</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-150">150</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd03287184617-152">152</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd03287184617-153">153</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-1"><span class="crayon-p"># grid search lstm for airline passengers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">mean</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-7"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-12"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-13"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-14"><span class="crayon-e">def </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-16"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-17"><span class="crayon-p"># transform list into supervised learning format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-18"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-19"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-20"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-21"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-22"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-23"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-24"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-25"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-26"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-27"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-28"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-29"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-30"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-31"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-32"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-33"><span class="crayon-p"># root mean squared error or rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-34"><span class="crayon-e">def </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-36"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-37"><span class="crayon-p"># difference dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-38"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-39"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">order</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-40"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-41"><span class="crayon-p"># fit a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-42"><span class="crayon-e">def </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-43"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-44"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-45"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-46"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-47"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-48"><span class="crayon-h"> </span><span class="crayon-p"># transform series into supervised format</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-49"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-50"><span class="crayon-h"> </span><span class="crayon-p"># separate inputs and outputs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-51"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-52"><span class="crayon-h"> </span><span class="crayon-p"># reshape input data into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-53"><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-54"><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-55"><span class="crayon-h"> </span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-56"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-57"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-58"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_nodes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-59"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-60"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-61"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-62"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-63"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-64"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-65"><span class="crayon-p"># forecast with the fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-66"><span class="crayon-e">def </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-67"><span class="crayon-h"> </span><span class="crayon-p"># unpack config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-68"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-69"><span class="crayon-h"> </span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-70"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-71"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-72"><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_diff</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-73"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-74"><span class="crayon-h"> </span><span class="crayon-p"># reshape sample into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-75"><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-76"><span class="crayon-h"> </span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-77"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-78"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correction</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-79"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-80"><span class="crayon-p"># walk-forward validation for univariate data</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-81"><span class="crayon-e">def </span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-82"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-83"><span class="crayon-h"> </span><span class="crayon-p"># split dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-84"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-85"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-86"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-87"><span class="crayon-h"> </span><span class="crayon-p"># seed history with training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-88"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-89"><span class="crayon-h"> </span><span class="crayon-p"># step over each time-step in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-90"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-91"><span class="crayon-h"> </span><span class="crayon-p"># fit model and make forecast for history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-92"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-93"><span class="crayon-h"> </span><span class="crayon-p"># store forecast in list of predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-94"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-95"><span class="crayon-h"> </span><span class="crayon-p"># add actual observation to history for the next loop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-96"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-97"><span class="crayon-h"> </span><span class="crayon-p"># estimate prediction error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-98"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">measure_rmse</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-99"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">' &gt; %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-100"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-101"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-102"><span class="crayon-p"># score a model, return None on failure</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-103"><span class="crayon-e">def </span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_repeats</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-104"><span class="crayon-h"> </span><span class="crayon-p"># convert config to a key</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-105"><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-106"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate the model n times</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-107"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">walk_forward_validation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_repeats</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-108"><span class="crayon-h"> </span><span class="crayon-p"># summarize score</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-109"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-110"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt; Model[%s] %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-111"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-112"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-113"><span class="crayon-p"># grid search configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-114"><span class="crayon-e">def </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-115"><span class="crayon-h"> </span><span class="crayon-p"># evaluate configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-116"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">repeat_evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">cfg </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-117"><span class="crayon-h"> </span><span class="crayon-p"># sort configs by error, asc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-118"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-119"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-120"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-121"><span class="crayon-p"># create a list of configs to try</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-122"><span class="crayon-e">def </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-123"><span class="crayon-h"> </span><span class="crayon-p"># define scope of configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-124"><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-125"><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-126"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">50</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-127"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-128"><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-129"><span class="crayon-h"> </span><span class="crayon-p"># create configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-130"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-131"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-132"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_nodes</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-133"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-134"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">l</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-135"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">n_diff</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-136"><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-137"><span class="crayon-h"> </span><span class="crayon-v">configs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-138"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total configs: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">configs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-139"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-140"> </div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-141"><span class="crayon-p"># define dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-142"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'monthly-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-143"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-144"><span class="crayon-p"># data split</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-145"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-146"><span class="crayon-p"># model configs</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-147"><span class="crayon-v">cfg_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">model_configs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-148"><span class="crayon-p"># grid search</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-149"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">grid_search</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cfg_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-150"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'done'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-151"><span class="crayon-p"># list top 10 configs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd03287184617-152"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">error </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca5ad1dd03287184617-153"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">cfg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0074 seconds] -->
<p>Running the example, we can see that only two distinct configurations are evaluated.</p>
<p>We can see that a configuration of [12, 100, 50, 1, 12] achieved an RMSE of 21.24, which is skillful as compared to a naive forecast model that achieved 50.70.</p>
<p>The model requires a lot more tuning and may do much better with a hybrid configuration, such as having a CNN model as input.</p>
<p>We can unpack this configuration as:</p>
<ul>
<li><strong>n_input</strong>: 12</li>
<li><strong>n_nodes</strong>: 100</li>
<li><strong>n_epochs</strong>: 50</li>
<li><strong>n_batch</strong>: 1</li>
<li><strong>n_diff</strong>: 12</li>
</ul>
<p>A truncated example output of the grid search is listed below.</p>
<p>Your specific scores may vary given the stochastic nature of the algorithm.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca5ad1dd07715507784" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total configs: 2
 &gt; 20.488
 &gt; 17.718
 &gt; 21.213
...
 &gt; 22.300
 &gt; 20.311
 &gt; 21.322
&gt; Model[[12, 100, 50, 150, 12]] 21.260
done
[12, 100, 50, 1, 12] 21.243775750634093
[12, 100, 50, 150, 12] 21.259553398553606</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca5ad1dd07715507784-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd07715507784-2">2</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd07715507784-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd07715507784-4">4</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd07715507784-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd07715507784-6">6</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd07715507784-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd07715507784-8">8</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd07715507784-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd07715507784-10">10</div><div class="crayon-num" data-line="crayon-5c0ca5ad1dd07715507784-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca5ad1dd07715507784-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca5ad1dd07715507784-1">Total configs: 2</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd07715507784-2"> &gt; 20.488</div><div class="crayon-line" id="crayon-5c0ca5ad1dd07715507784-3"> &gt; 17.718</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd07715507784-4"> &gt; 21.213</div><div class="crayon-line" id="crayon-5c0ca5ad1dd07715507784-5">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd07715507784-6"> &gt; 22.300</div><div class="crayon-line" id="crayon-5c0ca5ad1dd07715507784-7"> &gt; 20.311</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd07715507784-8"> &gt; 21.322</div><div class="crayon-line" id="crayon-5c0ca5ad1dd07715507784-9">&gt; Model[[12, 100, 50, 150, 12]] 21.260</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd07715507784-10">done</div><div class="crayon-line" id="crayon-5c0ca5ad1dd07715507784-11">[12, 100, 50, 1, 12] 21.243775750634093</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca5ad1dd07715507784-12">[12, 100, 50, 150, 12] 21.259553398553606</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>More Configurations</strong>. Explore a large suite of configurations for one of the models and see if you can find a configuration that results in better performance.</li>
<li><strong>Data Scaling</strong>. Update the grid search framework to also support the scaling (normalization and/or standardization) of data both before fitting the model and inverting the transform for predictions.</li>
<li><strong>Network Architecture</strong>. Explore the grid searching larger architectural changes for a given model, such as the addition of more hidden layers.</li>
<li><strong>New Dataset</strong>. Explore the grid search of a given model in a new univariate time series dataset.</li>
<li><strong>Multivariate</strong>. Update the grid search framework to support small multivariate time series datasets, e.g. datasets with multiple input variables.</li>
</ul>
<p>If you explore any of these extensions, I’d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a></li>
<li><a href="https://keras.io/layers/core/">Keras Core Layers API</a></li>
<li><a href="https://keras.io/layers/convolutional/">Keras Convolutional Layers API</a></li>
<li><a href="https://keras.io/layers/recurrent/">Keras Recurrent Layers API</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop a framework to grid search hyperparameters for deep learning models.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a generic grid searching framework for tuning model hyperparameters.</li>
<li>How to grid search hyperparameters for a Multilayer Perceptron model on the airline passengers univariate time series forecasting problem.</li>
<li>How to adapt the framework to grid search hyperparameters for convolutional and long short-term memory neural networks.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img align="left" alt="Deep Learning for Time Series Forecasting" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br/>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6441 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Grid+Search+Deep+Learning+Models+for+Time+Series+Forecasting&amp;url=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-time-series-forecasting/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop LSTM Models for Time Series Forecasting</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/weight-regularization-to-reduce-overfitting-of-deep-learning-models/" rel="next">Use Weight Regularization to Reduce Overfitting of Deep Learning Models <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">11 Responses to <em>How to Grid Search Deep Learning Models for Time Series Forecasting</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-455030">
<div class="comment-container" id="li-comment-455030">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7990b5794185a43834986e7f5208200d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7990b5794185a43834986e7f5208200d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://nearlearn.com/" rel="external nofollow">Kiran</a></span>
<span class="date">November 16, 2018 at 10:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-455030" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for providing such wonderful information.</p>
<div class="reply">
<a aria-label="Reply to Kiran" class="comment-reply-link" href="#comment-455030" onclick='return addComment.moveForm( "comment-455030", "455030", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455077">
<div class="comment-container" id="li-comment-455077">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 17, 2018 at 5:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-455077" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad it helped.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455077" onclick='return addComment.moveForm( "comment-455077", "455077", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-455095">
<div class="comment-container" id="li-comment-455095">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/13c3ca4e4c49351cebbb75fe6e90678f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/13c3ca4e4c49351cebbb75fe6e90678f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">James</span>
<span class="date">November 17, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-455095" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just wanted to say thank you for your most excellent tutorials. They have helped me tremendously.</p>
<div class="reply">
<a aria-label="Reply to James" class="comment-reply-link" href="#comment-455095" onclick='return addComment.moveForm( "comment-455095", "455095", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-455222">
<div class="comment-container" id="li-comment-455222">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 18, 2018 at 6:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-455222" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I’m happy to hear that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455222" onclick='return addComment.moveForm( "comment-455222", "455222", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-456679">
<div class="comment-container" id="li-comment-456679">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/38fad5c19b9f971dbd2b25b324bda3f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/38fad5c19b9f971dbd2b25b324bda3f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JG</span>
<span class="date">November 30, 2018 at 9:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-456679" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hola Jason:</p>
<p>A very complete and rich hyperparameters  tutorial (i.e. a sensitivity analysis of model errors output vs hyperparameters inputs). Even very useful in order to practice model definitions as MLP, CNN and LSTM. In addition to practice with modules or function to standardize the code.Thank you very much. I got same results as you but with some first decimal changes !.</p>
<p>My comments, if useful , are related to two main cores regarding machine learning structure:</p>
<p>– The first one is, related to dataset FRAMING (i.e. prepare inputs vs labels (outputs) and train vs test split from dataset).  the function “def train_test_split” is very clear , but the function “def series_to_supervised” is less clear. Probably because the use of methodS for dataframe .shift[i] for backward input is counterintuitive with shift[-i] for forward or labels :-). My suggestion is to use some plot or drawings to show more clearly how those inputs-labels are caught from original dataset cols.</p>
<p>-The second one is related to how DIMENSION and RESHAPING matching. So the  argument of first layer (input_shape=) of model definition for different ones (MLP,CNN,LSTM), or how to reshape training_data (input data into [samples, timesteps, features] into different model_fit function, or finally x_input into different model_predict function  (x_input = array(history[-n_input:]).reshape((1, n_input, 1)). One more time my suggestion is to use some plot or drawings or matrices to see how those dimension must match the different input parts of the process (layers, training, predicting,..).<br/>
From my experience those use to be the hard part of the code …I always have to work hard on how to handle them. So emphasizing those hard cores issues during code presentation… could help a lot .</p>
<p>thank you for your job.</p>
<div class="reply">
<a aria-label="Reply to JG" class="comment-reply-link" href="#comment-456679" onclick='return addComment.moveForm( "comment-456679", "456679", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-456701">
<div class="comment-container" id="li-comment-456701">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2018 at 2:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-456701" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<p>This post may help in understanding the mapping of time series to supervised learning:<br/>
<a href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<p>Another great question, I cover this more here:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<p>You’re right, pictures would be helpful!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456701" onclick='return addComment.moveForm( "comment-456701", "456701", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-456880">
<div class="comment-container" id="li-comment-456880">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/38fad5c19b9f971dbd2b25b324bda3f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/38fad5c19b9f971dbd2b25b324bda3f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JG</span>
<span class="date">December 2, 2018 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-456880" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason. </p>
<p>1)  I see your useful function valid for single-steps or multi-steps and univariate or multivariate TIMESERIES:<br/>
“def series_to_supervised(data, n_in=1, n_out=1, dropnan=True)”:</p>
<p>But also I see also the guy who set up this “shift” function in pandas decided to put shift(+i) to go backward (t-1) and shift (-1) to go forward t+1 :a little counterintuitive :–)<br/>
thks.</p>
<p>2) I see now more clearly the meaning of 3D dimensions for LSTM input ( I guess is the same for CNN), as [samples, timesteps, features)…thanks </p>
<p>But also I see how when you define the data 3D shape in [samples, timesteps, features] later when you use the input_shape argument of LST it must be omitted the samples dimension, and only retain in the set up a 2D tuple  [timesteps, features] and also in the x_input for model_predict to set up samples for 1 for sample [1, timesteps=1, features)=1</p>
<p>I hope more examples give us more easy understanding </p>
<p>thanks</p>
<div class="reply">
<a aria-label="Reply to JG" class="comment-reply-link" href="#comment-456880" onclick='return addComment.moveForm( "comment-456880", "456880", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-456906">
<div class="comment-container" id="li-comment-456906">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2018 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-456906" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great observations! </p>
<p>I’m glad it helped.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456906" onclick='return addComment.moveForm( "comment-456906", "456906", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-457116">
<div class="comment-container" id="li-comment-457116">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0b10b9562ad44bfe6d1e05f3b4559e06?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0b10b9562ad44bfe6d1e05f3b4559e06?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joe Choong</span>
<span class="date">December 3, 2018 at 6:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-457116" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great tutorial ! Please let me know how to predict for future data for 1 value for LSTM.<br/>
For, example, i have a trained LSTM and want to predict for t(n+1).</p>
<p>The example above only show prediction using the test set.</p>
<p>Thank you </p>
<p>Joe</p>
<div class="reply">
<a aria-label="Reply to Joe Choong" class="comment-reply-link" href="#comment-457116" onclick='return addComment.moveForm( "comment-457116", "457116", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-457162">
<div class="comment-container" id="li-comment-457162">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 4, 2018 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-457162" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I show how to make a prediction with a fit LSTM model here:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-457162" onclick='return addComment.moveForm( "comment-457162", "457162", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-457235">
<div class="comment-container" id="li-comment-457235">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0b10b9562ad44bfe6d1e05f3b4559e06?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0b10b9562ad44bfe6d1e05f3b4559e06?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joe</span>
<span class="date">December 4, 2018 at 6:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#comment-457235" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Fantastic ! Thank you</p>
<p>Joe</p>
<div class="reply">
<a aria-label="Reply to Joe" class="comment-reply-link" href="#comment-457235" onclick='return addComment.moveForm( "comment-457235", "457235", "respond", "6441" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/how-to-grid-search-deep-learning-models-for-time-series-forecasting/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="6441"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="3fe1da38b2"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="13"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-51"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for Time Series</strong><br/>
Forecast the future with MLPs, CNNs, and LSTMs.
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>