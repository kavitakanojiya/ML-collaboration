<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</title>
<link href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" property="og:title"/>
<meta content="The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems such as machine translation. Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-11-01T18:00:26+00:00" property="article:published_time"/>
<meta content="2018-07-05T01:02:19+00:00" property="article:modified_time"/>
<meta content="2018-07-05T01:02:19+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="425" property="og:image:height"/>
<meta content="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4569" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-encoder-decoder-model-sequence-sequence-prediction-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-encoder-decoder-model-sequence-sequence-prediction-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4569 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Want help with LSTMs? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4569 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-11-02T05:00:26+1100">November 2, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4569 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+an+Encoder-Decoder+Model+for+Sequence-to-Sequence+Prediction+in+Keras&amp;url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems such as machine translation.</p>
<p>Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample code distributed with the Keras project.</p>
<p>This example can provide the basis for developing encoder-decoder LSTM models for your own sequence-to-sequence prediction problems.</p>
<p>In this tutorial, you will discover how to develop a sophisticated encoder-decoder recurrent neural network for sequence-to-sequence prediction problems with Keras.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to correctly define a sophisticated encoder-decoder model in Keras for sequence-to-sequence prediction.</li>
<li>How to define a contrived yet scalable sequence-to-sequence prediction problem that you can use to evaluate the encoder-decoder LSTM model.</li>
<li>How to apply the encoder-decoder LSTM model in Keras to address the scalable integer sequence-to-sequence prediction problem.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4570" style="width: 650px"><img alt="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" class="size-full wp-image-4570" height="425" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras-300x199.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras<br/>Photo by <a href="https://www.flickr.com/photos/damescalito/35370558025/">Björn Groß</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 3 parts; they are:</p>
<ul>
<li>Encoder-Decoder Model in Keras</li>
<li>Scalable Sequence-to-Sequence Problem</li>
<li>Encoder-Decoder LSTM for Sequence Prediction</li>
</ul>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this tutorial.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<h2>Encoder-Decoder Model in Keras</h2>
<p>The encoder-decoder model is a way of organizing recurrent neural networks for sequence-to-sequence prediction problems.</p>
<p>It was originally developed for machine translation problems, although it has proven successful at related sequence-to-sequence prediction problems such as text summarization and question answering.</p>
<p>The approach involves two recurrent neural networks, one to encode the source sequence, called the encoder, and a second to decode the encoded source sequence into the target sequence, called the decoder.</p>
<p>The Keras deep learning Python library provides an example of how to implement the encoder-decoder model for machine translation (<a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">lstm_seq2seq.py</a>) described by the libraries creator in the post: “<a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a>.”</p>
<p>For a detailed breakdown of this model see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</a></li>
</ul>
<p>For more information on the use of return_state, which might be new to you, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/return-sequences-and-return-states-for-lstms-in-keras/">Understand the Difference Between Return Sequences and Return States for LSTMs in Keras</a></li>
</ul>
<p>For more help getting started with the Keras Functional API, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/">How to Use the Keras Functional API for Deep Learning</a></li>
</ul>
<p>Using the code in that example as a starting point, we can develop a generic function to define an encoder-decoder recurrent neural network. Below is this function named <em>define_models()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031428666776558" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# returns train, inference_encoder and inference_decoder models
def define_models(n_input, n_output, n_units):
	# define training encoder
	encoder_inputs = Input(shape=(None, n_input))
	encoder = LSTM(n_units, return_state=True)
	encoder_outputs, state_h, state_c = encoder(encoder_inputs)
	encoder_states = [state_h, state_c]
	# define training decoder
	decoder_inputs = Input(shape=(None, n_output))
	decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True)
	decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
	decoder_dense = Dense(n_output, activation='softmax')
	decoder_outputs = decoder_dense(decoder_outputs)
	model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
	# define inference encoder
	encoder_model = Model(encoder_inputs, encoder_states)
	# define inference decoder
	decoder_state_input_h = Input(shape=(n_units,))
	decoder_state_input_c = Input(shape=(n_units,))
	decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
	decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)
	decoder_states = [state_h, state_c]
	decoder_outputs = decoder_dense(decoder_outputs)
	decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)
	# return all models
	return model, encoder_model, decoder_model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7e031428666776558-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031428666776558-26">26</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031428666776558-1"><span class="crayon-p"># returns train, inference_encoder and inference_decoder models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-2"><span class="crayon-e">def </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-3"><span class="crayon-h"> </span><span class="crayon-p"># define training encoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-4"><span class="crayon-h"> </span><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-5"><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-6"><span class="crayon-h"> </span><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-7"><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-8"><span class="crayon-h"> </span><span class="crayon-p"># define training decoder</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-9"><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-10"><span class="crayon-h"> </span><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-11"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-12"><span class="crayon-h"> </span><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-13"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-15"><span class="crayon-h"> </span><span class="crayon-p"># define inference encoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-16"><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-17"><span class="crayon-h"> </span><span class="crayon-p"># define inference decoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-18"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-19"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-20"><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-21"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-22"><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-23"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-24"><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031428666776558-25"><span class="crayon-h"> </span><span class="crayon-p"># return all models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031428666776558-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>The function takes 3 arguments, as follows:</p>
<ul>
<li><strong>n_input</strong>: The cardinality of the input sequence, e.g. number of features, words, or characters for each time step.</li>
<li><strong>n_output</strong>: The cardinality of the output sequence, e.g. number of features, words, or characters for each time step.</li>
<li><strong>n_units</strong>: The number of cells to create in the encoder and decoder models, e.g. 128 or 256.</li>
</ul>
<p>The function then creates and returns 3 models, as follows:</p>
<ul>
<li><strong>train</strong>: Model that can be trained given source, target, and shifted target sequences.</li>
<li><strong>inference_encoder</strong>: Encoder model used when making a prediction for a new source sequence.</li>
<li><strong>inference_decoder</strong> Decoder model use when making a prediction for a new source sequence.</li>
</ul>
<p>The model is trained given source and target sequences where the model takes both the source and a shifted version of the target sequence as input and predicts the whole target sequence.</p>
<p>For example, one source sequence may be [1,2,3] and the target sequence [4,5,6]. The inputs and outputs to the model during training would be:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031432417716058" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Input1: ['1', '2', '3']
Input2: ['_', '4', '5']
Output: ['4', '5', '6']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031432417716058-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031432417716058-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031432417716058-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031432417716058-1">Input1: ['1', '2', '3']</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031432417716058-2">Input2: ['_', '4', '5']</div><div class="crayon-line" id="crayon-5c0ca7e031432417716058-3">Output: ['4', '5', '6']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The model is intended to be called recursively when generating target sequences for new source sequences.</p>
<p>The source sequence is encoded and the target sequence is generated one element at a time, using a “start of sequence” character such as ‘_’ to start the process. Therefore, in the above case, the following input-output pairs would occur during training:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031434484130887" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
t, 	Input1,				Input2,		Output
1,  ['1', '2', '3'],	'_',		'4'
2,  ['1', '2', '3'],	'4',		'5'
3,  ['1', '2', '3'],	'5',		'6'</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031434484130887-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031434484130887-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031434484130887-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031434484130887-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031434484130887-1">t, 	Input1,				Input2,		Output</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031434484130887-2">1,  ['1', '2', '3'],	'_',		'4'</div><div class="crayon-line" id="crayon-5c0ca7e031434484130887-3">2,  ['1', '2', '3'],	'4',		'5'</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031434484130887-4">3,  ['1', '2', '3'],	'5',		'6'</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Here you can see how the recursive use of the model can be used to build up output sequences.</p>
<p>During prediction, the <em>inference_encoder</em> model is used to encode the input sequence once which returns states that are used to initialize the <em>inference_decoder</em> model. From that point, the <em>inference_decoder</em> model is used to generate predictions step by step.</p>
<p>The function below named <em>predict_sequence()</em> can be used after the model is trained to generate a target sequence given a source sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031436977760044" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate target given source sequence
def predict_sequence(infenc, infdec, source, n_steps, cardinality):
	# encode
	state = infenc.predict(source)
	# start of sequence input
	target_seq = array([0.0 for _ in range(cardinality)]).reshape(1, 1, cardinality)
	# collect predictions
	output = list()
	for t in range(n_steps):
		# predict next char
		yhat, h, c = infdec.predict([target_seq] + state)
		# store prediction
		output.append(yhat[0,0,:])
		# update state
		state = [h, c]
		# update target sequence
		target_seq = yhat
	return array(output)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e031436977760044-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031436977760044-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031436977760044-1"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-2"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-3"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-4"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-5"><span class="crayon-h"> </span><span class="crayon-p"># start of sequence input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-6"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-7"><span class="crayon-h"> </span><span class="crayon-p"># collect predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-8"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-10"><span class="crayon-h"> </span><span class="crayon-p"># predict next char</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-11"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_seq</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-12"><span class="crayon-h"> </span><span class="crayon-p"># store prediction</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-13"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-14"><span class="crayon-h"> </span><span class="crayon-p"># update state</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-15"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-16"><span class="crayon-h"> </span><span class="crayon-p"># update target sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e031436977760044-17"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031436977760044-18"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>This function takes 5 arguments as follows:</p>
<ul>
<li><strong>infenc</strong>: Encoder model used when making a prediction for a new source sequence.</li>
<li><strong>infdec</strong>: Decoder model use when making a prediction for a new source sequence.</li>
<li><strong>source</strong>:Encoded source sequence.</li>
<li><strong>n_steps</strong>: Number of time steps in the target sequence.</li>
<li><strong>cardinality</strong>: The cardinality of the output sequence, e.g. the number of features, words, or characters for each time step.</li>
</ul>
<p>The function then returns a list containing the target sequence.</p>
<h2>Scalable Sequence-to-Sequence Problem</h2>
<p>In this section, we define a contrived and scalable sequence-to-sequence prediction problem.</p>
<p>The source sequence is a series of randomly generated integer values, such as [20, 36, 40, 10, 34, 28], and the target sequence is a reversed pre-defined subset of the input sequence, such as the first 3 elements in reverse order [40, 36, 20].</p>
<p>The length of the source sequence is configurable; so is the cardinality of the input and output sequence and the length of the target sequence.</p>
<p>We will use source sequences of 6 elements, a cardinality of 50, and target sequences of 3 elements.</p>
<p>Below are some more examples to make this concrete.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031438771958683" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Source,						Target
[13, 28, 18, 7, 9, 5]		[18, 28, 13]
[29, 44, 38, 15, 26, 22]	[38, 44, 29]
[27, 40, 31, 29, 32, 1]		[31, 40, 27]
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031438771958683-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031438771958683-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031438771958683-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031438771958683-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031438771958683-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031438771958683-1">Source,						Target</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031438771958683-2">[13, 28, 18, 7, 9, 5]		[18, 28, 13]</div><div class="crayon-line" id="crayon-5c0ca7e031438771958683-3">[29, 44, 38, 15, 26, 22]	[38, 44, 29]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031438771958683-4">[27, 40, 31, 29, 32, 1]		[31, 40, 27]</div><div class="crayon-line" id="crayon-5c0ca7e031438771958683-5">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>You are encouraged to explore larger and more complex variations. Post your findings in the comments below.</p>
<p>Let’s start off by defining a function to generate a sequence of random integers.</p>
<p>We will use the value of 0 as the padding or start of sequence character, therefore it is reserved and we cannot use it in our source sequences. To achieve this, we will add 1 to our configured cardinality to ensure the one-hot encoding is large enough (e.g. a value of 1 maps to a ‘1’ value in index 1).</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e03143d774317750" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_features = 50 + 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e03143d774317750-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e03143d774317750-1"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can use the <em>randint()</em> python function to generate random integers in a range between 1 and 1-minus the size of the problem’s cardinality. The <em>generate_sequence()</em> below generates a sequence of random integers.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e03143f294465522" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(1, n_unique-1) for _ in range(length)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e03143f294465522-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03143f294465522-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e03143f294465522-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e03143f294465522-1"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03143f294465522-2"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e03143f294465522-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we need to create the corresponding output sequence given the source sequence.</p>
<p>To keep thing simple, we will select the first n elements of the source sequence as the target sequence and reverse them.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031441766967295" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define target sequence
target = source[:n_out]
target.reverse()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031441766967295-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031441766967295-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031441766967295-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031441766967295-1"><span class="crayon-p"># define target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031441766967295-2"><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031441766967295-3"><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We also need a version of the output sequence shifted forward by one time step that we can use as the mock target generated so far, including the start of sequence value in the first time step. We can create this from the target sequence directly.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031442132807311" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create padded input target sequence
target_in = [0] + target[:-1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031442132807311-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031442132807311-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031442132807311-1"><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031442132807311-2"><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Now that all of the sequences have been defined, we can one-hot encode them, i.e. transform them into sequences of binary vectors. We can use the Keras built in <em>to_categorical()</em> function to achieve this.</p>
<p>We can put all of this into a function named <em>get_dataset()</em> that will generate a specific number of sequences that we can use to train a model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031444210192957" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare data for the LSTM
def get_dataset(n_in, n_out, cardinality, n_samples):
	X1, X2, y = list(), list(), list()
	for _ in range(n_samples):
		# generate source sequence
		source = generate_sequence(n_in, cardinality)
		# define target sequence
		target = source[:n_out]
		target.reverse()
		# create padded input target sequence
		target_in = [0] + target[:-1]
		# encode
		src_encoded = to_categorical([source], num_classes=cardinality)
		tar_encoded = to_categorical([target], num_classes=cardinality)
		tar2_encoded = to_categorical([target_in], num_classes=cardinality)
		# store
		X1.append(src_encoded)
		X2.append(tar2_encoded)
		y.append(tar_encoded)
	return array(X1), array(X2), array(y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e031444210192957-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031444210192957-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031444210192957-1"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-2"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-3"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-5"><span class="crayon-h"> </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-6"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-7"><span class="crayon-h"> </span><span class="crayon-p"># define target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-8"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-9"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-10"><span class="crayon-h"> </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-11"><span class="crayon-h"> </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-12"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-13"><span class="crayon-h"> </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-14"><span class="crayon-h"> </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-15"><span class="crayon-h"> </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-16"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-17"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-18"><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031444210192957-19"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031444210192957-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Finally, we need to be able to decode a one-hot encoded sequence to make it readable again.</p>
<p>This is needed for both printing the generated target sequences but also for easily comparing whether the full predicted target sequence matches the expected target sequence. The <em>one_hot_decode()</em> function will decode an encoded sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031446269647540" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031446269647540-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031446269647540-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031446269647540-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031446269647540-1"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031446269647540-2"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031446269647540-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can tie all of this together and test these functions.</p>
<p>A complete worked example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031448034712306" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from keras.utils import to_categorical

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(1, n_unique-1) for _ in range(length)]

# prepare data for the LSTM
def get_dataset(n_in, n_out, cardinality, n_samples):
	X1, X2, y = list(), list(), list()
	for _ in range(n_samples):
		# generate source sequence
		source = generate_sequence(n_in, cardinality)
		# define target sequence
		target = source[:n_out]
		target.reverse()
		# create padded input target sequence
		target_in = [0] + target[:-1]
		# encode
		src_encoded = to_categorical([source], num_classes=cardinality)
		tar_encoded = to_categorical([target], num_classes=cardinality)
		tar2_encoded = to_categorical([target_in], num_classes=cardinality)
		# store
		X1.append(src_encoded)
		X2.append(tar2_encoded)
		y.append(tar_encoded)
	return array(X1), array(X2), array(y)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# configure problem
n_features = 50 + 1
n_steps_in = 6
n_steps_out = 3
# generate a single source and target sequence
X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
print(X1.shape, X2.shape, y.shape)
print('X1=%s, X2=%s, y=%s' % (one_hot_decode(X1[0]), one_hot_decode(X2[0]), one_hot_decode(y[0])))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7e031448034712306-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031448034712306-42">42</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031448034712306-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">to_categorical</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-6"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-7"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-10"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-11"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-12"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-14"><span class="crayon-h"> </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-15"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-16"><span class="crayon-h"> </span><span class="crayon-p"># define target sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-17"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-18"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-19"><span class="crayon-h"> </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-20"><span class="crayon-h"> </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-21"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-22"><span class="crayon-h"> </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-23"><span class="crayon-h"> </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-24"><span class="crayon-h"> </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-25"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-26"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-27"><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-28"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-30"> </div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-31"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-32"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-34"> </div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-35"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-36"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-37"><span class="crayon-v">n_steps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-38"><span class="crayon-v">n_steps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-39"><span class="crayon-p"># generate a single source and target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-40"><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031448034712306-41"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031448034712306-42"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'X1=%s, X2=%s, y=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>Running the example first prints the shape of the generated dataset, ensuring the 3D shape required to train the model matches our expectations.</p>
<p>The generated sequence is then decoded and printed to screen demonstrating both that the preparation of source and target sequences matches our intention and that the decode operation is working.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e03144a186592082" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(1, 6, 51) (1, 3, 51) (1, 3, 51)
X1=[32, 16, 12, 34, 25, 24], X2=[0, 12, 16], y=[12, 16, 32]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e03144a186592082-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03144a186592082-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e03144a186592082-1">(1, 6, 51) (1, 3, 51) (1, 3, 51)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03144a186592082-2">X1=[32, 16, 12, 34, 25, 24], X2=[0, 12, 16], y=[12, 16, 32]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We are now ready to develop a model for this sequence-to-sequence prediction problem.</p>
<h2>Encoder-Decoder LSTM for Sequence Prediction</h2>
<p>In this section, we will apply the encoder-decoder LSTM model developed in the first section to the sequence-to-sequence prediction problem developed in the second section.</p>
<p>The first step is to configure the problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e03144c834726433" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# configure problem
n_features = 50 + 1
n_steps_in = 6
n_steps_out = 3</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e03144c834726433-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03144c834726433-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e03144c834726433-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03144c834726433-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e03144c834726433-1"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03144c834726433-2"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7e03144c834726433-3"><span class="crayon-v">n_steps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03144c834726433-4"><span class="crayon-v">n_steps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Next, we must define the models and compile the training model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e03144e316480773" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
train, infenc, infdec = define_models(n_features, n_features, 128)
train.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['acc'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e03144e316480773-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03144e316480773-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e03144e316480773-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e03144e316480773-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03144e316480773-2"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">128</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e03144e316480773-3"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we can generate a training dataset of 100,000 examples and train the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031450848863317" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate training dataset
X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 100000)
print(X1.shape,X2.shape,y.shape)
# train model
train.fit([X1, X2], y, epochs=1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031450848863317-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031450848863317-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031450848863317-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031450848863317-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031450848863317-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031450848863317-1"><span class="crayon-p"># generate training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031450848863317-2"><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100000</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031450848863317-3"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031450848863317-4"><span class="crayon-p"># train model</span></div><div class="crayon-line" id="crayon-5c0ca7e031450848863317-5"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Once the model is trained, we can evaluate it. We will do this by making predictions for 100 source sequences and counting the number of target sequences that were predicted correctly. We will use the numpy <em>array_equal()</em> function on the decoded sequences to check for equality.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031452392684633" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate LSTM
total, correct = 100, 0
for _ in range(total):
	X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
	target = predict_sequence(infenc, infdec, X1, n_steps_out, n_features)
	if array_equal(one_hot_decode(y[0]), one_hot_decode(target)):
		correct += 1
print('Accuracy: %.2f%%' % (float(correct)/float(total)*100.0))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031452392684633-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031452392684633-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031452392684633-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031452392684633-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031452392684633-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031452392684633-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e031452392684633-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031452392684633-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031452392684633-1"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031452392684633-2"><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c0ca7e031452392684633-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031452392684633-4"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031452392684633-5"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031452392684633-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031452392684633-7"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031452392684633-8"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Finally, we will generate some predictions and print the decoded source, target, and predicted target sequences to get an idea of whether the model is working as expected.</p>
<p>Putting all of these elements together, the complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031453525513455" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from numpy import array_equal
from keras.utils import to_categorical
from keras.models import Model
from keras.layers import Input
from keras.layers import LSTM
from keras.layers import Dense

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(1, n_unique-1) for _ in range(length)]

# prepare data for the LSTM
def get_dataset(n_in, n_out, cardinality, n_samples):
	X1, X2, y = list(), list(), list()
	for _ in range(n_samples):
		# generate source sequence
		source = generate_sequence(n_in, cardinality)
		# define padded target sequence
		target = source[:n_out]
		target.reverse()
		# create padded input target sequence
		target_in = [0] + target[:-1]
		# encode
		src_encoded = to_categorical([source], num_classes=cardinality)
		tar_encoded = to_categorical([target], num_classes=cardinality)
		tar2_encoded = to_categorical([target_in], num_classes=cardinality)
		# store
		X1.append(src_encoded)
		X2.append(tar2_encoded)
		y.append(tar_encoded)
	return array(X1), array(X2), array(y)

# returns train, inference_encoder and inference_decoder models
def define_models(n_input, n_output, n_units):
	# define training encoder
	encoder_inputs = Input(shape=(None, n_input))
	encoder = LSTM(n_units, return_state=True)
	encoder_outputs, state_h, state_c = encoder(encoder_inputs)
	encoder_states = [state_h, state_c]
	# define training decoder
	decoder_inputs = Input(shape=(None, n_output))
	decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True)
	decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
	decoder_dense = Dense(n_output, activation='softmax')
	decoder_outputs = decoder_dense(decoder_outputs)
	model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
	# define inference encoder
	encoder_model = Model(encoder_inputs, encoder_states)
	# define inference decoder
	decoder_state_input_h = Input(shape=(n_units,))
	decoder_state_input_c = Input(shape=(n_units,))
	decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
	decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)
	decoder_states = [state_h, state_c]
	decoder_outputs = decoder_dense(decoder_outputs)
	decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)
	# return all models
	return model, encoder_model, decoder_model

# generate target given source sequence
def predict_sequence(infenc, infdec, source, n_steps, cardinality):
	# encode
	state = infenc.predict(source)
	# start of sequence input
	target_seq = array([0.0 for _ in range(cardinality)]).reshape(1, 1, cardinality)
	# collect predictions
	output = list()
	for t in range(n_steps):
		# predict next char
		yhat, h, c = infdec.predict([target_seq] + state)
		# store prediction
		output.append(yhat[0,0,:])
		# update state
		state = [h, c]
		# update target sequence
		target_seq = yhat
	return array(output)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# configure problem
n_features = 50 + 1
n_steps_in = 6
n_steps_out = 3
# define model
train, infenc, infdec = define_models(n_features, n_features, 128)
train.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['acc'])
# generate training dataset
X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 100000)
print(X1.shape,X2.shape,y.shape)
# train model
train.fit([X1, X2], y, epochs=1)
# evaluate LSTM
total, correct = 100, 0
for _ in range(total):
	X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
	target = predict_sequence(infenc, infdec, X1, n_steps_out, n_features)
	if array_equal(one_hot_decode(y[0]), one_hot_decode(target)):
		correct += 1
print('Accuracy: %.2f%%' % (float(correct)/float(total)*100.0))
# spot check some examples
for _ in range(10):
	X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
	target = predict_sequence(infenc, infdec, X1, n_steps_out, n_features)
	print('X=%s y=%s, yhat=%s' % (one_hot_decode(X1[0]), one_hot_decode(y[0]), one_hot_decode(target)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-22">22</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-24">24</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-26">26</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-28">28</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-30">30</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-32">32</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-34">34</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-36">36</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-38">38</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-40">40</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-42">42</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-44">44</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-46">46</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-48">48</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-50">50</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-52">52</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-54">54</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-56">56</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-58">58</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-60">60</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-62">62</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-64">64</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-66">66</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-68">68</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-70">70</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-72">72</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-74">74</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-76">76</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-78">78</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-80">80</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-82">82</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-84">84</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-86">86</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-88">88</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-90">90</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-92">92</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-94">94</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-96">96</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-98">98</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-100">100</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-102">102</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-104">104</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-106">106</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-108">108</div><div class="crayon-num" data-line="crayon-5c0ca7e031453525513455-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e031453525513455-110">110</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031453525513455-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">array_equal</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-10"> </div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-11"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-12"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-14"> </div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-15"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-16"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-17"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-18"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-19"><span class="crayon-h"> </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-20"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-21"><span class="crayon-h"> </span><span class="crayon-p"># define padded target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-22"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-23"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-24"><span class="crayon-h"> </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-25"><span class="crayon-h"> </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-26"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-27"><span class="crayon-h"> </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-28"><span class="crayon-h"> </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-29"><span class="crayon-h"> </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-30"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-31"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-32"><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-33"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-34"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-36"><span class="crayon-p"># returns train, inference_encoder and inference_decoder models</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-37"><span class="crayon-e">def </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-38"><span class="crayon-h"> </span><span class="crayon-p"># define training encoder</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-39"><span class="crayon-h"> </span><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-40"><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-41"><span class="crayon-h"> </span><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-42"><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-43"><span class="crayon-h"> </span><span class="crayon-p"># define training decoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-44"><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-45"><span class="crayon-h"> </span><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-46"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-47"><span class="crayon-h"> </span><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-48"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-49"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-50"><span class="crayon-h"> </span><span class="crayon-p"># define inference encoder</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-51"><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-52"><span class="crayon-h"> </span><span class="crayon-p"># define inference decoder</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-53"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-54"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-55"><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-56"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-57"><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-58"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-59"><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-60"><span class="crayon-h"> </span><span class="crayon-p"># return all models</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-61"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-62"> </div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-63"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-64"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-65"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-66"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-67"><span class="crayon-h"> </span><span class="crayon-p"># start of sequence input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-68"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-69"><span class="crayon-h"> </span><span class="crayon-p"># collect predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-70"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-71"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-72"><span class="crayon-h"> </span><span class="crayon-p"># predict next char</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-73"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_seq</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-74"><span class="crayon-h"> </span><span class="crayon-p"># store prediction</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-75"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-76"><span class="crayon-h"> </span><span class="crayon-p"># update state</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-77"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-78"><span class="crayon-h"> </span><span class="crayon-p"># update target sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-79"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-80"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-82"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-83"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-84"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-85"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-86"><span class="crayon-p"># configure problem</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-87"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-88"><span class="crayon-v">n_steps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">6</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-89"><span class="crayon-v">n_steps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-90"><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-91"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">128</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-92"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-93"><span class="crayon-p"># generate training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-94"><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100000</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-95"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-96"><span class="crayon-p"># train model</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-97"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-98"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-99"><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-100"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-101"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-102"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-103"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-104"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-105"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-106"><span class="crayon-p"># spot check some examples</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-107"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-108"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e031453525513455-109"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e031453525513455-110"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'X=%s y=%s, yhat=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0068 seconds] -->
<p>Running the example first prints the shape of the prepared dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031455323997086" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(100000, 6, 51) (100000, 3, 51) (100000, 3, 51)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031455323997086-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031455323997086-1">(100000, 6, 51) (100000, 3, 51) (100000, 3, 51)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Next, the model is fit. You should see a progress bar and the run should take less than one minute on a modern multi-core CPU.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e031458431896180" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
100000/100000 [==============================] - 50s - loss: 0.6344 - acc: 0.7968</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e031458431896180-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e031458431896180-1">100000/100000 [==============================] - 50s - loss: 0.6344 - acc: 0.7968</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Next, the model is evaluated and the accuracy printed. We can see that the model achieves 100% accuracy on new randomly generated examples.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e03145a066659215" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Accuracy: 100.00%</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e03145a066659215-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e03145a066659215-1">Accuracy: 100.00%</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Finally, 10 new examples are generated and target sequences are predicted. Again, we can see that the model correctly predicts the output sequence in each case and the expected value matches the reversed first 3 elements of the source sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e03145c987977112" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X=[22, 17, 23, 5, 29, 11] y=[23, 17, 22], yhat=[23, 17, 22]
X=[28, 2, 46, 12, 21, 6] y=[46, 2, 28], yhat=[46, 2, 28]
X=[12, 20, 45, 28, 18, 42] y=[45, 20, 12], yhat=[45, 20, 12]
X=[3, 43, 45, 4, 33, 27] y=[45, 43, 3], yhat=[45, 43, 3]
X=[34, 50, 21, 20, 11, 6] y=[21, 50, 34], yhat=[21, 50, 34]
X=[47, 42, 14, 2, 31, 6] y=[14, 42, 47], yhat=[14, 42, 47]
X=[20, 24, 34, 31, 37, 25] y=[34, 24, 20], yhat=[34, 24, 20]
X=[4, 35, 15, 14, 47, 33] y=[15, 35, 4], yhat=[15, 35, 4]
X=[20, 28, 21, 39, 5, 25] y=[21, 28, 20], yhat=[21, 28, 20]
X=[50, 38, 17, 25, 31, 48] y=[17, 38, 50], yhat=[17, 38, 50]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e03145c987977112-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03145c987977112-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e03145c987977112-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03145c987977112-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e03145c987977112-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03145c987977112-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e03145c987977112-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03145c987977112-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e03145c987977112-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e03145c987977112-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e03145c987977112-1">X=[22, 17, 23, 5, 29, 11] y=[23, 17, 22], yhat=[23, 17, 22]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03145c987977112-2">X=[28, 2, 46, 12, 21, 6] y=[46, 2, 28], yhat=[46, 2, 28]</div><div class="crayon-line" id="crayon-5c0ca7e03145c987977112-3">X=[12, 20, 45, 28, 18, 42] y=[45, 20, 12], yhat=[45, 20, 12]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03145c987977112-4">X=[3, 43, 45, 4, 33, 27] y=[45, 43, 3], yhat=[45, 43, 3]</div><div class="crayon-line" id="crayon-5c0ca7e03145c987977112-5">X=[34, 50, 21, 20, 11, 6] y=[21, 50, 34], yhat=[21, 50, 34]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03145c987977112-6">X=[47, 42, 14, 2, 31, 6] y=[14, 42, 47], yhat=[14, 42, 47]</div><div class="crayon-line" id="crayon-5c0ca7e03145c987977112-7">X=[20, 24, 34, 31, 37, 25] y=[34, 24, 20], yhat=[34, 24, 20]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03145c987977112-8">X=[4, 35, 15, 14, 47, 33] y=[15, 35, 4], yhat=[15, 35, 4]</div><div class="crayon-line" id="crayon-5c0ca7e03145c987977112-9">X=[20, 28, 21, 39, 5, 25] y=[21, 28, 20], yhat=[21, 28, 20]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e03145c987977112-10">X=[50, 38, 17, 25, 31, 48] y=[17, 38, 50], yhat=[17, 38, 50]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>You now have a template for an encoder-decoder LSTM model that you can apply to your own sequence-to-sequence prediction problems.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>Related Posts</h3>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
<li><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</a></li>
<li><a href="https://machinelearningmastery.com/return-sequences-and-return-states-for-lstms-in-keras/">Understand the Difference Between Return Sequences and Return States for LSTMs in Keras</a></li>
<li><a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/">How to Use the Keras Functional API for Deep Learning</a></li>
</ul>
<h3>Keras Resources</h3>
<ul>
<li><a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a></li>
<li><a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">Keras seq2seq Code Example (lstm_seq2seq)</a></li>
<li><a href="https://keras.io/getting-started/functional-api-guide/">Keras Functional API</a></li>
<li><a href="https://keras.io/layers/recurrent/#lstm">LSTM API in Keras</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop an encoder-decoder recurrent neural network for sequence-to-sequence prediction problems with Keras.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to correctly define a sophisticated encoder-decoder model in Keras for sequence-to-sequence prediction.</li>
<li>How to define a contrived yet scalable sequence-to-sequence prediction problem that you can use to evaluate the encoder-decoder LSTM model.</li>
<li>How to apply the encoder-decoder LSTM model in Keras to address the scalable integer sequence-to-sequence prediction problem.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4569 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+an+Encoder-Decoder+Model+for+Sequence-to-Sequence+Prediction+in+Keras&amp;url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/statistical-language-modeling-and-neural-language-models/" rel="prev"><i class="fa fa-angle-left"></i> Gentle Introduction to Statistical Language Modeling and Neural Language Models</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/develop-word-based-neural-language-models-python-keras/" rel="next">How to Develop Word-Based Neural Language Models in Python with Keras <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">144 Responses to <em>How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-418805">
<div class="comment-container" id="li-comment-418805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e1b745128d324ae58800448c40f5df6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e1b745128d324ae58800448c40f5df6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">November 2, 2017 at 7:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is this model suited for sequence regression too? For example the shampoo sales problem</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="#comment-418805" onclick='return addComment.moveForm( "comment-418805", "418805", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418834">
<div class="comment-container" id="li-comment-418834">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418834" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could try, but generally LSTMs do not perform well on autoregression problems:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418834" onclick='return addComment.moveForm( "comment-418834", "418834", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418808">
<div class="comment-container" id="li-comment-418808">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7dcc5ad52d0ad82e7f381d1e1fe3d169?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7dcc5ad52d0ad82e7f381d1e1fe3d169?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Teimour</span>
<span class="date">November 2, 2017 at 9:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418808" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi. is it possible to have multi layers of LSTM in encoder and decoder in this code? thank you for your great blog</p>
<div class="reply">
<a aria-label="Reply to Teimour" class="comment-reply-link" href="#comment-418808" onclick='return addComment.moveForm( "comment-418808", "418808", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418836">
<div class="comment-container" id="li-comment-418836">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418836" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but I don’t have an example. For this specific case it would require some careful re-design.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418836" onclick='return addComment.moveForm( "comment-418836", "418836", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418813">
<div class="comment-container" id="li-comment-418813">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7d2717facbef20886a831b0178ab64dc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7d2717facbef20886a831b0178ab64dc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kyu</span>
<span class="date">November 3, 2017 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418813" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How can I extract the bottleneck layer to extract the important features with sequence data?</p>
<div class="reply">
<a aria-label="Reply to Kyu" class="comment-reply-link" href="#comment-418813" onclick='return addComment.moveForm( "comment-418813", "418813", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418840">
<div class="comment-container" id="li-comment-418840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could access the returned states to get the context vector, but it does not help you understand which input features are relevant/important.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418840" onclick='return addComment.moveForm( "comment-418840", "418840", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418826">
<div class="comment-container" id="li-comment-418826">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">November 3, 2017 at 4:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418826" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason!</p>
<div class="reply">
<a aria-label="Reply to Thabet" class="comment-reply-link" href="#comment-418826" onclick='return addComment.moveForm( "comment-418826", "418826", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418846">
<div class="comment-container" id="li-comment-418846">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418846" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-418846" onclick='return addComment.moveForm( "comment-418846", "418846", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-420395">
<div class="comment-container" id="li-comment-420395">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harry Garrison</span>
<span class="date">November 18, 2017 at 3:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-420395" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the wonderful tutorial, Jason!<br/>
I am facing an issue, though: I tried to execute your code as is (copy-pasted it), but it throws an error:</p>
<p>Using TensorFlow backend.<br/>
Traceback (most recent call last):<br/>
  File “C:\Users\User\Documents\pystuff\keras_auto.py”, line 91, in<br/>
    train, infenc, infdec = define_models(n_features, n_features, 128)<br/>
  File “C:\Users\User\Documents\pystuff\keras_auto.py”, line 40, in define_models<br/>
    encoder = LSTM(n_units, return_state=True)<br/>
  File “C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\legacy\interfaces.py”, line 88, in wrapper<br/>
    return func(*args, **kwargs)<br/>
  File “C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\layers\recurrent.py”, line 949, in __init__<br/>
    super(LSTM, self).__init__(**kwargs)<br/>
  File C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\layers\recurrent.py”, line 191, in __init__<br/>
    super(Recurrent, self).__init__(**kwargs)<br/>
  File “C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\engine\topology.py”, line 281, in __init__<br/>
    raise TypeError(‘Keyword argument not understood:’, kwarg)<br/>
TypeError: (‘Keyword argument not understood:’, ‘return_state’)</p>
<p>I am using an anaconda environment (python 3.5.3). What could have possibly gone wrong?</p>
<div class="reply">
<a aria-label="Reply to Harry Garrison" class="comment-reply-link" href="#comment-420395" onclick='return addComment.moveForm( "comment-420395", "420395", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420431">
<div class="comment-container" id="li-comment-420431">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 18, 2017 at 10:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-420431" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps confirm that you have the most recent version of Keras and TensorFlow installed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-420431" onclick='return addComment.moveForm( "comment-420431", "420431", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-422484">
<div class="comment-container" id="li-comment-422484">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Carolyn</span>
<span class="date">December 8, 2017 at 12:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422484" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I had the same problem, and updated Keras (to version 2.1.2) and TensorFlow (to version 1.4.0). The problem above was solved. However, I now see that the shapes of X1, X2, and y are ((100000, 1, 6, 51), (100000, 1, 3, 51), (100000, 1, 3, 51)) instead of ((100000, 6, 51), (100000, 3, 51), (100000, 3, 51)). Why could this be?</p>
<div class="reply">
<a aria-label="Reply to Carolyn" class="comment-reply-link" href="#comment-422484" onclick='return addComment.moveForm( "comment-422484", "422484", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-422495">
<div class="comment-container" id="li-comment-422495">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 8, 2017 at 2:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422495" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure, perhaps related to recent API changes in Keras?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-422495" onclick='return addComment.moveForm( "comment-422495", "422495", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-422521">
<div class="comment-container" id="li-comment-422521">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Carolyn</span>
<span class="date">December 9, 2017 at 1:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422521" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here’s how I fixed the problem.</p>
<p>At the top of the code, include this line (before any ‘from numpy import’ statements:</p>
<p>import numpy as np</p>
<p>Change the get_dataset() function to the following:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e034783030029680" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def get_dataset(n_in, n_out, cardinality, n_samples):
        X1, X2, y = list(), list(), list()
        for _ in range(n_samples):
                # generate source sequence
                source = generate_sequence(n_in, cardinality)
                # define padded target sequence
                target = source[:n_out]
                target.reverse()
                # create padded input target sequence
                target_in = [0] + target[:-1]
                # encode
                src_encoded = to_categorical([source], num_classes=cardinality)
                tar_encoded = to_categorical([target], num_classes=cardinality)
                tar2_encoded = to_categorical([target_in], num_classes=cardinality)
                # store
                X1.append(src_encoded)
                X2.append(tar2_encoded)
                y.append(tar_encoded)
        X1 = np.squeeze(array(X1), axis=1) 
        X2 = np.squeeze(array(X2), axis=1) 
        y = np.squeeze(array(y), axis=1) 
        return X1, X2, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-18">18</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-20">20</div><div class="crayon-num" data-line="crayon-5c0ca7e034783030029680-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034783030029680-22">22</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e034783030029680-1"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-2"><span class="crayon-h">        </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-3"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-4"><span class="crayon-h">                </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-5"><span class="crayon-h">                </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-6"><span class="crayon-h">                </span><span class="crayon-p"># define padded target sequence</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-7"><span class="crayon-h">                </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-8"><span class="crayon-h">                </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-9"><span class="crayon-h">                </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-10"><span class="crayon-h">                </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-11"><span class="crayon-h">                </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-12"><span class="crayon-h">                </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-13"><span class="crayon-h">                </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-14"><span class="crayon-h">                </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-15"><span class="crayon-h">                </span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-16"><span class="crayon-h">                </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-17"><span class="crayon-h">                </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-18"><span class="crayon-h">                </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-19"><span class="crayon-h">        </span><span class="crayon-v">X1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">squeeze</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-20"><span class="crayon-h">        </span><span class="crayon-v">X2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">squeeze</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5c0ca7e034783030029680-21"><span class="crayon-h">        </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">squeeze</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034783030029680-22"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p>
<p>Notice instead of returning array(X1), array(X2), array(y), we now return arrays that have been squeezed – one axis has been removed. We remove axis 1 because it’s the wrong shape for what we need.</p>
<p>The output is now as it should be (although I’m getting 98% accuracy instead of 100%).</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-422541">
<div class="comment-container" id="li-comment-422541">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 9, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422541" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing.</p>
<p>Perhaps confirm that you have updated Keras to 2.1.2, it fixes bugs with to_categorical()?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421212">
<div class="comment-container" id="li-comment-421212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">November 26, 2017 at 8:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!<br/>
Are the encoder-decoder networks suitable for time series classification?</p>
<div class="reply">
<a aria-label="Reply to Thabet" class="comment-reply-link" href="#comment-421212" onclick='return addComment.moveForm( "comment-421212", "421212", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421277">
<div class="comment-container" id="li-comment-421277">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2017 at 5:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421277" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In my experience LSTMs have not proven effective at autoregression compared to MLPs.</p>
<p>See this post for more details:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421277" onclick='return addComment.moveForm( "comment-421277", "421277", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-449323">
<div class="comment-container" id="li-comment-449323">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7ada96dad7fe7339f58e42cf1b492a1a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7ada96dad7fe7339f58e42cf1b492a1a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">angelfight</span>
<span class="date">September 19, 2018 at 5:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-449323" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>for people later, you don’ t need to use squeeze, </p>
<p>Let ‘s try:<br/>
from<br/>
src_encoded = to_categorical([source], num_classes=cardinality)<br/>
tar_encoded = to_categorical([target], num_classes=cardinality)<br/>
tar2_encoded = to_categorical([target_in], num_classes=cardinality)</p>
<p>to:</p>
<p>src_encoded = to_categorical(source, num_classes=cardinality)<br/>
tar_encoded = to_categorical(target, num_classes=cardinality)<br/>
tar2_encoded = to_categorical(target_in, num_classes=cardinality)</p>
<div class="reply">
<a aria-label="Reply to angelfight" class="comment-reply-link" href="#comment-449323" onclick='return addComment.moveForm( "comment-449323", "449323", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-449360">
<div class="comment-container" id="li-comment-449360">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 20, 2018 at 7:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-449360" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-449360" onclick='return addComment.moveForm( "comment-449360", "449360", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-421754">
<div class="comment-container" id="li-comment-421754">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/21454ff208f6cf48e95b69020266fad5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/21454ff208f6cf48e95b69020266fad5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Python</span>
<span class="date">November 30, 2017 at 11:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421754" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
running the get_dataset the function returns one additional row in the Arrays X1, X2, y:<br/>
(1,1,6,51) (1,1,3,51)(1,1,3,51).<br/>
This results form numpy.array(), before the X1, X2, y are lists with the correct sizes:<br/>
(1,6,51) (1,3,51)(1,3,51).<br/>
It seems the comand array() adds an additional dimension. Could you help on solving this problem?</p>
<div class="reply">
<a aria-label="Reply to Python" class="comment-reply-link" href="#comment-421754" onclick='return addComment.moveForm( "comment-421754", "421754", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421852">
<div class="comment-container" id="li-comment-421852">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandu</span>
<span class="date">December 1, 2017 at 6:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421852" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how to train the keras ,it has to identify capital letter and small letter has to same </p>
<p>Please suggest any tactics for it.</p>
<div class="reply">
<a aria-label="Reply to nandu" class="comment-reply-link" href="#comment-421852" onclick='return addComment.moveForm( "comment-421852", "421852", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421906">
<div class="comment-container" id="li-comment-421906">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2017 at 8:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421906" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Start by clearly defining your problem:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-421906" onclick='return addComment.moveForm( "comment-421906", "421906", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422332">
<div class="comment-container" id="li-comment-422332">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/826da901288894bd468a2a9d719bf598?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/826da901288894bd468a2a9d719bf598?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pritish Yuvraj</span>
<span class="date">December 7, 2017 at 4:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422332" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could you please give me a tutorial for a case where we are input to the seq2seq model is word embeddings and outputs is also word embeddings. I find it frustrating to see a Dense layer at the end. this is what is stopping a fully seq2seq model with input as well as output word embeddings.</p>
<div class="reply">
<a aria-label="Reply to Pritish Yuvraj" class="comment-reply-link" href="#comment-422332" onclick='return addComment.moveForm( "comment-422332", "422332", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422363">
<div class="comment-container" id="li-comment-422363">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2017 at 8:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422363" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why would we have a word embedding at the output layer?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-422363" onclick='return addComment.moveForm( "comment-422363", "422363", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-430905">
<div class="comment-container" id="li-comment-430905">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/14f3da96e85670dc1101b00ac2be69a6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/14f3da96e85670dc1101b00ac2be69a6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Uthman Apatira</span>
<span class="date">March 2, 2018 at 6:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-430905" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If embeddings are coming in, we’d want to have embeddings going out (auto-encoder). Imagine input = category (cat, dog, frog, wale, human). These animals are quite different, so we represent w/ embedding. Rather than having a dense output of 5 OHE, if an embedding is used for output, the assumption is that, especially if weights are shared between inputs + outputs, we could train the net with and give it more detail about what exactly each class is… rather than use something like cross entropy.</p>
<div class="reply">
<a aria-label="Reply to Uthman Apatira" class="comment-reply-link" href="#comment-430905" onclick='return addComment.moveForm( "comment-430905", "430905", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-430957">
<div class="comment-container" id="li-comment-430957">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 3, 2018 at 8:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-430957" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ok.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430957" onclick='return addComment.moveForm( "comment-430957", "430957", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-438545">
<div class="comment-container" id="li-comment-438545">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6ee1dcf55af01c3c4a07632f2f50c3ee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6ee1dcf55af01c3c4a07632f2f50c3ee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joe</span>
<span class="date">May 25, 2018 at 9:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438545" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is there such a tutorial yet? Sounds interesting.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-438572">
<div class="comment-container" id="li-comment-438572">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 25, 2018 at 9:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438572" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’ve not written one, I still don’t get/see benefit in the approach. Happy to be proven wrong.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-422922">
<div class="comment-container" id="li-comment-422922">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/74da881ad05a47d5dfb93c851b65f8d6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/74da881ad05a47d5dfb93c851b65f8d6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dinter</span>
<span class="date">December 13, 2017 at 12:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422922" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi ! When adding dropout and recurrent_dropout as LSTM arguments on line 40 of the last complete code example with everything else being the same, the code went wrong. So how can I add dropout in this case? Thanks!</p>
<div class="reply">
<a aria-label="Reply to Dinter" class="comment-reply-link" href="#comment-422922" onclick='return addComment.moveForm( "comment-422922", "422922", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422949">
<div class="comment-container" id="li-comment-422949">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422949" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I give a worked example of dropout with LSTMs here:<br/>
<a href="https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-422949" onclick='return addComment.moveForm( "comment-422949", "422949", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-426182">
<div class="comment-container" id="li-comment-426182">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dipesh</span>
<span class="date">January 11, 2018 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426182" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason! Thanks for your great effort to put encoder decoder implementations here. As Dinter mentioned, when dropout is added, the code runs well for training phase but gives following error during prediction.</p>
<p>InvalidArgumentError (see above for traceback): You must feed a value for placeholder tensor ‘lstm_1/keras_learning_phase’ with dtype bool<br/>
	 [[Node: lstm_1/keras_learning_phase = Placeholder[dtype=DT_BOOL, shape=, _device=”/job:localhost/replica:0/task:0/cpu:0″]()]]</p>
<p>How to fix the problem in this particular implementation?</p>
<p>[Note: Your worked example of dropout however worked for me, but the difference is you are adding layer by layer in sequential model there which is different than this example of encoder decoder]</p>
<div class="reply">
<a aria-label="Reply to Dipesh" class="comment-reply-link" href="#comment-426182" onclick='return addComment.moveForm( "comment-426182", "426182", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-426246">
<div class="comment-container" id="li-comment-426246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry to hear that, perhaps it’s a bug? See if you can reproduce the fault on a small standalone network?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426246" onclick='return addComment.moveForm( "comment-426246", "426246", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-426703">
<div class="comment-container" id="li-comment-426703">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dipesh Gautam</span>
<span class="date">January 17, 2018 at 6:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426703" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I tried with exactly the same network in the example you presented and added dropout=0.0 in line 10 and line 15 of define_models function, the program runs but for other values of dropout it gives error. Also changing the size of network, for example, number of units to 5, 10, 20 does give the same error. </p>
<p>Any idea to add dropout?</p>
<p>line 5: encoder = LSTM(n_units, return_state=True,dropout=0.0)</p>
<p>line 10: decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True,dropout=0.0)</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-426728">
<div class="comment-container" id="li-comment-426728">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 17, 2018 at 10:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426728" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this tutorial:<br/>
<a href="https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-427353">
<div class="comment-container" id="li-comment-427353">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d70f96565bc62adb459707f61cdeeaf3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d70f96565bc62adb459707f61cdeeaf3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Huzefa Calcuttawala</span>
<span class="date">January 23, 2018 at 8:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-427353" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
what is the difference between specifying the model input:<br/>
Model( [decoder_inputs] + decoder_states_inputs,….)<br/>
and this<br/>
Model([decoder_inputs,decoder_states_inputs],…)</p>
<p>Does the 1st version add the elements of decoder_states_inputs array to corresponding elements of decoder_inputs</p>
<div class="reply">
<a aria-label="Reply to Huzefa Calcuttawala" class="comment-reply-link" href="#comment-427353" onclick='return addComment.moveForm( "comment-427353", "427353", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427481">
<div class="comment-container" id="li-comment-427481">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c442e5fec2ad69d4f2995af55cbdd45f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c442e5fec2ad69d4f2995af55cbdd45f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alfredo</span>
<span class="date">January 24, 2018 at 10:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-427481" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Thanks for sharing this tutorial.  I am only confused when you are defining the model. This is the line:</p>
<p>train, infenc, infdec = define_models(n_features, n_features, 128)</p>
<p>It is a silly question but why n_features in this case is used for the n_input and for the n_output instead of n_input equal to 6 and n_output equal to 3 ?</p>
<p>I look forward to hearing from you soon.</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Alfredo" class="comment-reply-link" href="#comment-427481" onclick='return addComment.moveForm( "comment-427481", "427481", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427531">
<div class="comment-container" id="li-comment-427531">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 25, 2018 at 5:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-427531" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, because the model only does one time step per call, so we walk the input/output time steps manually.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427531" onclick='return addComment.moveForm( "comment-427531", "427531", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-430231">
<div class="comment-container" id="li-comment-430231">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1351a03e610967c8fb9ebec7ce474334?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1351a03e610967c8fb9ebec7ce474334?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dat</span>
<span class="date">February 22, 2018 at 8:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-430231" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would like to see the hidden states vector. Because there are 96 training samples, there would be 96 of these (each as a vector of length 4).</p>
<p>I added the “return_sequences=True” in the LSTM</p>
<p>model = Sequential()<br/>
model.add( LSTM(4, input_shape=(1, look_back), return_sequences=True ) )<br/>
model.add(Dense(1))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)<br/>
model.fit(trainX, trainY, epochs=20, batch_size=20, verbose=2)</p>
<p>But, I get the error </p>
<p>Traceback (most recent call last):<br/>
  File “”, line 1, in<br/>
  File “E:\ProgramData\Anaconda3\lib\site-packages\keras\models.py”, line 965, in fit<br/>
    validation_steps=validation_steps)<br/>
  File “E:\ProgramData\Anaconda3\lib\site-packages\keras\engine\training.py”, line 1593, in fit<br/>
    batch_size=batch_size)<br/>
  File “E:\ProgramData\Anaconda3\lib\site-packages\keras\engine\training.py”, line 1430, in _standardize_user_data<br/>
    exception_prefix=’target’)<br/>
  File “E:\ProgramData\Anaconda3\lib\site-packages\keras\engine\training.py”, line 110, in _standardize_input_data<br/>
    ‘with shape ‘ + str(data_shape))<br/>
ValueError: Error when checking target: expected dense_24 to have 3 dimensions, but got array with shape (94, 1)</p>
<p>How can I make this model work, and also how can I view the hidden states for each of the input samples (should be 96 hidden states). </p>
<p>Thank you.</p>
<div class="reply">
<a aria-label="Reply to Dat" class="comment-reply-link" href="#comment-430231" onclick='return addComment.moveForm( "comment-430231", "430231", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430303">
<div class="comment-container" id="li-comment-430303">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 23, 2018 at 11:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-430303" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Return sequences does not return the hidden state, but instead the outcome from each time step.</p>
<p>This post might clear things up for you regarding outputs and hidden states:<br/>
<a href="https://machinelearningmastery.com/return-sequences-and-return-states-for-lstms-in-keras/" rel="nofollow">https://machinelearningmastery.com/return-sequences-and-return-states-for-lstms-in-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430303" onclick='return addComment.moveForm( "comment-430303", "430303", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-430926">
<div class="comment-container" id="li-comment-430926">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84a2b90c8264c375e659a4f0b7d90190?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84a2b90c8264c375e659a4f0b7d90190?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">D. Liebman</span>
<span class="date">March 3, 2018 at 12:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-430926" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I like your blog posts. I have some code based on this post, but I get this error message all the time. There’s something wrong with my dense layer. Can you  point it out? Here units is 300 and tokens_per_sentence is 25.</p>
<p>an error message:</p>
<p>        ValueError: Error when checking target: expected dense_layer_b to have 2 dimensions, but got array with shape (1, 25, 300)</p>
<p>this is some code:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca7e034568551306339" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
        def model_lstm():
            x_shape = (None,units)
            valid_word_a = Input(shape=x_shape)
            valid_word_b = Input(shape=x_shape)
            ### encoder for training ###
            lstm_a = LSTM(units=tokens_per_sentence,input_shape=x_shape, return_state=True)
            recurrent_a, lstm_a_h, lstm_a_c = lstm_a(valid_word_a)
            lstm_a_states = [lstm_a_h , lstm_a_c]
            print(lstm_a_h)
            ### decoder for training ###
            lstm_b = LSTM(units=tokens_per_sentence ,return_state=True ,input_shape=x_shape)
            recurrent_b, inner_lstmb_h, inner_lstmb_c = lstm_b(valid_word_b, initial_state=lstm_a_states)
            print(inner_lstmb_h.shape, inner_lstmb_c.shape,'h c'
            dense_b = Dense(units  , activation='softmax', name='dense_layer_b')
            decoder_b = dense_b(recurrent_b)
            model = Model([valid_word_a,valid_word_b], decoder_b) 
            return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-2">2</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-4">4</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-6">6</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-8">8</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-10">10</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-12">12</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-14">14</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca7e034568551306339-16">16</div><div class="crayon-num" data-line="crayon-5c0ca7e034568551306339-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca7e034568551306339-1"><span class="crayon-h">        </span><span class="crayon-e">def </span><span class="crayon-e">model_lstm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-2"><span class="crayon-h">            </span><span class="crayon-v">x_shape</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-v">units</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-3"><span class="crayon-h">            </span><span class="crayon-v">valid_word_a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-v">x_shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-4"><span class="crayon-h">            </span><span class="crayon-v">valid_word_b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-v">x_shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-5"><span class="crayon-h">            </span><span class="crayon-p">### encoder for training ###</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-6"><span class="crayon-h">            </span><span class="crayon-v">lstm_a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">units</span><span class="crayon-o">=</span><span class="crayon-v">tokens_per_sentence</span><span class="crayon-sy">,</span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-v">x_shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-7"><span class="crayon-h">            </span><span class="crayon-v">recurrent_a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lstm_a_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lstm_a_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">lstm_a</span><span class="crayon-sy">(</span><span class="crayon-v">valid_word_a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-8"><span class="crayon-h">            </span><span class="crayon-v">lstm_a_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">lstm_a</span><span class="crayon-sy">_</span>h<span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lstm_a_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-9"><span class="crayon-h">            </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">lstm_a_h</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-10"><span class="crayon-h">            </span><span class="crayon-p">### decoder for training ###</span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-11"><span class="crayon-h">            </span><span class="crayon-v">lstm_b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">units</span><span class="crayon-o">=</span><span class="crayon-v">tokens_per</span><span class="crayon-sy">_</span>sentence<span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-v">x_shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-12"><span class="crayon-h">            </span><span class="crayon-v">recurrent_b</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inner_lstmb_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inner_lstmb_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">lstm_b</span><span class="crayon-sy">(</span><span class="crayon-v">valid_word_b</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">lstm_a_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-13"><span class="crayon-h">            </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">inner_lstmb_h</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inner_lstmb_c</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-s">'h c'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-14"><span class="crayon-h">            </span><span class="crayon-v">dense_b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-i">units</span><span class="crayon-h">  </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'dense_layer_b'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-15"><span class="crayon-h">            </span><span class="crayon-v">decoder_b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dense_b</span><span class="crayon-sy">(</span><span class="crayon-v">recurrent_b</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca7e034568551306339-16"><span class="crayon-h">            </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">valid_word_a</span><span class="crayon-sy">,</span><span class="crayon-v">valid_word_b</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_b</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5c0ca7e034568551306339-17"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to D. Liebman" class="comment-reply-link" href="#comment-430926" onclick='return addComment.moveForm( "comment-430926", "430926", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-430964">
<div class="comment-container" id="li-comment-430964">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 3, 2018 at 8:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-430964" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps the data does not match the model, you could change one or the other.</p>
<p>I’m eager to help, but I cannot debug the code for you sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-430964" onclick='return addComment.moveForm( "comment-430964", "430964", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-431083">
<div class="comment-container" id="li-comment-431083">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84a2b90c8264c375e659a4f0b7d90190?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84a2b90c8264c375e659a4f0b7d90190?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">D. Liebman</span>
<span class="date">March 4, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-431083" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi. so I think I needed to set ‘return_sequences’ to True for both lstm_a and lstm_b.</p>
<div class="reply">
<a aria-label="Reply to D. Liebman" class="comment-reply-link" href="#comment-431083" onclick='return addComment.moveForm( "comment-431083", "431083", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-432335">
<div class="comment-container" id="li-comment-432335">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a9b9a9a8378ad52e4884c970a82f9032?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a9b9a9a8378ad52e4884c970a82f9032?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jia Yee</span>
<span class="date">March 16, 2018 at 2:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-432335" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason, </p>
<p>Do you think that this algorithm works for weather prediction? For example, by having the input integer variables as dew point, humidity, and temperature, to predict rainfall as output</p>
<div class="reply">
<a aria-label="Reply to Jia Yee" class="comment-reply-link" href="#comment-432335" onclick='return addComment.moveForm( "comment-432335", "432335", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-432339">
<div class="comment-container" id="li-comment-432339">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 16, 2018 at 2:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-432339" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Only for demonstration purposes.</p>
<p>In practice, weather forecasts are performed using simulations of physics models and are more accurate than small machine learning models.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-432339" onclick='return addComment.moveForm( "comment-432339", "432339", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-432724">
<div class="comment-container" id="li-comment-432724">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a89b49079f4442c0f78aecf13adcbcd7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a89b49079f4442c0f78aecf13adcbcd7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lukas</span>
<span class="date">March 20, 2018 at 10:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-432724" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason.</p>
<p>I would like tou ask you, how could I use this model with float numbers? Yours training data seems like this:<br/>
[[<br/>
   [0,0,0,0,1,0,0]<br/>
   [0,0,1,0,0,1,0]<br/>
   [0,1,0,0,0,0,0]]<br/>
             .<br/>
             .<br/>
             .<br/>
]]</p>
<p>I would need something like this:<br/>
[[<br/>
    [0.12354,0.9854,5875, 0.0659]<br/>
    [0.12354,0.9854,5875, 0.0659]<br/>
    [0.12354,0.9854,5875, 0.0659]<br/>
    [0.12354,0.9854,5875, 0.0659]<br/>
]]</p>
<p>Whan i run your model with float numbers, the network doesn’t learn. Should I use some different LOSS function?</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Lukas" class="comment-reply-link" href="#comment-432724" onclick='return addComment.moveForm( "comment-432724", "432724", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-432761">
<div class="comment-container" id="li-comment-432761">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 21, 2018 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-432761" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The loss function is related to the output, if you have a real-valued output, consider mse or mae loss functions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-432761" onclick='return addComment.moveForm( "comment-432761", "432761", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-433762">
<div class="comment-container" id="li-comment-433762">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f91b267e23e1f49756e0c83411f2b33f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f91b267e23e1f49756e0c83411f2b33f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jugal</span>
<span class="date">March 31, 2018 at 4:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-433762" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How to add bidirectional layer in encoder decoder architecture?</p>
<div class="reply">
<a aria-label="Reply to Jugal" class="comment-reply-link" href="#comment-433762" onclick='return addComment.moveForm( "comment-433762", "433762", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-433797">
<div class="comment-container" id="li-comment-433797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 1, 2018 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-433797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Use it directly on the encoder or decoder.</p>
<p>Here’s how to in Keras:<br/>
<a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" rel="nofollow">https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433797" onclick='return addComment.moveForm( "comment-433797", "433797", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-434019">
<div class="comment-container" id="li-comment-434019">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a89b49079f4442c0f78aecf13adcbcd7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a89b49079f4442c0f78aecf13adcbcd7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Luke</span>
<span class="date">April 3, 2018 at 9:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434019" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi.<br/>
I would like to use your model with word embedding. I was inspired by <a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html" rel="nofollow">https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html</a> -&gt;features -&gt; word-level model</p>
<p>I decoded words in sentences as integer numbers. My input is list of sentences with 15 words. [[1,5,7,5,6,4,5, 10,15,12,11,10,8,1,2], […], [….], …]</p>
<p> My model seems:</p>
<p>encoder_inputs = Input(shape=(None,))<br/>
x = Embedding(num_encoder_tokens, latent_dim)(encoder_inputs)<br/>
x, state_h, state_c = LSTM(latent_dim, return_state=True)(x)<br/>
encoder_states = [state_h, state_c]</p>
<p># Set up the decoder, using <code>encoder_states</code> as initial state.<br/>
decoder_inputs = Input(shape=(None,))<br/>
x = Embedding(num_decoder_tokens, latent_dim)(decoder_inputs)<br/>
x = LSTM(latent_dim, return_sequences=True)(x, initial_state=encoder_states)<br/>
decoder_outputs = Dense(num_decoder_tokens, activation=’softmax’)(x)</p>
<p># Define the model that will turn<br/>
# <code>encoder_input_data</code> &amp; <code>decoder_input_data</code> into <code>decoder_target_data</code><br/>
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)</p>
<p>Whan i try to train the model, i get this error: expected dense_1 to have 3 dimensions, but got array with shape (10, 15). Could you help me with that please? </p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Luke" class="comment-reply-link" href="#comment-434019" onclick='return addComment.moveForm( "comment-434019", "434019", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-445501">
<div class="comment-container" id="li-comment-445501">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cdc08769d1fd11b353aa9ea0d5f1bea5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cdc08769d1fd11b353aa9ea0d5f1bea5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fatemeh</span>
<span class="date">August 8, 2018 at 4:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-445501" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,<br/>
I also have the same issue. could you solve your problem?</p>
<div class="reply">
<a aria-label="Reply to Fatemeh" class="comment-reply-link" href="#comment-445501" onclick='return addComment.moveForm( "comment-445501", "445501", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-434085">
<div class="comment-container" id="li-comment-434085">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/df0ea0ca9783e4b0ceaab2f15b7dd553?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/df0ea0ca9783e4b0ceaab2f15b7dd553?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sunil</span>
<span class="date">April 4, 2018 at 6:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434085" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi , </p>
<p>I am trying to do seq2seq problem using Keras – LSTM. Predicted output words matches with most frequent words of the vocabulary built using the dataset. Not sure what could be the reason. After training is completed while trying to predict the output for the given input sequence model is predicting same output irrespective of the input seq. Also using separate embedding layer for both encoder and decoder. </p>
<p>Can you help me what could be the reason ?</p>
<p>Question elaborated here:<br/>
<a href="https://stackoverflow.com/questions/49638685/keras-seq2seq-model-predicting-same-output-for-all-test-inputs" rel="nofollow">https://stackoverflow.com/questions/49638685/keras-seq2seq-model-predicting-same-output-for-all-test-inputs</a></p>
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Sunil" class="comment-reply-link" href="#comment-434085" onclick='return addComment.moveForm( "comment-434085", "434085", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-434154">
<div class="comment-container" id="li-comment-434154">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 5, 2018 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434154" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It suggests the model has not learned the problem.</p>
<p>Here are a list of ideas to try:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434154" onclick='return addComment.moveForm( "comment-434154", "434154", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-434545">
<div class="comment-container" id="li-comment-434545">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/119335b0952b4a74ecfb5053408d05dd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/119335b0952b4a74ecfb5053408d05dd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Phetsa Ndlangamandla</span>
<span class="date">April 9, 2018 at 9:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434545" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>In your current setup, how would you add a pre-trained embedding matrix, like glove?</p>
<div class="reply">
<a aria-label="Reply to Phetsa Ndlangamandla" class="comment-reply-link" href="#comment-434545" onclick='return addComment.moveForm( "comment-434545", "434545", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-434597">
<div class="comment-container" id="li-comment-434597">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 10, 2018 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434597" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here are some examples of loading a word embedding:<br/>
<a href="https://machinelearningmastery.com/use-word-embedding-layers-deep-learning-keras/" rel="nofollow">https://machinelearningmastery.com/use-word-embedding-layers-deep-learning-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434597" onclick='return addComment.moveForm( "comment-434597", "434597", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-434674">
<div class="comment-container" id="li-comment-434674">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/134c24588f8e602d86bba02aef79c38c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/134c24588f8e602d86bba02aef79c38c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lukas</span>
<span class="date">April 11, 2018 at 2:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434674" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, </p>
<p>Could you help me with my problem? I think that a lot of required logic is implemented in your code but I am very beginner in python. I want to predict numbers according to input test sequence (seq2seq) so output of my decoder should by sequence of 6 numbers (1-7). U can imagine it as lottery prediction. I have very long input vector of numbers 1-7 (contains sequenses of 6 numbers) so I don’t need to generate test data. I just need to predict next 6 numbers which should be generated. 1,1,2,2,3 -&gt; 3,4,4,5,5,6</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Lukas" class="comment-reply-link" href="#comment-434674" onclick='return addComment.moveForm( "comment-434674", "434674", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-434697">
<div class="comment-container" id="li-comment-434697">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 11, 2018 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434697" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps here would be a good place for you to get stared with LSTMs:<br/>
<a href="https://machinelearningmastery.com/start-here/#lstm" rel="nofollow">https://machinelearningmastery.com/start-here/#lstm</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434697" onclick='return addComment.moveForm( "comment-434697", "434697", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-434927">
<div class="comment-container" id="li-comment-434927">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/134c24588f8e602d86bba02aef79c38c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/134c24588f8e602d86bba02aef79c38c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lukas</span>
<span class="date">April 13, 2018 at 8:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434927" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason, it was very helpful for me. And can you give me advice or link how to correctly initiate and train network with multiple input sequences?</p>
<div class="reply">
<a aria-label="Reply to Lukas" class="comment-reply-link" href="#comment-434927" onclick='return addComment.moveForm( "comment-434927", "434927", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-434964">
<div class="comment-container" id="li-comment-434964">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 14, 2018 at 6:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-434964" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>They can be side by side:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<p>Or separate inputs entirely:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-434964" onclick='return addComment.moveForm( "comment-434964", "434964", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-435213">
<div class="comment-container" id="li-comment-435213">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2e722104a3ea9e975a20cf4709e15c3f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2e722104a3ea9e975a20cf4709e15c3f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jameshwart Lopez</span>
<span class="date">April 17, 2018 at 11:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-435213" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason for this tutorial it gets me started. I tried to use larger sequence where input is 400 series of numbers and output is 40 numbers. I have problem with categorical because of index error and i don’t know how to set or get the the value for cardinality/n_features. Can you give me an idea on this? </p>
<p>Im also not clear if this is a classification type of model. Can you please confirm. Thanks</p>
<div class="reply">
<a aria-label="Reply to Jameshwart Lopez" class="comment-reply-link" href="#comment-435213" onclick='return addComment.moveForm( "comment-435213", "435213", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-435227">
<div class="comment-container" id="li-comment-435227">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 17, 2018 at 2:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-435227" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can integer encode or one hot encode categorial input features. Here is a tutorial on the topic:<br/>
<a href="https://machinelearningmastery.com/how-to-one-hot-encode-sequence-data-in-python/" rel="nofollow">https://machinelearningmastery.com/how-to-one-hot-encode-sequence-data-in-python/</a></p>
<p>This post will make the distinction between classification and regression clear:<br/>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435227" onclick='return addComment.moveForm( "comment-435227", "435227", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-435251">
<div class="comment-container" id="li-comment-435251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bebe589b3b8ad57c976732578abeeb5c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bebe589b3b8ad57c976732578abeeb5c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kadirou</span>
<span class="date">April 17, 2018 at 8:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-435251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
thank you for this totu, please i receive this error when i run your example :<br/>
ValueError: Error when checking input: expected input_1 to have 3 dimensions, but got array with shape (100000, 1, 6, 51)</p>
<div class="reply">
<a aria-label="Reply to Kadirou" class="comment-reply-link" href="#comment-435251" onclick='return addComment.moveForm( "comment-435251", "435251", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-435725">
<div class="comment-container" id="li-comment-435725">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d523eb9dac32fb985e0a2064d18f0252?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d523eb9dac32fb985e0a2064d18f0252?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://yeo.ro" rel="external nofollow">Claudiu</a></span>
<span class="date">April 23, 2018 at 10:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-435725" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi! I have the same problem.. Did you solve it ? Thanks!</p>
<div class="reply">
<a aria-label="Reply to Claudiu" class="comment-reply-link" href="#comment-435725" onclick='return addComment.moveForm( "comment-435725", "435725", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-436263">
<div class="comment-container" id="li-comment-436263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85940155764e0f6a3ba32d23850b02d7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85940155764e0f6a3ba32d23850b02d7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://wangjiayu.ninja" rel="external nofollow">Gary</a></span>
<span class="date">April 30, 2018 at 1:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>change this:</p>
<p>src_encoded = to_categorical([source], num_classes=cardinality)[0]<br/>
tar_encoded = to_categorical([target], num_classes=cardinality)[0]<br/>
tar2_encoded = to_categorical([target_in], num_classes=cardinality)[0]</p>
<div class="reply">
<a aria-label="Reply to Gary" class="comment-reply-link" href="#comment-436263" onclick='return addComment.moveForm( "comment-436263", "436263", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-435836">
<div class="comment-container" id="li-comment-435836">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c55815a572476126bafc26c999fbdd3a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c55815a572476126bafc26c999fbdd3a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jonathan K</span>
<span class="date">April 25, 2018 at 3:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-435836" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thank you very much for the tutorial. Is it possible to decode many sequences simultaneously instead of decoding a single sequence one character at a time? The inference for my project takes too long and I thought that doing it in larger batches may help.</p>
<div class="reply">
<a aria-label="Reply to Jonathan K" class="comment-reply-link" href="#comment-435836" onclick='return addComment.moveForm( "comment-435836", "435836", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-435857">
<div class="comment-container" id="li-comment-435857">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 25, 2018 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-435857" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could use copies of the model to make prediction in parallel for different inputs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-435857" onclick='return addComment.moveForm( "comment-435857", "435857", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-436009">
<div class="comment-container" id="li-comment-436009">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2e722104a3ea9e975a20cf4709e15c3f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2e722104a3ea9e975a20cf4709e15c3f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jameshwart Lopez</span>
<span class="date">April 26, 2018 at 4:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436009" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi im just wondering why do we need to use to_categorical if the sequence is already numbers. On my case i have a series of input features(numbers) and another series of output features(number). Should i still use to_categorical method?</p>
<div class="reply">
<a aria-label="Reply to Jameshwart Lopez" class="comment-reply-link" href="#comment-436009" onclick='return addComment.moveForm( "comment-436009", "436009", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-436052">
<div class="comment-container" id="li-comment-436052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 27, 2018 at 5:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, it will one hot encode the numbers:<br/>
<a href="https://keras.io/utils/#to_categorical" rel="nofollow">https://keras.io/utils/#to_categorical</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436052" onclick='return addComment.moveForm( "comment-436052", "436052", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-436197">
<div class="comment-container" id="li-comment-436197">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/460e3f4f0d83c27cbb0ec073fe96c82b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/460e3f4f0d83c27cbb0ec073fe96c82b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">chunky</span>
<span class="date">April 28, 2018 at 10:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436197" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am working on word boundary detection problem where dataset containing .wav files in which a sentence is spoken are given, and corresponding to each .wav file a .wrd file is also given which contains the words spoken in a sentence and also its boundaries (starting and end boundaries).<br/>
Our task is to identify word boundaries in test .wav file (words spoken will also be given).<br/>
I want to do this with sequential models .</p>
<p>What I have tried is:</p>
<p>I have read .wav files using librosa module in numpy array (made it equal to max size using padding)</p>
<p>Its output is like 3333302222213333022221333302222133333 (for i/p ex: I am hero)<br/>
where (0:start of word, 1:end of word, 2:middle, 3:space) </p>
<p>means I want to solve this as supervised learning problem, can I train such model with RNN?</p>
<div class="reply">
<a aria-label="Reply to chunky" class="comment-reply-link" href="#comment-436197" onclick='return addComment.moveForm( "comment-436197", "436197", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-436226">
<div class="comment-container" id="li-comment-436226">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 29, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436226" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like a great project.</p>
<p>I don’t have examples of working with audio data sorry, I cannot give you good off the cuff advice.</p>
<p>Perhaps find some code bases on related modeling problems and use them for inspiration?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436226" onclick='return addComment.moveForm( "comment-436226", "436226", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-436260">
<div class="comment-container" id="li-comment-436260">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a89b49079f4442c0f78aecf13adcbcd7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a89b49079f4442c0f78aecf13adcbcd7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lukas</span>
<span class="date">April 30, 2018 at 1:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436260" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello.<br/>
I’ve tried this example for word-level chatbot. Everything works great, on a small data (5000 sentences)</p>
<p>When I use dataset of 50 000 sentences something is wrong. Model accuracy is 95% but when i try to chat with this chatbot, responses are generated randomly. Chatbot is capable of learning sentences from dataset, but it use them randomly to respond to users questions.</p>
<p>How it is possible, when accuracy is so hight?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Lukas" class="comment-reply-link" href="#comment-436260" onclick='return addComment.moveForm( "comment-436260", "436260", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-436285">
<div class="comment-container" id="li-comment-436285">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 30, 2018 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436285" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps it memorized the training data? E.g. overfitting?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436285" onclick='return addComment.moveForm( "comment-436285", "436285", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-436483">
<div class="comment-container" id="li-comment-436483">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b1e2a22e9d1a487d33058ff818b5cc51?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b1e2a22e9d1a487d33058ff818b5cc51?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ricky</span>
<span class="date">May 3, 2018 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436483" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sir, how to create confusion matrix, evaluated and the accuracy printed for this model : </p>
<p># Define an input sequence and process it.<br/>
encoder_inputs = Input(shape=(None, num_encoder_tokens))<br/>
encoder = LSTM(latent_dim, return_state=True)<br/>
encoder_outputs, state_h, state_c = encoder(encoder_inputs)<br/>
# We discard <code>encoder_outputs</code> and only keep the states.<br/>
encoder_states = [state_h, state_c]</p>
<p># Set up the decoder, using <code>encoder_states</code> as initial state.<br/>
decoder_inputs = Input(shape=(None, num_decoder_tokens))<br/>
# We set up our decoder to return full output sequences,<br/>
# and to return internal states as well. We don’t use the<br/>
# return states in the training model, but we will use them in inference.<br/>
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)<br/>
decoder_outputs, _, _ = decoder_lstm(decoder_inputs,<br/>
                                     initial_state=encoder_states)<br/>
decoder_dense = Dense(num_decoder_tokens, activation=’softmax’)<br/>
decoder_outputs = decoder_dense(decoder_outputs)</p>
<p># Define the model that will turn<br/>
# <code>encoder_input_data</code> &amp; <code>decoder_input_data</code> into <code>decoder_target_data</code><br/>
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)</p>
<p>model.compile(optimizer=’rmsprop’, loss=’categorical_crossentropy’, metrics=[‘accuracy’])<br/>
model.fit([encoder_input_data, decoder_input_data], decoder_target_data,<br/>
          batch_size=batch_size,<br/>
          epochs=epochs,<br/>
validation_split=0.2)</p>
<p>model.summary()</p>
<div class="reply">
<a aria-label="Reply to ricky" class="comment-reply-link" href="#comment-436483" onclick='return addComment.moveForm( "comment-436483", "436483", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-436517">
<div class="comment-container" id="li-comment-436517">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 3, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436517" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is information on how to calculate a confusion matrix:<br/>
<a href="https://machinelearningmastery.com/confusion-matrix-machine-learning/" rel="nofollow">https://machinelearningmastery.com/confusion-matrix-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436517" onclick='return addComment.moveForm( "comment-436517", "436517", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-436938">
<div class="comment-container" id="li-comment-436938">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3384b0b717cf5bc53b38670d837c9a28?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3384b0b717cf5bc53b38670d837c9a28?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chandra Sutrisno</span>
<span class="date">May 8, 2018 at 7:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436938" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thank you for this awesome tutorial, so useful. I have one simple question. Is there any specific<br/>
 reason why use 50+1 as n_features? </p>
<p>Please advise</p>
<div class="reply">
<a aria-label="Reply to Chandra Sutrisno" class="comment-reply-link" href="#comment-436938" onclick='return addComment.moveForm( "comment-436938", "436938", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-436985">
<div class="comment-container" id="li-comment-436985">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 9, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-436985" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The +1 is to leave room for the “0” value, for “no data”.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436985" onclick='return addComment.moveForm( "comment-436985", "436985", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-437597">
<div class="comment-container" id="li-comment-437597">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c7532138bb2548f292e2160a3c6b485e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c7532138bb2548f292e2160a3c6b485e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunwar</span>
<span class="date">May 15, 2018 at 11:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-437597" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for all the wonderful tutorial ..great work.</p>
<p>i have question,</p>
<p> in time series prediction does multivariate give better result then uni-variate.<br/>
eg.- for  “Beijing PM2.5 Data Set” we have  multivariate data will the multivariate give better results,  or  by taking the single pollution data for uni-variate will give better result.  </p>
<p>2 – what is better encoder-decoder or normal RNN for time series prediction.</p>
<div class="reply">
<a aria-label="Reply to Kunwar" class="comment-reply-link" href="#comment-437597" onclick='return addComment.moveForm( "comment-437597", "437597", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-437630">
<div class="comment-container" id="li-comment-437630">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 16, 2018 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-437630" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For both questions, it depends on the specific problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437630" onclick='return addComment.moveForm( "comment-437630", "437630", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-437996">
<div class="comment-container" id="li-comment-437996">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/78999743a555b3f92cdab2e01e2d45e5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/78999743a555b3f92cdab2e01e2d45e5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">matt</span>
<span class="date">May 20, 2018 at 3:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-437996" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, here it looks like one time step in the model. What do I  have to change to add here more time steps in the model ?</p>
<p># returns train, inference_encoder and inference_decoder models<br/>
def define_models(n_input, n_output, n_units):<br/>
	# define training encoder<br/>
	encoder_inputs = Input(shape=(None, n_input))<br/>
	encoder = LSTM(n_units, return_state=True)<br/>
	encoder_outputs, state_h, state_c = encoder(encoder_inputs)<br/>
	encoder_states = [state_h, state_c]<br/>
	# define training decoder<br/>
	decoder_inputs = Input(shape=(None, n_output))<br/>
	decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True)<br/>
	decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)<br/>
	decoder_dense = Dense(n_output, activation=’softmax’)<br/>
	decoder_outputs = decoder_dense(decoder_outputs)<br/>
	model = Model([encoder_inputs, decoder_inputs], decoder_outputs)<br/>
	# define inference encoder<br/>
	encoder_model = Model(encoder_inputs, encoder_states)<br/>
	# define inference decoder<br/>
	decoder_state_input_h = Input(shape=(n_units,))<br/>
	decoder_state_input_c = Input(shape=(n_units,))<br/>
	decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]<br/>
	decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)<br/>
	decoder_states = [state_h, state_c]<br/>
	decoder_outputs = decoder_dense(decoder_outputs)<br/>
	decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)<br/>
	# return all models<br/>
	return model, encoder_model, decoder_model</p>
<div class="reply">
<a aria-label="Reply to matt" class="comment-reply-link" href="#comment-437996" onclick='return addComment.moveForm( "comment-437996", "437996", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-438132">
<div class="comment-container" id="li-comment-438132">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/24b1cc57305e88579dfbcc82aa2deb2f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/24b1cc57305e88579dfbcc82aa2deb2f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Skye</span>
<span class="date">May 21, 2018 at 6:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438132" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thank you very much! I would like to ask a question which seems silly…When training the model, we store the weights in training model. Are the inference encoder and inference decoder empty? At predict stage, the training model is not used, so how are the training model weights used to predict?</p>
<p>Looking forward to your reply. Thank you!</p>
<div class="reply">
<a aria-label="Reply to Skye" class="comment-reply-link" href="#comment-438132" onclick='return addComment.moveForm( "comment-438132", "438132", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-438198">
<div class="comment-container" id="li-comment-438198">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 22, 2018 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438198" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No silly questions here!</p>
<p>The state of the model is reset at the end of each batch.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438198" onclick='return addComment.moveForm( "comment-438198", "438198", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-438426">
<div class="comment-container" id="li-comment-438426">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/24b1cc57305e88579dfbcc82aa2deb2f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/24b1cc57305e88579dfbcc82aa2deb2f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Skye</span>
<span class="date">May 24, 2018 at 10:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438426" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Get it. Thank you a lot!</p>
<div class="reply">
<a aria-label="Reply to Skye" class="comment-reply-link" href="#comment-438426" onclick='return addComment.moveForm( "comment-438426", "438426", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-438439">
<div class="comment-container" id="li-comment-438439">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 24, 2018 at 1:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438439" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438439" onclick='return addComment.moveForm( "comment-438439", "438439", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-438564">
<div class="comment-container" id="li-comment-438564">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6ee1dcf55af01c3c4a07632f2f50c3ee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6ee1dcf55af01c3c4a07632f2f50c3ee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joe</span>
<span class="date">May 25, 2018 at 9:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438564" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can this model described in this blog post be used when we have variable length input? How.</p>
<div class="reply">
<a aria-label="Reply to Joe" class="comment-reply-link" href="#comment-438564" onclick='return addComment.moveForm( "comment-438564", "438564", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-438567">
<div class="comment-container" id="li-comment-438567">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6ee1dcf55af01c3c4a07632f2f50c3ee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6ee1dcf55af01c3c4a07632f2f50c3ee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joe</span>
<span class="date">May 25, 2018 at 9:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438567" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>And also variable length output.</p>
<div class="reply">
<a aria-label="Reply to Joe" class="comment-reply-link" href="#comment-438567" onclick='return addComment.moveForm( "comment-438567", "438567", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-438573">
<div class="comment-container" id="li-comment-438573">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 25, 2018 at 9:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-438573" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it processes time steps one at a time, therefore supports variable length by default.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-438573" onclick='return addComment.moveForm( "comment-438573", "438573", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-440245">
<div class="comment-container" id="li-comment-440245">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c8f15d37cf2c855b9a305c0300ccb6cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c8f15d37cf2c855b9a305c0300ccb6cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">michel</span>
<span class="date">June 9, 2018 at 3:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-440245" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason how to deal and implement this model if you have time series data with 3D shape (samples, timesteps, features) and can not /want not one hot encode them? Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to michel" class="comment-reply-link" href="#comment-440245" onclick='return addComment.moveForm( "comment-440245", "440245", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-440280">
<div class="comment-container" id="li-comment-440280">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2018 at 6:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-440280" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can integer encode the inputs and use an embedding layer on the input.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440280" onclick='return addComment.moveForm( "comment-440280", "440280", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-440359">
<div class="comment-container" id="li-comment-440359">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c8f15d37cf2c855b9a305c0300ccb6cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c8f15d37cf2c855b9a305c0300ccb6cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">michel</span>
<span class="date">June 10, 2018 at 8:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-440359" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how would that look like ? And can I not do it with the inference part later only ? Sorry my questions could sound a bit stupid, I try to understand the topics.</p>
<div class="reply">
<a aria-label="Reply to michel" class="comment-reply-link" href="#comment-440359" onclick='return addComment.moveForm( "comment-440359", "440359", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-440416">
<div class="comment-container" id="li-comment-440416">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 11, 2018 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-440416" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I provide a ton more help on preparing data for LSTMs here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/how-do-i-prepare-my-data-for-an-lstm" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-do-i-prepare-my-data-for-an-lstm</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-440416" onclick='return addComment.moveForm( "comment-440416", "440416", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-441072">
<div class="comment-container" id="li-comment-441072">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f5854561ac4860e9886f5d27e2e4e7c2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f5854561ac4860e9886f5d27e2e4e7c2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mlguy</span>
<span class="date">June 17, 2018 at 2:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441072" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
thank you for sharing your codes. I used this for my own problem and it works, but I still get good prediction results on values that are far away from the ones used in the training. What could my problem be ? I made a regression using mse for loss, do I need a different loss function ?</p>
<div class="reply">
<a aria-label="Reply to mlguy" class="comment-reply-link" href="#comment-441072" onclick='return addComment.moveForm( "comment-441072", "441072", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441116">
<div class="comment-container" id="li-comment-441116">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 18, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441116" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some suggestions for improving model skill here that may give you some ideas:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441116" onclick='return addComment.moveForm( "comment-441116", "441116", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-441137">
<div class="comment-container" id="li-comment-441137">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d0a87c4b1c01822bd4b3c5e32775dd8f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d0a87c4b1c01822bd4b3c5e32775dd8f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">patrick</span>
<span class="date">June 18, 2018 at 8:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441137" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, great contribution! when I use timeseries data for this model, can I also use not the shfitet case in the target data for y, so: model.fit([input, output], output) , so output=input.reversed() and than would this make sense as well? because I want to use sliding windows  for input and output; and than shfiting by one for the output being would not make sense in my eyes.</p>
<div class="reply">
<a aria-label="Reply to patrick" class="comment-reply-link" href="#comment-441137" onclick='return addComment.moveForm( "comment-441137", "441137", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441153">
<div class="comment-container" id="li-comment-441153">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 18, 2018 at 3:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441153" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not sure I follow sorry.</p>
<p>Perhaps this post will make things clearer:<br/>
<a href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441153" onclick='return addComment.moveForm( "comment-441153", "441153", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-441143">
<div class="comment-container" id="li-comment-441143">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">simon</span>
<span class="date">June 18, 2018 at 9:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441143" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>lets say I trained with shape (1000,20,1) but I want to predict with (20000,20,1) than this would not work, because the sample size is bigger. how do I have to adjust this ?</p>
<p>output=list()<br/>
for t in range(2):<br/>
    output_tokens, h, c  = decoder_model.predict([target_seqs] + states_values)<br/>
    output.append(output_tokens[0,0,:])<br/>
    states_values = [h,c]<br/>
    target_seq = output_tokens</p>
<div class="reply">
<a aria-label="Reply to simon" class="comment-reply-link" href="#comment-441143" onclick='return addComment.moveForm( "comment-441143", "441143", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441155">
<div class="comment-container" id="li-comment-441155">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 18, 2018 at 3:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441155" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why would it not work?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441155" onclick='return addComment.moveForm( "comment-441155", "441155", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-441202">
<div class="comment-container" id="li-comment-441202">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">simon</span>
<span class="date">June 19, 2018 at 3:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441202" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>it says the following: index 1000 is out of bounds for axis 0 with size 1000,<br/>
so the axis of the second one needs to be in the same length. But I will not train with the same length of data that I am predicting. How can this be solved?</p>
<div class="reply">
<a aria-label="Reply to simon" class="comment-reply-link" href="#comment-441202" onclick='return addComment.moveForm( "comment-441202", "441202", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-441225">
<div class="comment-container" id="li-comment-441225">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 19, 2018 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441225" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps double check your data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441225" onclick='return addComment.moveForm( "comment-441225", "441225", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-441878">
<div class="comment-container" id="li-comment-441878">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">simon</span>
<span class="date">June 24, 2018 at 6:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441878" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>still not working Jason, Unfortunately it seems like variable sequence length is not possible ? I trained my model with a part of the whole data and wanted to use in the inference the whole data ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-441880">
<div class="comment-container" id="li-comment-441880">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1078734dd27f998e26837991c5148f82?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">simon</span>
<span class="date">June 24, 2018 at 7:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441880" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I correct myself: to I have to padd my data with zeros in the beginning of my training data since I want to use the last state of the encoder as initial state ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-441333">
<div class="comment-container" id="li-comment-441333">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e0c503e4d6bd4e15c2b6f6229bf49f4d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e0c503e4d6bd4e15c2b6f6229bf49f4d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sarah</span>
<span class="date">June 20, 2018 at 1:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441333" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have 2 questions:<br/>
1- This example is using teacher forcing, right? I’m trying to re-implement it without teacher forcing but it fails. When I define the train model as (line 49 of your example): model = Model(encoder_inputs, decoder_outputs), it gives me this error: RuntimeError: Graph disconnected: cannot obtain value for tensor Tensor(“decoder_inputs:0”, shape=(?, n_units, n_output_features), dtype=float32) at layer “decoder_inputs”. The following previous layers were accessed without issue: [‘encoder_inputs’, ‘encoder_LSTM’]</p>
<p>2- Can you please explain a bit more about how you defined the decoder model? I don’t get what is happening in the part between line 52 to 60 of the code (copied below)? Why do you need to re-define the decoder_outputs? How the model is defined? </p>
<p># define inference decoder<br/>
decoder_state_input_h = Input(shape=(n_units,))<br/>
decoder_state_input_c = Input(shape=(n_units,))<br/>
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]<br/>
decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)<br/>
decoder_states = [state_h, state_c]<br/>
decoder_outputs = decoder_dense(decoder_outputs)<br/>
decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)<br/>
# return all models</p>
<div class="reply">
<a aria-label="Reply to Sarah" class="comment-reply-link" href="#comment-441333" onclick='return addComment.moveForm( "comment-441333", "441333", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-441367">
<div class="comment-container" id="li-comment-441367">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 20, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-441367" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct. If performance is poor without teacher forcing, then don’t train without it. I’m not sure why you would want to remove it?!?</p>
<p>The decoder is a new model that uses parts of the encoder. Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-441367" onclick='return addComment.moveForm( "comment-441367", "441367", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-442282">
<div class="comment-container" id="li-comment-442282">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/020d695692580f38734ca0664e6e0bec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/020d695692580f38734ca0664e6e0bec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">dave</span>
<span class="date">June 29, 2018 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-442282" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason, I looked at different pages and found that a seq2seq is not possible with variable length without manipulating the data with zeros etc. So in your example, is it right that you can only use in inference data with shape (100000,timesteps,features), so not having variable length? If not how you can change that ? thanks a lot for responding!</p>
<div class="reply">
<a aria-label="Reply to dave" class="comment-reply-link" href="#comment-442282" onclick='return addComment.moveForm( "comment-442282", "442282", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442307">
<div class="comment-container" id="li-comment-442307">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 29, 2018 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-442307" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, variable length inputs can be truncated or padded and a masking layer can be used to ignore the padding.</p>
<p>Alternately, the above model can be used time-step wise, allowing truely multivariate inputs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442307" onclick='return addComment.moveForm( "comment-442307", "442307", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-442343">
<div class="comment-container" id="li-comment-442343">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/020d695692580f38734ca0664e6e0bec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/020d695692580f38734ca0664e6e0bec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">dave</span>
<span class="date">June 29, 2018 at 4:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-442343" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>nice explanation, a last question: my timesteps woud be the same in all cases,just the sample size woud be different. The keras padding sequences shows only padding for timesteps or am I wrong ? in that case I would need to pad my samples</p>
<div class="reply">
<a aria-label="Reply to dave" class="comment-reply-link" href="#comment-442343" onclick='return addComment.moveForm( "comment-442343", "442343", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-442376">
<div class="comment-container" id="li-comment-442376">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 30, 2018 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-442376" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question. Only the time steps and feature dimensions are fixed, the number of samples can vary.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442376" onclick='return addComment.moveForm( "comment-442376", "442376", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-442355">
<div class="comment-container" id="li-comment-442355">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a4d3068ca6573eeb8ae7d134566942ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a4d3068ca6573eeb8ae7d134566942ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.cs-machinelearning.com" rel="external nofollow">DrCam</a></span>
<span class="date">June 29, 2018 at 8:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-442355" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,</p>
<p>These are really awesome little tutorials and you do a great job explaining them. </p>
<p>Just as an FYI, to help out other readers, I had to use tensorflow v1.7 to get this to run with Keras 2.2.0.  With older versions I got a couple of errors while initializing the models and with the newer v1.8 I got some session errors with TF.</p>
<div class="reply">
<a aria-label="Reply to DrCam" class="comment-reply-link" href="#comment-442355" onclick='return addComment.moveForm( "comment-442355", "442355", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-442382">
<div class="comment-container" id="li-comment-442382">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 30, 2018 at 6:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-442382" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the tip.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442382" onclick='return addComment.moveForm( "comment-442382", "442382", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-443611">
<div class="comment-container" id="li-comment-443611">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63817766ca54fb89c419d3fc662ec4aa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63817766ca54fb89c419d3fc662ec4aa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yasir Hussain</span>
<span class="date">July 16, 2018 at 5:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-443611" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, Your work has always been awesome. I have learned a lot form your tutorials.<br/>
I am trying a simple encoder-decoder model following your example but facing some problem.</p>
<p>my issue is vocabulary size where it is around 5600, which makes my one hot encoder really big and puts my pc to freeze. can you give some simple example in which I don’t need to one hot encode my data? I know about sparse_categorical_crossentropy but I am facing trouble implementing it. Maybe my approach is wrong. your guidance can help me a lot.</p>
<p>Thanks once again for such great tutorials…..</p>
<div class="reply">
<a aria-label="Reply to Yasir Hussain" class="comment-reply-link" href="#comment-443611" onclick='return addComment.moveForm( "comment-443611", "443611", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-443655">
<div class="comment-container" id="li-comment-443655">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 17, 2018 at 6:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-443655" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try a word embedding instead?</p>
<p>Or, perhaps try training on an EC2 instance?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443655" onclick='return addComment.moveForm( "comment-443655", "443655", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-444225">
<div class="comment-container" id="li-comment-444225">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e458bf345e2fb412bc550c996759452?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e458bf345e2fb412bc550c996759452?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">George Kibirige</span>
<span class="date">July 24, 2018 at 1:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444225" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
Why I got this shape ((100000, 1, 6, 51), (100000, 1, 3, 51), (100000, 1, 3, 51)) when I run your code….Or Do I need to reshape or i did not copy correct</p>
<p>Because it shows you get ((100000,6, 51), (100000,3, 51), (100000,3, 51))</p>
<div class="reply">
<a aria-label="Reply to George Kibirige" class="comment-reply-link" href="#comment-444225" onclick='return addComment.moveForm( "comment-444225", "444225", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444251">
<div class="comment-container" id="li-comment-444251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 24, 2018 at 6:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is your version of Keras up to date?</p>
<p>Did you copy all of the code exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444251" onclick='return addComment.moveForm( "comment-444251", "444251", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-444279">
<div class="comment-container" id="li-comment-444279">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e458bf345e2fb412bc550c996759452?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e458bf345e2fb412bc550c996759452?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">George</span>
<span class="date">July 24, 2018 at 4:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444279" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, the version is different i put this<br/>
        X1 = np.squeeze(array(X1), axis=1)<br/>
        X2 = np.squeeze(array(X2), axis=1)<br/>
        y = np.squeeze(array(y), axis=1) </p>
<p>Its Ok now, What are you doing is called many to one encoding? and in decoding case is it called   one to many or?</p>
<p>another question I want to remove those one hot encode, I want to encode the exactly number and predict the exactly number</p>
<p>Also to remove this option  src_encoded = to_categorical([source], num_classes=cardinality)<br/>
but I got a lot of error</p>
<div class="reply">
<a aria-label="Reply to George" class="comment-reply-link" href="#comment-444279" onclick='return addComment.moveForm( "comment-444279", "444279", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-444330">
<div class="comment-container" id="li-comment-444330">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 25, 2018 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444330" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have advice on changing between regression/classification in keras:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/how-can-i-change-a-neural-network-from-regression-to-classification" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-can-i-change-a-neural-network-from-regression-to-classification</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444330" onclick='return addComment.moveForm( "comment-444330", "444330", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-444471">
<div class="comment-container" id="li-comment-444471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ef2777a650f9899d7eb85d84af397cb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ef2777a650f9899d7eb85d84af397cb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">broley</span>
<span class="date">July 27, 2018 at 12:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>good explanations appreciate your sharings! I wanted to ask if in the line for the inference prediction<br/>
 for t in range(n_steps):</p>
<p>you also could go with not the n_steps but also with one more ? Or why are you looping with n_steps? you also would get a result with for t in range(1), right= I hope you understood what I try to find out.</p>
<div class="reply">
<a aria-label="Reply to broley" class="comment-reply-link" href="#comment-444471" onclick='return addComment.moveForm( "comment-444471", "444471", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444499">
<div class="comment-container" id="li-comment-444499">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 27, 2018 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444499" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, i don’t follow. Perhaps you can provide more details?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444499" onclick='return addComment.moveForm( "comment-444499", "444499", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-444503">
<div class="comment-container" id="li-comment-444503">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ef2777a650f9899d7eb85d84af397cb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ef2777a650f9899d7eb85d84af397cb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">broley</span>
<span class="date">July 27, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444503" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>so in your code here below, you are predicting in a for loop with n_steps, what needs n_steps to be ? Can you also go with 1? or do you need that n_steps from the data shape  (batch,n_steps,features) as timesteps?  Because when you infdec.predict isnt the model is taking the whole target_seq for prediction at once why you need n_steps? </p>
<p>	for t in range(n_steps):<br/>
		# predict next char<br/>
		yhat, h, c = infdec.predict([target_seq] + state)<br/>
		# store prediction<br/>
		output.append(yhat[0,0,:])<br/>
		# update state<br/>
		state = [h, c]<br/>
		# update target sequence<br/>
		target_seq = yhat<br/>
	return array(output)</p>
<div class="reply">
<a aria-label="Reply to broley" class="comment-reply-link" href="#comment-444503" onclick='return addComment.moveForm( "comment-444503", "444503", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444514">
<div class="comment-container" id="li-comment-444514">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 27, 2018 at 11:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444514" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure, you can set it to 1.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444514" onclick='return addComment.moveForm( "comment-444514", "444514", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-444634">
<div class="comment-container" id="li-comment-444634">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ef2777a650f9899d7eb85d84af397cb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ef2777a650f9899d7eb85d84af397cb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">broley</span>
<span class="date">July 28, 2018 at 7:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444634" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>and what is the benefit of using 1 or a higher iteration number ?</p>
<div class="reply">
<a aria-label="Reply to broley" class="comment-reply-link" href="#comment-444634" onclick='return addComment.moveForm( "comment-444634", "444634", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-444664">
<div class="comment-container" id="li-comment-444664">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 29, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444664" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>for multi-step forecasts.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444664" onclick='return addComment.moveForm( "comment-444664", "444664", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-444803">
<div class="comment-container" id="li-comment-444803">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a388c0117da0a3ac0f49f286177fbc0e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a388c0117da0a3ac0f49f286177fbc0e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">guofeng</span>
<span class="date">July 30, 2018 at 8:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444803" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In the “def define_models()”, there are three models: model, encoder_model, decoder_model, </p>
<p>what is the function of encoder_model and decoder_model? Can I use only the “model” for </p>
<p>prediction? Looking forward to your reply</p>
<div class="reply">
<a aria-label="Reply to guofeng" class="comment-reply-link" href="#comment-444803" onclick='return addComment.moveForm( "comment-444803", "444803", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444831">
<div class="comment-container" id="li-comment-444831">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 31, 2018 at 6:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444831" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can learn more about the architecture here:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444831" onclick='return addComment.moveForm( "comment-444831", "444831", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-444899">
<div class="comment-container" id="li-comment-444899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/26a2eedee833988f5e76a5372059c6f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/26a2eedee833988f5e76a5372059c6f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rahul Sattar</span>
<span class="date">July 31, 2018 at 6:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How do we use Normalized Discounted Cumulative Rate (NDCR) for evaluating the model?<br/>
Is it necessary to use NDCR or we can live with accuracy as a performance metric?</p>
<div class="reply">
<a aria-label="Reply to Rahul Sattar" class="comment-reply-link" href="#comment-444899" onclick='return addComment.moveForm( "comment-444899", "444899", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444952">
<div class="comment-container" id="li-comment-444952">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 1, 2018 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-444952" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is NDCR exactly? I’ve never heard of it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444952" onclick='return addComment.moveForm( "comment-444952", "444952", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-445537">
<div class="comment-container" id="li-comment-445537">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cdc08769d1fd11b353aa9ea0d5f1bea5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cdc08769d1fd11b353aa9ea0d5f1bea5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fatemeh</span>
<span class="date">August 8, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-445537" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thank you for your great description. why you didn’t use “rmsprop” optimizer?</p>
<div class="reply">
<a aria-label="Reply to Fatemeh" class="comment-reply-link" href="#comment-445537" onclick='return addComment.moveForm( "comment-445537", "445537", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445546">
<div class="comment-container" id="li-comment-445546">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 8, 2018 at 9:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-445546" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I find I get great results from Adam, an extension of RMSProp:<br/>
<a href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/" rel="nofollow">https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445546" onclick='return addComment.moveForm( "comment-445546", "445546", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-445698">
<div class="comment-container" id="li-comment-445698">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cdc08769d1fd11b353aa9ea0d5f1bea5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cdc08769d1fd11b353aa9ea0d5f1bea5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fatemeh</span>
<span class="date">August 10, 2018 at 1:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-445698" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
I added the embediing matrix to your code and received an error related to matrix dimentions same as what Luke mentioned in the previous comments. do you have any post for adding embedding matrix to encoder-decoder?</p>
<div class="reply">
<a aria-label="Reply to Fatemeh" class="comment-reply-link" href="#comment-445698" onclick='return addComment.moveForm( "comment-445698", "445698", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-445724">
<div class="comment-container" id="li-comment-445724">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 10, 2018 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-445724" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some suggestions here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445724" onclick='return addComment.moveForm( "comment-445724", "445724", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-446111">
<div class="comment-container" id="li-comment-446111">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/27a3ecb5b31b043f366dfcb777dc75cb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/27a3ecb5b31b043f366dfcb777dc75cb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">star</span>
<span class="date">August 15, 2018 at 1:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-446111" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I have a low-level question. why did you train the model in only “one” epoch?wasn’t better to choose the higher number?</p>
<div class="reply">
<a aria-label="Reply to star" class="comment-reply-link" href="#comment-446111" onclick='return addComment.moveForm( "comment-446111", "446111", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446140">
<div class="comment-container" id="li-comment-446140">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2018 at 6:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-446140" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Because we have a very large number of random samples.</p>
<p>Perhaps re-read the tutorial?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446140" onclick='return addComment.moveForm( "comment-446140", "446140", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-446167">
<div class="comment-container" id="li-comment-446167">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/27a3ecb5b31b043f366dfcb777dc75cb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/27a3ecb5b31b043f366dfcb777dc75cb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mohammad H</span>
<span class="date">August 15, 2018 at 11:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-446167" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, Jason. How can we save the results of our model to use them later on?</p>
<div class="reply">
<a aria-label="Reply to mohammad H" class="comment-reply-link" href="#comment-446167" onclick='return addComment.moveForm( "comment-446167", "446167", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446195">
<div class="comment-container" id="li-comment-446195">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 16, 2018 at 6:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-446195" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this tutorial:<br/>
<a href="https://machinelearningmastery.com/save-load-keras-deep-learning-models/" rel="nofollow">https://machinelearningmastery.com/save-load-keras-deep-learning-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446195" onclick='return addComment.moveForm( "comment-446195", "446195", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-446826">
<div class="comment-container" id="li-comment-446826">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/275ae8894c0519003803f210fcbe3c98?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/275ae8894c0519003803f210fcbe3c98?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">khan</span>
<span class="date">August 24, 2018 at 4:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-446826" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I was using your code to solve a regression problem. I have the data defined exactly like you have but instead of casting them to one-hot-vectors I wish to leave them integers or floats.<br/>
I modified the code as follows:<br/>
<code><br/>
def define_models(n_input, n_output, n_units):<br/>
	# define training encoder<br/>
	encoder_inputs = Input(shape=(None, n_input))<br/>
	encoder = LSTM(n_units, return_state=True)<br/>
	encoder_outputs, state_h, state_c = encoder(encoder_inputs)<br/>
	encoder_states = [state_h, state_c]<br/>
	# define training decoder<br/>
	decoder_inputs = Input(shape=(None, n_output))<br/>
	decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True)<br/>
	decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)<br/>
	decoder_dense = Dense(n_output, activation='relu')<br/>
	decoder_outputs = decoder_dense(decoder_outputs)<br/>
	model = Model([encoder_inputs, decoder_inputs], decoder_outputs)<br/>
	# define inference encoder<br/>
	encoder_model = Model(encoder_inputs, encoder_states)<br/>
	# define inference decoder<br/>
	decoder_state_input_h = Input(shape=(n_units,))<br/>
	decoder_state_input_c = Input(shape=(n_units,))<br/>
	decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]<br/>
	decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)<br/>
	decoder_states = [state_h, state_c]<br/>
	decoder_outputs = decoder_dense(decoder_outputs)<br/>
	decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)<br/>
	# return all models<br/>
	return model, encoder_model, decoder_model<br/>
</code><br/>
However the model does not learn to predict for more than one future timesteps, gives correct prediction for only one ahead. Could you please suggest some solution. Much thanks!</p>
<p>I make the prediction then as follows:<br/>
def predict_sequence(infenc, infdec, source, n_steps):<br/>
    state = infenc.predict(source)<br/>
    output = list()<br/>
    pred=np.array([0]).reshape(1,1,1)<br/>
    for t in range(n_steps):<br/>
        yhat, h, c = infdec.predict([pred]+state)<br/>
        output.append(yhat[0,0,0])<br/>
        state = [h, c]<br/>
        pred = yhat<br/>
    return array(output)</p>
<div class="reply">
<a aria-label="Reply to khan" class="comment-reply-link" href="#comment-446826" onclick='return addComment.moveForm( "comment-446826", "446826", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446841">
<div class="comment-container" id="li-comment-446841">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2018 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-446841" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some ideas here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446841" onclick='return addComment.moveForm( "comment-446841", "446841", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-456239">
<div class="comment-container" id="li-comment-456239">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c5137858a8ce23f50a1073bd091b26fd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c5137858a8ce23f50a1073bd091b26fd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gilles Madi</span>
<span class="date">November 27, 2018 at 1:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-456239" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Khan, I have a similar proble the network not predicting more than one step ahead. did you find a solution?</p>
<div class="reply">
<a aria-label="Reply to Gilles Madi" class="comment-reply-link" href="#comment-456239" onclick='return addComment.moveForm( "comment-456239", "456239", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-447898">
<div class="comment-container" id="li-comment-447898">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84e2fb5328f373813297b361218a1936?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84e2fb5328f373813297b361218a1936?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://bctech.vn/" rel="external nofollow">Canh Bui</a></span>
<span class="date">September 5, 2018 at 1:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-447898" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for great serial about MLs,<br/>
In this tutorial, i have a bit complex (I’m a beginner in Python. I just have a little AI and ML theory).</p>
<p>y set (target sequence) is a part of X1. Clearly, y specified by X (reserve and subset). So,<br/>
1, In train model, Have you use y in X1 as input sequence (  sequence X1(y) =&gt; sequence y )<br/>
2, Can i define y separate with X1 (such as not subset, reserve…)?<br/>
Thanks you!</p>
<div class="reply">
<a aria-label="Reply to Canh Bui" class="comment-reply-link" href="#comment-447898" onclick='return addComment.moveForm( "comment-447898", "447898", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-447904">
<div class="comment-container" id="li-comment-447904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 5, 2018 at 2:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-447904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not sure I follow. Perhaps this will help you define your problem:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-447904" onclick='return addComment.moveForm( "comment-447904", "447904", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-454405">
<div class="comment-container" id="li-comment-454405">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/203d641b1c95f629e09b36545c17b2df?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/203d641b1c95f629e09b36545c17b2df?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">rahnema</span>
<span class="date">November 11, 2018 at 2:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-454405" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi sir<br/>
i want to generate seq from pretrained embedding and in details i have a set of embedding list and its corresponding sentence.and i want to have a model to generate sentence with that embedding data. but i don’t know how to develop that model.</p>
<div class="reply">
<a aria-label="Reply to rahnema" class="comment-reply-link" href="#comment-454405" onclick='return addComment.moveForm( "comment-454405", "454405", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-454469">
<div class="comment-container" id="li-comment-454469">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 12, 2018 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-454469" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use a model like an LSTM to generate text, but not an embedding alone.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-454469" onclick='return addComment.moveForm( "comment-454469", "454469", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-454670">
<div class="comment-container" id="li-comment-454670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e10e23d8577af2347d93fc034e86c43d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e10e23d8577af2347d93fc034e86c43d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">maxrutag</span>
<span class="date">November 13, 2018 at 11:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-454670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great work again! I am a big fan of your tutorials! </p>
<p>I am working on a water inflow forecast problem. I have access to weather predictions and I want to predict the water inflow, given the historical values of both weather and inflows.</p>
<p>I have tried a simple LSTM model with overlapping sequences (time series to supervised), taking weather predictions and past inflows as input, and outputting future inflows. This works pretty well. </p>
<p>Seeing all this Seq2Seq time series forecast trend, I have also tried it, by encoding the weather forecast and decoding them to water inflow (with past inflows as decoder inputs), expecting even better results.</p>
<p>But this Seq2Seq model is performing very poorly. Do you have an idea why? Should I give up this kind of models for my problem?</p>
<div class="reply">
<a aria-label="Reply to maxrutag" class="comment-reply-link" href="#comment-454670" onclick='return addComment.moveForm( "comment-454670", "454670", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-454715">
<div class="comment-container" id="li-comment-454715">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 14, 2018 at 7:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-454715" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try improving the performance of the model:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-454715" onclick='return addComment.moveForm( "comment-454715", "454715", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-455929">
<div class="comment-container" id="li-comment-455929">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c2b0090ecae47ba58f6545cc6eb73222?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c2b0090ecae47ba58f6545cc6eb73222?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">trancy</span>
<span class="date">November 23, 2018 at 7:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-455929" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I have read couple of your blogs about seq2seq and lstm. Wondering how should I combine this encoder-decoder model with attention? My scenario is kind of translation.</p>
<div class="reply">
<a aria-label="Reply to trancy" class="comment-reply-link" href="#comment-455929" onclick='return addComment.moveForm( "comment-455929", "455929", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-455973">
<div class="comment-container" id="li-comment-455973">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-455973" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure, attention often improves the performance of an encoder-decoder model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-455973" onclick='return addComment.moveForm( "comment-455973", "455973", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-456383">
<div class="comment-container" id="li-comment-456383">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/436692f7a8d9058510b2a43b8b7c5d2e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/436692f7a8d9058510b2a43b8b7c5d2e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Marcos Jimenez</span>
<span class="date">November 28, 2018 at 3:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-456383" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hey Jason, I have 2 questions :<br/>
question 1 – how do you estimate a “confidence” for a whole sequence prediction in a neural translation model. i guess you could multiply the individual probabilities for each time-step. somehow i’m not sure that is a proper way to do it. another approach is to feed the output sequence probabilities into a binary classifier (confident/not-confident) and take its value as the confidence score.<br/>
question 2 – how do ensure that the whole sequence prediction in a neural translation model is the optimal sequence. if you have a greedy approach where you take the max at each time-step you end up with a sequence which itself is probably not the most likely one. i’ve heard of beam search and other approaches. do you have an idea of the state-of-the-art ?</p>
<div class="reply">
<a aria-label="Reply to Marcos Jimenez" class="comment-reply-link" href="#comment-456383" onclick='return addComment.moveForm( "comment-456383", "456383", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-456418">
<div class="comment-container" id="li-comment-456418">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2018 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-456418" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can do a greedy search through the predicted probabilities to get the most likely word at each step, but it does not mean that it is the best sequence.</p>
<p>Perhaps look into a beam search.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-456418" onclick='return addComment.moveForm( "comment-456418", "456418", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-457446">
<div class="comment-container" id="li-comment-457446">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85bb0c5979cc10b5e4eebd7991fb253e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85bb0c5979cc10b5e4eebd7991fb253e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ashima</span>
<span class="date">December 6, 2018 at 2:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-457446" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Luke,</p>
<p>I am dealing with the same scenario of sequences of integers. </p>
<p>Before you input the sequence, you need to reshape the sequences to 3D and best to train the model in mini batches as it will reset the states after every iteration which works really well for LSTM based model.</p>
<p>Hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Ashima" class="comment-reply-link" href="#comment-457446" onclick='return addComment.moveForm( "comment-457446", "457446", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4569"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="e0d33b4273"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="22"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center><br/>
<strong>Long Short-Term Memory Networks</strong><br/>
Develop sequence prediction models in Keras.
<p><a href="/lstms-with-python/">Click to Get Started Now!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>