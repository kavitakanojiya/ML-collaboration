<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</title>
<link href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" property="og:title"/>
<meta content="A standard deep learning model for text classification and sentiment analysis uses a word embedding layer and one-dimensional convolutional neural network. The model can be expanded by using multiple parallel convolutional neural networks that read the source document using different kernel sizes. This, in effect, creates a multichannel convolutional neural network for text that reads …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="https://www.facebook.com/jason.brownlee.39" property="article:author"/>
<meta content="Deep Learning for Natural Language Processing" property="article:section"/>
<meta content="2018-01-11T18:00:36+00:00" property="article:published_time"/>
<meta content="2018-02-14T00:02:24+00:00" property="article:modified_time"/>
<meta content="2018-02-14T00:02:24+00:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png" property="og:image:secure_url"/>
<meta content="1579" property="og:image:width"/>
<meta content="959" property="og:image:height"/>
<meta content="Plot of the Multichannel Convolutional Neural Network For Text" property="og:image:alt"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style media="all" type="text/css">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8" id="wpautoterms_css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.5" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/css/front.css?ver=2.0.20" id="ssb-front-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8" id="ewd-ufaq-style-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8" id="ewd-ufaq-rrssb-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/simple-social-buttons/assets/js/front.js?ver=2.0.20" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4586" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
<script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4586 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Want help with deep learning for text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<input name="post_type" type="hidden" value="post"/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Main Menu</h3><ul class="nav fl" id="main-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503" id="menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501" id="menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506" id="menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508" id="menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511" id="menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6509" id="menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6515" id="menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512" id="menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507" id="menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513" id="menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516" id="menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517" id="menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522" id="menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518" id="menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510" id="menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519" id="menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520" id="menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523" id="menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514" id="menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502" id="menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500" id="menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504" id="menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505" id="menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4586 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-01-12T05:00:36+1100">January 12, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Deep Learning for Natural Language Processing">Deep Learning for Natural Language Processing</a></span> </div>
<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4586 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+an+N-gram+Multichannel+Convolutional+Neural+Network+for+Sentiment+Analysis&amp;url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>A standard deep learning model for text classification and sentiment analysis uses a word embedding layer and one-dimensional convolutional neural network.</p>
<p>The model can be expanded by using multiple parallel convolutional neural networks that read the source document using different kernel sizes. This, in effect, creates a multichannel convolutional neural network for text that reads text with different n-gram sizes (groups of words).</p>
<p>In this tutorial, you will discover how to develop a multichannel convolutional neural network for sentiment prediction on text movie review data.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to prepare movie review text data for modeling.</li>
<li>How to develop a multichannel convolutional neural network for text in Keras.</li>
<li>How to evaluate a fit model on unseen movie review data.</li>
</ul>
<p>Let’s get started.</p>
<ul>
<li><strong>Update Feb/2018</strong>: Small code change to reflect changes in Keras 2.1.3 API.</li>
</ul>
<div class="wp-caption aligncenter" id="attachment_4591" style="width: 650px"><img alt="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" class="size-full wp-image-4591" height="360" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-an-N-gram-Multichannel-Convolutional-Neural-Network-for-Sentiment-Analysis.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-an-N-gram-Multichannel-Convolutional-Neural-Network-for-Sentiment-Analysis.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-an-N-gram-Multichannel-Convolutional-Neural-Network-for-Sentiment-Analysis-300x169.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis<br/>Photo by <a href="https://www.flickr.com/photos/blachswan/32732882104/">Ed Dunens</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 4 parts; they are:</p>
<ol>
<li>Movie Review Dataset</li>
<li>Data Preparation</li>
<li>Develop Multichannel Model</li>
<li>Evaluate Model</li>
</ol>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python 3 SciPy environment installed.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div>
<h2>Movie Review Dataset</h2>
<p>The Movie Review Data is a collection of movie reviews retrieved from the imdb.com website in the early 2000s by Bo Pang and Lillian Lee. The reviews were collected and made available as part of their research on natural language processing.</p>
<p>The reviews were originally released in 2002, but an updated and cleaned up version was released in 2004, referred to as “v2.0”.</p>
<p>The dataset is comprised of 1,000 positive and 1,000 negative movie reviews drawn from an archive of the rec.arts.movies.reviews newsgroup hosted at imdb.com. The authors refer to this dataset as the “polarity dataset.”</p>
<blockquote><p>Our data contains 1000 positive and 1000 negative reviews all written before 2002, with a cap of 20 reviews per author (312 authors total) per category. We refer to this corpus as the polarity dataset.</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>The data has been cleaned up somewhat; for example:</p>
<ul>
<li>The dataset is comprised of only English reviews.</li>
<li>All text has been converted to lowercase.</li>
<li>There is white space around punctuation like periods, commas, and brackets.</li>
<li>Text has been split into one sentence per line.</li>
</ul>
<p>The data has been used for a few related natural language processing tasks. For classification, the performance of machine learning models (such as Support Vector Machines) on the data is in the range of high 70% to low 80% (e.g. 78%-82%).</p>
<p>More sophisticated data preparation may see results as high as 86% with 10-fold cross-validation. This gives us a ballpark of low-to-mid 80s if we were looking to use this dataset in experiments of modern methods.</p>
<blockquote><p>… depending on choice of downstream polarity classifier, we can achieve highly statistically significant improvement (from 82.8% to 86.4%)</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>You can download the dataset from here:</p>
<ul>
<li><a href="https://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz">Movie Review Polarity Dataset</a> (review_polarity.tar.gz, 3MB)</li>
</ul>
<p>After unzipping the file, you will have a directory called “<em>txt_sentoken</em>” with two sub-directories containing the text “<em>neg</em>” and “<em>pos</em>” for negative and positive reviews. Reviews are stored one per file with a naming convention <em>cv000</em> to <em>cv999</em> for each neg and pos.</p>
<p>Next, let’s look at loading and preparing the text data.</p>
<h2>Data Preparation</h2>
<p>In this section, we will look at 3 things:</p>
<ol>
<li>Separation of data into training and test sets.</li>
<li>Loading and cleaning the data to remove punctuation and numbers.</li>
<li>Prepare all reviews and save to file.</li>
</ol>
<h3>Split into Train and Test Sets</h3>
<p>We are pretending that we are developing a system that can predict the sentiment of a textual movie review as either positive or negative.</p>
<p>This means that after the model is developed, we will need to make predictions on new textual reviews. This will require all of the same data preparation to be performed on those new reviews as is performed on the training data for the model.</p>
<p>We will ensure that this constraint is built into the evaluation of our models by splitting the training and test datasets prior to any data preparation. This means that any knowledge in the data in the test set that could help us better prepare the data (e.g. the words used) is unavailable in the preparation of data used for training the model.</p>
<p>That being said, we will use the last 100 positive reviews and the last 100 negative reviews as a test set (100 reviews) and the remaining 1,800 reviews as the training dataset.</p>
<p>This is a 90% train, 10% split of the data.</p>
<p>The split can be imposed easily by using the filenames of the reviews where reviews named 000 to 899 are for training data and reviews named 900 onwards are for test.</p>
<h3>Loading and Cleaning Reviews</h3>
<p>The text data is already pretty clean; not much preparation is required.</p>
<p>Without getting bogged down too much by the details, we will prepare the data in the following way:</p>
<ul>
<li>Split tokens on white space.</li>
<li>Remove all punctuation from words.</li>
<li>Remove all words that are not purely comprised of alphabetical characters.</li>
<li>Remove all words that are known stop words.</li>
<li>Remove all words that have a length &lt;= 1 character.</li>
</ul>
<p>We can put all of these steps into a function called <em>clean_doc()</em> that takes as an argument the raw text loaded from a file and returns a list of cleaned tokens. We can also define a function <em>load_doc()</em> that loads a document from file ready for use with the <em>clean_doc()</em> function. An example of cleaning the first positive review is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671c7096890222" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from nltk.corpus import stopwords
import string

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', string.punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	return tokens

# load the document
filename = 'txt_sentoken/pos/cv000_29590.txt'
text = load_doc(filename)
tokens = clean_doc(text)
print(tokens)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-16">16</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-18">18</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-20">20</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-22">22</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-24">24</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-26">26</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-28">28</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-30">30</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-32">32</div><div class="crayon-num" data-line="crayon-5c0ca631671c7096890222-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671c7096890222-34">34</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671c7096890222-1"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-e">stopwords</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-2"><span class="crayon-e">import </span><span class="crayon-t">string</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-4"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-5"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-6"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-7"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-8"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-9"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-10"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-11"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-14"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-15"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-16"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-17"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-18"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-19"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-20"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-21"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-23"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-24"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-25"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-26"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-30"><span class="crayon-p"># load the document</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-31"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'txt_sentoken/pos/cv000_29590.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-32"><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671c7096890222-33"><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671c7096890222-34"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running the example loads and cleans one movie review.</p>
<p>The tokens from the clean review are printed for review.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671d0343224665" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671d0343224665-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d0343224665-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671d0343224665-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d0343224665-2">'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Clean All Reviews and Save</h3>
<p>We can now use the function to clean reviews and apply it to all reviews.</p>
<p>To do this, we will develop a new function named <em>process_docs()</em> below that will walk through all reviews in a directory, clean them, and return them as a list.</p>
<p>We will also add an argument to the function to indicate whether the function is processing train or test reviews, that way the filenames can be filtered (as described above) and only those train or test reviews requested will be cleaned and returned.</p>
<p>The full function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671d2252056554" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all docs in a directory
def process_docs(directory, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc)
		# add to list
		documents.append(tokens)
	return documents</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-16">16</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d2252056554-18">18</div><div class="crayon-num" data-line="crayon-5c0ca631671d2252056554-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671d2252056554-1"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-2"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-3"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-4"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-6"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-8"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-10"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-11"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-12"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-13"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-14"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-15"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-16"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-17"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d2252056554-18"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d2252056554-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We can call this function with negative training reviews as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671d4711833638" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
negative_docs = process_docs('txt_sentoken/neg', True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671d4711833638-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671d4711833638-1"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, we need labels for the train and test documents. We know that we have 900 training documents and 100 test documents. We can use a Python list comprehension to create the labels for the negative (0) and positive (1) reviews for both train and test sets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671d6127978071" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
trainy = [0 for _ in range(900)] + [1 for _ in range(900)]
testY = [0 for _ in range(100)] + [1 for _ in range(100)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671d6127978071-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d6127978071-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671d6127978071-1"><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d6127978071-2"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Finally, we want to save the prepared train and test sets to file so that we can load them later for modeling and model evaluation.</p>
<p>The function below-named <em>save_dataset()</em> will save a given prepared dataset (X and y elements) to a file using the pickle API.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671d7184355042" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# save a dataset to file
def save_dataset(dataset, filename):
	dump(dataset, open(filename, 'wb'))
	print('Saved: %s' % filename)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671d7184355042-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d7184355042-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671d7184355042-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d7184355042-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671d7184355042-1"><span class="crayon-p"># save a dataset to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d7184355042-2"><span class="crayon-e">def </span><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671d7184355042-3"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d7184355042-4"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>We can tie all of these data preparation steps together.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671d9020432287" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from nltk.corpus import stopwords
from pickle import dump

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc)
		# add to list
		documents.append(tokens)
	return documents

# save a dataset to file
def save_dataset(dataset, filename):
	dump(dataset, open(filename, 'wb'))
	print('Saved: %s' % filename)

# load all training reviews
negative_docs = process_docs('txt_sentoken/neg', True)
positive_docs = process_docs('txt_sentoken/pos', True)
trainX = negative_docs + positive_docs
trainy = [0 for _ in range(900)] + [1 for _ in range(900)]
save_dataset([trainX,trainy], 'train.pkl')

# load all test reviews
negative_docs = process_docs('txt_sentoken/neg', False)
positive_docs = process_docs('txt_sentoken/pos', False)
testX = negative_docs + positive_docs
testY = [0 for _ in range(100)] + [1 for _ in range(100)]
save_dataset([testX,testY], 'test.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-16">16</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-18">18</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-20">20</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-22">22</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-24">24</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-26">26</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-28">28</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-30">30</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-32">32</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-34">34</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-36">36</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-38">38</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-40">40</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-42">42</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-44">44</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-46">46</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-48">48</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-50">50</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-52">52</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-54">54</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-56">56</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-58">58</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-60">60</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-62">62</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-64">64</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-66">66</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-68">68</div><div class="crayon-num" data-line="crayon-5c0ca631671d9020432287-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671d9020432287-70">70</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671d9020432287-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-3"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-e">stopwords</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-4"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-v">dump</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-6"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-7"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-8"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-9"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-10"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-11"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-12"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-13"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-16"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-17"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-18"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-19"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-20"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-21"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-23"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-24"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-25"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-26"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-28"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-29"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-30"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-31"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-32"> </div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-33"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-34"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-35"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-36"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-37"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-38"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-39"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-40"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-41"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-42"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-43"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-44"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-45"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-46"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-47"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-48"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-49"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-50"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-51"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-52"> </div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-53"><span class="crayon-p"># save a dataset to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-54"><span class="crayon-e">def </span><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-55"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-56"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-57"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-58"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-59"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-60"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-61"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-62"><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-63"><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainy</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-64"> </div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-65"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-66"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-67"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-68"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line" id="crayon-5c0ca631671d9020432287-69"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671d9020432287-70"><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'test.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0034 seconds] -->
<p>Running the example cleans the text movie review documents, creates labels, and saves the prepared data for both train and test datasets in <em>train.pkl</em> and <em>test.pkl</em> respectively.</p>
<p>Now we are ready to develop our model.</p>
<h2>Develop Multichannel Model</h2>
<p>In this section, we will develop a multichannel convolutional neural network for the sentiment analysis prediction problem.</p>
<p>This section is divided into 3 parts:</p>
<ol>
<li>Encode Data</li>
<li>Define Model.</li>
<li>Complete Example.</li>
</ol>
<h3>Encode Data</h3>
<p>The first step is to load the cleaned training dataset.</p>
<p>The function below-named <em>load_dataset()</em> can be called to load the pickled training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671db408808729" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load a clean dataset
def load_dataset(filename):
	return load(open(filename, 'rb'))

trainLines, trainLabels = load_dataset('train.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671db408808729-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671db408808729-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671db408808729-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671db408808729-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671db408808729-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671db408808729-1"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671db408808729-2"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671db408808729-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671db408808729-4"> </div><div class="crayon-line" id="crayon-5c0ca631671db408808729-5"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we must fit a Keras Tokenizer on the training dataset. We will use this tokenizer to both define the vocabulary for the Embedding layer and encode the review documents as integers.</p>
<p>The function <em>create_tokenizer()</em> below will create a Tokenizer given a list of documents.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671dd648735552" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671dd648735552-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671dd648735552-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671dd648735552-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671dd648735552-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671dd648735552-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671dd648735552-1"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671dd648735552-2"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671dd648735552-3"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671dd648735552-4"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671dd648735552-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We also need to know the maximum length of input sequences as input for the model and to pad all sequences to the fixed length.</p>
<p>The function <em>max_length()</em> below will calculate the maximum length (number of words) for all reviews in the training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671e4150743538" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# calculate the maximum document length
def max_length(lines):
	return max([len(s.split()) for s in lines])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671e4150743538-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e4150743538-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671e4150743538-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671e4150743538-1"><span class="crayon-p"># calculate the maximum document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e4150743538-2"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671e4150743538-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We also need to know the size of the vocabulary for the Embedding layer.</p>
<p>This can be calculated from the prepared Tokenizer, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671e5667494631" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671e5667494631-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e5667494631-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671e5667494631-1"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e5667494631-2"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Finally, we can integer encode and pad the clean movie review text.</p>
<p>The function below named <em>encode_text()</em> will both encode and pad text data to the maximum review length.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671e7173508450" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# encode a list of lines
def encode_text(tokenizer, lines, length):
	# integer encode
	encoded = tokenizer.texts_to_sequences(lines)
	# pad encoded sequences
	padded = pad_sequences(encoded, maxlen=length, padding='post')
	return padded</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671e7173508450-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e7173508450-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671e7173508450-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e7173508450-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671e7173508450-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e7173508450-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671e7173508450-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671e7173508450-1"><span class="crayon-p"># encode a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e7173508450-2"><span class="crayon-e">def </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671e7173508450-3"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e7173508450-4"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e7173508450-5"><span class="crayon-h"> </span><span class="crayon-p"># pad encoded sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e7173508450-6"><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e7173508450-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">padded</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p></p>
<h3>Define Model</h3>
<p>A standard model for document classification is to use an Embedding layer as input, followed by a one-dimensional convolutional neural network, pooling layer, and then a prediction output layer.</p>
<p>The kernel size in the convolutional layer defines the number of words to consider as the convolution is passed across the input text document, providing a grouping parameter.</p>
<p>A multi-channel convolutional neural network for document classification involves using multiple versions of the standard model with different sized kernels. This allows the document to be processed at different resolutions or different n-grams (groups of words) at a time, whilst the model learns how to best integrate these interpretations.</p>
<p>This approach was first described by Yoon Kim in his 2014 paper titled “<a href="https://arxiv.org/abs/1408.5882">Convolutional Neural Networks for Sentence Classification</a>.”</p>
<p>In the paper, Kim experimented with static and dynamic (updated) embedding layers, we can simplify the approach and instead focus only on the use of different kernel sizes.</p>
<p>This approach is best understood with a diagram taken from Kim’s paper:</p>
<div class="wp-caption aligncenter" id="attachment_4587" style="width: 1692px"><img alt="Depiction of the multiple-channel convolutional neural network for text" class="size-full wp-image-4587" height="672" sizes="(max-width: 1682px) 100vw, 1682px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text.png 1682w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text-300x120.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text-768x307.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text-1024x409.png 1024w" width="1682"/><p class="wp-caption-text">Depiction of the multiple-channel convolutional neural network for text.<br/>Taken from “Convolutional Neural Networks for Sentence Classification.”</p></div>
<p>In Keras, a multiple-input model can be defined using the <a href="https://keras.io/getting-started/functional-api-guide/">functional API</a>.</p>
<p>We will define a model with three input channels for processing 4-grams, 6-grams, and 8-grams of movie review text.</p>
<p>Each channel is comprised of the following elements:</p>
<ul>
<li>Input layer that defines the length of input sequences.</li>
<li>Embedding layer set to the size of the vocabulary and 100-dimensional real-valued representations.</li>
<li>One-dimensional convolutional layer with 32 filters and a kernel size set to the number of words to read at once.</li>
<li>Max Pooling layer to consolidate the output from the convolutional layer.</li>
<li>Flatten layer to reduce the three-dimensional output to two dimensional for concatenation.</li>
</ul>
<p>The output from the three channels are concatenated into a single vector and process by a Dense layer and an output layer.</p>
<p>The function below defines and returns the model. As part of defining the model, a summary of the defined model is printed and a plot of the model graph is created and saved to file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671e9293477420" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define the model
def define_model(length, vocab_size):
	# channel 1
	inputs1 = Input(shape=(length,))
	embedding1 = Embedding(vocab_size, 100)(inputs1)
	conv1 = Conv1D(filters=32, kernel_size=4, activation='relu')(embedding1)
	drop1 = Dropout(0.5)(conv1)
	pool1 = MaxPooling1D(pool_size=2)(drop1)
	flat1 = Flatten()(pool1)
	# channel 2
	inputs2 = Input(shape=(length,))
	embedding2 = Embedding(vocab_size, 100)(inputs2)
	conv2 = Conv1D(filters=32, kernel_size=6, activation='relu')(embedding2)
	drop2 = Dropout(0.5)(conv2)
	pool2 = MaxPooling1D(pool_size=2)(drop2)
	flat2 = Flatten()(pool2)
	# channel 3
	inputs3 = Input(shape=(length,))
	embedding3 = Embedding(vocab_size, 100)(inputs3)
	conv3 = Conv1D(filters=32, kernel_size=8, activation='relu')(embedding3)
	drop3 = Dropout(0.5)(conv3)
	pool3 = MaxPooling1D(pool_size=2)(drop3)
	flat3 = Flatten()(pool3)
	# merge
	merged = concatenate([flat1, flat2, flat3])
	# interpretation
	dense1 = Dense(10, activation='relu')(merged)
	outputs = Dense(1, activation='sigmoid')(dense1)
	model = Model(inputs=[inputs1, inputs2, inputs3], outputs=outputs)
	# compile
	model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
	# summarize
	print(model.summary())
	plot_model(model, show_shapes=True, to_file='multichannel.png')
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-16">16</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-18">18</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-20">20</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-22">22</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-24">24</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-26">26</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-28">28</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-30">30</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-32">32</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671e9293477420-34">34</div><div class="crayon-num" data-line="crayon-5c0ca631671e9293477420-35">35</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671e9293477420-1"><span class="crayon-p"># define the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-2"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-3"><span class="crayon-h"> </span><span class="crayon-p"># channel 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-4"><span class="crayon-h"> </span><span class="crayon-v">inputs1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-5"><span class="crayon-h"> </span><span class="crayon-v">embedding1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-6"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-7"><span class="crayon-h"> </span><span class="crayon-v">drop1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-8"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-9"><span class="crayon-h"> </span><span class="crayon-v">flat1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-10"><span class="crayon-h"> </span><span class="crayon-p"># channel 2</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-11"><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-12"><span class="crayon-h"> </span><span class="crayon-v">embedding2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-13"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-14"><span class="crayon-h"> </span><span class="crayon-v">drop2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-15"><span class="crayon-h"> </span><span class="crayon-v">pool2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-16"><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-17"><span class="crayon-h"> </span><span class="crayon-p"># channel 3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-18"><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-19"><span class="crayon-h"> </span><span class="crayon-v">embedding3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-20"><span class="crayon-h"> </span><span class="crayon-v">conv3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-21"><span class="crayon-h"> </span><span class="crayon-v">drop3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-22"><span class="crayon-h"> </span><span class="crayon-v">pool3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-23"><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-24"><span class="crayon-h"> </span><span class="crayon-p"># merge</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-25"><span class="crayon-h"> </span><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">flat1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-26"><span class="crayon-h"> </span><span class="crayon-p"># interpretation</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-27"><span class="crayon-h"> </span><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-28"><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-29"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">inputs1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-30"><span class="crayon-h"> </span><span class="crayon-p"># compile</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-31"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-32"><span class="crayon-h"> </span><span class="crayon-p"># summarize</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-33"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671e9293477420-34"><span class="crayon-h"> </span><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'multichannel.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671e9293477420-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0026 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>Pulling all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671ec918204182" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from numpy import array
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.utils.vis_utils import plot_model
from keras.models import Model
from keras.layers import Input
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Dropout
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D
from keras.layers.merge import concatenate

# load a clean dataset
def load_dataset(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# calculate the maximum document length
def max_length(lines):
	return max([len(s.split()) for s in lines])

# encode a list of lines
def encode_text(tokenizer, lines, length):
	# integer encode
	encoded = tokenizer.texts_to_sequences(lines)
	# pad encoded sequences
	padded = pad_sequences(encoded, maxlen=length, padding='post')
	return padded

# define the model
def define_model(length, vocab_size):
	# channel 1
	inputs1 = Input(shape=(length,))
	embedding1 = Embedding(vocab_size, 100)(inputs1)
	conv1 = Conv1D(filters=32, kernel_size=4, activation='relu')(embedding1)
	drop1 = Dropout(0.5)(conv1)
	pool1 = MaxPooling1D(pool_size=2)(drop1)
	flat1 = Flatten()(pool1)
	# channel 2
	inputs2 = Input(shape=(length,))
	embedding2 = Embedding(vocab_size, 100)(inputs2)
	conv2 = Conv1D(filters=32, kernel_size=6, activation='relu')(embedding2)
	drop2 = Dropout(0.5)(conv2)
	pool2 = MaxPooling1D(pool_size=2)(drop2)
	flat2 = Flatten()(pool2)
	# channel 3
	inputs3 = Input(shape=(length,))
	embedding3 = Embedding(vocab_size, 100)(inputs3)
	conv3 = Conv1D(filters=32, kernel_size=8, activation='relu')(embedding3)
	drop3 = Dropout(0.5)(conv3)
	pool3 = MaxPooling1D(pool_size=2)(drop3)
	flat3 = Flatten()(pool3)
	# merge
	merged = concatenate([flat1, flat2, flat3])
	# interpretation
	dense1 = Dense(10, activation='relu')(merged)
	outputs = Dense(1, activation='sigmoid')(dense1)
	model = Model(inputs=[inputs1, inputs2, inputs3], outputs=outputs)
	# compile
	model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
	# summarize
	print(model.summary())
	plot_model(model, show_shapes=True, to_file='multichannel.png')
	return model

# load training dataset
trainLines, trainLabels = load_dataset('train.pkl')
# create tokenizer
tokenizer = create_tokenizer(trainLines)
# calculate max document length
length = max_length(trainLines)
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1
print('Max document length: %d' % length)
print('Vocabulary size: %d' % vocab_size)
# encode data
trainX = encode_text(tokenizer, trainLines, length)
print(trainX.shape)

# define model
model = define_model(length, vocab_size)
# fit model
model.fit([trainX,trainX,trainX], array(trainLabels), epochs=10, batch_size=16)
# save the model
model.save('model.h5')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-16">16</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-18">18</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-20">20</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-22">22</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-24">24</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-26">26</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-28">28</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-30">30</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-32">32</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-34">34</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-36">36</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-38">38</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-40">40</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-42">42</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-44">44</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-46">46</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-48">48</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-50">50</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-52">52</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-54">54</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-56">56</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-58">58</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-60">60</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-62">62</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-64">64</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-66">66</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-68">68</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-70">70</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-72">72</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-74">74</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-76">76</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-78">78</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-80">80</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-82">82</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-84">84</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-86">86</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-88">88</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-90">90</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ec918204182-92">92</div><div class="crayon-num" data-line="crayon-5c0ca631671ec918204182-93">93</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671ec918204182-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-e">plot_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-14"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">merge </span><span class="crayon-e">import </span><span class="crayon-v">concatenate</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-16"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-17"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-19"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-20"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-21"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-22"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-23"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-24"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-25"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-26"><span class="crayon-p"># calculate the maximum document length</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-27"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-30"><span class="crayon-p"># encode a list of lines</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-31"><span class="crayon-e">def </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-32"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-33"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-34"><span class="crayon-h"> </span><span class="crayon-p"># pad encoded sequences</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-35"><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">padded</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-38"><span class="crayon-p"># define the model</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-39"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-40"><span class="crayon-h"> </span><span class="crayon-p"># channel 1</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-41"><span class="crayon-h"> </span><span class="crayon-v">inputs1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-42"><span class="crayon-h"> </span><span class="crayon-v">embedding1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-43"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-44"><span class="crayon-h"> </span><span class="crayon-v">drop1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-45"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-46"><span class="crayon-h"> </span><span class="crayon-v">flat1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-47"><span class="crayon-h"> </span><span class="crayon-p"># channel 2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-48"><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-49"><span class="crayon-h"> </span><span class="crayon-v">embedding2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-50"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-51"><span class="crayon-h"> </span><span class="crayon-v">drop2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-52"><span class="crayon-h"> </span><span class="crayon-v">pool2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-53"><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-54"><span class="crayon-h"> </span><span class="crayon-p"># channel 3</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-55"><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-56"><span class="crayon-h"> </span><span class="crayon-v">embedding3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-57"><span class="crayon-h"> </span><span class="crayon-v">conv3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-58"><span class="crayon-h"> </span><span class="crayon-v">drop3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-59"><span class="crayon-h"> </span><span class="crayon-v">pool3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-60"><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-61"><span class="crayon-h"> </span><span class="crayon-p"># merge</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-62"><span class="crayon-h"> </span><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">flat1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-63"><span class="crayon-h"> </span><span class="crayon-p"># interpretation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-64"><span class="crayon-h"> </span><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-65"><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-66"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">inputs1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-67"><span class="crayon-h"> </span><span class="crayon-p"># compile</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-68"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-69"><span class="crayon-h"> </span><span class="crayon-p"># summarize</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-70"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-71"><span class="crayon-h"> </span><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'multichannel.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-72"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-73"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-74"><span class="crayon-p"># load training dataset</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-75"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-76"><span class="crayon-p"># create tokenizer</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-77"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-78"><span class="crayon-p"># calculate max document length</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-79"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-80"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-81"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-82"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Max document length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-83"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-84"><span class="crayon-p"># encode data</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-85"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-86"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-88"><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-89"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-90"><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-91"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">trainLabels</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">16</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ec918204182-92"><span class="crayon-p"># save the model</span></div><div class="crayon-line" id="crayon-5c0ca631671ec918204182-93"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">save</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0047 seconds] -->
<p>Running the example first prints a summary of the prepared training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671ee894289782" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Max document length: 1380
Vocabulary size: 44277
(1800, 1380)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671ee894289782-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671ee894289782-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671ee894289782-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671ee894289782-1">Max document length: 1380</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671ee894289782-2">Vocabulary size: 44277</div><div class="crayon-line" id="crayon-5c0ca631671ee894289782-3">(1800, 1380)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Next, a summary of the defined model is printed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671f0032581214" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
____________________________________________________________________________________________________
Layer (type)                     Output Shape          Param #     Connected to
====================================================================================================
input_1 (InputLayer)             (None, 1380)          0
____________________________________________________________________________________________________
input_2 (InputLayer)             (None, 1380)          0
____________________________________________________________________________________________________
input_3 (InputLayer)             (None, 1380)          0
____________________________________________________________________________________________________
embedding_1 (Embedding)          (None, 1380, 100)     4427700     input_1[0][0]
____________________________________________________________________________________________________
embedding_2 (Embedding)          (None, 1380, 100)     4427700     input_2[0][0]
____________________________________________________________________________________________________
embedding_3 (Embedding)          (None, 1380, 100)     4427700     input_3[0][0]
____________________________________________________________________________________________________
conv1d_1 (Conv1D)                (None, 1377, 32)      12832       embedding_1[0][0]
____________________________________________________________________________________________________
conv1d_2 (Conv1D)                (None, 1375, 32)      19232       embedding_2[0][0]
____________________________________________________________________________________________________
conv1d_3 (Conv1D)                (None, 1373, 32)      25632       embedding_3[0][0]
____________________________________________________________________________________________________
dropout_1 (Dropout)              (None, 1377, 32)      0           conv1d_1[0][0]
____________________________________________________________________________________________________
dropout_2 (Dropout)              (None, 1375, 32)      0           conv1d_2[0][0]
____________________________________________________________________________________________________
dropout_3 (Dropout)              (None, 1373, 32)      0           conv1d_3[0][0]
____________________________________________________________________________________________________
max_pooling1d_1 (MaxPooling1D)   (None, 688, 32)       0           dropout_1[0][0]
____________________________________________________________________________________________________
max_pooling1d_2 (MaxPooling1D)   (None, 687, 32)       0           dropout_2[0][0]
____________________________________________________________________________________________________
max_pooling1d_3 (MaxPooling1D)   (None, 686, 32)       0           dropout_3[0][0]
____________________________________________________________________________________________________
flatten_1 (Flatten)              (None, 22016)         0           max_pooling1d_1[0][0]
____________________________________________________________________________________________________
flatten_2 (Flatten)              (None, 21984)         0           max_pooling1d_2[0][0]
____________________________________________________________________________________________________
flatten_3 (Flatten)              (None, 21952)         0           max_pooling1d_3[0][0]
____________________________________________________________________________________________________
concatenate_1 (Concatenate)      (None, 65952)         0           flatten_1[0][0]
                                                                   flatten_2[0][0]
                                                                   flatten_3[0][0]
____________________________________________________________________________________________________
dense_1 (Dense)                  (None, 10)            659530      concatenate_1[0][0]
____________________________________________________________________________________________________
dense_2 (Dense)                  (None, 1)             11          dense_1[0][0]
====================================================================================================
Total params: 14,000,337
Trainable params: 14,000,337
Non-trainable params: 0
____________________________________________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-16">16</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-18">18</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-20">20</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-22">22</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-24">24</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-26">26</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-28">28</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-30">30</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-32">32</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-34">34</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-36">36</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-38">38</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-40">40</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-42">42</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-44">44</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-46">46</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-48">48</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f0032581214-50">50</div><div class="crayon-num" data-line="crayon-5c0ca631671f0032581214-51">51</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671f0032581214-1">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-2">Layer (type)                     Output Shape          Param #     Connected to</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-3">====================================================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-4">input_1 (InputLayer)             (None, 1380)          0</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-5">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-6">input_2 (InputLayer)             (None, 1380)          0</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-7">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-8">input_3 (InputLayer)             (None, 1380)          0</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-9">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-10">embedding_1 (Embedding)          (None, 1380, 100)     4427700     input_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-11">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-12">embedding_2 (Embedding)          (None, 1380, 100)     4427700     input_2[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-13">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-14">embedding_3 (Embedding)          (None, 1380, 100)     4427700     input_3[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-15">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-16">conv1d_1 (Conv1D)                (None, 1377, 32)      12832       embedding_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-17">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-18">conv1d_2 (Conv1D)                (None, 1375, 32)      19232       embedding_2[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-19">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-20">conv1d_3 (Conv1D)                (None, 1373, 32)      25632       embedding_3[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-21">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-22">dropout_1 (Dropout)              (None, 1377, 32)      0           conv1d_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-23">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-24">dropout_2 (Dropout)              (None, 1375, 32)      0           conv1d_2[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-25">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-26">dropout_3 (Dropout)              (None, 1373, 32)      0           conv1d_3[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-27">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-28">max_pooling1d_1 (MaxPooling1D)   (None, 688, 32)       0           dropout_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-29">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-30">max_pooling1d_2 (MaxPooling1D)   (None, 687, 32)       0           dropout_2[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-31">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-32">max_pooling1d_3 (MaxPooling1D)   (None, 686, 32)       0           dropout_3[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-33">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-34">flatten_1 (Flatten)              (None, 22016)         0           max_pooling1d_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-35">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-36">flatten_2 (Flatten)              (None, 21984)         0           max_pooling1d_2[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-37">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-38">flatten_3 (Flatten)              (None, 21952)         0           max_pooling1d_3[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-39">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-40">concatenate_1 (Concatenate)      (None, 65952)         0           flatten_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-41">                                                                   flatten_2[0][0]</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-42">                                                                   flatten_3[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-43">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-44">dense_1 (Dense)                  (None, 10)            659530      concatenate_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-45">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-46">dense_2 (Dense)                  (None, 1)             11          dense_1[0][0]</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-47">====================================================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-48">Total params: 14,000,337</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-49">Trainable params: 14,000,337</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f0032581214-50">Non-trainable params: 0</div><div class="crayon-line" id="crayon-5c0ca631671f0032581214-51">____________________________________________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The model is fit relatively quickly and appears to show good skill on the training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671f3882462554" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
1800/1800 [==============================] - 30s - loss: 9.9093e-04 - acc: 1.0000
Epoch 7/10
1800/1800 [==============================] - 29s - loss: 5.1899e-04 - acc: 1.0000
Epoch 8/10
1800/1800 [==============================] - 28s - loss: 3.7958e-04 - acc: 1.0000
Epoch 9/10
1800/1800 [==============================] - 29s - loss: 3.0534e-04 - acc: 1.0000
Epoch 10/10
1800/1800 [==============================] - 29s - loss: 2.6234e-04 - acc: 1.0000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671f3882462554-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f3882462554-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671f3882462554-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f3882462554-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671f3882462554-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f3882462554-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671f3882462554-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f3882462554-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671f3882462554-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f3882462554-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671f3882462554-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671f3882462554-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f3882462554-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5c0ca631671f3882462554-3">1800/1800 [==============================] - 30s - loss: 9.9093e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f3882462554-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5c0ca631671f3882462554-5">1800/1800 [==============================] - 29s - loss: 5.1899e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f3882462554-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5c0ca631671f3882462554-7">1800/1800 [==============================] - 28s - loss: 3.7958e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f3882462554-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5c0ca631671f3882462554-9">1800/1800 [==============================] - 29s - loss: 3.0534e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f3882462554-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5c0ca631671f3882462554-11">1800/1800 [==============================] - 29s - loss: 2.6234e-04 - acc: 1.0000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A plot of the defined model is saved to file, clearly showing the three input channels for the model.</p>
<div class="wp-caption aligncenter" id="attachment_4588" style="width: 1589px"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="size-full wp-image-4588" height="959" sizes="(max-width: 1579px) 100vw, 1579px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png 1579w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-300x182.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-768x466.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-1024x622.png 1024w" width="1579"/><p class="wp-caption-text">Plot of the Multichannel Convolutional Neural Network For Text</p></div>
<p>The model is fit for a number of epochs and saved to the file <em>model.h5</em> for later evaluation.</p>
<h2>Evaluate Model</h2>
<p>In this section, we can evaluate the fit model by predicting the sentiment on all reviews in the unseen test dataset.</p>
<p>Using the data loading functions developed in the previous section, we can load and encode both the training and test datasets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671f6515106696" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load datasets
trainLines, trainLabels = load_dataset('train.pkl')
testLines, testLabels = load_dataset('test.pkl')

# create tokenizer
tokenizer = create_tokenizer(trainLines)
# calculate max document length
length = max_length(trainLines)
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1
print('Max document length: %d' % length)
print('Vocabulary size: %d' % vocab_size)
# encode data
trainX = encode_text(tokenizer, trainLines, length)
testX = encode_text(tokenizer, testLines, length)
print(trainX.shape, testX.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671f6515106696-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f6515106696-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671f6515106696-1"><span class="crayon-p"># load datasets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-2"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f6515106696-3"><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-4"> </div><div class="crayon-line" id="crayon-5c0ca631671f6515106696-5"><span class="crayon-p"># create tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-6"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f6515106696-7"><span class="crayon-p"># calculate max document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-8"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f6515106696-9"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-10"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca631671f6515106696-11"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Max document length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-12"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f6515106696-13"><span class="crayon-p"># encode data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-14"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f6515106696-15"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f6515106696-16"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We can load the saved model and evaluate it on both the training and test datasets.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671f8265622606" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from numpy import array
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import load_model

# load a clean dataset
def load_dataset(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# calculate the maximum document length
def max_length(lines):
	return max([len(s.split()) for s in lines])

# encode a list of lines
def encode_text(tokenizer, lines, length):
	# integer encode
	encoded = tokenizer.texts_to_sequences(lines)
	# pad encoded sequences
	padded = pad_sequences(encoded, maxlen=length, padding='post')
	return padded

# load datasets
trainLines, trainLabels = load_dataset('train.pkl')
testLines, testLabels = load_dataset('test.pkl')

# create tokenizer
tokenizer = create_tokenizer(trainLines)
# calculate max document length
length = max_length(trainLines)
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1
print('Max document length: %d' % length)
print('Vocabulary size: %d' % vocab_size)
# encode data
trainX = encode_text(tokenizer, trainLines, length)
testX = encode_text(tokenizer, testLines, length)
print(trainX.shape, testX.shape)

# load the model
model = load_model('model.h5')

# evaluate model on training dataset
loss, acc = model.evaluate([trainX,trainX,trainX], array(trainLabels), verbose=0)
print('Train Accuracy: %f' % (acc*100))

# evaluate model on test dataset dataset
loss, acc = model.evaluate([testX,testX,testX],array(testLabels), verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-6">6</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-8">8</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-10">10</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-12">12</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-14">14</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-16">16</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-18">18</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-20">20</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-22">22</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-24">24</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-26">26</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-28">28</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-30">30</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-32">32</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-34">34</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-36">36</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-38">38</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-40">40</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-42">42</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-44">44</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-46">46</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-48">48</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-50">50</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-52">52</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671f8265622606-54">54</div><div class="crayon-num" data-line="crayon-5c0ca631671f8265622606-55">55</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671f8265622606-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-v">load_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-6"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-7"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-8"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-10"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-11"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-12"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-13"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-14"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-16"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-17"><span class="crayon-p"># calculate the maximum document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-18"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-20"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-21"><span class="crayon-p"># encode a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-22"><span class="crayon-e">def </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-23"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-24"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-25"><span class="crayon-h"> </span><span class="crayon-p"># pad encoded sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-26"><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">padded</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-28"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-29"><span class="crayon-p"># load datasets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-30"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-31"><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-32"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-33"><span class="crayon-p"># create tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-34"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-35"><span class="crayon-p"># calculate max document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-36"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-37"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-38"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-39"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Max document length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-40"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-41"><span class="crayon-p"># encode data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-42"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-43"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-44"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-45"> </div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-46"><span class="crayon-p"># load the model</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-47"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-48"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-49"><span class="crayon-p"># evaluate model on training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-50"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">trainLabels</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-51"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-52"> </div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-53"><span class="crayon-p"># evaluate model on test dataset dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671f8265622606-54"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-v">testX</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">testLabels</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca631671f8265622606-55"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>Running the example prints the skill of the model on both the training and test datasets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca631671fa783234537" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Max document length: 1380
Vocabulary size: 44277
(1800, 1380) (200, 1380)

Train Accuracy: 100.000000
Test Accuracy: 87.500000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca631671fa783234537-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671fa783234537-2">2</div><div class="crayon-num" data-line="crayon-5c0ca631671fa783234537-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671fa783234537-4">4</div><div class="crayon-num" data-line="crayon-5c0ca631671fa783234537-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca631671fa783234537-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca631671fa783234537-1">Max document length: 1380</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671fa783234537-2">Vocabulary size: 44277</div><div class="crayon-line" id="crayon-5c0ca631671fa783234537-3">(1800, 1380) (200, 1380)</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671fa783234537-4"> </div><div class="crayon-line" id="crayon-5c0ca631671fa783234537-5">Train Accuracy: 100.000000</div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca631671fa783234537-6">Test Accuracy: 87.500000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that, as expected, the skill on the training dataset is excellent, here at 100% accuracy.</p>
<p>We can also see that the skill of the model on the unseen test dataset is also very impressive, achieving 87.5%, which is above the skill of the model reported in the 2014 paper (although not a direct apples-to-apples comparison).</p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Different n-grams</strong>. Explore the model by changing the kernel size (number of n-grams) used by the channels in the model to see how it impacts model skill.</li>
<li><strong>More or Fewer Channels</strong>. Explore using more or fewer channels in the model and see how it impacts model skill.</li>
<li><strong>Deeper Network</strong>. Convolutional neural networks perform better in computer vision when they are deeper. Explore using deeper models here and see how it impacts model skill.</li>
</ul>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://arxiv.org/abs/1408.5882">Convolutional Neural Networks for Sentence Classification</a>, 2014.</li>
<li><a href="https://github.com/yoonkim/CNN_sentence">Convolutional Neural Networks for Sentence Classification (code)</a>.</li>
<li><a href="https://keras.io/getting-started/functional-api-guide/">Keras Functional API</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop a multichannel convolutional neural network for sentiment prediction on text movie review data.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to prepare movie review text data for modeling.</li>
<li>How to develop a multichannel convolutional neural network for text in Keras.</li>
<li>How to evaluate a fit model on unseen movie review data.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-4586 post simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+an+N-gram+Multichannel+Convolutional+Neural+Network+for+Sentiment+Analysis&amp;url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" rel="nofollow">
<span class="icon"><svg viewbox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h72v72H0z" fill="none"></path><path class="icon" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z" fill="#fff"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
<button class="ssb_fbshare-icon" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank">
<span class="icon"><svg class="_1pbq" color="#ffffff" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z" fill="#ffffff" fill-rule="evenodd"></path></svg></span>
<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"> <svg enable-background="new -301.4 387.5 15 14.1" height="14.1px" id="Layer_1" version="1.1" viewbox="-301.4 387.5 15 14.1" width="15px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g id="XMLID_398_"> <path d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z" fill="#FFFFFF" id="XMLID_399_"></path> <path d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z" fill="#FFFFFF" id="XMLID_400_"></path> <path d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z" fill="#FFFFFF" id="XMLID_401_"></path> </g> </svg> </span>
<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
<span class="icon"><svg class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_" height="18px" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="-10 -6 60 36" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
<span class="simplesocialtxt">Google Plus </span></button>
</div>
</section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop a Neural Machine Translation System from Scratch</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/generate-test-datasets-python-scikit-learn/" rel="next">How to Generate Test Datasets in Python with scikit-learn <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">100 Responses to <em>How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-426313">
<div class="comment-container" id="li-comment-426313">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b9b1cfed1408b16d19c2e4f1a8c29a8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b9b1cfed1408b16d19c2e4f1a8c29a8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hitkul</span>
<span class="date">January 12, 2018 at 5:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426313" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi<br/>
Great article<br/>
I think there is a small error, According to this code trainLines would be a list of list, where each list holds tokens for one review. But all the functions to which trainLines is passed(i.e texts_to_sequences, fit_on_texts, max_length) takes a list of strings as input. I think all the lists in trainX and testX should be converted to strings before dumping them into a file.</p>
<div class="reply">
<a aria-label="Reply to Hitkul" class="comment-reply-link" href="#comment-426313" onclick='return addComment.moveForm( "comment-426313", "426313", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426361">
<div class="comment-container" id="li-comment-426361">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426361" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The list of tokens is turned back into a string:</p>
<pre>
tokens = ' '.join(tokens)
</pre>
<pre></pre>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426361" onclick='return addComment.moveForm( "comment-426361", "426361", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426320">
<div class="comment-container" id="li-comment-426320">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a7f62cd07e0e6772893ea43d2ce91cfc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a7f62cd07e0e6772893ea43d2ce91cfc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://virostatiq.com" rel="external nofollow">Marko Plahuta</a></span>
<span class="date">January 12, 2018 at 6:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426320" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
thanks for the article. Would it be possible to use only one input and one embedding layer, and branch into convolutions after that?</p>
<div class="reply">
<a aria-label="Reply to Marko Plahuta" class="comment-reply-link" href="#comment-426320" onclick='return addComment.moveForm( "comment-426320", "426320", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426364">
<div class="comment-container" id="li-comment-426364">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426364" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How would that work?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426364" onclick='return addComment.moveForm( "comment-426364", "426364", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-427585">
<div class="comment-container" id="li-comment-427585">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fd198fa6754174efe5a06c337c678587?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fd198fa6754174efe5a06c337c678587?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Francesco</span>
<span class="date">January 25, 2018 at 9:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427585" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Wouldn’t the model below be exactly the same? (with just one input, used in the three channels?) Of course, if we also had a single embedding (put the embedding before the channels, and let all convs act on that one) the model would be different.</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca6316972c428132689" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def define_model(length, vocab_size):
	inputs = Input(shape=(length,))
	# channel 1
	embedding1 = Embedding(vocab_size, 100)(inputs)
	conv1 = Conv1D(filters=32, kernel_size=4, activation='relu')(embedding1)
	drop1 = Dropout(0.5)(conv1)
	pool1 = MaxPooling1D(pool_size=2)(drop1)
	flat1 = Flatten()(pool1)
	# channel 2
	embedding2 = Embedding(vocab_size, 100)(inputs)
	conv2 = Conv1D(filters=32, kernel_size=6, activation='relu')(embedding2)
	drop2 = Dropout(0.5)(conv2)
	pool2 = MaxPooling1D(pool_size=2)(drop2)
	flat2 = Flatten()(pool2)
	# channel 3
	embedding3 = Embedding(vocab_size, 100)(inputs)
	conv3 = Conv1D(filters=32, kernel_size=8, activation='relu')(embedding3)
	drop3 = Dropout(0.5)(conv3)
	pool3 = MaxPooling1D(pool_size=2)(drop3)
	flat3 = Flatten()(pool3)
	# merge
	merged = concatenate([flat1, flat2, flat3])
	# interpretation
	dense1 = Dense(10, activation='relu')(merged)
	outputs = Dense(1, activation='sigmoid')(dense1)
	model = Model(inputs=[inputs], outputs=outputs)
	# compile
	model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
	# summarize
	print(model.summary())
	plot_model(model, show_shapes=True, to_file='multichannel.png')
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-2">2</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-4">4</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-6">6</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-8">8</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-10">10</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-12">12</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-14">14</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-16">16</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-18">18</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-20">20</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-22">22</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-24">24</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-26">26</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-28">28</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-30">30</div><div class="crayon-num" data-line="crayon-5c0ca6316972c428132689-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca6316972c428132689-32">32</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca6316972c428132689-1"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-2"><span class="crayon-h"> </span><span class="crayon-v">inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-3"><span class="crayon-h"> </span><span class="crayon-p"># channel 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-4"><span class="crayon-h"> </span><span class="crayon-v">embedding1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-5"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-6"><span class="crayon-h"> </span><span class="crayon-v">drop1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-7"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-8"><span class="crayon-h"> </span><span class="crayon-v">flat1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-9"><span class="crayon-h"> </span><span class="crayon-p"># channel 2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-10"><span class="crayon-h"> </span><span class="crayon-v">embedding2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-11"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-12"><span class="crayon-h"> </span><span class="crayon-v">drop2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-13"><span class="crayon-h"> </span><span class="crayon-v">pool2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-14"><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-15"><span class="crayon-h"> </span><span class="crayon-p"># channel 3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-16"><span class="crayon-h"> </span><span class="crayon-v">embedding3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-17"><span class="crayon-h"> </span><span class="crayon-v">conv3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-18"><span class="crayon-h"> </span><span class="crayon-v">drop3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-19"><span class="crayon-h"> </span><span class="crayon-v">pool3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-20"><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-21"><span class="crayon-h"> </span><span class="crayon-p"># merge</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-22"><span class="crayon-h"> </span><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">flat1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-23"><span class="crayon-h"> </span><span class="crayon-p"># interpretation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-24"><span class="crayon-h"> </span><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-25"><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-26"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-27"><span class="crayon-h"> </span><span class="crayon-p"># compile</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-28"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-29"><span class="crayon-h"> </span><span class="crayon-p"># summarize</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-30"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c0ca6316972c428132689-31"><span class="crayon-h"> </span><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'multichannel.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca6316972c428132689-32"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0024 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Francesco" class="comment-reply-link" href="#comment-427585" onclick='return addComment.moveForm( "comment-427585", "427585", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-427613">
<div class="comment-container" id="li-comment-427613">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 26, 2018 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427613" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, nice approach.</p>
<p>How does it compare regarding training/prediction?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427613" onclick='return addComment.moveForm( "comment-427613", "427613", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426332">
<div class="comment-container" id="li-comment-426332">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ecbb83d7b327d05417eca640b27d9192?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ecbb83d7b327d05417eca640b27d9192?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adnan ÖNCEVARLIK</span>
<span class="date">January 13, 2018 at 12:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426332" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
Thank you for your effort and good clean article.</p>
<div class="reply">
<a aria-label="Reply to Adnan ÖNCEVARLIK" class="comment-reply-link" href="#comment-426332" onclick='return addComment.moveForm( "comment-426332", "426332", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426370">
<div class="comment-container" id="li-comment-426370">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426370" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426370" onclick='return addComment.moveForm( "comment-426370", "426370", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426452">
<div class="comment-container" id="li-comment-426452">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/505e29b02a2e4cc905ab2e901e6057f2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/505e29b02a2e4cc905ab2e901e6057f2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sébastien</span>
<span class="date">January 14, 2018 at 3:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426452" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>FYI, the link to the review polarity dataset is wrong. The correct one is: <a href="https://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz" rel="nofollow">https://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz</a></p>
<div class="reply">
<a aria-label="Reply to Sébastien" class="comment-reply-link" href="#comment-426452" onclick='return addComment.moveForm( "comment-426452", "426452", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426480">
<div class="comment-container" id="li-comment-426480">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426480" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fixed, thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426480" onclick='return addComment.moveForm( "comment-426480", "426480", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426454">
<div class="comment-container" id="li-comment-426454">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.phexum.com" rel="external nofollow">Ahmet</a></span>
<span class="date">January 14, 2018 at 3:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426454" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for your this beautiful work. I want to ask you that we are able to evaluate the accuracy of the model but how can we predict the classes of tested documents to analyze results in detail. In a Sequential model we can perform it like model.predict_classes(x_test). However for the Model(inputs=…) object predict_classes feature is not supported. Do you have a suggestion?<br/>
Thanks.</p>
<div class="reply">
<a aria-label="Reply to Ahmet" class="comment-reply-link" href="#comment-426454" onclick='return addComment.moveForm( "comment-426454", "426454", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426481">
<div class="comment-container" id="li-comment-426481">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426481" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the document must be provided in an array 3 times.</p>
<p>yhat = model.predict([doc, doc, doc])</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426481" onclick='return addComment.moveForm( "comment-426481", "426481", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-426495">
<div class="comment-container" id="li-comment-426495">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ahmet</span>
<span class="date">January 14, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426495" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes I also tried like that but I am not sure how to interpret the probabilities for multiclass classification.</p>
<div class="reply">
<a aria-label="Reply to ahmet" class="comment-reply-link" href="#comment-426495" onclick='return addComment.moveForm( "comment-426495", "426495", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-426578">
<div class="comment-container" id="li-comment-426578">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426578" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426578" onclick='return addComment.moveForm( "comment-426578", "426578", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-426615">
<div class="comment-container" id="li-comment-426615">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ahmet</span>
<span class="date">January 15, 2018 at 7:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426615" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for interest, Jason.<br/>
I am actually trying to apply your post for a multiclass case (0:negative,1:neutral,2:positive). After training part I want to compare the accuracy rates for each class to measure the how model is accurate in detail. Then I want to calculate the Precision and Recall. However, I can not use predict_classes() function in Model() object it is just allowed for Sequential() object. When I prefer the fuction model.predict([test_doc, test_doc, test_doc]) it gives me some probabilities below but I am not sure how to map them to class labels (0,1,2).</p>
<p>[0.03045881]<br/>
 [0.39043367]<br/>
 [0.01636862]<br/>
 …<br/>
 [0.7408592 ]<br/>
 [0.17758404]<br/>
 [0.21271853]</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-426650">
<div class="comment-container" id="li-comment-426650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use argmax on the result from predict() to get a class index.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426459">
<div class="comment-container" id="li-comment-426459">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">January 14, 2018 at 4:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426459" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have tried similar architectures and came to the conclusion that this type of architecture (with parallel paths) are not good because when the error is back propagated  one of the good paths ,that would be learning in the right way, will be affected by a bad path that will increase tha global error. So one good path would be in the right way but it will think it is a bad learning because the global error will increase . (is this ideia right ? ) </p>
<p>whe I have “parallel layers” I have to find a way to pretrain before … and the freeze the values and add this layers to the model.</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="#comment-426459" onclick='return addComment.moveForm( "comment-426459", "426459", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426483">
<div class="comment-container" id="li-comment-426483">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426483" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps it depends on the dataset and models involved.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426483" onclick='return addComment.moveForm( "comment-426483", "426483", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-426487">
<div class="comment-container" id="li-comment-426487">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">January 14, 2018 at 6:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426487" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There are some types of backprop that work with different learning rates for each connection and with this mitigate better the error on each connection … maybe this can help on “concurrent paths” during learning .  here is one type of bprop like this : <a href="https://en.wikipedia.org/wiki/Rprop" rel="nofollow">https://en.wikipedia.org/wiki/Rprop</a></p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="#comment-426487" onclick='return addComment.moveForm( "comment-426487", "426487", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-426574">
<div class="comment-container" id="li-comment-426574">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426574" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I recommend Adam:<br/>
<a href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/" rel="nofollow">https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426574" onclick='return addComment.moveForm( "comment-426574", "426574", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426524">
<div class="comment-container" id="li-comment-426524">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/405ca9f94a2b3ee2ad49a79479aebd26?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/405ca9f94a2b3ee2ad49a79479aebd26?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JP Raymond</span>
<span class="date">January 14, 2018 at 12:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426524" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The architecture described in Yoon Kim’s paper:<br/>
– has one embedding layer (not one for each branch),<br/>
– uses global (max-over-time) pooling (not with a pool of size 2),<br/>
– applies dropout once, on the concatenation of the max features (not in each branch before the pooling operation).</p>
<p>Do the changes proposed here yield a better predictive performance?</p>
<div class="reply">
<a aria-label="Reply to JP Raymond" class="comment-reply-link" href="#comment-426524" onclick='return addComment.moveForm( "comment-426524", "426524", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426582">
<div class="comment-container" id="li-comment-426582">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426582" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice!</p>
<p>No idea, why not compare?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426582" onclick='return addComment.moveForm( "comment-426582", "426582", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426769">
<div class="comment-container" id="li-comment-426769">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ad8be962bb1b656bcc1439c3a8157de4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ad8be962bb1b656bcc1439c3a8157de4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dev</span>
<span class="date">January 18, 2018 at 3:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426769" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this article. Very helpful.</p>
<p>I am facing an issue with the output, like getting different results everytime when I run the same model. The loss and accuracy are also changing all the time. </p>
<p>Any thoughts on this ?</p>
<div class="reply">
<a aria-label="Reply to Dev" class="comment-reply-link" href="#comment-426769" onclick='return addComment.moveForm( "comment-426769", "426769", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426809">
<div class="comment-container" id="li-comment-426809">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 18, 2018 at 10:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426809" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Machine learning algorithms are stochastic by design. This is a feature, not a bug. Learn more here:<br/>
<a href="https://machinelearningmastery.com/randomness-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/randomness-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-426809" onclick='return addComment.moveForm( "comment-426809", "426809", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427041">
<div class="comment-container" id="li-comment-427041">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63c15cacf138927083b3ced57fcd061c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63c15cacf138927083b3ced57fcd061c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ramzy</span>
<span class="date">January 21, 2018 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427041" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the great tutorial, I performed all the steps and in the last step when I tried to evaluate the model, I got the below results!</p>
<p>Train Accuracy: 50.000000<br/>
Test Accuracy: 50.000000<br/>
What does this mean! I think this is not logical.</p>
<p>Also I got some warning like the below while running the evaluation code.</p>
<p>2018-01-20 22:21:41.333198: W c:\tf_jenkins\home\workspace\release-win\m\windows<br/>
\py\36\tensorflow\core\platform\cpu_feature_guard.cc:45] The TensorFlow library<br/>
wasn’t compiled to use AVX2 instructions, but these are available on your machin<br/>
e and could speed up CPU computations.<br/>
2018-01-20 22:21:41.333808: W c:\tf_jenkins\home\workspace\release-win\m\windows<br/>
\py\36\tensorflow\core\platform\cpu_feature_guard.cc:45] The TensorFlow library<br/>
wasn’t compiled to use FMA instructions, but these are available on your machine<br/>
 and could speed up CPU computations.</p>
<p>I’ll appreciate your reply. Thanks in advance</p>
<div class="reply">
<a aria-label="Reply to Ramzy" class="comment-reply-link" href="#comment-427041" onclick='return addComment.moveForm( "comment-427041", "427041", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427059">
<div class="comment-container" id="li-comment-427059">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2018 at 9:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427059" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ignore those warnings.</p>
<p>Perhaps try running the code a second time given the stochastic nature of the algorithm.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427059" onclick='return addComment.moveForm( "comment-427059", "427059", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-427471">
<div class="comment-container" id="li-comment-427471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63c15cacf138927083b3ced57fcd061c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63c15cacf138927083b3ced57fcd061c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ramzy</span>
<span class="date">January 24, 2018 at 8:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry sir, I didn’t get a notification that you replied to me.<br/>
Could you please tell me what you meant by running the code given the stochastic nature of the algorithm. Thanks in advance.</p>
<div class="reply">
<a aria-label="Reply to Ramzy" class="comment-reply-link" href="#comment-427471" onclick='return addComment.moveForm( "comment-427471", "427471", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-427529">
<div class="comment-container" id="li-comment-427529">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 25, 2018 at 5:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427529" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, see this post:<br/>
<a href="https://machinelearningmastery.com/randomness-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/randomness-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427529" onclick='return addComment.moveForm( "comment-427529", "427529", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427446">
<div class="comment-container" id="li-comment-427446">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aa2960e53239a2ef4fc1ea0906e1d089?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aa2960e53239a2ef4fc1ea0906e1d089?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mahfuza</span>
<span class="date">January 24, 2018 at 11:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427446" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, First of all thank you so much for the article. </p>
<p>I tried to utilize the multichannel concept in a different way. I am working with relation extraction in natural language where relations are marked already but needs to figure out whether or not there is a valid sentence structure in between those entities. I am thinking to get different representations of a same sentence. For an example sentence (Paris is the capital of France), the real words of the sentence (Paris, is, the, capital, of, France) as first channel’s data, the POS tags of those same tokens (propn, verb, det, noun, adp, propn) as second channel’s data and, dependency tree tags (nsubj, root, det, attr, prep, pobj) as third channel’s data.</p>
<p>I am confused whether I need to encode all the words, pos tags, and dep tags thinking them as a part of the same vocabulary? Or I need to encode those different tokens/representations in their own vocabulary scope? </p>
<p>Regards</p>
<div class="reply">
<a aria-label="Reply to Mahfuza" class="comment-reply-link" href="#comment-427446" onclick='return addComment.moveForm( "comment-427446", "427446", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427460">
<div class="comment-container" id="li-comment-427460">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 24, 2018 at 4:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427460" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting approach.</p>
<p>I guess you could try a few different representations and test whether there is any impact on model skill?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427460" onclick='return addComment.moveForm( "comment-427460", "427460", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427527">
<div class="comment-container" id="li-comment-427527">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aa2960e53239a2ef4fc1ea0906e1d089?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aa2960e53239a2ef4fc1ea0906e1d089?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mahfuza</span>
<span class="date">January 25, 2018 at 5:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427527" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Actually I am confused on the text to integer encoding step. I mean, should I consider all the different representations of the same sentence as a single list of documents? For example lets say I got three different representations of the sentence “Paris is the capital of France” and collected them in a single document list like below – </p>
<p>all_docs = [[Paris is the capital of France]…, [propn verb det noun adp propn]…, [nsubj root det attr prep pobj]…]</p>
<p>Now if I fit the tokenizer like tokenizer.fit_on_texts(all_docs) into these documents then all the tokens are having different unique integers, right? Is it then valuable if I feed those three encoded representations separately into different channels like input1 = [ints of tokens], input2 = [more ints of tokens], input3 = [some ints of tokens]?</p>
<p>OR</p>
<p>I should consider fitting the tokenizer in three different representations separately and then encode them separately based on the fitted tokenizer. I think the tokenizer would provide some common integers then. Because the encoding scopes are isolated. Will that help in the concatenated layer some how?</p>
<p>Thanks again Jason for your reply and effort for this blog.</p>
<div class="reply">
<a aria-label="Reply to Mahfuza" class="comment-reply-link" href="#comment-427527" onclick='return addComment.moveForm( "comment-427527", "427527", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427538">
<div class="comment-container" id="li-comment-427538">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 25, 2018 at 5:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427538" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this would be a good place to start to get a handle on data prep:<br/>
<a href="https://machinelearningmastery.com/start-here/#nlp" rel="nofollow">https://machinelearningmastery.com/start-here/#nlp</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427538" onclick='return addComment.moveForm( "comment-427538", "427538", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-427586">
<div class="comment-container" id="li-comment-427586">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fd198fa6754174efe5a06c337c678587?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fd198fa6754174efe5a06c337c678587?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Francesco</span>
<span class="date">January 25, 2018 at 9:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427586" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>would it be possible, looking at the activation patterns, to identify the n-ngrams that mostly affected the classification? With pictures it is possible, but I suppose that with text it should be very difficult, with the embedding inbetween…</p>
<p>Thanks<br/>
Francesco</p>
<div class="reply">
<a aria-label="Reply to Francesco" class="comment-reply-link" href="#comment-427586" onclick='return addComment.moveForm( "comment-427586", "427586", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427614">
<div class="comment-container" id="li-comment-427614">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 26, 2018 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427614" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may be, but some hard thinking and development would be required. It’s not obvious sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-427614" onclick='return addComment.moveForm( "comment-427614", "427614", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-428104">
<div class="comment-container" id="li-comment-428104">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8821bfcd78e8a2f6363bd6451864577b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8821bfcd78e8a2f6363bd6451864577b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Massa</span>
<span class="date">February 1, 2018 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-428104" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, </p>
<p>Thank you for this neat article! 🙂 </p>
<p>I am facing an issue. </p>
<p>AttributeError: ‘int’ object has no attribute ‘ndim’<br/>
in model.fit</p>
<div class="reply">
<a aria-label="Reply to Massa" class="comment-reply-link" href="#comment-428104" onclick='return addComment.moveForm( "comment-428104", "428104", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-428165">
<div class="comment-container" id="li-comment-428165">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 2, 2018 at 8:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-428165" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Did you try coping all of the code from the final example?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428165" onclick='return addComment.moveForm( "comment-428165", "428165", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-428879">
<div class="comment-container" id="li-comment-428879">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ce9f24db7234a8aea17e01c8d2244ece?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ce9f24db7234a8aea17e01c8d2244ece?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mia</span>
<span class="date">February 9, 2018 at 5:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-428879" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I also had the same issue. The reason is that variable  is a list object while Keras expects a numpy array. I solved the problem by importing numpy and inserting “trainLabels = numpy.array(trainLabels)”</p>
<div class="reply">
<a aria-label="Reply to Mia" class="comment-reply-link" href="#comment-428879" onclick='return addComment.moveForm( "comment-428879", "428879", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-428880">
<div class="comment-container" id="li-comment-428880">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ce9f24db7234a8aea17e01c8d2244ece?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ce9f24db7234a8aea17e01c8d2244ece?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mia</span>
<span class="date">February 9, 2018 at 5:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-428880" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i mean variable trainLabels .</p>
<div class="reply">
<a aria-label="Reply to Mia" class="comment-reply-link" href="#comment-428880" onclick='return addComment.moveForm( "comment-428880", "428880", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-429408">
<div class="comment-container" id="li-comment-429408">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 14, 2018 at 11:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-429408" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have update the example to correct this issue. </p>
<p>It seems to be a change in Keras 2.1.3.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-429408" onclick='return addComment.moveForm( "comment-429408", "429408", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-428393">
<div class="comment-container" id="li-comment-428393">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/30958cc5e9d7805e827b6bb631e4a466?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/30958cc5e9d7805e827b6bb631e4a466?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JanneK</span>
<span class="date">February 5, 2018 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-428393" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank for this useful post Jason. It’s interesting that even such a minimalistic preprocessing always seem to work fine. When doing text classification (or regression) tasks, do you generally see any value in keeping/including additional information during preprocessing, such as:</p>
<p>(1) Basic sentence-separating punctuations, such as “.”, “!” and “?”<br/>
(2) Paragraph separators between groups of sentences<br/>
(3) POS tag augmented tokens, e.g., “walking” –&gt; “walking_VERB”, “apple” –&gt; “apple_NOUN”</p>
<p>Do these typically have any significant impact?</p>
<div class="reply">
<a aria-label="Reply to JanneK" class="comment-reply-link" href="#comment-428393" onclick='return addComment.moveForm( "comment-428393", "428393", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-428414">
<div class="comment-container" id="li-comment-428414">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 5, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-428414" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It really depends on the application I’m afraid.</p>
<p>For simple classification like tasks, often simpler representations result in better model skill.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-428414" onclick='return addComment.moveForm( "comment-428414", "428414", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-428632">
<div class="comment-container" id="li-comment-428632">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/130d234a6bf32b89ac48641945cc1cc3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/130d234a6bf32b89ac48641945cc1cc3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jason H</span>
<span class="date">February 7, 2018 at 7:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-428632" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You should be able to comment out inputs2, embedding2, inputs3 and embedding3, and then feed embedding1 to conv2 and conv3, right? Then you go from [x_in, x_in, x_in] to just x_in for fit(), and predict().</p>
<div class="reply">
<a aria-label="Reply to Jason H" class="comment-reply-link" href="#comment-428632" onclick='return addComment.moveForm( "comment-428632", "428632", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-429463">
<div class="comment-container" id="li-comment-429463">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1b3b04ffee3cfc4f6395f3127d36304b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1b3b04ffee3cfc4f6395f3127d36304b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Franco Arda</span>
<span class="date">February 14, 2018 at 7:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-429463" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>In your NLP book (Chapter 16), you cover n-gram CNN in depth. LSTM’s memory mimic n-grams.</p>
<p>May I ask you why you not use a LSTM classification instead?</p>
<p>Thanks!<br/>
Franco</p>
<div class="reply">
<a aria-label="Reply to Franco Arda" class="comment-reply-link" href="#comment-429463" onclick='return addComment.moveForm( "comment-429463", "429463", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-429541">
<div class="comment-container" id="li-comment-429541">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 15, 2018 at 8:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-429541" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use LSTMs, here I was demonstrating how to do it with CNNs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-429541" onclick='return addComment.moveForm( "comment-429541", "429541", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-429614">
<div class="comment-container" id="li-comment-429614">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1b3b04ffee3cfc4f6395f3127d36304b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1b3b04ffee3cfc4f6395f3127d36304b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Franco</span>
<span class="date">February 15, 2018 at 8:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-429614" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason! </p>
<p>Indeed, you have a NLP sample in your LSTM book.</p>
<div class="reply">
<a aria-label="Reply to Franco" class="comment-reply-link" href="#comment-429614" onclick='return addComment.moveForm( "comment-429614", "429614", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-430067">
<div class="comment-container" id="li-comment-430067">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4b94ef685fd6ef274d3e9ad3d65bc60d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4b94ef685fd6ef274d3e9ad3d65bc60d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Boris</span>
<span class="date">February 21, 2018 at 2:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-430067" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for yet another amazing post. Apart from purely educational purposes, what do you think would be the differences between using LSTM and CNN in sentiment analysis? Are both approaches completely interchangeable or each of the models might hold advantages/limitations in different setups.</p>
<p>Best,<br/>
Boris</p>
<div class="reply">
<a aria-label="Reply to Boris" class="comment-reply-link" href="#comment-430067" onclick='return addComment.moveForm( "comment-430067", "430067", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-430107">
<div class="comment-container" id="li-comment-430107">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 21, 2018 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-430107" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>CNN seems to achieve state of the art results. I would start there.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-433112">
<div class="comment-container" id="li-comment-433112">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2e01b90e4b5c312953ed0a883e336f00?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2e01b90e4b5c312953ed0a883e336f00?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Satheesh</span>
<span class="date">March 24, 2018 at 10:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-433112" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can we apply this approach to multi class problems? The only change is during fitting and using ‘categorical cross entropy” as loss.Am I correct</p>
<div class="reply">
<a aria-label="Reply to Satheesh" class="comment-reply-link" href="#comment-433112" onclick='return addComment.moveForm( "comment-433112", "433112", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-433149">
<div class="comment-container" id="li-comment-433149">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 25, 2018 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-433149" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-433149" onclick='return addComment.moveForm( "comment-433149", "433149", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-436650">
<div class="comment-container" id="li-comment-436650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4b0913197c442cdb471526bef6737473?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4b0913197c442cdb471526bef6737473?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Marwa</span>
<span class="date">May 5, 2018 at 3:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-436650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I am  beginner on keras and CNN ,I want to know How to give multinputs  to train_test_split?</p>
<p>my example:(Xtrain_user,Xtrain_item,Xtest_user,Xtest_item),y_train,y_test=train_test_split((user_reviews,<br/>
item_reviews),rating , test_size=0.2, random_state=42)</p>
<p>which X=  (user_reviews,item_reviews)<br/>
and Y=rating</p>
<div class="reply">
<a aria-label="Reply to Marwa" class="comment-reply-link" href="#comment-436650" onclick='return addComment.moveForm( "comment-436650", "436650", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-436671">
<div class="comment-container" id="li-comment-436671">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 5, 2018 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-436671" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps split the data manually using array notation in NumPy:<br/>
<a href="https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/" rel="nofollow">https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436671" onclick='return addComment.moveForm( "comment-436671", "436671", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-436677">
<div class="comment-container" id="li-comment-436677">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4b0913197c442cdb471526bef6737473?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4b0913197c442cdb471526bef6737473?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Marwa</span>
<span class="date">May 5, 2018 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-436677" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>But I have a dictionnaire for user and for item ,how can I split it ?</p>
<div class="reply">
<a aria-label="Reply to Marwa" class="comment-reply-link" href="#comment-436677" onclick='return addComment.moveForm( "comment-436677", "436677", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-436722">
<div class="comment-container" id="li-comment-436722">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 6, 2018 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-436722" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps pick one axis (e.g. users) and divide a list of users in half?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-436722" onclick='return addComment.moveForm( "comment-436722", "436722", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-437224">
<div class="comment-container" id="li-comment-437224">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2e9a4d09353cf8892044031a7e62c70a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2e9a4d09353cf8892044031a7e62c70a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Junaid Akhtar</span>
<span class="date">May 11, 2018 at 3:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-437224" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all, thank you for what you did here, and generally what you do 🙂</p>
<p>I tested your code on the imdb data, got the similar results, then changed the output to 2 neurons with softmax/argmax training/testing, got marginally better results.</p>
<p>Then I switched to my own 5-class sentiment dataset, but got 98%-ish traning accuracy but  40%-ish testing accuracy, which means its over-fitting, but then read in many papers that generally in the 5-grained SST1 dataset everyone reports an accuracy of 40%-ish. With binary +/- sentiments of course everyone reaches late 80s-90s in accuracy.</p>
<p>What do you suggest to that? Or a setting I could try on top of your code.</p>
<div class="reply">
<a aria-label="Reply to Junaid Akhtar" class="comment-reply-link" href="#comment-437224" onclick='return addComment.moveForm( "comment-437224", "437224", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-437283">
<div class="comment-container" id="li-comment-437283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 12, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-437283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model architecture may require tuning to each different problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-437283" onclick='return addComment.moveForm( "comment-437283", "437283", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-439253">
<div class="comment-container" id="li-comment-439253">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4aaf14c19e90de1591572bdbad80c66b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4aaf14c19e90de1591572bdbad80c66b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ethan Schmit</span>
<span class="date">May 31, 2018 at 7:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-439253" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason ,</p>
<p>Thanks for the great article.</p>
<p>If I have more than 2 classes, e.g. positive/negative/neutral, what will my output list (trainLabels) look like? Will it be a a list containing 0’s, 1’s and 2’s or will it be a n*3 matrix, with each column containing 0’s and 1’s?</p>
<p>Thanks a lot</p>
<div class="reply">
<a aria-label="Reply to Ethan Schmit" class="comment-reply-link" href="#comment-439253" onclick='return addComment.moveForm( "comment-439253", "439253", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-439325">
<div class="comment-container" id="li-comment-439325">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 1, 2018 at 8:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-439325" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend a one hot encoding, you can learn more here:<br/>
<a href="https://machinelearningmastery.com/why-one-hot-encode-data-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/why-one-hot-encode-data-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-439325" onclick='return addComment.moveForm( "comment-439325", "439325", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-442186">
<div class="comment-container" id="li-comment-442186">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">az</span>
<span class="date">June 28, 2018 at 4:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-442186" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
i have created a network which takes two sequences of integers  (2 inputs) for one sentence (one related to word embeddings and other related to POS tags) and corresponding embedding layers and then merges them both together before applying the convolution layer. I had called it multi input model.</p>
<p>inp = Input(shape=(data.shape[1],))<br/>
 e= Embedding(vocab_size, 200, input_length=maxSeqLength, weights=[embedding_matrix], trainable=False)(inp)<br/>
 inp2 = Input(shape=(embedding_pos.shape[1],))<br/>
e1= Embedding(54, 54, input_length=maxSeqLength, weights=[embedding_matrix_pos], trainable=False)(inp2)</p>
<p>mer=concatenate([e,e1],axis=-1)</p>
<p>conv1_1 = Conv1D(filters=100, kernel_size=3)(mer)<br/>
conv1_2 = Conv1D(filters=100, kernel_size=4)(mer)</p>
<p>From this article i understood that it might be multichannel. I am confused that is multiple inputs is necessarily multichannel or multiple parallel convolution layers even on same input is multichannel? If i consider the second definition i would call my network multi-input multichannel?<br/>
Also in this case all the convolutions are applied to original input.What is the difference if i stack up convolutions so the result of one is input to another?Thanks.</p>
<div class="reply">
<a aria-label="Reply to az" class="comment-reply-link" href="#comment-442186" onclick='return addComment.moveForm( "comment-442186", "442186", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-442210">
<div class="comment-container" id="li-comment-442210">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2018 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-442210" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If the inputs are different, it might be better to have a multi-headed CNN rather than a multichannel CNN.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442210" onclick='return addComment.moveForm( "comment-442210", "442210", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-442222">
<div class="comment-container" id="li-comment-442222">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">az</span>
<span class="date">June 28, 2018 at 8:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-442222" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The inputs are sequence of the same sentence and both are padded to same length..so would it be called different inputs still? and can you please clarify  if multichannel is multi-input regardless of parallel or sequential convolutions?</p>
<div class="reply">
<a aria-label="Reply to az" class="comment-reply-link" href="#comment-442222" onclick='return addComment.moveForm( "comment-442222", "442222", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-442234">
<div class="comment-container" id="li-comment-442234">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2018 at 2:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-442234" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Each head of the model will “read” the data differently.</p>
<p>Perhaps referring to the multiple inputs to the model as “channels” was a poor choice. Different inputs as in the above model are indeed different to different channels for one input. Importantly, we can use different sized kernels and number of filters with different inputs, whereas each channel on one input is fixed to use the same kernel and number of filters.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-442234" onclick='return addComment.moveForm( "comment-442234", "442234", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-443250">
<div class="comment-container" id="li-comment-443250">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">az</span>
<span class="date">July 12, 2018 at 4:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-443250" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks alot. I understand that now that multichannel means one input with one or more embeddings for that one input.In your example you are using input multiple times but still its the same input. I have taken your advice and applied convolution of different filter size to each embedding separately instead of merging them together which has improved accuracy. Only one thing,it means it is multi input, i can understand how it can be seen as multi headed..so basically having multiple inputs makes it multiheaded?Thanks</p>
<div class="reply">
<a aria-label="Reply to az" class="comment-reply-link" href="#comment-443250" onclick='return addComment.moveForm( "comment-443250", "443250", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-443267">
<div class="comment-container" id="li-comment-443267">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-443267" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443267" onclick='return addComment.moveForm( "comment-443267", "443267", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-444570">
<div class="comment-container" id="li-comment-444570">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">az</span>
<span class="date">July 28, 2018 at 4:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-444570" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you so much! The precision and recall graphs i plotted through training epochs show sudden spikes in precision while gradual increase in recall.Though recall is higher than precision. Now my dataset has more positive samples than negative ones which lead me to believe that there is chance higher number of FN than FP i.e. lower recall and higher precision but my results are opposite. Can you please elaborate if i have the wrong understanding?</p>
<div class="reply">
<a aria-label="Reply to az" class="comment-reply-link" href="#comment-444570" onclick='return addComment.moveForm( "comment-444570", "444570", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-444574">
<div class="comment-container" id="li-comment-444574">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5fbecd15a9914622c78cbacff7ab61e9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">az</span>
<span class="date">July 28, 2018 at 4:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-444574" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>or should i see it this way that since it has more positive samples,classifier is biased towards positive class,leading to more FP and hence lower precision and higher recall?Thanks</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-444604">
<div class="comment-container" id="li-comment-444604">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 28, 2018 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-444604" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You will need to find a trade-off that makes sense for your specific application and problem.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-443238">
<div class="comment-container" id="li-comment-443238">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6c04345e968695d1f5d2ca6414867538?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6c04345e968695d1f5d2ca6414867538?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yuval</span>
<span class="date">July 11, 2018 at 11:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-443238" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I plotted precision-recall curve for both pos and neg class and found the results interesting,<br/>
While the curve for the pos class looks very good with oprtimal point at 0.9 and 0.8 for recall and precision respecitvally. The curve for the neg class is a stright line that gives 0.6 for precision and recall  or 0.8 with 0.6 and vice versa.<br/>
Any idea how this could be?</p>
<div class="reply">
<a aria-label="Reply to Yuval" class="comment-reply-link" href="#comment-443238" onclick='return addComment.moveForm( "comment-443238", "443238", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-443260">
<div class="comment-container" id="li-comment-443260">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2018 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-443260" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may suggest that one class is easier to predict than the other.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-443260" onclick='return addComment.moveForm( "comment-443260", "443260", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-444131">
<div class="comment-container" id="li-comment-444131">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">July 22, 2018 at 9:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-444131" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I did the exact thing on the tutorial but i got a lower test accuracy which is 83.5%. Traning is 100%</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-444131" onclick='return addComment.moveForm( "comment-444131", "444131", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-444171">
<div class="comment-container" id="li-comment-444171">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 23, 2018 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-444171" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could try running the example a few times to see if you get differing results.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444171" onclick='return addComment.moveForm( "comment-444171", "444171", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-445239">
<div class="comment-container" id="li-comment-445239">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">August 5, 2018 at 2:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-445239" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>(forgot to reply) Yes, actually got different results after running it a few times.</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-445239" onclick='return addComment.moveForm( "comment-445239", "445239", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-444563">
<div class="comment-container" id="li-comment-444563">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/883e5181c4d655a1a36c185753999d26?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/883e5181c4d655a1a36c185753999d26?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">andi wijaya</span>
<span class="date">July 28, 2018 at 2:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-444563" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>def max_length(lines):<br/>
	return max([len(s.split()) for s in lines])<br/>
I just copy and paste the code and have this error, I believe that code is actually right, I dont know why I got an error<br/>
AttributeError: ‘list’ object has no attribute ‘split’</p>
<p>Environment<br/>
Python 3.6<br/>
Tensorflow 1.9<br/>
Keras 2.2</p>
<div class="reply">
<a aria-label="Reply to andi wijaya" class="comment-reply-link" href="#comment-444563" onclick='return addComment.moveForm( "comment-444563", "444563", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-444600">
<div class="comment-container" id="li-comment-444600">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 28, 2018 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-444600" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ensure the indenting is correct and that you have all of the surrounding code and data.</p>
<p>I have more suggestions here:<br/>
<a href="https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/why-does-the-code-in-the-tutorial-not-work-for-me</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-444600" onclick='return addComment.moveForm( "comment-444600", "444600", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-445230">
<div class="comment-container" id="li-comment-445230">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">August 4, 2018 at 11:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-445230" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a question on the “Plot of the Multichannel Convolutional Neural Network For Text”.<br/>
Why is there always a “none” per box? What does it denote to?</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-445230" onclick='return addComment.moveForm( "comment-445230", "445230", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-445235">
<div class="comment-container" id="li-comment-445235">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">August 5, 2018 at 2:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-445235" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Found the answer: The None dimension in the shape tuple refers to the batch dimension which simply means that the layer can accept input of any size.</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-445235" onclick='return addComment.moveForm( "comment-445235", "445235", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-445263">
<div class="comment-container" id="li-comment-445263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 5, 2018 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-445263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445263" onclick='return addComment.moveForm( "comment-445263", "445263", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-445261">
<div class="comment-container" id="li-comment-445261">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 5, 2018 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-445261" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question! </p>
<p>“None” refers to a dimension that is not specified, and in turn is variable.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445261" onclick='return addComment.moveForm( "comment-445261", "445261", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-445240">
<div class="comment-container" id="li-comment-445240">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">August 5, 2018 at 2:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-445240" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a question. Based on this paper, <a href="https://arxiv.org/pdf/1510.03820.pdf" rel="nofollow">https://arxiv.org/pdf/1510.03820.pdf</a> (A Sensitivity Analysis of (and Practitioners’ Guide to) Convolutional Neural Networks for Sentence Classification), they stated “we set the number of feature maps for this region size to 100”. How do i set the number of feature maps? Is the number of feature maps based on the number of filters per region size?</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-445240" onclick='return addComment.moveForm( "comment-445240", "445240", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-445266">
<div class="comment-container" id="li-comment-445266">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 5, 2018 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-445266" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The number of feature maps is the first argument to the convolutional layer Conv1D().</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-445266" onclick='return addComment.moveForm( "comment-445266", "445266", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-446264">
<div class="comment-container" id="li-comment-446264">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">August 17, 2018 at 1:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446264" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I really got lots of questions sorry xD.</p>
<p>What’s an intuitive way of understanding how this multi-channeled CNN (or perhaps a basic CNN architecture in general) identify the following (given that the sentiment expressed are only positive or negative):<br/>
1.)  If more than one sentiment is expressed in the tweet but the positive sentiment is more dominant, then it is a positive tweet, or<br/>
2.)  If more than one sentiment is expressed in the tweet but the negative sentiment is more dominant, then it is a negative tweet.</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-446264" onclick='return addComment.moveForm( "comment-446264", "446264", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-446290">
<div class="comment-container" id="li-comment-446290">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2018 at 6:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446290" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We cannot know what the CNN has learned, only the evaluation of the model performance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446290" onclick='return addComment.moveForm( "comment-446290", "446290", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-446342">
<div class="comment-container" id="li-comment-446342">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">August 17, 2018 at 3:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446342" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What I’m trying to understand here is how CNN is applied to sentence classification. I still don’t get the idea. What i know is CNN when it comes to computer vision, it finds features of pictures. For example a dog with features such ears, nose and eyes.</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-446342" onclick='return addComment.moveForm( "comment-446342", "446342", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-446344">
<div class="comment-container" id="li-comment-446344">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fca5c1336412f6babdbf835e62cc4bb3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zenon Uchida</span>
<span class="date">August 17, 2018 at 4:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446344" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think i got.<br/>
In convolutional neural networks every network layer acts as a detection filter for the presence of specific features present in the original data. The first layer in a CNN detect (large) features that can be recognized and interpreted relatively easy. Subsequent layers detect increasingly (smaller) features that are more abstract. The last layer of the CNN is able to make an ultra-specific classification by combining all the specific features detected by the previous layers in the input data.</p>
<div class="reply">
<a aria-label="Reply to Zenon Uchida" class="comment-reply-link" href="#comment-446344" onclick='return addComment.moveForm( "comment-446344", "446344", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-446379">
<div class="comment-container" id="li-comment-446379">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2018 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446379" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try this simpler tutorial:<br/>
<a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" rel="nofollow">https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446379" onclick='return addComment.moveForm( "comment-446379", "446379", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-446431">
<div class="comment-container" id="li-comment-446431">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ishay Telavivi</span>
<span class="date">August 19, 2018 at 1:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446431" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>I have a question about the input of the model, based on an error I got.</p>
<p>I ran this code on a different data and I had no problems. Then I tried an extention with RandomizedSearchCV, as the following:</p>
<p>model = KerasClassifier(build_fn=create_model, verbose=1, epochs=3, batch_size=32)<br/>
param_dist= {“n_strides”: sp_randint(1,3)}<br/>
random_grid = RandomizedSearchCV(estimator=model, param_distributions=param_dist, n_iter = 3)<br/>
random_grid_result = random_grid.fit([X_train, X_train, X_train], y_train)</p>
<p>I got the following error:<br/>
ValueError: Found input variables with inconsistent numbers of samples: [3, 25000]</p>
<p>What may the error be? 25000 is the length of my train data</p>
<div class="reply">
<a aria-label="Reply to Ishay Telavivi" class="comment-reply-link" href="#comment-446431" onclick='return addComment.moveForm( "comment-446431", "446431", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446460">
<div class="comment-container" id="li-comment-446460">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 19, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446460" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure what is going on.</p>
<p>Perhaps post your code and error to stackoverflow?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446460" onclick='return addComment.moveForm( "comment-446460", "446460", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-446467">
<div class="comment-container" id="li-comment-446467">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ishay Telavivi</span>
<span class="date">August 19, 2018 at 7:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446467" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry for not being understood.</p>
<p>I have explored this further and found out that Keras wrapper don’t support multi input network. That was the problem (<a href="https://github.com/keras-team/keras/issues/6451" rel="nofollow">https://github.com/keras-team/keras/issues/6451</a>)</p>
<p>So I decided to use Francesco’s comment above (January 25), using one Input for all three channels and that it’s working!</p>
<div class="reply">
<a aria-label="Reply to Ishay Telavivi" class="comment-reply-link" href="#comment-446467" onclick='return addComment.moveForm( "comment-446467", "446467", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-446498">
<div class="comment-container" id="li-comment-446498">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 20, 2018 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446498" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446498" onclick='return addComment.moveForm( "comment-446498", "446498", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-446432">
<div class="comment-container" id="li-comment-446432">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ishay Telavivi</span>
<span class="date">August 19, 2018 at 1:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446432" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>I have a queation about the nagtion words.<br/>
When you clean your data with excluding stopwords, you are loosing the nagation words (‘not’ etc.).  Don’t you want to leave these words to have better interpretation of the sentence?</p>
<p>For example: “I didn’t like the movie” and “I liked the movie” would look the same after cleaning.</p>
<div class="reply">
<a aria-label="Reply to Ishay Telavivi" class="comment-reply-link" href="#comment-446432" onclick='return addComment.moveForm( "comment-446432", "446432", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-446461">
<div class="comment-container" id="li-comment-446461">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 19, 2018 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446461" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It really depends on whether they add value on the specific problem you are solving or not.</p>
<p>Perhaps try modeling with and without them?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-446461" onclick='return addComment.moveForm( "comment-446461", "446461", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-446465">
<div class="comment-container" id="li-comment-446465">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e067278cca91d37b03be0515b8fd7584?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ishay Telavivi</span>
<span class="date">August 19, 2018 at 7:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-446465" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great Thanks</p>
<div class="reply">
<a aria-label="Reply to Ishay Telavivi" class="comment-reply-link" href="#comment-446465" onclick='return addComment.moveForm( "comment-446465", "446465", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-447977">
<div class="comment-container" id="li-comment-447977">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6b4b74efd880846b20c76a35e41f9296?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6b4b74efd880846b20c76a35e41f9296?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Suleyman Suleymanzade</span>
<span class="date">September 6, 2018 at 7:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-447977" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is two neuron networks that I tried to merge by using concatenate operation. The network should classify IMDB movies reviews by 1-good and 0-bad movies<br/>
I have an error in model’s fit (training):<br/>
history = conc_model.fit([X_train, X_train], [y_train, y_train], np.reshape([y_train, y_train],(25000,2)),epochs=3, batch_size=(64,64))<br/>
TypeError: fit() got multiple values for argument ‘batch_size’.<br/>
This is the method that should return trained model. BTW x_train shape (25000, 5) and y_train shape (25000,)</p>
<p>def cnn_lstm_merged():<br/>
  embedding_vecor_length = 32<br/>
  cnn_model = Sequential()<br/>
  cnn_model.add(Embedding(top_words, embedding_vecor_length,input_length=max_review_length))<br/>
  cnn_model.add(Conv1D(filters=32, kernel_size=3, padding=’same’, activation=’relu’))<br/>
  cnn_model.add(MaxPooling1D(pool_size=2))<br/>
  cnn_model.add(Flatten())</p>
<p>  lstm_model = Sequential()<br/>
  lstm_model.add(Embedding(top_words, embedding_vecor_length,   input_length=max_review_length))<br/>
  lstm_model.add(LSTM(64, activation = ‘relu’, return_sequences=True))<br/>
  lstm_model.add(Flatten())</p>
<p>merge = Concatenate([lstm_model, cnn_model])<br/>
hidden = Dense(1, activation = ‘sigmoid’)</p>
<p>conc_model = Sequential()<br/>
conc_model.add(merge)<br/>
conc_model.add(hidden)</p>
<p>conc_model.compile(loss=’binary_crossentropy’, optimizer=’adam’, metrics=[‘accuracy’])<br/>
history = conc_model.fit([X_train, X_train], [y_train, y_train], np.reshape([y_train, y_train],(25000,2)),epochs=3, batch_size=(64,64))<br/>
return history</p>
<div class="reply">
<a aria-label="Reply to Suleyman Suleymanzade" class="comment-reply-link" href="#comment-447977" onclick='return addComment.moveForm( "comment-447977", "447977", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-448008">
<div class="comment-container" id="li-comment-448008">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 6, 2018 at 2:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-448008" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have the capacity to debug your new code, perhaps post it to stackoverflow?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-448008" onclick='return addComment.moveForm( "comment-448008", "448008", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-448781">
<div class="comment-container" id="li-comment-448781">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cd006d441aaf38e38693ef5992c76360?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cd006d441aaf38e38693ef5992c76360?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Emmanuel</span>
<span class="date">September 14, 2018 at 2:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-448781" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very Nice Tutorial!</p>
<p>I adapted your version to fit on my data saved in pandas’ dataframe. Since I have a limited data set, the evaluated score has reached to 100% which is a great improvement as compared to my previous, BOW model, 98%. </p>
<p>You can find the complete code at my github:</p>
<p><a href="https://github.com/eanunez/ArticleClassifier/blob/master/cnn/Multi-Channel%20CNN.ipynb" rel="nofollow">https://github.com/eanunez/ArticleClassifier/blob/master/cnn/Multi-Channel%20CNN.ipynb</a></p>
<p>Thank you so much Jason!</p>
<p>Kind Regards,<br/>
Emmanuel</p>
<div class="reply">
<a aria-label="Reply to Emmanuel" class="comment-reply-link" href="#comment-448781" onclick='return addComment.moveForm( "comment-448781", "448781", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-448848">
<div class="comment-container" id="li-comment-448848">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2018 at 6:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-448848" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-448848" onclick='return addComment.moveForm( "comment-448848", "448848", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-457011">
<div class="comment-container" id="li-comment-457011">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d177caa68f0359716a180310e27e8ee3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d177caa68f0359716a180310e27e8ee3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sanjie</span>
<span class="date">December 3, 2018 at 1:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-457011" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello Emmanuel,<br/>
thanks for the updated version on your github, when making multi-classes fit, you should add  the code </p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63168e88037352298" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from keras.utils import to_categorical
 if len(self.classes_) &gt; 2:
            train_y = to_categorical(train_y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63168e88037352298-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c0ca63168e88037352298-2">2</div><div class="crayon-num" data-line="crayon-5c0ca63168e88037352298-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63168e88037352298-1"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c0ca63168e88037352298-2"><span class="crayon-e"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">classes_</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c0ca63168e88037352298-3"><span class="crayon-h">            </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<p>after your code</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5c0ca63168e8f195292119" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
train_y = self.encode_classes(train_df['label'].values)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c0ca63168e8f195292119-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c0ca63168e8f195292119-1"><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">encode_classes</span><span class="crayon-sy">(</span><span class="crayon-v">train_df</span><span class="crayon-sy">[</span><span class="crayon-s">'label'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<p>Thank Jason Brownlee  again, i am really one of your fans.</p>
<div class="reply">
<a aria-label="Reply to sanjie" class="comment-reply-link" href="#comment-457011" onclick='return addComment.moveForm( "comment-457011", "457011", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-451785">
<div class="comment-container" id="li-comment-451785">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/582af59febac10c23aaa2bc4d9342dac?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/582af59febac10c23aaa2bc4d9342dac?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Astariul</span>
<span class="date">October 16, 2018 at 7:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-451785" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>My first comment on this amazing blog of yours, even though I read a lot of your article, all of them useful.</p>
<p>Anyway I have a question about MaxPooling layers : why do we need them at all ?</p>
<p>Is it just for reducing the dimension ? Because I feel that using it will make us loose some information we learned in the Convolution layer.</p>
<p>###</p>
<p>I my application I want to work with embeddings but n-grams as well. If I have the sentence ‘I like you’, I want to end up with a tensor of dimension [?, 6, d] (d is the dimension of embeddings). The tensor would represent :<br/>
‘I’<br/>
‘like’<br/>
‘you’<br/>
‘I like’<br/>
‘like you’<br/>
‘I like you’</p>
<p>So I want to use the basic embeddings for the 3 first token, and apply a 2-gram convolution layer to get the 2 next token, and finally a 3-gram convolution layer for the last token. Then I concatenate everything (choosing a kernel size adequately).</p>
<p>In this case, why would I want to apply a MaxPooling layer ?<br/>
Do you think my approach could work ?</p>
<p>Thank you and keep up the good work 🙂</p>
<div class="reply">
<a aria-label="Reply to Astariul" class="comment-reply-link" href="#comment-451785" onclick='return addComment.moveForm( "comment-451785", "451785", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-451839">
<div class="comment-container" id="li-comment-451839">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 17, 2018 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-451839" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, we use the pooling layer to distil the large feature maps down to the most essential. </p>
<p>Try with and without the pooling layer and use the model that gives the best performance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-451839" onclick='return addComment.moveForm( "comment-451839", "451839", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-452471">
<div class="comment-container" id="li-comment-452471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1b2ea406ab4a116d654d661b03476e09?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1b2ea406ab4a116d654d661b03476e09?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Prem Kumar</span>
<span class="date">October 23, 2018 at 10:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-452471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Its very much helpful for me to learn about NLP and its tasks. Thank you very much for your work.. please do the same for computer vision problems too. I can’t find a blogs like yours anywhere for computer vision problems. Please consider it..</p>
<div class="reply">
<a aria-label="Reply to Prem Kumar" class="comment-reply-link" href="#comment-452471" onclick='return addComment.moveForm( "comment-452471", "452471", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-452517">
<div class="comment-container" id="li-comment-452517">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 24, 2018 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-452517" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="#comment-452517" onclick='return addComment.moveForm( "comment-452517", "452517", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4586"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="1c17d0c5c5"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="55"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Jason Brownlee, PhD
<br/>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center><br/>
<strong>Deep Learning for NLP</strong><br/>
Develop deep learning models for text data.
<p><a href="/deep-learning-for-nlp/">Click to Get Started Now!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img alt="How to Develop a Neural Machine Translation System in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" title="How to Develop a Neural Machine Translation System from Scratch" width="45"/></a> <a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch">How to Develop a Neural Machine Translation System from Scratch</a>
<span class="meta">January 10, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img alt="Difference Between Classification and Regression in Machine Learning" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" title="Difference Between Classification and Regression in Machine Learning" width="45"/></a> <a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning">Difference Between Classification and Regression in Machine Learning</a>
<span class="meta">December 11, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img alt="So, You are Working on a Machine Learning Problem..." class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/So-You-are-Working-on-a-Machine-Learning-Problem...-150x150.jpg" title="So, You are Working on a Machine Learning Problem..." width="45"/></a> <a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem…">So, You are Working on a Machine Learning Problem…</a>
<span class="meta">April 4, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-150x150.png" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45"/></a> <a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
<span class="meta">January 12, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/04/How-to-Make-Classification-and-Regression-Predictions-for-Deep-Learning-Models-in-Keras-150x150.jpg" title="How to Make Predictions with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras">How to Make Predictions with Keras</a>
<span class="meta">April 9, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat-Sheet-150x150.jpg" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
<span class="meta">August 6, 2018</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras"><img alt="How to Visualize a Deep Learning Neural Network Model in Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/How-to-Visualize-a-Deep-Learning-Neural-Network-Model-in-Keras-150x150.jpg" title="How to Visualize a Deep Learning Neural Network Model in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/visualize-deep-learning-neural-network-model-keras/" title="How to Visualize a Deep Learning Neural Network Model in Keras">How to Visualize a Deep Learning Neural Network Model in Keras</a>
<span class="meta">December 13, 2017</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> <div class="widget_text widget widget_custom_html" id="custom_html-2"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
<li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.5" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1" type="text/javascript"></script>
</body>
</html>